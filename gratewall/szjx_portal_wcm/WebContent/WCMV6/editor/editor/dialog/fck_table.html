<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" >
<!--
 * FCKeditor - The text editor for Internet - http://www.fckeditor.net
 * Copyright (C) 2003-2007 Frederico Caldeira Knabben
 *
 * == BEGIN LICENSE ==
 *
 * Licensed under the terms of any of the following licenses at your
 * choice:
 *
 *  - GNU General Public License Version 2 or later (the "GPL")
 *    http://www.gnu.org/licenses/gpl.html
 *
 *  - GNU Lesser General Public License Version 2.1 or later (the "LGPL")
 *    http://www.gnu.org/licenses/lgpl.html
 *
 *  - Mozilla Public License Version 1.1 or later (the "MPL")
 *    http://www.mozilla.org/MPL/MPL-1.1.html
 *
 * == END LICENSE ==
 *
 * Table dialog window.
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Table Properties</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="robots" content="noindex, nofollow" />
	<script src="common/fck_dialog_common.js" type="text/javascript"></script>
	<script type="text/javascript">

var oEditor = window.parent.InnerDialogLoaded() ;

// Gets the document DOM
var oDOM = oEditor.FCK.EditorDocument ;

// Gets the table if there is one selected.
var table ;
var e = oEditor.FCKSelection.GetSelectedElement() ;

if ( ( !e && document.location.search.substr(1) == 'Parent' ) || ( e && e.tagName != 'TABLE' ) )
	e = oEditor.FCKSelection.MoveToAncestorNode( 'TABLE' ) ;

var editTable = false;
if ( e && e.tagName == "TABLE" ){
	table = e ;
	editTable = true;
}
// Fired when the window loading process is finished. It sets the fields with the
// actual values if a table is selected in the editor.
window.onload = function()
{
	// First of all, translate the dialog box texts
	oEditor.FCKLanguageManager.TranslatePage(document) ;

	if (table)
	{
		document.getElementById('txtRows').value    = table.rows.length ;
		document.getElementById('txtColumns').value = table.rows[0].cells.length ;

		// Gets the value from the Width or the Style attribute
		var iWidth  = (table.style.width  ? table.style.width  : table.width ) ;
		var iHeight = (table.style.height ? table.style.height : table.height ) ;

		if (iWidth.indexOf('%') >= 0)			// Percentual = %
		{
			iWidth = parseInt( iWidth.substr(0,iWidth.length - 1), 10 ) ;
			document.getElementById('selWidthType').value = "percent" ;
		}
		else if(iWidth!=''&&iWidth!=null)//if (iWidth.indexOf('px') >= 0)		// Style Pixel = px
		{																										  //
			iWidth = parseInt(iWidth,10);//iWidth.substr(0,iWidth.length - 2);
			document.getElementById('selWidthType').value = "pixels" ;
		}
		if (iHeight && iHeight.indexOf('px') >= 0)		// Style Pixel = px
			iHeight = iHeight.substr(0,iHeight.length - 2);
		
		document.getElementById('txtWidth').value		= iWidth ;
		document.getElementById('txtHeight').value		= iHeight ;
		document.getElementById('txtBorder').value		= table.border ;
		document.getElementById('selAlignment').value	= table.align ;
		document.getElementById('txtCellPadding').value	= table.cellPadding	;
		document.getElementById('txtCellSpacing').value	= table.cellSpacing	;
		document.getElementById('txtBorderColor').value = table.borderColor || "#000000" ;
//		document.getElementById('txtSummary').value     = table.summary;
//		document.getElementById('cmbFontStyle').value	= table.className ;

//		if (table.caption) document.getElementById('txtCaption').value = table.caption.innerHTML ;
		
		document.getElementById('txtRows').disabled    = true ;
		document.getElementById('txtColumns').disabled = true ;
	}
	
//	window.parent.SetOkButton( true ) ;	
	window.parent.SetBtnsRow(false);
	window.parent.SetAutoSize( true ) ;	
}

// Fired when the user press the OK button
function Ok()
{
	if(!editTable){
		var iRows = document.getElementById('txtRows').value ;
		var iCols = document.getElementById('txtColumns').value ;
		if(!iRows||isNaN(iRows)){
			alert('错误的输入数据:行数');
			document.getElementById('txtRows').focus();
			return false;
		}
		if(!iCols||isNaN(iCols)){
			alert('错误的输入数据:列数');
			document.getElementById('txtColumns').focus();
			return false;
		}
	}
	var validValues = ['txtWidth','txtHeight','txtBorder','txtCellPadding','txtCellSpacing'];
	var validNames = ['宽度','高度','边框','单元格填充','单元格间距'];
	for(var i=0;i<validValues.length;i++){
		var sValue = document.getElementById(validValues[i]).value;
		if(sValue!=''&&isNaN(sValue)){
			alert('错误的输入数据:'+validNames[i]);
			document.getElementById(validValues[i]).focus();
			return false;
		}
	}
	var bExists = ( table != null ) ;
	if ( ! bExists )
	{
		table = oEditor.FCK.EditorDocument.createElement( "TABLE" ) ;
	}

	// Removes the Width and Height styles
	if ( bExists && table.style.width )		table.style.width = null ; //.removeAttribute("width") ;
	if ( bExists && table.style.height )	table.style.height = null ; //.removeAttribute("height") ;
	var sWidth = document.getElementById('txtWidth').value;
	table.width			= sWidth + ((sWidth!='' && (document.getElementById('selWidthType').value == "percent")) ? "%" : "") ;
	table.height		= document.getElementById('txtHeight').value ;

	table.border		= document.getElementById('txtBorder').value ;
	table.align			= document.getElementById('selAlignment').value ;
	table.cellPadding	= document.getElementById('txtCellPadding').value ;
	table.cellSpacing	= document.getElementById('txtCellSpacing').value ;
//	table.summary       = document.getElementById('txtSummary').value ;
	table.borderColor	= document.getElementById('txtBorderColor').value || "#000000" ;
	table.style.borderCollapse = "collapse";
//	table.className		= cmbFontStyle.value ;
/*	
	if ( document.getElementById('txtCaption').value != '')
	{
		if (! table.caption) table.createCaption() ;
		table.caption.innerHTML = document.getElementById('txtCaption').value ;
	}
	else if ( bExists && table.caption )
	{
		if ( document.all )
			table.caption.innerHTML = '' ;	// TODO: It causes an IE internal error if using removeChild.
		else
			table.caption.parentNode.removeChild( table.caption ) ;
	}
*/		
	if (! bExists)
	{
		for ( var r = 0 ; r < iRows ; r++ )
		{
			var oRow = table.insertRow(-1) ;
			for ( var c = 0 ; c < iCols ; c++ )
			{
				var oCell = oRow.insertCell(-1) ;
				if ( oEditor.FCKBrowserInfo.IsGecko )
					oCell.innerHTML = '<br _moz_editor_bogus_node="TRUE">' ;
				oCell.innerHTML = "&nbsp;" ;
			}
		}
		
		oEditor.FCKUndo.SaveUndoStep() ;
		
		// START iCM MODIFICATIONS	
		// Amended to ensure that newly inserted tables are not incorrectly nested in P tags, etc
		// We insert the table first and then rectify any nestings afterwards so we can re-use the
		// FCKTablesProcessor function that corrects tables on SetHTML()
		/*
		table = oEditor.FCK.InsertElementAndGetIt( table ) ;
		if ( !oEditor.FCKConfig.UseBROnCarriageReturn )
		{
			oEditor.FCKTablesProcessor.CheckTableNesting( table ) ;
		}
		*/
		// END iCM MODIFICATIONS	
		try{
			oEditor.FCK.InsertElement( table ) ;
		}catch(err){
			var aCells = oEditor.FCKTableHandler.GetSelectedCells() ;
			if(aCells.length >=2){
//				alert('表格不支持跨多个单元格内嵌。');
				oEditor.FCKSelection.SelectNode( aCells[0] ) ;
				oEditor.FCKSelection.Collapse( false ) ;
				oEditor.FCK.InsertElement( table ) ;
			}
//			alert(oEditor.FCKSelection);
		}
	}
	
	return true ;
}

function ChooseBorderColor()
{
	return oEditor.FCKDialog.OpenDialog( 'FCKDialog_Color', oEditor.FCKLang.DlgColorTitle, 'dialog/fck_colorselector.html', 400, 330, SetColor ,window) ;
}
function SetColor(_sColor){
	txtBorderColor.value = _sColor||'#000000';
}
	</script>
<style>
body {
	background-color: #CCCCCC;
}
td{
	height:30px;
}
.input_btn{
	width:60px;
	margin-right:10px;
}
.input_text{
	border:1px solid gray;
	width:60px;
}
</style>
</head>
<body style="overflow: hidden;">
	<table id="otable" cellspacing="0" cellpadding="0" width="100%" border="0" style="height: 100%">
		<tr>
			<td valign="top">
				<table cellspacing="1" cellpadding="1" width="100%" border="0">
					<tr>
						<td valign="top" width="35%">
							<table cellspacing="0" cellpadding="0" border="0">
								<tr>
									<td>
										<span fcklang="DlgTableRows">Rows</span>:</td>
									<td>
										&nbsp;<input id="txtRows" onkeypress="return IsDigit(event);" class="input_text" type="text" maxlength="3" size="2" value="3" name="txtRows" /></td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableColumns">Columns</span>:</td>
									<td>
										&nbsp;<input id="txtColumns" class="input_text" type="text" maxlength="2" size="2" value="2" name="txtColumns"
											onkeypress="return IsDigit(event);" /></td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableWidth">Width</span>:</td>
									<td>
										&nbsp;<input id="txtWidth" class="input_text" type="text" maxlength="4" size="3" value="100" name="txtWidth"
											onkeypress="return IsDigit(event);" />
										&nbsp;<select id="selWidthType" name="selWidthType">
											<option fcklang="DlgTableWidthPx" value="pixels">pixels</option>
											<option fcklang="DlgTableWidthPc" value="percent" selected="selected">percent</option>
										</select></td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableBorder">Border size</span>:</td>
									<td>
										&nbsp;<input id="txtBorder" class="input_text" type="text" maxlength="2" size="2" value="1" name="txtBorder"
											onkeypress="return IsDigit(event);" /></td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableAlign">Alignment</span>:</td>
									<td>
										&nbsp;<select id="selAlignment" name="selAlignment">
											<option fcklang="DlgTableAlignNotSet" value="" selected="selected">&lt;Not set&gt;</option>
											<option fcklang="DlgTableAlignLeft" value="left">Left</option>
											<option fcklang="DlgTableAlignCenter" value="center">Center</option>
											<option fcklang="DlgTableAlignRight" value="right">Right</option>
										</select></td>
								</tr>
							</table>
						</td>
						<td align="left" valign="top" width="45%">
							<table cellspacing="0" cellpadding="0" border="0">
									<tr>
									<td nowrap="nowrap">
										<span fcklang="DlgTableCellSpace">Cell spacing</span>:</td>
									<td>
										&nbsp;<input id="txtCellSpacing" class="input_text" type="text" maxlength="2" size="2" value="0" name="txtCellSpacing"
											onkeypress="return IsDigit(event);" /></td>
									<td>
										&nbsp;</td>
								</tr>
								<tr>
									<td nowrap="nowrap">
										<span fcklang="DlgTableCellPad">Cell padding</span>:</td>
									<td>
										&nbsp;<input id="txtCellPadding" class="input_text" type="text" maxlength="2" size="2" value="2" name="txtCellPadding"
											onkeypress="return IsDigit(event);" /></td>
									<td>
										&nbsp;</td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableHeight">Height</span>:</td>
									<td>
										&nbsp;<input id="txtHeight" class="input_text" type="text" maxlength="4" size="3" name="txtHeight" onkeypress="return IsDigit(event);" />
										&nbsp;<span fcklang="DlgTableWidthPx">pixels</span></td>
								</tr>
								<tr>
									<td>
										<span fcklang="DlgTableBorderColor">Border Color</span>:</td>
									<td>
										&nbsp;<input id="txtBorderColor" class="input_text" type="text" value="#000000" name="txtBorderColor" />&nbsp;
										<input id="btnChooseBorderColor" class="input_btn" onclick="ChooseBorderColor();"
								type="button" value="Choose Color" fcklang="DlgTableChooseBorderColor"/>
										</td>
								</tr>
								<tr>
									<td>
										&nbsp;</td>
									<td>
										&nbsp;
										
										
										</td>
								</tr>
							</table>
						</td>
						<td width="4%" align="center" valign="top">
							<div style="width:2px;border-left:1px solid gray;background:white;overflow:hidden;height:160px;"></div></td>
						<td width="16%" valign="top">
							<input id="btnOk" class="input_btn" onclick="window.parent.Ok();"
								type="button" value="Ok" fcklang="DlgBtnOK"/>
							<div style="height:5px;overflow:hidden"></div>
							<input name="button2" class="input_btn" type="button" value="Close" onclick="window.parent.Cancel();" fcklang="DlgBtnCancel">
						</td>
					</tr>
				</table>
<!--
				<table cellspacing="0" cellpadding="0" width="100%" border="0">
						<tr>
						<td nowrap>
						<span fcklang="DlgClassName">Class Name</span>:</td>
							<td>&nbsp;</td>
										<td>
										<script type="text/javascript">
//											var tbstyles = new TBCombo( "FontStyle"		, "null"			, "", oEditor.config.StyleNames, oEditor.config.StyleValues, 'CheckStyle("cmbFontStyle")');
//											document.write(tbstyles.GetHTML());
										</script></td>
						</tr>
					<tr>
						<td nowrap="nowrap">
							<span fcklang="DlgTableCaption">Caption</span>:&nbsp;</td>
						<td>
							&nbsp;</td>
						<td width="100%" nowrap="nowrap">
							<input id="txtCaption" class="input_text" type="text" style="width: 100%" /></td>
					</tr>
					<tr>
						<td nowrap="nowrap">
							<span fcklang="DlgTableSummary">Summary</span>:&nbsp;</td>
						<td>
							&nbsp;</td>
						<td width="100%" nowrap="nowrap">
							<input id="txtSummary" type="text" style="width: 100%" /></td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
-->
</body>
</html>
