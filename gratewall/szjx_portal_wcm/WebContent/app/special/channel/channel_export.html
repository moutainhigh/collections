<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title id="tlDoc" WCMAnt:param="channel_export.html.title">export some channels</title>
<script src="../../js/runtime/myext-debug.js"></script>
<script src="../../js/source/wcmlib/WCMConstants.js"></script>
<script src="../../js/source/wcmlib/core/MsgCenter.js"></script>
<script src="../../js/data/locale/channel.js"></script>
<script src="../../js/source/wcmlib/core/CMSObj.js"></script>
<script src="../../js/source/wcmlib/core/AuthServer.js"></script>
<script src="../../js/data/locale/ajax.js"></script>
<script src="../../js/source/wcmlib/com.trs.web2frame/AjaxRequest.js"></script>

<script src="../js/adapter4Top.js"></script>
<script language="javascript">
window.m_cbCfg = {
	btns :[
		{
			text : '导出',
			cmd : function(){
				doExport();
				return false;
			}
		},
		{
			extraCls : 'wcm-btn-close',
			text : '取消'
		}
	]
};
</script>
<script>

	//var PageContext = {
	//	params: getAllParameters()
	//};
	
	var params = location.search.parseQuery();
	function doExport(){
		//ProcessBar.start();
		var oPostData = {
			ContainsChildren: $('chkContainsChildren').checked,
			ContainsRelated: $('chkContainsRelated').checked
		};
		Object.extend(oPostData,params );
		var cbWin = wcm.CrashBoarder.get(window);
		BasicDataHelper.call('wcm6_channel', 'export', oPostData, true, function(_oXMLHttp, _json){
			//ProcessBar.exit();
			if(_oXMLHttp.responseText.trim() == 'no-available-channels'){
				Ext.Msg.alert(wcm.LANG.CHANNEL_67||'没有任何要导出的栏目。', function(){
					cbWin.close();
				});
				return;
			}
			var sFileUrl = _oXMLHttp.responseText;
            var frm = $MsgCenter.getActualTop().$('iframe4download');
			if(frm == null) {
                frm = $MsgCenter.getActualTop().document.createElement('IFRAME');
                frm.id = "iframe4download";
                frm.style.display = 'none';
                $MsgCenter.getActualTop().document.body.appendChild(frm);
			}
			sFileUrl = WCMConstants.WCM_ROOTPATH +"file/read_file.jsp?DownName=CHANNEL&FileName=" + sFileUrl;
			frm.src = sFileUrl;
            cbWin.close();
		});
		cbWin.hide();
        return false;
	}
</SCRIPT>
<style type="text/css">
	#divBox{
		margin:5px;
		background: lightblue;
		padding:1px;
		height: 100%;
		width: 100%;
	}
	#divContainer{
		background: #ffffff;
		padding:5px;
		height: 100%;
	}
	.divRow{
		font-size: 12px;
		line-height: 22px;
		height: 22px;
	}
	body{
		background:whitesmoke;
	}
</style>
</HEAD>

<BODY>
<div id="divBox">
<div id="divContainer">
	<div class="divRow">
		<input type="checkbox" id="chkContainsChildren" checked>&nbsp;<span id="spDesc" style="cursor: pointer;" onclick="$('chkContainsChildren').click()"></span>
	</div>
	<div class="divRow">
		<input type="checkbox" id="chkContainsRelated" checked>&nbsp;<span style="cursor: pointer;" onclick="$('chkContainsRelated').click()" WCMAnt:param="channel_export.html.export">同时导出扩展字段</span>
	</div>
</div>
</div>
<script language="javascript">
<!--
	//$('spDesc').innerHTML = PageContext.params['ObjectIds'] != null ?
	$('spDesc').innerHTML = getParameter('ObjectIds') != "" ?
		(wcm.LANG.CHANNEL_2||'导出当前栏目及其下的各级子栏目') : (wcm.LANG.CHANNEL_3||'递归导出所有子栏目及其下的各级子栏目');
//-->
</script>
</BODY>
</HTML>