Ext.apply(wcm.LANG, {
PHOTO_CONFIRM_1 : '确定',
PHOTO_CONFIRM_2 : '取消',
PHOTO_CONFIRM_3 : "不符合规则！",
PHOTO_CONFIRM_4 : "Id[{0}]规则不一致",
PHOTO_CONFIRM_5 : "指定的对象[{0}.{1}]可能已经被删除!栏目树的同步刷新操作不能进行!",
PHOTO_CONFIRM_6 : "Root节点元素[Id=r_{0}]竟然都不存在？？？\n(reloadChildrenAndFocus)相关信息：NodeType:{1}, _nFocusNodeId:{2}\n相关HTML代码：",
PHOTO_CONFIRM_7 : '个',
PHOTO_CONFIRM_8 : '图片',
PHOTO_CONFIRM_9 : '您正准备删除如下图片：',
PHOTO_CONFIRM_10 : '您正准备还原如下图片：',
PHOTO_CONFIRM_11 : '您正准备将如下图片放入废稿箱：',
PHOTO_CONFIRM_12 : '由于以下原因，您无法进行图片还原操作！',
PHOTO_CONFIRM_13 : '图片所属分类尚在分类回收站内',
PHOTO_CONFIRM_14 : '引用图片的实体尚在废稿箱内',
PHOTO_CONFIRM_15 : '未知操作',
PHOTO_CONFIRM_16 : '全部图片',
PHOTO_CONFIRM_17 : '新稿', 
PHOTO_CONFIRM_18 : '可发',
PHOTO_CONFIRM_19 : '已发', 
PHOTO_CONFIRM_20 : '已否',
PHOTO_CONFIRM_21 : '我创建的',
PHOTO_CONFIRM_22 : '最近三天', 
PHOTO_CONFIRM_23 : '最近一周', 
PHOTO_CONFIRM_24 : '最近一月',
PHOTO_CONFIRM_25 : '宽度缩放比例',
PHOTO_CONFIRM_26 : '高度缩放比例',
PHOTO_CONFIRM_27 : '正在处理，请稍候...',
PHOTO_CONFIRM_28 : "仅支持[{0}]类型的图片!",
PHOTO_CONFIRM_29 : '执行进度，请稍候...',
PHOTO_CONFIRM_30 : '上传图片',
PHOTO_CONFIRM_31 : '成功上传文件.',
PHOTO_CONFIRM_32 : '保存图片',
PHOTO_CONFIRM_33 : '保存图片成功.',
PHOTO_CONFIRM_34 : '上传文件失败,与服务器交互时出错啦！',
PHOTO_CONFIRM_35 : "没有指定结束时间！",
PHOTO_CONFIRM_36 : "没有指定开始时间！",
PHOTO_CONFIRM_37 : "无效的时间段：结束时间早于开始时间！",
PHOTO_CONFIRM_38 : "后面已经没有图片了！",
PHOTO_CONFIRM_39 : "前面已经没有图片了！",
PHOTO_CONFIRM_40 : '图片快速检索',
PHOTO_CONFIRM_41 : '创建时间',
PHOTO_CONFIRM_42 : '图片标题',
PHOTO_CONFIRM_43 : '创建者',
PHOTO_CONFIRM_44 : "请输入[1-9]的数字！",
PHOTO_CONFIRM_45 : "标注图片属性",
PHOTO_CONFIRM_46 : "您所选的不是一个zip格式的文件!",
PHOTO_CONFIRM_47 : "只支持[{0}]格式的图片！",
PHOTO_CONFIRM_48 : "请选择一个主分类！",
PHOTO_CONFIRM_49 : "[{0}]不是支持的图片格式!\n仅支持[{1}]类型",
PHOTO_CONFIRM_50 : "没有选择图片!",
PHOTO_CONFIRM_51 : "请选择一个有效的zip文件!",
PHOTO_CONFIRM_52 : "选择主分类",
PHOTO_CONFIRM_53 : "选择其它分类",
PHOTO_CONFIRM_54 : "请选择目标分类",
PHOTO_CONFIRM_55 : '重新上传图片',
PHOTO_CONFIRM_56 : "设置成功!",
PHOTO_CONFIRM_57 : "已经是第一幅图了!",
PHOTO_CONFIRM_58 : "已经是最后一幅图了!",
PHOTO_CONFIRM_59 : '下幅',
PHOTO_CONFIRM_60 : '上幅',
PHOTO_CONFIRM_61 : '上传图片',
PHOTO_CONFIRM_62 : '选择对象',
PHOTO_CONFIRM_63 : "系统提示信息",
PHOTO_CONFIRM_64 : "重新分类图片[",
PHOTO_CONFIRM_65 : "]到分类[",
PHOTO_CONFIRM_66 : "]失败！",
PHOTO_CONFIRM_67 : "编辑图片信息",
PHOTO_CONFIRM_68 : '文档',
PHOTO_CONFIRM_69 : '-调整顺序',
PHOTO_CONFIRM_70 : '图片-改变状态',
PHOTO_CONFIRM_71 : '编辑这幅图片',
PHOTO_CONFIRM_72 : '删除这幅图片',
PHOTO_CONFIRM_73 : '预览这幅图片',
PHOTO_CONFIRM_74 : '发布这幅图片',
PHOTO_CONFIRM_75 : '重新分类',
PHOTO_CONFIRM_76 : '增加分类',
PHOTO_CONFIRM_77 : '改变这幅图片的状态',
PHOTO_CONFIRM_78 : '上传新图片',
PHOTO_CONFIRM_79 : '导入系统图片',
PHOTO_CONFIRM_80 : '删除这些图片',
PHOTO_CONFIRM_81 : '预览这些图片',
PHOTO_CONFIRM_82 : '发布这些图片',
PHOTO_CONFIRM_83 : '改变这些图片的状态',
PHOTO_CONFIRM_84 : '撤销发布这幅图片',
PHOTO_CONFIRM_85 : '撤销发布这幅图片,撤回已发布目录或页面',
PHOTO_CONFIRM_86 : '撤销发布这些图片',
PHOTO_CONFIRM_87 : '撤销发布这些图片,撤回已发布目录或页面',
PHOTO_CONFIRM_88 : '设置这幅图片的权限',
PHOTO_CONFIRM_89 : '设置这些图片的权限',
PHOTO_CONFIRM_90 : '调整顺序',
PHOTO_CONFIRM_91 : '待导入',
PHOTO_CONFIRM_92 : '选择',
PHOTO_CONFIRM_93 : '非法输入',
PHOTO_CONFIRM_94 : '上传',
PHOTO_CONFIRM_95 : '请选择要删除的图片',
PHOTO_CONFIRM_96 : '删除',
PHOTO_CONFIRM_97 : '删除这幅/些图片',
PHOTO_CONFIRM_98 : '刷新',
PHOTO_CONFIRM_99 : '刷新列表',
PHOTO_CONFIRM_100 : '图片列表管理',
PHOTO_CONFIRM_101 : '显示名称',
PHOTO_CONFIRM_102 : '预览',
PHOTO_CONFIRM_103 : '预览这个/些图片',
PHOTO_CONFIRM_104 : '请选择要预览的图片',
PHOTO_CONFIRM_105 : '发布',
PHOTO_CONFIRM_106 : '发布这个/些图片',
PHOTO_CONFIRM_107 : '请选择要发布的图片',
PHOTO_CONFIRM_108 : '标题',
PHOTO_CONFIRM_109 : '关键词',
PHOTO_CONFIRM_110 : '正文',
PHOTO_CONFIRM_111 : '批量上传图片',
PHOTO_CONFIRM_112 : '选择要批量上传图片的栏目',
PHOTO_CONFIRM_113 : '批量上传图片',
PHOTO_CONFIRM_114 : '批量上传图片到栏目[',
PHOTO_CONFIRM_115 : '关闭',
PHOTO_CONFIRM_116 : '结束',
PHOTO_CONFIRM_117 : '拍摄时间',
PHOTO_CONFIRM_118 : '大标题',
PHOTO_CONFIRM_119 : '标题',
PHOTO_CONFIRM_120 : '作者',
PHOTO_CONFIRM_121 : '说明内容',
PHOTO_CONFIRM_122 : '地点',
PHOTO_CONFIRM_123 : '人物',
PHOTO_CONFIRM_124 : '保存图片相关信息完毕！',
PHOTO_CONFIRM_125 : '与服务器交互时出现错误',
PHOTO_CONFIRM_126 : "请输入[1-9]个分类!",
PHOTO_CONFIRM_127 : "确实要改变图片排列顺序吗？",
PHOTO_CONFIRM_128 : "当前图片列表不支持拖动排序",
PHOTO_CONFIRM_129 : "移动图片",
PHOTO_CONFIRM_130 : "引用图片",
PHOTO_CONFIRM_131 : "图片移动结果",
PHOTO_CONFIRM_132 : "图片引用结果",
PHOTO_CONFIRM_133 : "管理评论",
PHOTO_CONFIRM_134 : "管理图片的评论",
PHOTO_CONFIRM_135 : "仅发布这幅图片细览",
PHOTO_CONFIRM_136 : "仅发布这些图片细览",
PHOTO_CONFIRM_137 : '还原这幅图片',
PHOTO_CONFIRM_138 : '还原这些图片',
PHOTO_CONFIRM_139 : '还原图片...',
PHOTO_CONFIRM_140 : '清空废稿箱',
PHOTO_CONFIRM_141 : '还原所有图片',
PHOTO_CONFIRM_142 : '您确定要还原所有图片',
PHOTO_CONFIRM_143 : '您当前所执行的操作将彻底删除废稿箱中所有图片,您确定仍要继续清空当前废稿箱?',
PHOTO_CONFIRM_144 : '删除图片...',
PHOTO_CONFIRM_145 : '您正准备强制删除如下图片：',
PHOTO_CONFIRM_146 : '确实要删除这些图片吗',
PHOTO_CONFIRM_147 : '您正准备还原如下图片（含有不能还原的图片）：',
PHOTO_CONFIRM_148 : '无法还原：图片所属分类尚在分类回收站内',
PHOTO_CONFIRM_149 : '还原',
PHOTO_CONFIRM_150 : '还原这幅/些图片',
PHOTO_CONFIRM_151 : "确定要<font color='red' style='font-size:14px;'>撤销发布</font>所选图片么？将<font color='red' style='font-size:14px;'>不可逆转</font>！",
PHOTO_CONFIRM_152 : "改变状态",
PHOTO_CONFIRM_153 :'改变这幅/些图片的状态',
PHOTO_CONFIRM_154 :'仅发布细览',
PHOTO_CONFIRM_155 :'仅发布这幅/些图片的细览',
PHOTO_CONFIRM_156 :'撤销发布',
PHOTO_CONFIRM_157 :'撤销发布这幅/些图片,撤回已发布目录或页面',
PHOTO_CONFIRM_158 :'设置权限',
PHOTO_CONFIRM_159 :'设置这幅/些图片的权限',
PHOTO_CONFIRM_160 :'直接发布这幅图片',
PHOTO_CONFIRM_161 :'发布这幅图片,同时发布此图片的所有引用图片',
PHOTO_CONFIRM_162 :'直接发布这些图片',
PHOTO_CONFIRM_163 :'发布这些图片,同时发布这些图片的所有引用图片',
PHOTO_CONFIRM_164 :'直接撤销发布这幅图片',
PHOTO_CONFIRM_165 :'撤回当前图片的发布页面，并同步撤销图片的所有引用以及原图片发布页面',
PHOTO_CONFIRM_166 :'直接撤销发布这些图片',
PHOTO_CONFIRM_167 :'撤回这些图片的发布页面，并同步撤销图片的所有引用以及原图片发布页面',
PHOTO_CONFIRM_168 :"确定要<font color='red' style='font-size:14px;'>撤销发布</font>所选图片及其所有的引用图片么？将<font color='red' style='font-size:14px;'>不可逆转</font>！",
PHOTO_CONFIRM_169 :"下载原图"
});

Ext.ns('wcm.domain.photoMgr');
(function(){
var m_oMgr = wcm.domain.photoMgr;
var m_nDocumentObjType = 605;
function getHelper(){
return new com.trs.web2frame.BasicDataHelper();
}
function parseHost(host){
if(host.getType()==WCMConstants.OBJ_TYPE_CHANNEL){
return {ChannelId:host.getId(),SiteId:0};
}
if(host.getType()==WCMConstants.OBJ_TYPE_WEBSITE){
return {SiteId:host.getId(),ChannelId:0};
}
return {};
}
function uploadCallback1(fpInfo){
setTimeout(function(){
FloatPanel.open(fpInfo.src,
fpInfo.title,uploadCallback);
}, 200);
return false;
}
function uploadCallback(fpInfo){
FloatPanel.close();
setTimeout(function(){
FloatPanel.open(fpInfo.src,
fpInfo.title);
}, 200);
return false;
}
function doOptionsAfterDisplayInfo(_params, _fDoAfterDisp){
var DIALOG_PHOTO_INFO = 'photo_info_dialog';
var aTop = (top.actualTop||top);
var link = WCMConstants.WCM6_PATH + 'photo/photo_info.jsp';
aTop.m_eDocumentInfo = wcm.CrashBoarder.get(DIALOG_PHOTO_INFO).show({
title : wcm.LANG.PHOTO_CONFIRM_63 || '系统提示信息',
src : link,
width: '500px',
height: '220px',
reloadable : true,
params : _params,
maskable : true,
callback : _fDoAfterDisp
});
}
function registerOnFinish(_title,_param,_sparam,event){
var mytop = top || top.actualTop;
mytop.m_eSelector = wcm.CrashBoarder.get(DIALOG_IMAGEKIND_SELECTOR).show({
title : _title,
src : WCMConstants.WCM6_PATH +'photo/channel_select.html',
width: '250px',
height: '300px',
reloadable : false,
params : _param,
maskable : true,
callback : function(_args){
if(!_args.ids || _args.ids.length == 0){
return false;
}
if(_args.mode == "radio"){
if(_args.ids && m_nCurrId != _args.ids){
var oPostData = Object.extend(_sparam,{ToChannelId:_args.ids});
BasicDataHelper.call("wcm6_viewdocument","move",oPostData,true,function(_transport,_json){
var r = $v(_json,"Reports.Is_Success");
_json.REPORTS.TITLE = wcm.LANG.PHOTO_CONFIRM_129 || "移动图片";
Ext.Msg.report(_json,wcm.LANG.PHOTO_CONFIRM_131 || '图片移动结果',func);
event.getObjs().afterdelete();
});
}
}else{
if(_args.ids && _args.ids.length > 0 && m_nCurrId != _args.ids){
var oPostData = Object.extend(_sparam,{ToChannelIds:_args.ids});
var func = function(){
FloatPanel.close();
};
BasicDataHelper.call("wcm6_viewdocument","quote",oPostData,true,function(_transport,_json){
_json.REPORTS.TITLE = wcm.LANG.PHOTO_CONFIRM_130 || "引用图片";
Ext.Msg.report(_json,wcm.LANG.PHOTO_CONFIRM_132 || '图片引用结果',func);
event.getObjs().afteredit();
});
}
}
}
});
}
function $openCenterWin(_sUrl, _sName, _width, _height, _sFeature){
if(!_width || !_height){
$openCentralWin(_sUrl, _sName);
return;
}
var _WIN_WIDTH = window.screen.availWidth;
var _WIN_HEIGHT = window.screen.availHeight;
var l = (_WIN_WIDTH - _width) / 2;
var t = (_WIN_HEIGHT - _height) / 2;
sFeature = "left="+l + ",top=" + t +",width=" 
+ _width + ",height=" + _height + "," + _sFeature;
var sName = _sName || "";
sName = sName.replace(/[^0-9a-zA-Z_]/g,'_');
var oWin = window.open(_sUrl, sName, sFeature);
if(oWin) oWin.focus();
}
function $openMaxWin(_sUrl, _sName, _bResizable){
var nWidth = window.screen.width - 12;
var nHeight = window.screen.height - 60;
var nLeft = 0;
var nTop = 0;
var sName = _sName || "";
var oWin = window.open(_sUrl, sName, "resizable=" + (_bResizable == true ? "yes" : "no") + ",top=" + nTop + ",left=" + nLeft + ",menubar =no,toolbar =no,width=" + nWidth + ",height=" + nHeight + ",scrollbars=yes,location =no,titlebar=no");
if(oWin)oWin.focus();
}
function __openPreviewPage(_sIds, _iObjectType,_extraParams){
window.open('/wcm/app/preview/index.htm?objectType='+ _iObjectType + '&objectids=' + _sIds + '&'+$toQueryStr(_extraParams||{}), 'preview_page');
}
var m_nCurrId = 0;
var DIALOG_IMAGEKIND_SELECTOR = "Dialog_ImageKind_Selector";
ChannelSelector = Class.create("ChannelSelector");
ChannelSelector.prototype = {
initialize : function(){
},
selectMainKind : function(_param,event){
var pContext = {mode:"radio",SelectedIds:event.getHost().getId(),CurrId:event.getHost().getId(),Type:event.getHost().getType()};
registerOnFinish(wcm.LANG.PHOTO_CONFIRM_52 || "选择主分类",pContext,_param,event);
},
selectOtherKinds : function(_param,event){
var pContext = {mode:"multi",SelectedIds:event.getHost().getId(),CurrId:event.getHost().getId(),Type:event.getHost().getType()};
registerOnFinish(wcm.LANG.PHOTO_CONFIRM_53 || "选择其它分类",pContext,_param,event);
},
setParams : function(_params){
Object.extend(this.m_oParams,_params ||{});
}
};
$channelSelector = new ChannelSelector();
Ext.apply(wcm.domain.photoMgr, {
upload : function(event){
var oPageParams = event.getContext();
var host = event.getHost();
var hostid = host.getId();
Object.extend(oPageParams,host.getType()=="website"?{"siteid" : hostid}:{"channelid" : hostid});
FloatPanel.open(WCMConstants.WCM6_PATH +
'photo/photo_upload.jsp?' + $toQueryStr(oPageParams),
wcm.LANG.PHOTO_CONFIRM_61 || '上传图片', uploadCallback);
},
edit : function(event){
var oPageParams = event.getContext();
var host = event.getHost();
var hostid = host.getId();
var docid = event.getObjs().getAt(0).getPropertyAsInt("docId", 0);
Object.extend(oPageParams,host.getType()=="website"?{"siteid" : hostid}:{"channelid" : hostid});
Object.extend(oPageParams,{"DocId":docid});
FloatPanel.open(WCMConstants.WCM6_PATH +"photo/photodoc_edit.jsp?"+$toQueryStr(oPageParams),wcm.LANG.PHOTO_CONFIRM_67 || "编辑图片信息",CMSObj.afteredit(event));
},
"delete" : function(event){
var oPageParams = event.getContext();
var _sDocIds = event.getIds();
_sDocIds = _sDocIds + '';
var nCount = (_sDocIds.indexOf(',') == -1) ? 1 : _sDocIds.split(',').length;
var sHint = (nCount==1)?'':' '+nCount+' ';
var browserEvent = event.browserEvent;
var bDrop = !!(browserEvent && 
browserEvent.type=='keydown' && browserEvent.shiftKey);
var params = {
objectids: _sDocIds,
operation: bDrop ? '_forcedelete' : '_trash'
}
doOptionsAfterDisplayInfo(params, function(){
var aTop = (top.actualTop||top);
BasicDataHelper.call("wcm6_viewdocument", 'delete', Object.extend(oPageParams,{"ObjectIds": _sDocIds, "drop": bDrop}), true, 
function(){
event.getObjs().afterdelete();
}
);
}.bind(this));
},
importsysphoto : function(event){
var oPageParams = {};
var host = event.getHost();
var hostid = host.getId();
Object.extend(oPageParams,host.getType()=="website"?{"siteid" : hostid}:{"channelid" : hostid});
FloatPanel.open(WCMConstants.WCM6_PATH +
'photo/photo_importsyspics.jsp?' + $toQueryStr(oPageParams),
wcm.LANG.PHOTO_CONFIRM_79 || '导入系统图片', uploadCallback);
},
importphotos : function(event){
var oPageParams = {};
var host = event.getHost();
var hostid = host.getId();
Object.extend(oPageParams,host.getType()=="website"?{"siteid" : hostid}:{"channelid" : hostid});
if(!oPageParams.channelid){
FloatPanel.open(WCMConstants.WCM6_PATH + 'photo/photos_siteimport_step1.html?' + $toQueryStr(oPageParams), wcm.LANG.PHOTO_CONFIRM_112 || '选择要批量上传图片的栏目', uploadCallback1);
return;
}
FloatPanel.open(WCMConstants.WCM6_PATH +'photo/photos_import.jsp?' + $toQueryStr(oPageParams), wcm.LANG.PHOTO_CONFIRM_113 || '批量上传图片',
function(){
event.getObjs().afterdelete();
});
},
preview : function(event){
var host = event.getHost();
var hostid = host.getId();
var oParams = {
FolderId : hostid,
FolderType : host.getType()=="website"? 103:101,
'isPhoto':true
};
var _sIds = event.getIds();
wcm.domain.PublishAndPreviewMgr.preview(_sIds,600,oParams,"wcm6_viewdocument");
},
basicpublish : function(event){
var oPageParams = event.getContext();
var _sIds = event.getIds();
var postData = Object.extend({},{
'ObjectIds' : _sIds,
'isPhoto':true
});
BasicDataHelper.call("wcm6_viewdocument", "basicpublish", postData, true, function(_transport,_json){
wcm.domain.PublishAndPreviewMgr.doAfterPublish(postData, "detailpublish",_transport,_json);
}.bind(this));
},
detailpublish : function(event){
var oPageParams = event.getContext();
var _sIds = event.getIds();
var postData = Object.extend({},{
'ObjectIds' : _sIds,
'isPhoto':true
});
BasicDataHelper.call("wcm6_viewdocument", "detailpublish", postData, true, function(_transport,_json){
wcm.domain.PublishAndPreviewMgr.doAfterPublish(postData, "detailpublish",_transport,_json);
}.bind(this));
},
directpublish : function(event){
var oPageParams = event.getContext();
var _sIds = event.getIds();
var postData = Object.extend({},{
'ObjectIds' : _sIds,
'isPhoto':true
});
BasicDataHelper.call("wcm6_viewdocument", "directpublish", postData, true, function(_transport,_json){
wcm.domain.PublishAndPreviewMgr.doAfterPublish(postData, "detailpublish",_transport,_json);
}.bind(this));
},
quote : function(event){
var oPageParams = event.getContext();
var _sDocIds = event.getIds();
var host = event.getHost();
var currId = host.getType()=="website" ? 0:host.getId();
var param ={ObjectIds:_sDocIds,channelids:currId,isPhoto:true};
$channelSelector.setParams(param);
$channelSelector.selectOtherKinds(param,event);
},
move : function(event){
var oPageParams = event.getContext();
var _sDocIds = event.getIds();
var host = event.getHost();
var param ={ObjectIds:_sDocIds,FromChannelId:currId,isPhoto:true};
var currId = (host.getType()=="website"?0:host.getId());
$channelSelector.setParams(param);
$channelSelector.selectMainKind(param,event);
},
docpositionset : function(event){
var oPageParams = event.getContext();
var host = event.getHost();
var hostid = host.getId();
var objType = event.getObjs().getAt(0).objType;
var docid = event.getObjs().getAt(0).getPropertyAsInt("docId", 0);
Object.extend(oPageParams,host.getType()=="website"?{"siteid" : hostid}:{"channelid" : hostid});
Object.extend(oPageParams,{"DocumentId":docid,"DocType":objType});
FloatPanel.open(WCMConstants.WCM6_PATH + 'document/document_position_set.jsp?' + $toQueryStr(oPageParams), (objType.trim()=='photo'?(wcm.LANG.PHOTO_CONFIRM_8 || '图片'):(wcm.LANG.PHOTO_CONFIRM_68 || '文档')) +
(wcm.LANG.PHOTO_CONFIRM_69 || '-调整顺序'), CMSObj.afteredit(event));
},
commentmgr : function(event){
var docid = event.getObjs().getAt(0).getPropertyAsInt("docId", 0);
var host = event.getHost();
var hostid = host.getId();
var oParams = Ext.apply({
DocumentId : docid,
ChannelId :hostid,
SiteId : 0
}, parseHost(event.getHost()));
var sUrl = WCMConstants.WCM_ROOTPATH +'comment/comment_mgr.jsp?'
+ $toQueryStr(oParams);
$openMaxWin(sUrl);
},
recallpublish : function(event){
var host = event.getHost();
var hostid = host.getId();
var _sIds = event.getIds();
var oParams = {
FolderId : hostid,
FolderType : host.getType()=="website"? 103:101
};
var sHtml = (wcm.LANG.PHOTO_CONFIRM_151 ||"确定要<font color=\'red\' style=\'font-size:14px;\'>撤销发布</font>所选图片么？将<font color=\'red\' style=\'font-size:14px;\'>不可逆转</font>");
Ext.Msg.confirm(sHtml,{
yes : function(){
wcm.domain.PublishAndPreviewMgr.publish(_sIds, 600, 'recallPublish',oParams,"wcm6_viewdocument");
}
});
},
setright : function(event){
$openCenterWin(WCMConstants.WCM6_PATH + "auth/right_set.jsp?ObjType=" +
m_nDocumentObjType + "&ObjId=" + event.getObjs().getPropertys("docId",0).join(),
"document_right_set", 900, 600, "resizable=yes");
},
changestatus : function(event){
var oPageParams = event.getContext();
var host = event.getHost();
var hostid = host.getId();
var sId = event.getIds().join();
var docid = event.getObjs().getAt(0).getPropertyAsInt("docId", 0);
Object.extend(oPageParams,{"DocumentId":docid,"ObjectIds":sId,"IsPhoto":true,'ChannelIds':(oPageParams,host.getType()=="website"?0:hostid)});
FloatPanel.open(WCMConstants.WCM6_PATH +'document/change_status.jsp?' + $toQueryStr(oPageParams), wcm.LANG.PHOTO_CONFIRM_70 || '图片-改变状态', CMSObj.afteredit(event));
},
downLoadOrigin : function(event){
var oparam = {
PhotoId : event.getObjs().getAt(0).getPropertyAsInt("docId", 0)
}
BasicDataHelper.JspRequest(WCMConstants.WCM6_PATH+'photo/photo_download.jsp',oparam,false,function(transport){
var sFileUrl = transport.responseText;
var frm = $MsgCenter.getActualTop().$('iframe4download');
if(frm==null){
frm = $MsgCenter.getActualTop().document.createElement('IFRAME');
frm.id = "iframe4download";
frm.style.display = 'none';
$MsgCenter.getActualTop().document.body.appendChild(frm);
}
sFileUrl = WCMConstants.WCM_ROOTPATH +"file/read_file.jsp?DownName=DOCUMENT&FileName=" + sFileUrl;
frm.src = sFileUrl;
});
}
});
})();
(function(){
var pageObjMgr = wcm.domain.photoMgr;
var reg = wcm.SysOpers.register;
reg({
key : 'edit',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_71 || '编辑这幅图片',
title : wcm.LANG.PHOTO_CONFIRM_71 || '编辑这幅图片',
rightIndex : 32,
order : 1,
fn : pageObjMgr['edit'],
quickKey : 'E'
});
reg({
key : 'delete',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_72 || '删除这幅图片',
title : wcm.LANG.PHOTO_CONFIRM_72 || '删除这幅图片',
rightIndex : 33,
order : 2,
fn : pageObjMgr['delete'],
quickKey : ['Delete', 'ShiftDelete']
});
reg({
key : 'preview',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_73 || '预览这幅图片',
title : wcm.LANG.PHOTO_CONFIRM_73 || '预览这幅图片',
rightIndex : 38,
order : 3,
fn : pageObjMgr['preview'],
quickKey : 'Y'
});
reg({
key : 'basicpublish',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_74 || '发布这幅图片',
title : wcm.LANG.PHOTO_CONFIRM_74 || '发布这幅图片',
rightIndex : 39,
order : 4,
fn : pageObjMgr['basicpublish'],
quickKey : 'P'
});
reg({
key : 'move',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_75 || '重新分类',
title : wcm.LANG.PHOTO_CONFIRM_75 || '重新分类',
rightIndex : 33,
order : 5,
fn : pageObjMgr['move']
});
reg({
key : 'quote',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_76 || '增加分类',
title : wcm.LANG.PHOTO_CONFIRM_76 || '增加分类',
rightIndex : 34,
order : 6,
fn : pageObjMgr['quote']
});
reg({
key : 'changestatus',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_77 || '改变这幅图片的状态',
title : wcm.LANG.PHOTO_CONFIRM_77 || '改变这幅图片的状态',
rightIndex : 35,
order : 7,
fn : pageObjMgr['changestatus']
});
reg({
key : 'upload',
type : 'photoInChannel',
desc : wcm.LANG.PHOTO_CONFIRM_78 || '上传新图片',
title : wcm.LANG.PHOTO_CONFIRM_78 || '上传新图片...',
rightIndex : 31,
order : 8,
fn : pageObjMgr['upload'],
quickKey : 'N'
});
reg({
key : 'importsysphoto',
type : 'photoInChannel',
desc : wcm.LANG.PHOTO_CONFIRM_79 || '导入系统图片',
title : wcm.LANG.PHOTO_CONFIRM_79 || '导入系统图片...',
rightIndex : 31,
order : 9,
fn : pageObjMgr['importsysphoto']
});
reg({
key : 'importphotos',
type : 'photoInChannel',
desc : wcm.LANG.PHOTO_CONFIRM_111 || '批量上传图片',
title : wcm.LANG.PHOTO_CONFIRM_111 || '批量上传图片...',
rightIndex : 31,
order : 9,
fn : pageObjMgr['importphotos']
});
reg({
key : 'upload',
type : 'photoInSite',
desc : wcm.LANG.PHOTO_CONFIRM_78 || '上传新图片',
title : wcm.LANG.PHOTO_CONFIRM_78 || '上传新图片...',
rightIndex : 31,
order : 10,
fn : pageObjMgr['upload'],
quickKey : 'N'
});
reg({
key : 'importsysphoto',
type : 'photoInSite',
desc : wcm.LANG.PHOTO_CONFIRM_79 || '导入系统图片',
title : wcm.LANG.PHOTO_CONFIRM_79 || '导入系统图片...',
rightIndex : 31,
order : 11,
fn : pageObjMgr['importsysphoto']
});
reg({
key : 'importphotos',
type : 'photoInSite',
desc : wcm.LANG.PHOTO_CONFIRM_111 || '批量上传图片',
title : wcm.LANG.PHOTO_CONFIRM_111 || '批量上传图片...',
rightIndex : 31,
order : 11,
fn : pageObjMgr['importphotos']
});
reg({
key : 'delete',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_80 || '删除这些图片',
title : wcm.LANG.PHOTO_CONFIRM_80 || '删除这些图片',
rightIndex : 33,
order : 12,
fn : pageObjMgr['delete'],
quickKey : ['Delete', 'ShiftDelete']
});
reg({
key : 'preview',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_81 || '预览这些图片',
title : wcm.LANG.PHOTO_CONFIRM_81 || '预览这些图片',
rightIndex : 38,
order : 13,
fn : pageObjMgr['preview'],
quickKey : 'Y'
});
reg({
key : 'basicpublish',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_82 || '发布这些图片',
title : wcm.LANG.PHOTO_CONFIRM_82 || '发布这些图片',
rightIndex : 39,
order : 14,
fn : pageObjMgr['basicpublish'],
quickKey : 'P'
});
reg({
key : 'move',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_75 || '重新分类',
title : wcm.LANG.PHOTO_CONFIRM_75 || '重新分类',
rightIndex : 33,
order : 15,
fn : pageObjMgr['move']
});
reg({
key : 'quote',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_76 || '增加分类',
title : wcm.LANG.PHOTO_CONFIRM_76 || '增加分类',
rightIndex : 34,
order : 16,
fn : pageObjMgr['quote']
});
reg({
key : 'changestatus',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_83 || '改变这些图片的状态',
title : wcm.LANG.PHOTO_CONFIRM_83 || '改变这些图片的状态',
rightIndex : 35,
order : 17,
fn : pageObjMgr['changestatus']
});
reg({
key : 'detailpublish',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_135 ||'仅发布这幅图片细览',
title : '仅发布这幅图片细览...',
rightIndex : 39,
order : 18,
fn : pageObjMgr['detailpublish']
});
reg({
key : 'directpublish',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_160 ||'直接发布这幅图片',
title : wcm.LANG.PHOTO_CONFIRM_161 ||'发布这幅图片,同时发布此图片的所有引用图片',
rightIndex : 39,
order : 18,
fn : pageObjMgr['directpublish']
});
reg({
key : 'detailpublish',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_136 ||'仅发布这些图片细览',
title : wcm.LANG.PHOTO_CONFIRM_136 ||'仅发布这些图片细览...',
rightIndex : 39,
order : 19,
fn : pageObjMgr['detailpublish']
});
reg({
key : 'directpublish',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_162 ||'直接发布这些图片',
title : wcm.LANG.PHOTO_CONFIRM_163 ||'发布这些图片,同时发布这些图片的所有引用图片',
rightIndex : 39,
order : 19,
fn : pageObjMgr['directpublish']
});
reg({
key : 'recallpublish',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_84 || '撤销发布这幅图片',
title : wcm.LANG.PHOTO_CONFIRM_85 || '撤销发布这幅图片,撤回已发布目录或页面',
rightIndex : 39,
order : 20,
fn : pageObjMgr['recallpublish']
});
reg({
key : 'recallpublish',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_86 || '撤销发布这些图片',
title : wcm.LANG.PHOTO_CONFIRM_87 || '撤销发布这些图片,撤回已发布目录或页面',
rightIndex : 39,
order : 21,
fn : pageObjMgr['recallpublish']
});
reg({
key : 'setright',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_88 || '设置这幅图片的权限',
title :'设置这幅图片的权限...',
rightIndex : 61,
order : 22,
fn : pageObjMgr['setright']
});
reg({
key : 'setright',
type : 'photos',
desc : wcm.LANG.PHOTO_CONFIRM_89 || '设置这些图片的权限',
title : wcm.LANG.PHOTO_CONFIRM_89 || '设置这些图片的权限...',
rightIndex : 61,
order : 23,
fn : pageObjMgr['setright']
});
reg({
key : 'docpositionset',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_90 || '调整顺序',
title : wcm.LANG.PHOTO_CONFIRM_90 || '调整顺序',
rightIndex : 62,
order : 24,
fn : pageObjMgr['docpositionset'],
isVisible : function(event){
if(event.getHost().getType() == WCMConstants.OBJ_TYPE_CHANNEL)
return true;
return false;
}
});
reg({
key : 'commentmgr',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_133 ||'管理评论',
title : wcm.LANG.PHOTO_CONFIRM_134 ||'管理图片的评论',
rightIndex : 8,
order : 25,
fn : pageObjMgr['commentmgr'],
isVisible : function(event){
try{
return $MsgCenter.getActualTop().g_IsRegister['comment'];
}catch(err){
return false;
}
}
});
reg({
key : 'downLoadOrigin',
type : 'photo',
desc : wcm.LANG.PHOTO_CONFIRM_169 ||'下载原图',
title : wcm.LANG.PHOTO_CONFIRM_169 ||'下载原图',
rightIndex : 32,
order : 26,
fn : pageObjMgr['downLoadOrigin']
});
})();

Ext.ns('wcm.photos', 'wcm.photo');
WCMConstants.OBJ_TYPE_PHOTO = 'photo';
wcm.photos = function(_config, _context){
this.objType = WCMConstants.OBJ_TYPE_PHOTO;
wcm.photos.superclass.constructor.call(this, _config, _context);
}
Ext.extend(wcm.photos, wcm.CMSObjs, {
});
wcm.photo = function(_config, _context){
this.objType = WCMConstants.OBJ_TYPE_PHOTO;
wcm.photo.superclass.constructor.call(this, _config, _context);
var arrRights = {
"view" : -1
};
for(rightName in arrRights){
var cameRightName = rightName.camelize();
var nRightIndex = parseInt(arrRights[rightName], 10);
this['can'+cameRightName] = function(){
return wcm.AuthServer.hasRight(this.right, nRightIndex);
}
}
}
CMSObj.register(WCMConstants.OBJ_TYPE_PHOTO, 'wcm.photo');
Ext.extend(wcm.photo, wcm.CMSObj, {
getDocId : function(){
return this.getPropertyAsInt("DocId", 0);
}
});

(function(){
var sName = wcm.LANG['PHOTO'] || '图片';
wcm.PageOper.registerPanels({
photoInRoot : {
isHost : true,
title : String.format(wcm.LANG['OPER_TITLE_INROOT'] || '库{0}操作任务', sName),
displayNum : 5
},
photoInSite : {
isHost : true,
title : String.format(wcm.LANG['OPER_TITLE_INSITE'] || '站点{0}操作任务', sName),
displayNum : 5
},
photoInChannel : {
isHost : true,
title : String.format(wcm.LANG['OPER_TITLE_INCHANNEL'] || '栏目{0}操作任务', sName),
displayNum : 5
},
photo : {
title : String.format(wcm.LANG['OPER_TITLE_OBJ'] || '{0}操作任务', sName),
displayNum : 7,
url : '?serviceid=wcm61_photo&methodname=jFindbyid',
params : function(opt){
var host = opt.event.getHost()
switch(host.getType()){
case "website" :
return "siteId=" + host.getId();
case "channel" :
return "channelId=" + host.getId();
}
}
},
photos : {
title : String.format(wcm.LANG['OPER_TITLE_OBJ'] || '{0}操作任务', sName),
displayNum : 7
}
});
})();

