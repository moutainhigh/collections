Ext.apply(wcm.LANG, {
UNIT : '个',
TEMPLATE : '模板',
TEMPLATE_0 : '修改这个模板',
TEMPLATE_1 : '修改当前选中的模板',
TEMPLATE_2 : '预览这个模板',
TEMPLATE_3 : '预览当前选中的模板',
TEMPLATE_4 : '导出这个模板',
TEMPLATE_5 : '导出当前选中的模板',
TEMPLATE_6 : '校验这个模板',
TEMPLATE_7 : '校验当前选中的模板',
TEMPLATE_8 : '删除这个模板',
TEMPLATE_9 : '删除当前选中的模板(不可恢复)',
TEMPLATE_10 : '同步模板附件',
TEMPLATE_11 : '同步当前选中模板的附件',
TEMPLATE_12 : '新建一个模板',
TEMPLATE_13 : '导入模板',
TEMPLATE_14 : '从文件中导入模板到当前栏目',
TEMPLATE_15 : '导出所有模板',
TEMPLATE_16 : '导出当前列出的所有模板',
TEMPLATE_17 : '校验所有模板',
TEMPLATE_18 : '校验当前列出的所有模板',
TEMPLATE_19 : '同步所有模板附件',
TEMPLATE_20 : '同步当前所列模板的附件',
TEMPLATE_21 : '删除这些模板',
TEMPLATE_23 : '校验这些模板',
TEMPLATE_22 : '导出这些模板',
TEMPLATE_24 : '模板导入',
TEMPLATE_25 : '模板校验',
TEMPLATE_ALERT : '没有任何要操作的模板！',
TEMPLATE_CONFIRM_0 : '此操作将校验模板的语法和文法细则，可能需要较长时间。确实要进行模板校验吗？',
TEMPLATE_CONFIRM_1 : '此操作将重新分发模板附件，可能需要较长时间。确实要同步附件吗？',
TEMPLATE_ALERT_0 : '请选择模板类型！',
TEMPLATE_ALERT_1 : '请输入模板内容！',
TEMPLATE_ALERT_2 : '请选择模板类型后再进行此操作！',
TEMPLATE_CALLBACK : '模板名称已经存在',
TEMPLATE_ALERT_3 : '没有找到模板正文所在的文本框！',
TEMPLATE_INNER_0 : '隐藏TRS置标添加向导',
TEMPLATE_INNER_1 : '进入置标编辑模式',
TEMPLATE_INNER_2 : '显示TRS置标添加向导',
TEMPLATE_ALL : '全部模板',
TEMPLATE_OUTLINE : '概览模板',
TEMPLATE_XILAN : '细览模板',
TEMPLATE_NESTING : '嵌套模板',
TEMPLATE_USED : '已被使用的',
TEMPLATE_NON : '未被使用的',
TEMPLATE_CRBYME : '我创建的',
TEMPLATE_LASTWEEK : '最近一周',
TEMPLATE_TEMPNAME : '模板名称',
TEMPLATE_TEMPDESC : '模板描述',
TEMPLATE_TEMPDESC : '模板描述',
TEMPLATE_TEMPCRUSER : '创建者',
TEMPLATE_TEMPID : '模板Id',
TEMPLATE_26 : '递归显示',
TEMPLATE_27 : '仅显示当前',
HIDTEMP : '点击切换递归显示所有模板\n;当前为：仅显示当前',
SHOWTEMP : '点击切换递归显示所有模板\n;当前为：递归显示',
TEMPLATE_USED_1 : '模板被引用情况',
TEMPLATE_USED_2 : '查看模板被栏目或站点使用的情况',
TEMPLATE_USED_3 : '查看模板被栏目或站点使用的情况',
TEMPLATE_ALERT4 :'文件路径为空，上传失败！',
TEMPLATE_RESULT : '模板导入结果',
TEMPLATE_ALERT5:'请选择置标类型！',
TEMPLATE_ALERT6:'已经复制到剪切板中！',
TEMPLATE_RESULT1:'模板校验结果',
TEMPLATE_SELECT:'选择模板',
CLOSE:'关闭',
TRUE:'确定',
REFRESH : '刷新',
CANCEL : '取消',
TEMPLATE_29:'当前编辑的模板 - ',
TEMPLATE_ALERT7:'设置成功！',
TEMPLATE_ALERT8:'忽略错误',
TEMPLATE_ALERT9:'返回修改',
TEMPLATE_ALERT10:'返回模板编辑',
TEMPLATE_ALERT11:'您的浏览器不支持自动复制操作，请手工拷贝！',
EMPOLOYTO : '将模板分配给栏目或站点使用',
TEMPLATE_28 : '当前模板并不是概览模板。<br><br>点击[确定]将按<b>默认首页模板</b>预览该{0}。',
TEMPLATE_30 : '确实要将这{0}个模板删除吗? ',
TEMPLATE_31:'成功同步了模板附件！实际耗时<br><b> {0}</b>s.',
TEMPLATE_MESSAGE : '限字母，数字和下划线',
TEMPLATE_TEXNAME : '文件扩展名',
TEMPLATE_OUTLINENAME : '发布文件名',
SELECT_OBJECT : '选择对象',
TEMPLATE_32 : '新建',
TEMPLATE_33 : '新建一个模板',
TEMPLATE_34 : '导入',
TEMPLATE_35 : '导出',
TEMPLATE_36 : '导出模板',
TEMPLATE_37 : '同步附件',
TEMPLATE_38 : '删除',
TEMPLATE_39 : '删除这个/些模板',
TEMPLATE_40 : '刷新',
TEMPLATE_41 : '刷新列表',
TEMPLATE_42 : '模板列表管理',
TEMPLATE_45 : '选择的模板将全部替换当前编辑器的内容，你确定要执行此操作么？',
TEMPLATE_46 : '返回',
TEMPLATE_47 :'选择广告',
TEMPLATE_48 :'插入广告位出错：',
TEMPLATE_49 : '校验模板..',
TEMPLATE_50 : '同步模板附件..',
TEMPLATE_51 : '粘贴模板..',
TEMPLATE_CHNL : '栏目',
TEMPLATE_SITE : '站点',
TEMPLATE_52 : '没有找到指定ID[{0}]的Select！',
TEMPLATE_53 : 'WCAG2校验',
TEMPLATE_54 : 'WCAG2校验当前选中的模板',
TEMPLATE_55 : '模板WCAG2校验结果',
TEMPLATE_56 : '无障碍处理建议',
TEMPLATE_57 : 'W3C规范',
TEMPLATE_58 : '无障碍检查结果:符合WCAG2规范.',
TEMPLATE_59 : '无障碍检查结果',
TEMPLATE_60 : '警告',
TEMPLATE_61 : '错误',
TEMPLATE_62 : '建议',
TEMPLATE_63 : '详细',
TEMPLATE_64 : 'HTML格式不规范',
TEMPLATE_65 : '页面没有指定DOCTYPE',
TEMPLATE_66 : '在页面的开始部分指定一个标准的文档类型声明，例如：<br>',
TEMPLATE_67 : '查看',
TEMPLATE_68 : '全部W3C推荐的文档类型声明.',
TEMPLATE_69 : '多语言',
TEMPLATE_70 : 'html节点上没有指定lang/xml:lang属性或属性值为空',
TEMPLATE_71 : '在HTML节点上添加lang属性和值，例如：<br>',
TEMPLATE_72 : '页面的Charset属性没有指定',
TEMPLATE_73 : '在Head节点中添加描述charset的meta节点，例如：<br>',
TEMPLATE_74 : '标题',
TEMPLATE_75 : '页面没有包含Title节点或者Title无内容',
TEMPLATE_76 : '在页面Head部分添加Title节点，例如：<br>',
TEMPLATE_77 : '&nbsp;&nbsp;&lt;TITLE&gt;描述这个页面的说明&lt;/TITLE&gt;',
TEMPLATE_78 : '页面正文中没有和Title相对应的H1节点',
TEMPLATE_79 : '页面正文中的H1节点数超过2个,不建议',
TEMPLATE_80 : '页面正文中的H1节点的内容应该完全匹配或包含于页面标题（Title）的内容',
TEMPLATE_81 : '在页面Body部分添加隐藏的H1节点与Title对应，内容保持一致，例如：<br>',
TEMPLATE_82 : '描述这个页面的说明',
TEMPLATE_83 : '将页面正文中的部分H1节点调整为H2-H6节点',
TEMPLATE_84 : '调整H1节点/Title使得H1和Title的内容相等',
TEMPLATE_85 : '标题/类目',
TEMPLATE_86 : '不是使用H1-H6来定义页面的框架结构',
TEMPLATE_87 : '使用页面标签将页面划分为 标题, 段落, 列表, 引用等，例如：<br>',
TEMPLATE_88 : '&nbsp;&nbsp;使用 &lt;h1&gt; 标签来区分顶层头信息而不是简单的加大加粗这些文字，再使用CSS格式化这些标签的内容。',
TEMPLATE_89 : '图片',
TEMPLATE_90 : 'IMG,AREA,INPUT(type=image)的节点没有指定alt属性',
TEMPLATE_91 : 'IMG节点的alt属性为空',
TEMPLATE_92 : '为页面中表示内容的图片指定alt属性，例如：<br>',
TEMPLATE_93 : '图片说明',
TEMPLATE_94 : '<br>为页面中不用于表示内容的图片指定alt属性，设置其说明为空，例如：<br>',
TEMPLATE_95 : '请确定当前alt属性为空的图片不用于表示内容，否则需要为其指定说明，例如：<br>',
TEMPLATE_96 : 'B,I节点为非WCAG2的规范节点,建议替换为strong,em',
TEMPLATE_97 : '使用strong,em节点加粗/斜字体，避免使用B,I节点，例如：<br>',
TEMPLATE_98 : '加粗',
TEMPLATE_99 : '加斜',
TEMPLATE_100 : '数据表格',
TEMPLATE_101 : '描述数据的表格中没有指定summary属性且不包含Caption节点',
TEMPLATE_102 : 'Frame/Iframe节点没有指定title属性',
TEMPLATE_103 : '为页面中的Iframe/Frame节点指定title属性，例如：<br>',
TEMPLATE_104 : '页面说明',
TEMPLATE_105 : 'Object/Applet节点中不包含内容',
TEMPLATE_106 : '为页面中的Object/Applet节点添加内容，例如：<br>',
TEMPLATE_107 : 'Embed节点没有指定alt属性,以及Embed节点中没有包含NoEmbed节点且下一个节点不是NoEmbed节点',
TEMPLATE_108 : '为Embed节点指定alt属性，例如：<br>',
TEMPLATE_109 : '表单',
TEMPLATE_110 : 'Form表单中没有表示提交的按钮(input type=submit/image 或button type=submit)',
TEMPLATE_111 : 'Form表单中增加表示提交的按钮，例如：<br>',
TEMPLATE_112 : '表单控件',
TEMPLATE_113 : '可能原因',
TEMPLATE_114 : '1、Input(type=image)控件没有指定alt/title属性;',
TEMPLATE_115 : '2、Input(type=button/submit/reset)控件没有指定value属性;',
TEMPLATE_116 : '3、Input(type=text/radio/checkbox/password)/Select/Textarea控件没有指定title属性且没有相关的label节点',
TEMPLATE_117 : '4、Button控件没有指定文本内容且没有title属性',
TEMPLATE_118 : '1、为Input(type=image)控件指定alt属性，例如：<br>',
TEMPLATE_119 : '<br>2、为Input(type=button/submit/reset)控件指定value属性，例如：<br>',
TEMPLATE_120 : '<br>3、为Input(type=text/radio/checkbox/password)/Select/Textarea控件指定title属性，例如：<br>',
TEMPLATE_121 : '<br>4、为Button控件指定文本内容，例如：<br>',
TEMPLATE_122 : '按钮内容',
TEMPLATE_123 : '菜单/导航条',
TEMPLATE_124 : '每个表示菜单/导航条的OL/UL控件应该对应着一个H2-H6的标签',
TEMPLATE_125 : '表示菜单/导航条的OL/UL控件对应增加一个H2-H6的标签，例如：<br>',
TEMPLATE_126 : '更多下载选项',
TEMPLATE_127 : '其他文件格式',
TEMPLATE_128 : '旧版本',
TEMPLATE_129 : '测试版本',
TEMPLATE_130 : '候选发行版本',
TEMPLATE_131 : '控件指定了onmouseover事件的行为,但是没有与之相同行为的onfocus事件相对应',
TEMPLATE_132 : '为控件同时指定onfocus行为，并与onmouseover一致，例如：<br>',
TEMPLATE_133 : '使用可通过键盘切换到焦点的控件替换该控件，例如：<br>',
TEMPLATE_134 : '控件指定了onclick事件的行为,但是该控件不可选中(focus)',
TEMPLATE_135 : '<br>转换为<br>',
TEMPLATE_136 : '您没有选择任何模板！',
TEMPLATE_137 : '模板正文不能为空',
TEMPLATE_LASTMODIFIEDUSER :'最近修改人',
TEMPLATE_138 : '当前编辑的模板 - ',
TEMPLATE_139 : '导入模板',
TEMPLATE_140 : '当前编辑的模板 - ',
TEMPLATE_141 : '请输入模板名.',
TEMPLATE_142 : '分配',
TEMPLATE_143 : '执行模板导出..'
});

Ext.ns('wcm.domain.TemplateMgr');
(function(){
var m_oMgr = wcm.domain.TemplateMgr={
serviceId : 'wcm6_template',
helpers : {},
getHelper : function(_sServceFlag){
return new com.trs.web2frame.BasicDataHelper();
}
};
Ext.apply(wcm.domain.TemplateMgr, {
'new' : function(event){
var result = '';
var context = event.getContext();
var host = event.getHost();
if(context) {
if(host.getType() == null) {
result += $toQueryStr(context);
}else{
result = 'hosttype=' + host.getIntType();
result += '&hostid=' + host.getId();
}
}
result += '&objectid=0';
var params = event.getContext();
if(params && params.isTypeStub) {
result += '&typestub=1';
}
$openMaxWin(WCMConstants.WCM6_PATH + 'template/template_add_edit.jsp?' + result);
},
__getCurrentParams : function(event){
var result = '';
var context = event.getContext();
var host = event.getHost();
var bIsSingle = event.length()<=1;
if(context) {
if(host.getType() == null) {
result += $toQueryStr(context);
}else{
result = 'hosttype=' + host.getIntType();
result += '&hostid=' + host.getId();
}
}
result += '&' + (bIsSingle ? 'objectid' : 'objectids') + '=' + event.getIds();
return result;
},
edit : function(event){
var sParams = m_oMgr.__getCurrentParams(event);
var params = event.getContext();
if(params && params.isTypeStub) {
sParams += '&typestub=1';
}
$openMaxWin(WCMConstants.WCM6_PATH + 'template/template_add_edit.jsp?' + sParams);
},
'import' : function(event){
var sParams = m_oMgr.__getCurrentParams(event);
FloatPanel.open(WCMConstants.WCM6_PATH + 'template/template_import.html?' + sParams, wcm.LANG.TEMPLATE_24 || '模板导入', function(){
CMSObj.afteradd(event)({objType:WCMConstants.OBJ_TYPE_TEMPLATE});
});
},
__checkNoRecords : function(oHostInfos){
if(oHostInfos.RecordNum <= 0) {
Ext.Msg.$fail(wcm.LANG.TEMPLATE_ALERT || '没有任何要操作的模板!');
return false;
}
return true;
},
__getCurrentPostData : function(event, _sRenderAllName){
var sTempIds = event.getIds().join(',');
var host = event.getHost();
var context = event.getContext();
var obj = event.getObjs().getAt(0);
var bIsHost = _sRenderAllName!=null;
var oPostData = Ext.apply({
objectids : bIsHost?'':sTempIds,
hostid : host.getId(),
hostType : host.getIntType()
});
if(bIsHost) {
oPostData = {};
oPostData[_sRenderAllName] = true;
Ext.apply(oPostData,context.get("pagecontext").params);
Ext.apply(oPostData,{PAGESIZE:-1});
}
return oPostData;
},
exportAll : function(event, operItem){
return m_oMgr['export'](event, operItem, 'exportAll');
},
'export' : function(event, operItem, _sRenderAllName){
var oHostInfos = event.getContext();
if(!m_oMgr.__checkNoRecords(oHostInfos)) {
return;
}
ProcessBar.start(wcm.LANG.TEMPLATE_143 || '执行模板导出..');
var oPostData = m_oMgr.__getCurrentPostData(event, _sRenderAllName);
m_oMgr.getHelper().call(m_oMgr.serviceId, 'export', oPostData, true, function(_oXMLHttp, _json){
ProcessBar.close();
var sFileUrl = _oXMLHttp.responseText;
var frm = document.getElementById("ifrmDownload");
if(frm == null) {
frm = document.createElement('iframe');
frm.style.height = 0;
frm.style.width = 0;
document.body.appendChild(frm);
}
sFileUrl = WCMConstants.WCM_ROOTPATH + "file/read_file.jsp?DownName=TEMPLATE&FileName=" + sFileUrl;
frm.src = sFileUrl;
}.bind(this));
},
checkAll : function(event, operItem){
return m_oMgr.check(event, operItem, 'CheckAll');
},
check : function(event, operItem, _sRenderAllName){
var oHostInfos = event.getContext();
var sTempIds = event.getIds();
var bIsSingle = event.length()<=1;
if(!m_oMgr.__checkNoRecords(oHostInfos)) {
return;
}
if(!confirm(wcm.LANG.TEMPLATE_CONFIRM_0 || '此操作将校验模板的语法和文法细则,可能需要较长时间.确实要进行模板校验吗?')) {
return;
}
ProcessBar.start(wcm.LANG.TEMPLATE_49||'校验模板..');
var oPostData = m_oMgr.__getCurrentPostData(event, _sRenderAllName);
m_oMgr.getHelper().call(m_oMgr.serviceId, 'check', oPostData, true, function(_trans, _json){
ProcessBar.close();
var func = bIsSingle != true ? null : function(){
CMSObj.afteredit(event)();
}
Ext.Msg.report(_json, wcm.LANG.TEMPLATE_25 || '模板校验',func, {
option: function(report, index){
var nIndex = (event.length() ==1&&!_sRenderAllName) ? _json.REPORTS.REPORT.TITLE.indexOf('~Edit-'):(_json.REPORTS.REPORT[index]?_json.REPORTS.REPORT[index].TITLE.indexOf('~Edit-'):-1);
if(nIndex>-1){
return 'edit';
}
return 'no_edit';
},
renderOption:
function(sTempId){
$openMaxWin(WCMConstants.WCM6_PATH + 'template/template_add_edit.jsp?objectid=' + sTempId);
}.bind(this)
});
}.bind(this));
},
wcag2check : function(event){
var sTempIds = event.getIds();
var oHostInfos = event.getContext();
if(!m_oMgr.__checkNoRecords(oHostInfos)) {
return;
}
var oPostData = {HostType:103,HostId:0,TemplateId:sTempIds};
var oHelper = new com.trs.web2frame.BasicDataHelper();
oHelper.call(m_oMgr.serviceId, 'checkWCAG2TemplateText', oPostData, true, function(_trans, _json){
wcm.CrashBoarder.get('WCAG2-TEMPLATE').show({
title : wcm.LANG.TEMPLATE_55 || '模板WCAG2校验结果',
src : WCMConstants.WCM6_PATH + 'template/template_wcag2_check_result2.html',
width:'650px',
height:'350px',
maskable:true,
params : _json
});
}.bind(this));
},
preview : function(event){
window.open(WCMConstants.WCM6_PATH + 'template/template_preview.jsp?TempId=' + event.getIds());
},
previewFolder : function(event){
var _nTempId = event.getIds();
var host = event.getHost();
var _sEmploryId = event.objId;
var _nObjectType = event.objType;
var nTempType = event.tempType;
var oParams = {
objecttype: _nObjectType,
objectids: _sEmploryId,
templateid: _nTempId
}
var sChnlorSite = _nObjectType == 103 ? (wcm.LANG.TEMPLATE_CHNL||'栏目') : (wcm.LANG.TEMPLATE_SITE||'站点');
if(nTempType != 1) {
Ext.Msg.confirm(String.format(wcm.LANG.TEMPLATE_28||'当前模板并不是概览模板.<br><br>点击[确定]将按<b>默认首页模板</b>预览该{0}.',sChnlorSite), {
ok : function(){
var host = event.getHost();
var nObjectType = host.getIntType();
var sEmploryId = host.getId();
var oParams1 = {
objecttype: _nObjectType,
objectids: sEmploryId,
templateid: 0
}
m_oMgr.getHelper().call('wcm6_publish', 'preview', oParams1, true, function(_trans, _json){
if($v(_json, 'urlcount') == 0) {
try{
var errInfo = {
message: _json.DATA[0].EXCEPTION, 
detail: _json.DATA[0].EXCEPTIONDETAIL
};
$render500Err(_trans, errInfo, true);
}catch(err){
}
return;
}
try{
var sUrl = $v(_json, 'data')[0]['URLS'];
window.open(sUrl, 'preview_page');
}catch(err){
}
})
}
});
return;
}
m_oMgr.getHelper().call('wcm6_publish', 'preview', oParams, true, function(_trans, _json){
if($v(_json, 'urlcount') != '1') {
try{
var errInfo = {
message: (_json.DATA.length>0)?_json.DATA[0].EXCEPTION:"", 
detail: (_json.DATA.length>0)?_json.DATA[0].EXCEPTIONDETAIL:""
};
$render500Err(_trans, errInfo, true);
}catch(err){
}
return;
}
try{
var sUrl = $v(_json, 'data')[0]['URLS'];
window.open(sUrl, 'preview_page');
}catch(err){
}
})
}, 
'delete' : function(event){
var sTempIds = event.getIds() + '';
var oPageParams = event.getContext();
var nCount = (sTempIds.indexOf(',') == -1) ? 1 : sTempIds.split(',').length;
var sHint = (nCount==1)?'':' '+nCount+' ';
var oPostData = {
"ObjectIds": sTempIds
};
if (confirm(String.format(wcm.LANG.TEMPLATE_30||('确实要将这{0}个模板删除吗?'),sHint))){
var fun = function(){
m_oMgr.getHelper().call(m_oMgr.serviceId,'delete', oPostData, true, 
function(){
event.getObjs().afterdelete();
}
);
}
m_oMgr.getHelper().call('wcm61_template','existNestedTemplate', oPostData, true, 
function(_transport,_json){
if(_json.REPORTS.REPORT){
Ext.Msg.report(_json,"含有嵌套模板",fun);
}else{
fun();
}
}
);
}
},
synchAll : function(event, operItem){
return m_oMgr.synch(event, operItem, 'RedistributeAll');
},
synch : function(event, operItem, _sRenderAllName){
var oHostInfos = event.getContext();
if(!m_oMgr.__checkNoRecords(oHostInfos)) {
return;
}
if(_sRenderAllName && !confirm(wcm.LANG.TEMPLATE_CONFIRM_1 || '此操作将重新分发模板附件,可能需要较长时间.确实要同步附件吗?')) {
return;
}
ProcessBar.start(wcm.LANG.TEMPLATE_50||'同步模板附件');
var oPostData = m_oMgr.__getCurrentPostData(event, _sRenderAllName);
var dStart = new Date().getTime();
m_oMgr.getHelper().call(m_oMgr.serviceId, 'redistributeAppendixes', oPostData, true, function(){
var sInterval = (new Date().getTime() - dStart)/1000;
ProcessBar.close();
Ext.Msg.$success(String.format("成功同步了模板附件!实际耗时<br><b> {0}</b>秒.",sInterval));
}.bind(m_oMgr));
},
showArrangeEmployment : function(event){
var host = event.getHost();
var sRight = host.right;
var nHostType = event.getObj().getPropertyAsInt('folderType');
var nHostId = event.getObj().getPropertyAsInt('folderId');
var nTempId = event.getIds();
var nTempType = event.tempType;
if(!wcm.AuthServer.hasRight(sRight, 24)) {
return;
}
if(!(nHostType > 0) || !(nHostId > 0)) {
return;
}
var url = WCMConstants.WCM6_PATH + 'template/channel_select.html?TemplateId=' + nTempId + '&TemplateType=' + nTempType + '&HostType=' + nHostType + '&HostId=' + nHostId;
if(nHostType == '103' && wcm.AuthServer.hasRight(sRight, 9)) {
url += '&SiteModify=1';
}
FloatPanel.open(url, wcm.LANG.EMPOLOYTO||'将模板分配给栏目或站点使用',CMSObj.afteradd(event));
}
});
})();
(function(){
var pageObjMgr = wcm.domain.TemplateMgr;
var reg = wcm.SysOpers.register;
var fnIsVisible = function(event){
var host = event.getHost();
var context = event.getContext();
if(Ext.isTrue(host.isVirtual) && host.getPropertyAsInt("chnlType", 0) != 0){
return false;
}
return true;
};
reg({
key : 'edit',
type : 'template',
desc : wcm.LANG.TEMPLATE_0 || '修改这个模板',
title:'修改这个模板...',
rightIndex : 23,
order : 1,
fn : pageObjMgr['edit'],
quickKey : 'M'
});
reg({
key : 'preview',
type : 'template',
desc : wcm.LANG.TEMPLATE_2 || '预览这个模板',
title:'预览这个模板...',
rightIndex : 24,
order : 2,
fn : pageObjMgr['preview'],
quickKey : 'R'
});
reg({
key : 'export',
type : 'template',
desc : wcm.LANG.TEMPLATE_4 || '导出这个模板',
title:'导出这个模板...',
rightIndex : 24,
order : 3,
fn : pageObjMgr['export'],
quickKey : 'X'
});
reg({
key : 'check',
type : 'template',
desc : wcm.LANG.TEMPLATE_6 || '校验这个模板',
title:'校验这个模板...',
rightIndex : 25,
order : 4,
fn : pageObjMgr['check']
});
reg({
key : 'wcag2check',
type : 'template',
desc : wcm.LANG.TEMPLATE_53 || 'WCAG2校验',
title:'WCAG2校验...',
rightIndex : 25,
order : 6.5,
fn : pageObjMgr['wcag2check']
});
reg({
key : 'delete',
type : 'template',
desc : wcm.LANG.TEMPLATE_8 || '删除这个模板',
title:'删除这个模板...',
rightIndex : 22,
order : 5,
fn : pageObjMgr['delete'],
quickKey : ['Delete', 'ShiftDelete']
});
reg({
key : 'synch',
type : 'template',
desc : wcm.LANG.TEMPLATE_10 || '同步模板附件',
title:'同步模板附件...',
rightIndex : 28,
order : 6,
fn : pageObjMgr['synch']
});
reg({
key : 'new',
type : 'templateInChannel',
desc : wcm.LANG.TEMPLATE_12 || '新建一个模板',
title:'新建一个模板...',
rightIndex : 21,
order : 7,
fn : pageObjMgr['new'],
isVisible : fnIsVisible,
quickKey : 'N'
});
reg({
key : 'import',
type : 'templateInChannel',
desc : wcm.LANG.TEMPLATE_13 || '导入模板',
title:'导入模板',
rightIndex : 21,
order : 8,
fn : pageObjMgr['import'],
isVisible : fnIsVisible
});
reg({
key : 'export',
type : 'templateInChannel',
desc : wcm.LANG.TEMPLATE_15 || '导出所有模板',
title:'导出所有模板...',
rightIndex : 24,
order : 9,
fn : pageObjMgr['exportAll']
});
reg({
key : 'check',
type : 'templateInChannel',
desc : wcm.LANG.TEMPLATE_17 || '校验所有模板',
title:'校验所有模板...',
rightIndex : 25,
order : 10,
fn : pageObjMgr['checkAll']
});
reg({
key : 'synch',
type : 'templateInChannel',
desc : wcm.LANG.TEMPLATE_19 || '同步所有模板附件',
title : wcm.LANG.TEMPLATE_20 || '同步当前所列模板的附件',
rightIndex : 28,
order : 11,
fn : pageObjMgr['synchAll']
});
reg({
key : 'new',
type : 'templateInSite',
desc : wcm.LANG.TEMPLATE_12 || '新建一个模板',
title:'新建一个模板...',
rightIndex : 21,
order : 12,
fn : pageObjMgr['new'],
quickKey : 'N'
});
reg({
key : 'import',
type : 'templateInSite',
desc : wcm.LANG.TEMPLATE_13 || '导入模板',
title:'导入模板...',
rightIndex : 21,
order : 13,
fn : pageObjMgr['import']
});
reg({
key : 'export',
type : 'templateInSite',
desc : wcm.LANG.TEMPLATE_15 || '导出所有模板',
title:'导出所有模板...',
rightIndex : 24,
order : 14,
fn : pageObjMgr['exportAll']
});
reg({
key : 'check',
type : 'templateInSite',
desc : wcm.LANG.TEMPLATE_17 || '校验所有模板',
title:'校验所有模板...',
rightIndex : 25,
order : 15,
fn : pageObjMgr['checkAll']
});
reg({
key : 'synch',
type : 'templateInSite',
desc : wcm.LANG.TEMPLATE_19 || '同步所有模板附件',
title : wcm.LANG.TEMPLATE_20 || '同步当前所列模板的附件',
rightIndex : 28,
order : 16,
fn : pageObjMgr['synchAll']
});
reg({
key : 'export',
type : 'templates',
desc : wcm.LANG.TEMPLATE_22 || '导出这些模板',
title:'导出这些模板...',
rightIndex : 24,
order : 17,
fn : pageObjMgr['export'],
quickKey : 'X'
});
reg({
key : 'check',
type : 'templates',
desc : wcm.LANG.TEMPLATE_23 || '校验这些模板',
title:'校验这些模板...',
rightIndex : 25,
order : 18,
fn : pageObjMgr['check']
});
reg({
key : 'delete',
type : 'templates',
desc : wcm.LANG.TEMPLATE_21 || '删除这些模板',
title:'删除这些模板...',
rightIndex : 22,
order : 19,
fn : pageObjMgr['delete'],
quickKey : ['Delete', 'ShiftDelete']
});
reg({
key : 'synch',
type : 'templates',
desc : wcm.LANG.TEMPLATE_10 || '同步模板附件',
title:'同步模板附件...',
rightIndex : 28,
order : 20,
fn : pageObjMgr['synch']
});
reg({
key : 'designvisualtemplate',
type : 'template',
desc : '设计可视化模板',
title:'设计可视化模板...',
rightIndex : 23,
order : 1.5,
fn : function(){
pageObjMgr['designVisualTemplate'].apply(this, arguments);
},
isVisible : function(event){
var obj = event.getObjs().getAt(0);
if(obj.getPropertyAsString('VisualAble') != 'true'){
return false;
}
return true;
}
});
})();

Ext.ns('wcm.Templates', 'wcm.Template');
WCMConstants.OBJ_TYPE_TEMPLATE = 'template';
wcm.Templates = function(_config, _context){
this.objType = WCMConstants.OBJ_TYPE_TEMPLATE;
wcm.Templates.superclass.constructor.call(this, _config, _context);
}
Ext.extend(wcm.Templates, wcm.CMSObjs, {
});
wcm.Template = function(_config, _context){
this.objType = WCMConstants.OBJ_TYPE_TEMPLATE;
wcm.Template.superclass.constructor.call(this, _config, _context);
var arrRights = {
"view" : -1
};
for(rightName in arrRights){
var cameRightName = rightName.camelize();
var nRightIndex = parseInt(arrRights[rightName], 10);
this['can'+cameRightName] = function(){
return wcm.AuthServer.hasRight(this.right, nRightIndex);
}
}
}
CMSObj.register(WCMConstants.OBJ_TYPE_TEMPLATE, 'wcm.Template');
Ext.extend(wcm.Template, wcm.CMSObj, {
getIntType : function(){
return 102;
}
});

(function(){
var sName = wcm.LANG['TEMPLATE'] || '模板';
wcm.PageOper.registerPanels({
templateInRoot : {
isHost : true,
title : String.format(wcm.LANG['OPER_TITLE_INROOT'] || '库{0}操作任务', sName),
displayNum : 5
},
templateInSite : {
isHost : true,
title : String.format(wcm.LANG['OPER_TITLE_INSITE'] || '站点{0}操作任务', sName),
displayNum : 5
},
templateInChannel : {
isHost : true,
title : String.format(wcm.LANG['OPER_TITLE_INCHANNEL'] || '栏目{0}操作任务', sName),
displayNum : 5
},
template : {
title : String.format(wcm.LANG['OPER_TITLE_OBJ'] || '{0}操作任务', sName),
displayNum : 7,
url : '?serviceid=wcm61_template&methodname=jFindbyid'
},
templates : {
title : String.format(wcm.LANG['OPER_TITLE_OBJ'] || '{0}操作任务', sName),
displayNum : 7
}
});
})();
ValidationHelper.bindValidations([
{
renderTo : 'tempname',
type :'filename',
required :'',
max_len :'50',
desc :wcm.LANG.TEMPLATE_TEMPNAME||'模板名称',
methods : PageContext.validExistProperty(function(oParams){
var nRootId = PageContext.event.getObj().getPropertyAsInt("rootId");
Ext.apply(oParams, {
RootId : nRootId
});
})
},
{
renderTo : 'TempDesc',
type:'string',
max_len:'200',
desc:wcm.LANG.TEMPLATE_TEMPDESC||'模板描述'
},
{
renderTo : 'TempExt',
type :'common_char',
required :'',
desc :wcm.LANG.TEMPLATE_TEXNAME||'文件扩展名',
max_len :'50'
},
{
renderTo : 'OutputFileName',
type :'common_char',
required :'',
desc :wcm.LANG.TEMPLATE_OUTLINENAME||'发布文件名',
max_len :'50'
}
]);

Ext.ns('wcm.domain.TemplateMgr');
(function(){
var m_oTemplateMgr = wcm.domain.TemplateMgr;
Ext.apply(m_oTemplateMgr, {
'addOrEditVisualTemplate' : function(event, bAdd){
var postData = {};
var context = event.getContext();
var host = event.getHost();
if(context) {
if(host.getType() == null) {
postData = context;
}else{
postData['hosttype'] = host.getIntType();
postData['hostid'] = host.getId();
}
}
postData['objectid'] = (bAdd == true ? 0 : event.getIds()[0]);
if(context && context.isTypeStub) {
postData['typestub'] = 1;
}
wcm.CrashBoarder.get('visualtemplate_addedit').show({
title : wcm.LANG.visualTemplate_101 || '新建修改可视化模板',
src : WCMConstants.WCM6_PATH + 'template/visualtemplate_add_edit.jsp',
width:'700px',
height:'400px',
maskable:true,
params : postData,
callback : function(){
CMSObj.afteradd(event)({objType:WCMConstants.OBJ_TYPE_TEMPLATE});
this.hide();
}
});
},
'editGeneralTemplate' : function(event){
var sParams = m_oTemplateMgr.__getCurrentParams(event);
var params = event.getContext();
if(params && params.isTypeStub) {
sParams += '&typestub=1';
}
$openMaxWin(WCMConstants.WCM6_PATH + 'template/template_add_edit.jsp?' + sParams);
},
designVisualTemplate : function(event){
var nTempId = event.getIds();
var hostType = event.getHost().getIntType();
var hostId = event.getHost().getId();
window.open('../special/design.jsp?templateId=' + nTempId + 
'&HostType=' + hostType + '&HostId=' + hostId);
},
edit : function(event){
var bVisual = event.getObj().getPropertyAsString("VisualAble");
if(bVisual == 'true'){
m_oTemplateMgr.addOrEditVisualTemplate(event, false);
}else{
m_oTemplateMgr.editGeneralTemplate(event);
}
}
})
var editTemplate = wcm.SysOpers.getOperItem('template','edit');
Ext.apply(editTemplate, {
fn : function(event){
var bVisual = event.getObj().getPropertyAsString("VisualAble");
if(bVisual == 'true'){
m_oTemplateMgr.addOrEditVisualTemplate(event, false);
}else{
m_oTemplateMgr.edit(event);
}
}
})
Ext.apply(m_oTemplateMgr, {
'addVisualTemplate' : function(event){
m_oTemplateMgr.addOrEditVisualTemplate(event, true);
}
})
})();
(function(){
var pageObjMgr = wcm.domain.TemplateMgr;
var reg = wcm.SysOpers.register;
var fnIsVisible = function(event){
var host = event.getHost();
var context = event.getContext();
if(Ext.isTrue(host.isVirtual) && host.getPropertyAsInt("chnlType", 0) != 0){
return false;
}
return true;
};
reg({
key : 'newvisualtemplate',
type : 'templateInChannel',
desc : wcm.LANG.visualTemplate_102 || '新建可视化模板',
title:'新建可视化模板...',
rightIndex : 21,
order : 7,
fn : pageObjMgr['addVisualTemplate'],
isVisible : fnIsVisible
});
reg({
key : 'newvisualtemplate',
type : 'templateInSite',
desc : wcm.LANG.visualTemplate_102 || '新建可视化模板',
title:'新建可视化模板...',
rightIndex : 21,
order : 12,
fn : pageObjMgr['addVisualTemplate'],
isVisible : fnIsVisible
});
})();

