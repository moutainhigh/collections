Ext.apply(wcm.LANG, {
CHANNEL_EDIT : '修改这个栏目',
CHANNEL_EDIT_TITLE : '修改栏目的基本属性和发布设置等相关信息',
CHANNEL_EDIT_SEL : '修改当前选中的栏目',
CHANNEL_MOVE : '移动这个栏目',
CHANNEL_MOVE_TITLE : '移动这个栏目到指定的栏目',
CHANNEL_MOVE_SEL : '移动当前选中的栏目到...',
CHANNEL_TRASH : '删除栏目',
CHANNEL_TRASH_TITLE : '将这个栏目放入回收站',
CHANNEL_TRASH_SEL : '删除栏目',
CHANNEL_PREVIEW : '预览这个栏目',
CHANNEL_PREVIEW_TITLE : '重新生成并打开这个栏目的预览页面',
CHANNEL_ADDPUB : '增量发布这个栏目',
CHANNEL_ADDPUB_TITLE : '发布栏目的首页，并且发布所有处于可发布状态的文档',
CHANNEL_ADDPUB_UNPUB : '仅发布尚未发布的内容同时更新相关概览页面',
CHANNEL_SOLOPUB : '仅发布此栏目的首页',
CHANNEL_SOLOPUB_TITLE : '重新生成并发布当前栏目的首页',
CHANNEL_EXPORT : '导出这个栏目',
CHANNEL_EXPORT_SEL : '导出当前选中的栏目（提供下载的zip或者xml文件）',
CHANNEL_SYNCH : '同步模板到子栏目',
CHANNEL_SYNCH_TITLE : '将当前栏目的模板应用到其子栏目上',
CHANNEL_SEPERATE : '分隔线',
CHANNEL_FULLPUB : '完全发布这个栏目',
CHANNEL_FULLPUB_TITLE : '重新生成并发布当前栏目下的的所有文件',
CHANNEL_REFULLPUB : '重新生成栏目或站点下所有的细览页面以及概览页面',
CHANNEL_REFRESHPUB : '更新发布这个栏目',
CHANNEL_REFRESHPUB_TITLE : '更新发布当前栏目和其相关栏目的首页',
CHANNEL_CANCELPUB : '撤销发布这个栏目',
CHANNEL_CANCELPUB_PUBED : '撤回已发布目录或页面',
CHANNEL_LIKECOPY : '类似创建',
CHANNEL_LIKECOPY_TITLE : '创建相似的栏目（唯一标识和存放位置不同）',
CHANNEL_NEW : '新建一个栏目',
CHANNEL_NEW_INSITE : '在当前站点中新建一个子栏目',
CHANNEL_IMPORT : '导入栏目',
CHANNEL_IMPORT_INSITE : '在当前站点中导入一个子栏目（从zip文件中）',
CHANNEL_EXPORTALL : '导出所有子栏目',
CHANNEL_EXPORTALL_INSITE : '导出当前站点下的所有子栏目（提供下载的zip或者xml文件）',
CHANNEL_NEW_INCHANNEL : '在当前栏目中新建一个子栏目',
CHANNEL_IMPORT_INCHANNEL : '在当前栏目中导入一个子栏目（从zip文件中）',
CHANNEL_EXPORTALL_INCHANNEL : '导出当前栏目下的所有子栏目（提供下载的zip或者xml文件）',
CHANNEL_EDIT_NOW : '修改当前栏目',
CHANNEL_EDIT_NOW_TITLE : '修改当前栏目的基本属性和发布设置等相关信息',
CHANNEL_MOVE_NOW : '移动当前栏目',
CHANNEL_MOVE_NOW_TITLE : '移动当前栏目到指定的位置',
CHANNEL_MOVE_NOWTO : '移动当前栏目到...',
CHANNEL_TRASH_NOW : '将当前栏目放入回收站',
CHANNEL_PREVIEW_NOW : '预览当前栏目',
CHANNEL_PREVIEW_NOWPUB : '预览当前栏目的发布效果',
CHANNEL_ADDPUB_NOW : '增量发布当前栏目',
CHANNEL_ADDPUB_NOW_TITLE : '发布当前栏目和其子栏目的首页，并且发布该栏目下所有可发布状态的文档',
CHANNEL_SOLOPUB_NOW : '仅发布当前栏目首页',
CHANNEL_SOLOPUB_NOW_TITLE : '重新生成并发布当前栏目的首页',
CHANNEL_EXPORT_NOW : '导出当前栏目',
CHANNEL_EXPORT_NOW_INFO : '导出当前栏目（提供下载的zip或者xml文件）',
CHANNEL_FULLPUB_NOW : '完全发布当前栏目',
CHANNEL_FULLPUB_NOW_TITLE : '重新生成和发布当前栏目下的所有文档',
CHANNEL_REFRESHPUB_NOW : '更新发布当前栏目',
CHANNEL_REFRESHPUB_SEL : '仅重新生成当前栏目的首页以及相关的概览页面',
CHANNEL_CANCELPUB_NOW : '撤销发布当前栏目',
CHANNEL_MOVESOME : '移动这些栏目',
CHANNEL_MOVESOME_TITLE : '移动这些栏目到指定的栏目',
CHANNEL_ADDPUBSOME : '增量发布这些栏目',
CHANNEL_ADDPUBSOME_TITLE :'发布选中的栏目的首页，并且发布所有可发布状态的文档',
CHANNEL_PREVIEWSOME : '预览这些栏目',
CHANNEL_PREVIEWSOME_SEL : '预览当前选中栏目的发布效果',
CHANNEL_SOLOPUBSOME : '仅发布这些栏目的首页',
CHANNEL_SOLOPUBSOME_TITLE : '重新生成并发布选中栏目的首页',
CHANNEL_EXPORTPUBSOME : '导出这些栏目',
CHANNEL_FULLPUBSOME : '完全发布这些栏目',
CHANNEL_FULLPUBSOME_TITLE : '重新生成并发布选中栏目下的所有文件',
CHANNEL_REFRESHPUBSOME : '更新发布这些栏目',
CHANNEL_REFRESHPUBSOME_TITLE : '重新生成并发布选中栏目和与其相关栏目的首页',
CHANNEL_CANCELPUBSOME : '撤销发布这些栏目',
CHANNEL_CANCELPUBSOME_TITLE : '撤销选中栏目的发布操作',
CHANNEL_UNITNAME : '个',
CHANNEL_TYPENAME : '栏目',
CHANNEL_DESC : '显示名称',
CHANNEL_CHNLNAME : '唯一标识',
CHANNEL_CRUSER : '创建者',
CHANNEL_ID : '栏目ID',
CHANNEL_CHNLORDER : '默认排序',
CHANNEL_CHNLTYPE : '栏目类型',
CHANNEL_CRTIME : '创建时间',
CHANNEL_TRUE : '确定',
CHANNEL_CANCEL : '取消',
CHANNEL_RESET_FIELDS : '恢复默认',
CHANNEL_ALERT_1 : '请选择栏目移动的目标站点/栏目!',
CHANNEL_ALERT_2 : "文件路径为空，上传失败！",
CHANNEL_1 : '栏目导入结果',
CHANNEL_2 : '导出当前栏目及其下的各级子栏目',
CHANNEL_3 : '递归导出所有子栏目及其下的各级子栏目',
CHANNEL_ALERT_3 : '成功将当前栏目模板同步到了其子栏目下！',
CHANNEL_4 : '删除栏目',
CHANNEL_5 : '栏目移动',
CHANNEL_6 : '栏目导入',
CHANNEL_7 : '栏目类似创建结果',
CHANNEL_8 : '栏目类似创建',
CHANNEL_9 : '新建/修改栏目',
CHANNEL_10 : '导出栏目',
CHANNEL_11 : "确实要同步模板到子栏目吗？<br><span style='color:red;font:16px;'>注意：<br>该操作会覆盖更改所有子栏目的模板设置！</span>",
CHANNEL_12 : "确实要将此栏目放入回收站吗? ",
CHANNEL_13 : "确实要将这 {0}个栏目放入回收站吗? ",
CHANNEL_14 : '请选择栏目类似创建的目标站点/栏目!',
CHANNEL_15 : '点击进行查看',
CHANNEL_ALERT_4 : '由于您尚未启用或尚未购买表单选件，无法进行当前表单栏目的属性查看或编辑操作！',
CHANNEL_16 : '自定义表单栏目',
CHANNEL_ALERT_5 : '当前栏目可能已被放入栏目回收站中，您暂时无法对其进行操作！',
CHANNEL_17 : "新建/修改图片分类",
CHANNEL_18 : "新建/修改视频栏目",
CHANNEL_19 : '请为表单栏目选择一个表单！',
CHANNEL_ALERT_6 : "由于指定了“只使用检索条件检索”，请输入检索条件后再提交！",
CHANNEL_ALERT_7 : "开始时间不能大于/等于结束时间",
CHANNEL_ALERT_8 : "间隔时间为0或超出了运行设定时间",
CHANNEL_20 : '点击进行查看',
CHANNEL_22 : '选择工作流',
CHANNEL_21 : '栏目显示名称',
CHANNEL_23 : '栏目唯一标识',
CHANNEL_24 : "唯一标识不唯一",
CHANNEL_25 : "存放位置不唯一",
CHANNEL_26 : "sql不正确",
CHANNEL_27 : '小时',
CHANNEL_28 : '分钟',
CHANNEL_29 : '结束时间',
CHANNEL_30 : '间隔时间',
CHANNEL_31 : '内容新建修改页面',
CHANNEL_32 : '内容列表页面',
CHANNEL_33 : '内容查看页面',
CHANNEL_NONE : '无',
CHANNEL_34 : '新建',
CHANNEL_35 : '新建一个栏目',
CHANNEL_36 : '修改',
CHANNEL_37 : '修改这个栏目',
CHANNEL_38 : '导出栏目',
CHANNEL_39 : '删除',
CHANNEL_40 : '删除这个/些栏目',
CHANNEL_41 : '刷新',
CHANNEL_42 : '刷新列表',
CHANNEL_43 : '栏目列表管理',
CHANNEL_44 : "确实要<font color='red' style='font-size:14px;'>撤销发布</font>这个栏目么？将<font color='red' style='font-size:14px;'>不可逆转</font>！",
CHANNEL_SELECT_ORDERWAY : '选择排序方式',
CHANNEL_FAUILD : '解锁失败',
FLOW_ADD_EDIT : '新建/修改工作流',
CHANNEL_45 : '确实要改变当前拖动栏目的排列顺序吗?',
CHANNEL_46 : '无法将栏目移动成为头条、图片等特殊栏目的子栏目！',
CHANNEL_47 : "存放位置",
CHANNEL_COMMENT : '管理评论',
CHANNEL_COMMENT_TITLE : '管理当前栏目下的所有评论',
CHANNEL_COMMENTMGR : '管理栏目的评论',
CHANNEL_DOCPOSITIONSET : '调整顺序',
CHANNEL_DOCPOSITIONSET_TITLE : '调整当前栏目在站点中的顺序',
CHANNEL_48 : '栏目-调整顺序',
CHANNEL_49 : '确实要将栏目"',
CHANNEL_50 : '移动为栏目"',
CHANNEL_51 : '"的子栏目吗？',
CHANNEL_52 : '自定义表单栏目',
CHANNEL_53 : '校验语句',
CHANNEL_54 : '校验结果',
CHANNEL_55 : '站点栏目操作任务',
CHANNEL_56 : '子栏目操作任务',
CHANNEL_57 : '栏目操作任务',
CHANNEL_58 : '栏目显示名称',
CHANNEL_59 : '栏目唯一标识',
CHANNEL_60 : '计划撤销发布时间不能早于当前时间',
CHANNEL_61 : '栏目链接',
CHANNEL_62 : '不能改变头条、图片栏目的位置！',
CHANNEL_63 : '不能将该栏目放在头条、图片栏目之前！',
CHANNEL_64:'选择栏目',
TEMPLATE_SELECT : '选择模板',
FLOW_60 : '选择工作流',
CHANNEL_CREATE_FROMFILE:'批量创建',
CHANNEL_CREATE_FROMFILE_TITLE:'从文件批量创建栏目',
CHANNEL_65 : '批量创建栏目',
CHANNEL_66 : '导出所有栏目',
CHANNEL_DESC_LIST_ORDER : '栏目名称',
CHANNEL_LIKECOPY_2 : '类似创建栏目',
CHANNEL_67 : '没有任何要导出的栏目。',
CHANNEL_68 : '保存',
CHANNEL_69 : '关闭',
CHANNEL_70 : "编辑器工具栏定制",
CHANNEL_71 : '样式文件导入',
CHANNEL_72 : '定制编辑器工具栏',
CHANNEL_73 : '导入编辑器样式文件',
CHANNEL_74 : '设置文档列表显示字段',
CHANNEL_75 : '文档编辑页面属性定制',
CHANNEL_76 : '选定的字段都必须设定宽度.',
CHANNEL_77 : '排序出错.',
CHANNEL_78 : '除默认的文档标题外，您没有选择其他字段，系统将还原为显示默认字段.',
CHANNEL_79 : '计划撤销发布时间不能为空',
CHANNEL_80 : '您选的字段太多，数据超长。',
CHANNEL_81 : '导读管理',
CHANNEL_82 : '第[',
CHANNEL_83 : ']个设置为空!',
CHANNEL_84 : '选择检索条件',
CHANNEL_85 : '您确定要采用输入模式的值吗？',
CHANNEL_86 : '您确定要采用选择模式的值吗？',
CHANNEL_87 : '进入导读详细页面',
CHANNEL_88 : 'ajax 失败!',
CHANNEL_89 : '栏目上没有设置导读，请先设置!',
CHANNEL_90 : '导读名称不能为空!',
CHANNEL_91 : '宽度',
CHANNEL_92 : '导读',
CHANNEL_93 : '不能为空!',
CHANNEL_94 : '必须为数字!',
CHANNEL_95 : '保存失败!',
CHANNEL_96 : '保存成功!',
CHANNEL_97 : '双击选择文档...',
CHANNEL_98 : '设置标题格式',
CHANNEL_99 : '行数',
CHANNEL_100 : '列数',
CHANNEL_101 : "当前没有选择导读文档，现在选择？",
CHANNEL_102 : "当前共选择{0}导读文档，更改选择？",
CHANNEL_103 : '移除该文档',
CHANNEL_104 : '您的IE插件已经将对话框拦截！\n',
CHANNEL_105 : '请将拦截去掉-->点击退出-->关闭IE，然后重新打开IE登录即可！\n',
CHANNEL_106 : '给您造成不便，TRS致以深深的歉意！',
CHANNEL_107 : ']个设置的值类型不正确，正确的类型为[',
CHANNEL_108 : '字符串：例如 test',
CHANNEL_109 : '整型：例如 5',
CHANNEL_110 : '日期：例如 2010-1-22',
CHANNEL_116 : '导读名称最大长度为60！',
CHANNEL_117 : '字体大小',
CHANNEL_118 : '单元间距',
CHANNEL_119 : '不在范围',
CHANNEL_120 : '批量修改文档属性',
CHANNEL_121 : '修改所有文档属性',
CHANNEL_122 : '执行导出栏目..'
});

Ext.ns('wcm.domain.ChannelMgr');
(function(){
var m_nChannelObjType = 101;
var m_sServiceId = 'wcm6_channel';
var m_oMgr = wcm.domain.ChannelMgr;
function getHelper(){
return new com.trs.web2frame.BasicDataHelper();
}
function edit(event, oParams){
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'channel/channel_add_edit.jsp?' + $toQueryStr(oParams),
title : wcm.LANG.CHANNEL_9||'新建/修改栏目',
callback : function(objId){
CMSObj[oParams["objectid"] > 0 ? 'afteredit' : 'afteradd'](event)({objType:WCMConstants.OBJ_TYPE_CHANNEL, objId:objId});
}
});
}
function renderMove(event, _args){
moveAsChild(_args.srcId, _args.dstId, (_args.dstType == 103), event);
}
function moveAsChild(_nSrcChnlIds, _nTargetId, _bIsSite, event){
var oPostData = {srcChannelIds : _nSrcChnlIds};
if(_bIsSite === true) {
oPostData.DstSiteId = _nTargetId;
}else{
oPostData.DstChannelId = _nTargetId;
}
getHelper().call(m_sServiceId, 'moveAsChild', oPostData, true, function(){
var objsOrHost = event.getObjsOrHost();
var items = [];
for (var i = 0; i < objsOrHost.length(); i++){
items.push({objId : objsOrHost.getAt(i).getId()});
}
var context = {dstObjectId : _nTargetId, isSite : _bIsSite};
var oCmsObjs = CMSObj.createEnumsFrom({
objType : objsOrHost.getType()
}, context);
oCmsObjs.addElement(items);
oCmsObjs.aftermove();
});
}
function renderLikecopy(event,_args){
var oPostData = {srcChannelId: _args.srcId};
if(_args.dstType == 103) {
oPostData.DstSiteId = _args.dstId;
}else{
oPostData.DstChannelId = _args.dstId;
}
var nType = _args.dstType, nDstSiteId = oPostData.DstSiteId, nDstChnlId = oPostData.DstChannelId;
ProcessBar.start(wcm.LANG.CHANNEL_8||'栏目类似创建');
getHelper().call(m_sServiceId, 'createFrom', oPostData, true, function(_trans, _json){
var bSucess = $v(_json, 'REPORTS.IS_SUCCESS');
var objectIds = $v(_json, 'REPORTS.ObjectIds.ObjectId');
ProcessBar.close();
Ext.Msg.report(_json, wcm.LANG.CHANNEL_7||'栏目类似创建结果', function(){
if(bSucess != 'true') return;
var wcmEvent = CMSObj.createEvent(event.getHost(), {
objId : _args.dstId,
objType : _args.dstType==103 ?
WCMConstants.OBJ_TYPE_WEBSITE : WCMConstants.OBJ_TYPE_CHANNELMASTER
});
CMSObj.afteradd(wcmEvent)({objType:WCMConstants.OBJ_TYPE_CHANNEL, objId:objectIds});
});
});
}
function resetTemplates(_nFolderId, _nObjType, _fCallBack){
getHelper().call('wcm6_template', 'impartTemplateConfig',
{objectId: _nFolderId, ObjectType:_nObjType}, true, _fCallBack);
}
function synchTemplates(_nFolderId, _nObjType, childObjIds, _fCallBack){
getHelper().call('wcm61_template', 'synTemplates',
{objectId: _nFolderId, ObjectType:_nObjType, objectIds : childObjIds}, true, _fCallBack);
}
Ext.apply(wcm.domain.ChannelMgr, {
'new' : function(event){
var hostId = event.getHost().getId();
var hostType = event.getHost().getIntType();
edit(event, {
objectid: 0,
channelid: 0,
parentid: hostType == 101 ? hostId : 0,
siteid: hostType == 101 ? 0 : hostId
});
},
edit : function(event){
var hostId = event.getHost().getId();
var hostType = event.getHost().getIntType();
var obj = event.getObj().getId();
edit(event, {
objectid: event.getObj().getId(),
channelid: event.getObj().getId(),
parentid: hostType == 101 ? hostId : 0,
siteid: hostType == 101 ? 0 : hostId
});
},
'import' : function(event){
var hostId = event.getHost().getId();
var hostType = event.getHost().getIntType();
var params = {
parentid : hostId,
objecttype : hostType
}
FloatPanel.open(WCMConstants.WCM6_PATH + 'channel/channel_import.html?' + $toQueryStr(params), wcm.LANG.CHANNEL_6||'栏目导入', function(){
CMSObj.afteradd(event)({objType:WCMConstants.OBJ_TYPE_CHANNEL});
});
},
export0 : function (oPostData){
if(oPostData.ObjectIds){
FloatPanel.open(WCMConstants.WCM6_PATH + 'channel/channel_export.html?' + $toQueryStr(oPostData)
, wcm.LANG.CHANNEL_10||'导出栏目');
}else
FloatPanel.open(WCMConstants.WCM6_PATH + 'channel/channel_export.html?' + $toQueryStr(oPostData)
, wcm.LANG.CHANNEL_66||'导出所有栏目');
},
exportAll : function(event){
var hostId = event.getHost().getId();
var hostType = event.getHost().getIntType();
if(event.getContext().RecordNum <= 0) {
Ext.Msg.$fail(wcm.LANG.CHANNEL_67||'没有任何要导出的栏目。');
return false;
}
var objId = hostId;
var oPostData = {};
oPostData[hostType == 101 ? 'parentChannelId' : 'parentSiteId'] = objId;
wcm.domain.ChannelMgr.export0(oPostData);
},
'export' : function(event){
var hostId = event.getHost().getId();
var hostType = event.getHost().getIntType();
var objType = event.getObjs().getIntType();
var objIds = objType == 101 ? event.getIds().join(",") || hostId : hostId;
wcm.domain.ChannelMgr.export0({ObjectIds : objIds});
},
move : function(event){
var host = event.getHost();
var hostId = host.getId();
var hosttype = host.getIntType();
var sIds = (event.getIds().length == 0)?hostId : event.getIds();
var sUrl = WCMConstants.WCM6_PATH + 'channel/channel_select_move.html?srcId=' + sIds;
var sFolderInfo = 'folderType=' + hosttype;
sFolderInfo += '&folderId=' + hostId;
sUrl += '&' + sFolderInfo;
FloatPanel.open(sUrl, wcm.LANG.CHANNEL_5||'栏目移动',renderMove.bind(this, event));
},
likecopy : function(event){
var host = event.getHost();
var hostId = host.getId();
var sSrcId = (event.getIds().length == 0)?hostId : event.getIds();
var sSiteType = event.getContext().params["SITETYPE"];
var oParams = {srcId : sSrcId, siteType : sSiteType};
FloatPanel.open(WCMConstants.WCM6_PATH + 'channel/channel_select_likecopy.jsp?' + $toQueryStr(oParams) , wcm.LANG.CHANNEL_LIKECOPY_2 || '类似创建',renderLikecopy.bind(this,event));
},
trash : function(event){
var hostId = event.getHost().getId();
var sIds = (event.getIds().length == 0)?hostId : event.getIds();
sIds = sIds + '';
var nCount = (sIds.indexOf(',') == -1) ? 1 : sIds.split(',').length;
var sCon = "";
if(nCount == 1){
sCon = wcm.LANG.CHANNEL_12||"确实要将此栏目放入回收站吗?";
}else{
sCon = String.format(wcm.LANG.CHANNEL_13||("确实要将这 {0} 个栏目放入回收站吗?"),nCount);
}
getHelper().call('wcm61_special', 'findByChnlIds', {ChannelIds : sIds}, true, function(transport, _json){
try{
var oSpecials = $a(_json, "Specials.Special");
if(!oSpecials[0]){
if (confirm(sCon)){
ProcessBar.start(wcm.LANG.CHANNEL_4||'删除栏目');
getHelper().call(m_sServiceId, 'delete', {ObjectIds: sIds, drop: false}, true, function(){
ProcessBar.close();
window.setTimeout(function(){
event.getObjsOrHost().afterdelete();
}, 500);
});
}
}else {
alert("包含与专题对应的栏目，这样的栏目不能直接被删除，请到专题管理页面删除对应专题！");
}
}catch(e){
alert(e);
}
});
},
commentmgr : function(event){
var hostId = event.getHost().getId();
var sIds = (event.getIds().length == 0)?hostId : event.getIds();
var oParams = {
ChannelId : sIds
}
var sUrl = WCMConstants.WCM_ROOTPATH + 'comment/comment_mgr.jsp?' + $toQueryStr(oParams);
var sWinName = 'comment_name';
$openMaxWin(sUrl, sWinName);
},
chnlpositionset : function(event){
var oPageParams = event.getContext();
var channelId = 0;
if(event.getObjs().getAt(0)==null){
channelId = event.getHost().getId();
}
else {
channelId = event.getObjs().getAt(0).getId();
}
Object.extend(oPageParams,{"ChannelId":channelId});
FloatPanel.open(WCMConstants.WCM6_PATH + 'channel/channel_position_set.jsp?' + $toQueryStr(oPageParams),
wcm.LANG.CHANNEL_48||'栏目-调整顺序', CMSObj.afteredit(event));
},
synTemplates : function(event){
var objId = event.getObj().getId();
var params = {
objType:m_nChannelObjType,
objId:objId,
close : 0,
ExcludeTop : 1,
ExcludeInfoview : 0,
ExcludeLink : 1
};
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'channel/object_select.html',
dialogArguments : params,
title : wcm.LANG.CHANNEL_64||'选择栏目',
callback : function(args){
if(args.allChildren){
var sHtml = wcm.LANG.CHANNEL_11||"确实要同步模板到子栏目吗？<br><span style=\'color:red;font:16px;\'>注意：<br>该操作会覆盖更改所有子栏目的模板设置！</span>";
Ext.Msg.confirm(sHtml, {
ok : function(){
FloatPanel.close();
resetTemplates(objId, m_nChannelObjType);
}
});
}else{
FloatPanel.close();
synchTemplates(objId, m_nChannelObjType, args.ids.join());
}
}
});
},
preview : function(event){
var hostId = event.getHost().getId();
var aObjIds = (event.getIds().length == 0)?hostId : event.getIds().join(",");
wcm.domain.PublishAndPreviewMgr.preview(aObjIds, m_nChannelObjType);
},
publish : function(event, _sServiceId){
var hostId = event.getHost().getId();
var aObjIds = (event.getIds().length == 0)?hostId : event.getIds().join(",");
wcm.domain.PublishAndPreviewMgr.publish(aObjIds, m_nChannelObjType, _sServiceId);
},
increasingpublish : function(event){
m_oMgr.publish(event, 'increasingPublish');
},
increasepublish : function(event){
m_oMgr.increasingpublish(event);
},
fullypublish : function(event){
m_oMgr.publish(event, 'fullyPublish');
},
refreshpublish : function(event){
m_oMgr.publish(event, 'refreshPublish');
},
solopublish : function(event){
m_oMgr.publish(event, 'soloPublish');
},
recallpublish : function(event){
var sHtml = String.format("确实要{0}撤销发布{1}这个栏目么？将{2}不可逆转！{3}",'<font color=\'red\' style=\'font-size:14px;\'>','</font>','<font color=\'red\' style=\'font-size:14px;\'>','</font>');
Ext.Msg.confirm(sHtml,{
yes : function(){
m_oMgr.publish(event, 'recallPublish');
}
})
},
createFromFile : function(event){
var hostId = event.getHost().getId();
var hostType = event.getHost().getIntType();
var params = {
parentid : hostId,
objecttype : hostType
}
FloatPanel.open(WCMConstants.WCM6_PATH + 'channel/channel_create_fromfile.html?' + $toQueryStr(params), '批量创建栏目', function(){
CMSObj.afteradd(event)({objType:WCMConstants.OBJ_TYPE_CHANNEL});
});
}
});
})();
(function(){
var pageObjMgr = wcm.domain.ChannelMgr;
var reg = wcm.SysOpers.register;
var fnIsVisible = function(event){
var objs = event.getObjs();
var context = event.getContext();
if(objs.length() > 0){
var chnlTypes = objs.getPropertyAsInt("chnlType", 0);
}else{
var chnlTypes = context.get('ChannelType') || 0;
}
if(!Array.isArray(chnlTypes)){
chnlTypes = [chnlTypes];
}
var hideChnlTypes = [1,2,11];
for (var i = 0; i < chnlTypes.length; i++){
if(hideChnlTypes.include(chnlTypes[i])) return false;
}
return true;
}
var fnIsVisible2 = function(event){
var objs = event.getObjs();
var context = event.getContext();
if(objs.length() > 0){
var chnlTypes = objs.getPropertyAsInt("chnlType", 0);
}else{
var chnlTypes = context.get('ChannelType') || 0;
}
if(!Array.isArray(chnlTypes)){
chnlTypes = [chnlTypes];
}
var hideChnlTypes = [1,2,11,13];
for (var i = 0; i < chnlTypes.length; i++){
if(hideChnlTypes.include(chnlTypes[i])) return false;
}
return true;
}
var fnIsVisible3 = function(event){
var objs = event.getObjs();
var context = event.getContext();
if(context.params.SITETYPE && context.params.SITETYPE.indexOf("4") != -1)
return false;
if(objs.length() > 0){
var chnlTypes = objs.getPropertyAsInt("chnlType", 0);
}else{
var chnlTypes = context.get('ChannelType') || 0;
}
if(!Array.isArray(chnlTypes)){
chnlTypes = [chnlTypes];
}
var hideChnlTypes = [1,2,11,13];
for (var i = 0; i < chnlTypes.length; i++){
if(hideChnlTypes.include(chnlTypes[i])) return false;
}
return true;
}
reg({
key : 'edit',
type : 'channel',
desc : wcm.LANG.CHANNEL_EDIT || '修改这个栏目',
title : wcm.LANG.CHANNEL_EDIT_TITLE || '修改栏目的基本属性和发布设置等相关信息',
rightIndex : 13,
order : 1,
fn : pageObjMgr['edit'],
quickKey : 'M'
});
reg({
key : 'move',
type : 'channel',
desc : wcm.LANG.CHANNEL_MOVE || '移动这个栏目',
title : wcm.LANG.CHANNEL_MOVE_TITLE || '移动这个栏目到指定的栏目',
rightIndex : 12,
order : 2,
fn : pageObjMgr['move']
});
reg({
key : 'preview',
type : 'channel',
desc : wcm.LANG.CHANNEL_PREVIEW || '预览这个栏目',
title : wcm.LANG.CHANNEL_PREVIEW_TITLE || '重新生成并打开这个栏目的预览页面',
rightIndex : 15,
order : 4,
fn : pageObjMgr['preview'],
isVisible : fnIsVisible,
quickKey : 'R'
});
reg({
key : 'increasingpublish',
type : 'channel',
desc : wcm.LANG.CHANNEL_ADDPUB || '增量发布这个栏目',
title : wcm.LANG.CHANNEL_ADDPUB_TITLE || '发布栏目的首页，并且发布所有处于可发布状态的文档',
rightIndex : 17,
order : 5,
fn : pageObjMgr['increasingpublish'],
isVisible : fnIsVisible,
quickKey : 'P'
});
reg({
key : 'solopublish',
type : 'channel',
desc : wcm.LANG.CHANNEL_SOLOPUB || '仅发布此栏目的首页',
title : wcm.LANG.CHANNEL_SOLOPUB_TITLE || '重新生成并发布当前栏目的首页',
rightIndex : 17,
order : 6,
fn : pageObjMgr['solopublish'],
isVisible : fnIsVisible
});
reg({
key : 'export',
type : 'channel',
desc : wcm.LANG.CHANNEL_EXPORT || '导出这个栏目',
title : wcm.LANG.CHANNEL_EXPORT_SEL || '导出当前选中的栏目（提供下载的zip或者xml文件）',
rightIndex : 13,
order : 7,
fn : pageObjMgr['export']
});
reg({
key : 'synTemplates',
type : 'channel',
desc : wcm.LANG.CHANNEL_SYNCH || '同步模板到子栏目',
title : wcm.LANG.CHANNEL_SYNCH_TITLE || '将当前栏目的模板应用到其子栏目上',
rightIndex : 13,
order : 8,
fn : pageObjMgr['synTemplates'],
isVisible : fnIsVisible2
});
reg({
key : 'seperate',
type : 'channel',
desc : wcm.LANG.CHANNEL_SEPERATE || '分隔线',
rightIndex : -1,
order : 9,
fn : pageObjMgr['seperate']
});
reg({
key : 'fullypublish',
type : 'channel',
desc : wcm.LANG.CHANNEL_FULLPUB || '完全发布这个栏目',
title : wcm.LANG.CHANNEL_FULLPUB_TITLE || '重新生成并发布当前栏目下的的所有文件',
rightIndex : 16,
order : 10,
fn : pageObjMgr['fullypublish'],
isVisible : fnIsVisible
});
reg({
key : 'refreshpublish',
type : 'channel',
desc : wcm.LANG.CHANNEL_REFRESHPUB || '更新发布这个栏目',
title : wcm.LANG.CHANNEL_REFRESHPUB_TITLE || '更新当前栏目和其相关栏目的首页',
rightIndex : 17,
order : 11,
fn : pageObjMgr['refreshpublish'],
isVisible : fnIsVisible
});
reg({
key : 'recallpublish',
type : 'channel',
desc : wcm.LANG.CHANNEL_CANCELPUB || '撤销发布这个栏目',
title : wcm.LANG.CHANNEL_CANCELPUB_PUBED || '撤回已发布目录或页面',
rightIndex : 16,
order : 12,
fn : pageObjMgr['recallpublish'],
isVisible : fnIsVisible
});
reg({
key : 'seperate',
type : 'channel',
desc : wcm.LANG.CHANNEL_SEPERATE || '分隔线',
rightIndex : -1,
order : 13,
fn : pageObjMgr['seperate']
});
reg({
key : 'likecopy',
type : 'channel',
desc : wcm.LANG.CHANNEL_LIKECOPY || '类似创建',
title : wcm.LANG.CHANNEL_LIKECOPY_TITLE || '创建相似的栏目（唯一标识和存放位置不同）',
rightIndex : 13,
order : 14,
fn : pageObjMgr['likecopy']
});
reg({
key : 'docpositionset',
type : 'channel',
desc : wcm.LANG.CHANNEL_DOCPOSITIONSET || '调整顺序',
title : wcm.LANG.CHANNEL_DOCPOSITIONSET_TITLE || '调整当前栏目在站点中的顺序',
isVisible : fnIsVisible,
rightIndex : 13,
order : 35,
fn : pageObjMgr['chnlpositionset']
});
reg({
key : 'commentmgr',
type : 'channel',
desc : wcm.LANG.CHANNEL_COMMENT || '管理评论',
title : wcm.LANG.CHANNEL_COMMENT_TITLE || '管理当前栏目下的所有评论',
rightIndex : 8,
order : 16,
fn : pageObjMgr['commentmgr'],
isVisible : function(event){
try{
return $MsgCenter.getActualTop().g_IsRegister['comment'];
}catch(err){
return false;
}
}
});
reg({
key : 'new',
type : 'websiteHost',
desc : wcm.LANG.CHANNEL_NEW || '新建一个栏目',
title : wcm.LANG.CHANNEL_NEW_INSITE || '在当前站点下创建一个新栏目',
rightIndex : 11,
order : 258,
fn : pageObjMgr['new'],
quickKey : 'N'
});
reg({
key : 'import',
type : 'websiteHost',
desc : wcm.LANG.CHANNEL_IMPORT || '导入栏目',
title : wcm.LANG.CHANNEL_IMPORT_INSITE || '在当前站点中导入一个子栏目（从zip文件中）',
rightIndex : 11,
order : 259,
fn : pageObjMgr['import']
});
reg({
key : 'export',
type : 'websiteHost',
desc : wcm.LANG.CHANNEL_EXPORTALL || '导出所有子栏目',
title : wcm.LANG.CHANNEL_EXPORTALL_INSITE || '导出当前站点下的所有子栏目（提供下载的zip或者xml文件）',
rightIndex : 13,
order : 260,
fn : pageObjMgr['exportAll']
});
reg({
key : 'new',
type : 'channelHost',
desc : wcm.LANG.CHANNEL_NEW || '新建一个栏目',
title : wcm.LANG.CHANNEL_NEW_INCHANNEL ||'在当前栏目中新建一个子栏目',
rightIndex : 11,
order : 18,
fn : pageObjMgr['new'],
quickKey : 'N'
});
reg({
key : 'import',
type : 'channelHost',
desc : wcm.LANG.CHANNEL_IMPORT || '导入栏目',
title : wcm.LANG.CHANNEL_IMPORT_INCHANNEL || '在当前栏目中导入一个子栏目（从zip文件中）',
rightIndex : 11,
order : 19,
fn : pageObjMgr['import']
});
reg({
key : 'export',
type : 'channelHost',
desc : wcm.LANG.CHANNEL_EXPORTALL || '导出所有子栏目',
title : wcm.LANG.CHANNEL_EXPORTALL_INCHANNEL || '导出当前栏目下的所有子栏目（提供下载的zip或者xml文件）',
rightIndex : 13,
order : 20,
fn : pageObjMgr['exportAll'],
isVisible : function(event){
var hostchnl = event.getHost();
if(hostchnl.channelType && hostchnl.channelType==13)return false;
return true;
}
});
reg({
key : 'edit',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_EDIT_NOW || '修改当前栏目',
title : wcm.LANG.CHANNEL_EDIT_NOW_TITLE || '修改当前栏目的基本属性和发布设置等相关信息',
rightIndex : 13,
order : 21,
fn : pageObjMgr['edit'],
quickKey : 'M'
});
reg({
key : 'move',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_MOVE_NOW || '移动当前栏目',
title : wcm.LANG.CHANNEL_MOVE_NOW_TITLE || '移动当前栏目到指定的位置',
rightIndex : 12,
order : 22,
fn : pageObjMgr['move']
});
reg({
key : 'trash',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_TRASH || '删除栏目',
title : wcm.LANG.CHANNEL_TRASH_TITLE || '将栏目放入回收站',
rightIndex : 12,
order : 23,
fn : pageObjMgr['trash'],
quickKey : ['Delete', 'ShiftDelete']
});
reg({
key : 'preview',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_PREVIEW_NOW || '预览当前栏目',
title : wcm.LANG.CHANNEL_PREVIEW_NOWPUB || '预览当前栏目的发布效果',
rightIndex : 15,
order : 24,
fn : pageObjMgr['preview'],
isVisible : fnIsVisible,
quickKey : 'R'
});
reg({
key : 'increasingpublish',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_ADDPUB_NOW || '增量发布当前栏目',
title : wcm.LANG.CHANNEL_ADDPUB_NOW_TITLE || '发布当前栏目和其子栏目的首页，并且发布该栏目下所有可发布状态的文档',
rightIndex : 17,
order : 25,
fn : pageObjMgr['increasingpublish'],
isVisible : fnIsVisible,
quickKey : 'P'
});
reg({
key : 'solopublish',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_SOLOPUB_NOW || '仅发布当前栏目首页',
title : wcm.LANG.CHANNEL_SOLOPUB_NOW_TITLE || '重新生成并发布当前栏目的首页',
rightIndex : 17,
order : 26,
fn : pageObjMgr['solopublish'],
isVisible : fnIsVisible
});
reg({
key : 'export',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_EXPORT_NOW || '导出当前栏目',
title : wcm.LANG.CHANNEL_EXPORT_NOW_INFO || '导出当前栏目（提供下载的zip或者xml文件）',
rightIndex : 13,
order : 27,
fn : pageObjMgr['export']
});
reg({
key : 'synTemplates',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_SYNCH || '同步模板到子栏目',
title : wcm.LANG.CHANNEL_SYNCH_TITLE || '将当前栏目的模板应用到其子栏目上',
rightIndex : 13,
order : 28,
fn : pageObjMgr['synTemplates'],
isVisible : fnIsVisible2
});
reg({
key : 'seperate',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_SEPERATE || '分隔线',
rightIndex : -1,
order : 29,
fn : pageObjMgr['seperate']
});
reg({
key : 'fullypublish',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_FULLPUB_NOW || '完全发布当前栏目',
title : wcm.LANG.CHANNEL_FULLPUB_NOW_TITLE || '重新生成和发布当前栏目下的所有文档',
rightIndex : 16,
order : 30,
fn : pageObjMgr['fullypublish'],
isVisible : fnIsVisible
});
reg({
key : 'refreshpublish',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_REFRESHPUB_NOW || '更新发布当前栏目',
title : wcm.LANG.CHANNEL_REFRESHPUB_SEL || '仅重新生成当前栏目的首页以及相关的概览页面',
rightIndex : 17,
order : 31,
fn : pageObjMgr['refreshpublish'],
isVisible : fnIsVisible
});
reg({
key : 'recallpublish',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_CANCELPUB_NOW || '撤销发布当前栏目',
title : wcm.LANG.CHANNEL_CANCELPUB_PUBED || '撤回已发布目录或页面',
rightIndex : 16,
rightIndex : 16,
order : 32,
fn : pageObjMgr['recallpublish'],
isVisible : fnIsVisible
});
reg({
key : 'seperate',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_SEPERATE || '分隔线',
rightIndex : -1,
order : 33,
fn : pageObjMgr['seperate']
});
reg({
key : 'likecopy',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_LIKECOPY || '类似创建',
title : wcm.LANG.CHANNEL_LIKECOPY_TITLE || '创建相似的栏目（唯一标识和存放位置不同）',
rightIndex : 13,
order : 34,
fn : pageObjMgr['likecopy']
});
reg({
key : 'docpositionset',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_DOCPOSITIONSET || '调整顺序',
title : wcm.LANG.CHANNEL_DOCPOSITIONSET_TITLE || '调整当前栏目在站点中的顺序',
isVisible : fnIsVisible,
rightIndex : 13,
order : 35,
fn : pageObjMgr['chnlpositionset']
});
reg({
key : 'seperate',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_SEPERATE || '分隔线',
rightIndex : -1,
order : 36,
fn : pageObjMgr['seperate']
});
reg({
key : 'commentmgr',
type : 'channelMaster',
desc : wcm.LANG.CHANNEL_COMMENT || '管理评论',
title : wcm.LANG.CHANNEL_COMMENT_TITLE || '管理当前栏目下的所有评论',
rightIndex : 8,
order : 37,
fn : pageObjMgr['commentmgr'],
isVisible : function(event){
try{
return $MsgCenter.getActualTop().g_IsRegister['comment'];
}catch(err){
return false;
}
}
});
reg({
key : 'move',
type : 'channels',
desc : wcm.LANG.CHANNEL_MOVESOME || '移动这些栏目',
title : wcm.LANG.CHANNEL_MOVESOME_TITLE || '移动这些栏目到指定的栏目',
rightIndex : 12,
order : 39,
fn : pageObjMgr['move']
});
reg({
key : 'increasingpublish',
type : 'channels',
desc : wcm.LANG.CHANNEL_ADDPUBSOME || '增量发布这些栏目',
title : wcm.LANG.CHANNEL_ADDPUBSOME_TITLE ||'发布选中的栏目的首页，并且发布所有可发布状态的文档',
rightIndex : 17,
order : 40,
fn : pageObjMgr['increasingpublish'],
isVisible : fnIsVisible,
quickKey : 'P'
});
reg({
key : 'preview',
type : 'channels',
desc : wcm.LANG.CHANNEL_PREVIEWSOME || '预览这些栏目',
title : wcm.LANG.CHANNEL_PREVIEWSOME_SEL || '预览当前选中栏目的发布效果',
rightIndex : 15,
order : 41,
fn : pageObjMgr['preview'],
isVisible : fnIsVisible,
quickKey : 'R'
});
reg({
key : 'solopublish',
type : 'channels',
desc : wcm.LANG.CHANNEL_SOLOPUBSOME || '仅发布这些栏目的首页',
title : wcm.LANG.CHANNEL_SOLOPUBSOME_TITLE || '重新生成并发布选中栏目的首页',
rightIndex : 17,
order : 42,
fn : pageObjMgr['solopublish'],
isVisible : fnIsVisible
});
reg({
key : 'export',
type : 'channels',
desc : wcm.LANG.CHANNEL_EXPORTPUBSOME || '导出这些栏目',
title : wcm.LANG.CHANNEL_EXPORT_SEL || '导出当前选中的栏目（提供下载的zip或者xml文件）',
rightIndex : 13,
order : 43,
fn : pageObjMgr['export']
});
reg({
key : 'seperate',
type : 'channels',
desc : wcm.LANG.CHANNEL_SEPERATE || '分隔线',
rightIndex : -1,
order : 44,
fn : pageObjMgr['seperate']
});
reg({
key : 'fullypublish',
type : 'channels',
desc : wcm.LANG.CHANNEL_FULLPUBSOME || '完全发布这些栏目',
title : wcm.LANG.CHANNEL_FULLPUBSOME_TITLE || '重新生成并发布选中栏目下的所有文件',
rightIndex : 16,
order : 45,
fn : pageObjMgr['fullypublish'],
isVisible : fnIsVisible
});
reg({
key : 'refreshpublish',
type : 'channels',
desc : wcm.LANG.CHANNEL_REFRESHPUBSOME || '更新发布这些栏目',
title : wcm.LANG.CHANNEL_REFRESHPUBSOME_TITLE||'重新生成并发布选中栏目和与其相关栏目的首页',
rightIndex : 17,
order : 46,
fn : pageObjMgr['refreshpublish'],
isVisible : fnIsVisible
});
reg({
key : 'recallpublish',
type : 'channels',
desc : wcm.LANG.CHANNEL_CANCELPUBSOME || '撤销发布这些栏目',
title : wcm.LANG.CHANNEL_CANCELPUBSOME_TITLE || '撤销选中栏目的发布操作',
rightIndex : 16,
order : 47,
fn : pageObjMgr['recallpublish'],
isVisible : fnIsVisible
});
reg({
key : 'trash',
type : 'channels',
desc : wcm.LANG.CHANNEL_TRASH || '删除栏目',
title : wcm.LANG.CHANNEL_TRASH_TITLE || '将这个栏目放入回收站',
rightIndex : 12,
order : 48,
fn : pageObjMgr['trash'],
quickKey : ['Delete', 'ShiftDelete']
});
reg({
key : 'createFromFile',
type : 'channelHost',
desc : wcm.LANG.CHANNEL_CREATE_FROMFILE|| '批量创建栏目',
title : wcm.LANG.CHANNEL_CREATE_FROMFILE_TITLE || '从文件批量创建栏目',
rightIndex : 11,
order : 22,
fn : pageObjMgr['createFromFile']
});
reg({
key : 'createFromFile',
type : 'websiteHost',
desc : wcm.LANG.CHANNEL_CREATE_FROMFILE|| '批量创建栏目',
title : wcm.LANG.CHANNEL_CREATE_FROMFILE_TITLE || '从文件批量创建栏目',
rightIndex : 11,
order : 260,
fn : pageObjMgr['createFromFile']
});
reg({
key : 'trash',
type : 'channel',
desc : wcm.LANG.CHANNEL_TRASH || '删除栏目',
title : wcm.LANG.CHANNEL_TRASH_TITLE || '将这个栏目放入回收站',
rightIndex : 12,
order : 213,
fn : pageObjMgr['trash'],
quickKey : ['Delete', 'ShiftDelete']
});
})();

Ext.ns('wcm.Channels', 'wcm.Channel');
WCMConstants.OBJ_TYPE_CHANNEL = 'channel';
wcm.Channels = function(_config, _context){
this.objType = WCMConstants.OBJ_TYPE_CHANNEL;
wcm.Channels.superclass.constructor.call(this, _config, _context);
}
Ext.extend(wcm.Channels, wcm.CMSObjs, {
});
wcm.Channel = function(_config, _context){
this.objType = WCMConstants.OBJ_TYPE_CHANNEL;
wcm.Channel.superclass.constructor.call(this, _config, _context);
var arrRights = {
"view" : -1
};
for(rightName in arrRights){
var cameRightName = rightName.camelize();
var nRightIndex = parseInt(arrRights[rightName], 10);
this['can'+cameRightName] = function(){
return wcm.AuthServer.hasRight(this.right, nRightIndex);
}
}
}
CMSObj.register(WCMConstants.OBJ_TYPE_CHANNEL, 'wcm.Channel');
Ext.extend(wcm.Channel, wcm.CMSObj, {
});

Ext.ns('channelhelper.PageContext');
(function(){
var sName = wcm.LANG['CHANNEL'] || '栏目';
wcm.PageOper.registerPanels({
websiteHost : {
isHost : true,
title : wcm.LANG.CHANNEL_55 || '站点栏目操作任务',
displayNum : 5
},
channelHost : {
isHost : true,
title : wcm.LANG.CHANNEL_56 || '子栏目操作任务',
displayNum : 5
},
channelMaster : {
title : wcm.LANG.CHANNEL_57 || '栏目操作任务',
displayNum : 7,
url : '?serviceid=wcm61_channel&methodname=jFindbyid',
detailMore : function(wcmEvent, opers, curDef){
wcm.domain.ChannelMgr.edit(wcmEvent);
}
},
channel : {
title : String.format(wcm.LANG['OPER_TITLE_OBJ'] || '{0}操作任务', sName),
displayNum : 7,
url : '?serviceid=wcm61_channel&methodname=jFindbyid',
detailMore : function(wcmEvent, opers, curDef){
wcm.domain.ChannelMgr.edit(wcmEvent);
}
},
channels : {
title : String.format(wcm.LANG['OPER_TITLE_OBJ'] || '{0}操作任务', sName),
displayNum : 7
}
});
})();
ValidationHelper.bindValidations([
{
renderTo : 'ChnlDesc',
type :'string',
required :'',
max_len :'200',
desc :wcm.LANG.CHANNEL_58 || '栏目显示名称'
},
{
renderTo : 'ChnlName',
type:'string',
required:'',
max_len:'50',
desc:wcm.LANG.CHANNEL_59 || '栏目唯一标识',
methods : function(){
var element = this.field;
var oHelper = new com.trs.web2frame.BasicDataHelper();
var objId = (PageContext.event.getIds().length!=0)?PageContext.event.getIds():PageContext.event.getHost().getId();
var oPostData = {
objectId : objId,
ChannelName : element.value
};
oHelper.call(
'wcm6_channel',
'existsSimilarName',
oPostData, true,
function(transport, json){
var result = $v(json,'result');
var sDesc = result == 'true' ? ((wcm.LANG.CHANNEL_59 || '栏目唯一标识') + (wcm.LANG.SYSTEM_NOTUNIQUE||"不唯一")) : null;
ValidatorHelper.execCallBack(element, sDesc);
}
)
}
},
{
renderTo : 'LinkUrl',
type :'url',
required :'',
max_len :'200',
desc :wcm.LANG.CHANNEL_61 || '栏目链接'
}
]);
Ext.apply(channelhelper.PageContext, {
selectTemplate : function(nTempId, nTempType){
var event = PageContext.event;
var channel = event.getObjs().getAt(0) || event.getHost();
var sTempId = nTempId + '';
var oParams = {
objecttype: channel.getIntType(),
objectid: channel.getId(),
templatetype: nTempType,
templateIds: sTempId
};
var win = $MsgCenter.getActualTop() || window;
win.wcm.CrashBoarder.get('TEMPLATE_SELECT_SOLO').show({
title : wcm.LANG.TEMPLATE_SELECT||'选择模板',
src : WCMConstants.WCM6_PATH + 'template/template_select_list.html',
width:'510px',
height:'240px',
maskable:true,
params : oParams,
callback : function(_args){
var oHelper = new com.trs.web2frame.BasicDataHelper();
var oPostData = {
objectid: oParams.objectid, 
objecttype: oParams.objecttype,
templateid: _args.selectedIds[0] || 0,
templatetype: oParams.templatetype
};
if(oParams.templateids == 0 && oPostData.templateid == 0)
return;
oHelper.call('wcm6_template', 'setDefaultTemplate', oPostData, true, function(){
CMSObj.afteredit(event)();
this.close();
}.bind(this));
}
});
},
editTemplate : function(_nTempId, _nTempType, bVisualType){
_nTempId = parseInt(_nTempId);
var event = PageContext.event;
var channel = event.getObjs().getAt(0) || event.getHost();
if(_nTempId > 0){
var newParams = {
objectid : _nTempId,
tempType : _nTempType,
callback : 'channelhelper.PageContext.notifyAddEditTemplate',
hostid :channel.getId(),
hosttype : channel.getIntType(),
typestub : 1
}
if(bVisualType){
window.open('../special/design.jsp?templateId=' + _nTempId + 
'&HostType=' + channel.getIntType() + '&HostId=' + channel.getId());
}else{
$openMaxWin(WCMConstants.WCM6_PATH + 'template/template_add_edit.jsp?' + $toQueryStr(newParams));
}
}else{
var editParams = {
objectid : 0,
tempType : _nTempType,
callback : 'channelhelper.PageContext.notifyAddEditTemplate',
hostid :channel.getId(),
hosttype : channel.getIntType(),
typestub : 1
}
$openMaxWin(WCMConstants.WCM6_PATH + 'template/template_add_edit.jsp?' + $toQueryStr(editParams));
}
},
notifyAddEditTemplate : function(args){
var event = PageContext.event;
var chnlId = args.hostId;
var chnlType = args.hostType;
var tempId = args.objectId;
var tempType = args.tempType;
var savedTempId = args.saveTempId;
if(tempId > 0) {
CMSObj.afteredit(event)({objType:WCMConstants.OBJ_TYPE_CHANNEL, objId : chnlId});
return;
}
var oPostData = {
objectid: chnlId, 
objecttype: chnlType,
templateid: savedTempId,
templatetype: tempType
};
var oHelper = new com.trs.web2frame.BasicDataHelper();
oHelper.call('wcm6_template', 'setDefaultTemplate', oPostData, true, function(){
CMSObj.afteredit(event)({objType:WCMConstants.OBJ_TYPE_CHANNEL, objId : chnlId});
});
}
});



Ext.ns('wcm.domain.ChannelMgr');
(function (){
var m_oMgr = wcm.domain.ChannelMgr;
Ext.apply(wcm.domain.ChannelMgr, {
'configSCMpublishfield' : function(event){
var currObj = event.getObj();
var nHostId = currObj.getId();
var nHostType = currObj.getIntType();
var currContext = event.getContext();
var sitetype = currContext.params.SITETYPE;
var nSiteType = 0;
if(sitetype != undefined && sitetype != null){
if(sitetype == "4"){
nSiteType = 4;
}
}
var cbId = 'ConfigSCMCrashBoard';//定义弹出框的唯一标识 
var crashboard = wcmXCom.get(cbId);
if(!crashboard){
crashboard = new wcm.CrashBoard({
id: cbId,
title:'配置从WCM发布微博时使用的文档字段',
maskable:true, 
draggable : true,
width : '530px',//宽度
height : '300px',//高度
params : {HostId:nHostId,HostType:nHostType,SiteType:nSiteType},
src: WCMConstants.WCM6_PATH + 'scm/config_documentfield_wcm.jsp',//内嵌页面地址 
callback : function(params){
var oHelper = new com.trs.web2frame.BasicDataHelper();
oHelper.Call('wcm61_scmmicrocontenttemplate', 'save', 
{ObjectId:params.ObjectId,HostId:params.HostId,HostType:params.HostType,MicroContentStyle:params.MicroContentStyle},
true, function(){
alert("设置成功！");
this.close();
});
}
});
crashboard.show();
}
}
});
})();
(function(){
var fnIsVisible = function(event){
if($MsgCenter.getActualTop().g_IsRegister['SCM']){
var currContext = event.getContext();
var sitetype = currContext.params.SITETYPE;
if(sitetype != undefined && sitetype != null && ( sitetype == "4" || sitetype == "0" )){
var transport = ajaxRequest({
url : WCMConstants.WCM_ROOTPATH + 'center.do?serviceid=wcm61_scmgroup&methodname=isAdminsOfSCMGroups',
method : 'GET',
parameters : '',
asyn : false
});
if(transport != undefined && transport != null){
var json = parseXml(loadXml(transport.responseText));
return $a(json, "result") == 'true';
}
}
}
return false;
};
var reg = wcm.SysOpers.register;
reg({
key : 'configscmpublishfield',
type : 'channel',
desc : '配置发微博文档字段',
title : '配置从WCM发布微博时使用的文档字段',
fn : function(event){
wcm.domain.ChannelMgr.configSCMpublishfield(event);
},
isVisible : fnIsVisible
});
})();

Ext.ns('wcm.domain.ChannelMgr');
(function (){
Ext.apply(wcm.domain.ChannelMgr, {
addepress : function(event){
var hostId = event.getHost().getId();
var hostType = event.getHost().getIntType();
var oParams = {
parentid: hostType == 101 ? hostId : 0,
siteid: hostType == 101 ? 0 : hostId
};
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'epress/epresschannel_create.jsp?' + $toQueryStr(oParams),
title : wcm.LANG.epress_1000 || '新建电子报栏目', 
callback : function(objId){
FloatPanel.hide();
Ext.Msg.confirm(wcm.LANG.epress_1001 || "创建电子报栏目成功,继续设置栏目属性?",{
ok : function(){
FloatPanel.close();
var params = {
objectid: objId,
channelid: objId,
parentid: hostType == 101 ? hostId : 0,
siteid: hostType == 101 ? 0 : hostId
}
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'channel/channel_add_edit.jsp?' + $toQueryStr(params),
title : wcm.LANG.CHANNEL_9||'新建/修改栏目',
callback : function(objId){
CMSObj['afteradd'](event)({objType:WCMConstants.OBJ_TYPE_CHANNEL, objId:objId});
}
});
},
no : function(){
CMSObj['afteradd'](event)({objType:WCMConstants.OBJ_TYPE_CHANNEL, objId:objId});
FloatPanel.close();
}
});
}
});
},
pubhistory : function(event){
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'epress/epresschannel_pubhistory.html?ChannelId=' + event.getHost().getId(),
title : wcm.LANG.epress_1003 || '发布电子报历史索引'
});
}
});
})();
(function(){
var ePressVisible = function(){
var ePressEnabled = false;
try{
ePressEnabled = $MsgCenter.getActualTop().bEpressMainEnable;
}catch(error){
}
return ePressEnabled;
}
var fnIsVisible = function(event){
if(!ePressVisible()) {
return false;
}
var objs = event.getObjs();
var context = event.getContext();
if(objs.length() > 0){
var chnlTypes = objs.getPropertyAsInt("chnlType", 0);
}else{
var chnlTypes = context.get('ChannelType') || 0;
}
if(!Array.isArray(chnlTypes)){
chnlTypes = [chnlTypes];
}
var hideChnlTypes = [1,2,11,13];
for (var i = 0; i < chnlTypes.length; i++){
if(hideChnlTypes.include(chnlTypes[i])) return false;
}
return true;
}
var pageObjMgr = wcm.domain.ChannelMgr;
var reg = wcm.SysOpers.register;
reg({
key : 'seperate',
type : 'channel',
desc : wcm.LANG.CHANNEL_SEPERATE || '分隔线',
title : wcm.LANG.CHANNEL_SEPERATE || '分隔线',
rightIndex : -1,
order : 45,
fn : pageObjMgr['seperate']
});
reg({
key : 'addepress',
type : 'channelHost',
desc : wcm.LANG.epress_1004 || '创建电子报栏目',
title : wcm.LANG.epress_1004 || '创建电子报栏目',
rightIndex : 11,
order : 46,
fn : pageObjMgr['addepress'],
isVisible : ePressVisible
});
reg({
key : 'addepress',
type : 'websiteHost',
desc : wcm.LANG.epress_1004 || '创建电子报栏目',
title : wcm.LANG.epress_1004 || '创建电子报栏目',
rightIndex : 11,
order : 300,
fn : pageObjMgr['addepress'],
isVisible : ePressVisible
});
reg({
key : 'pubhistory',
type : 'channel',
desc : wcm.LANG.epress_1003 || '发布电子报历史索引',
title : wcm.LANG.epress_1003 || '发布电子报历史索引...',
rightIndex : 17,
order : 46,
fn : pageObjMgr['pubhistory'],
isVisible : fnIsVisible
});
reg({
key : 'pubhistory',
type : 'channelMaster',
desc : wcm.LANG.epress_1003 || '发布电子报历史索引',
title : wcm.LANG.epress_1003 || '发布电子报历史索引...',
rightIndex : 17,
order : 46,
fn : pageObjMgr['pubhistory'],
isVisible : fnIsVisible
});
})();

(function(){
function createMobileChannel(event, args){
var data = {
SrcChnlId : event.getObj().getId(), 
DestHostId : args.dstId,
DestHostType : args.dstType,
containChildren : args.containChildren,
DocSDate : args.DocSDate
};
BasicDataHelper.call('wcm61_mobileportal', 'createMobileChannel', data, true, function(transport, json){
alert("创建成功");
});
}
var fnIsVisible = function(event){
var srcChannelId = event.getObj().getId();
var transport = ajaxRequest({
url : WCMConstants.WCM_ROOTPATH + 'center.do?serviceid=wcm61_mobileportal&methodname=isCanCreateMobile',
method : 'GET',
parameters : 'objectid='+srcChannelId +'&objecttype=101',
asyn : false
});
var json = parseXml(loadXml(transport.responseText));
if(json.RESULT == 'false'){
return false;
}
return true;
}
var createMobilechnl = function(event){
var host = event.getHost();
var hostId = host.getId();
var sSrcId = (event.getIds().length == 0)?hostId : event.getIds();
var sSiteType = event.getContext().params["SITETYPE"];
var oParams = {srcId : sSrcId, siteType : sSiteType};
FloatPanel.open(WCMConstants.WCM6_PATH + 'mobile/channel_select_4_create_channel.jsp?' + $toQueryStr(oParams) , '创建移动门户栏目',createMobileChannel.bind(this,event));
}
wcm.SysOpers.register({
key : 'create4mobile',
type : 'channel',
desc : '生成移动门户栏目',
title : '生成移动门户栏目',
rightIndex : 13,
order : 2,
fn : createMobilechnl,
isVisible : fnIsVisible
});
wcm.SysOpers.register({
key : 'create4mobile',
type : 'channelMaster',
desc : '生成移动门户栏目',
title : '生成移动门户栏目',
rightIndex : 13,
order : 3,
fn : createMobilechnl,
isVisible : fnIsVisible
});
})();

Ext.ns('wcm.domain.ChannelMgr');
(function (){
var m_oMgr = wcm.domain.ChannelMgr;
Ext.apply(wcm.domain.ChannelMgr, {
publishpublisheddoc : function(event){
wcm.CrashBoarder.get('publish_published_docs').show({
title : '发布已发文档及其概览',
src : WCMConstants.WCM6_PATH + 'document/publish_publisheddocs_and_folder.html',
width:'570px',
height:'250px',
maskable:true,
callback:function(args){
var extrtParam = {
'StartDocCrtime' : args['starttime'],
'EndDocCrtime' : args['endtime']
}
var aIds = event.getObjsOrHost().getIds();
wcm.domain.PublishAndPreviewMgr.publish(aIds, 101, 'publishpublisheddoc', extrtParam);
this.close();
}
});
}
});
})();
(function(){
var fnIsVisible = function(event){
var objs = event.getObjs();
var context = event.getContext();
if(objs.length() > 0){
var chnlTypes = objs.getPropertyAsInt("chnlType", 0);
}else{
var chnlTypes = context.get('ChannelType') || 0;
}
if(!Array.isArray(chnlTypes)){
chnlTypes = [chnlTypes];
}
var hideChnlTypes = [1,2,11];
for (var i = 0; i < chnlTypes.length; i++){
if(hideChnlTypes.include(chnlTypes[i])) return false;
}
return true;
}
var pageObjMgr = wcm.domain.ChannelMgr;
var reg = wcm.SysOpers.register;
reg({
key : 'publishpublisheddoc',
type : 'channel',
desc : '发布已发文档及其概览',
title : '发布栏目的首页，并且发布指定时间范围的已发文档',
rightIndex : 17,
order : 6.1,
fn : pageObjMgr['publishpublisheddoc'],
isVisible : fnIsVisible
});
reg({
key : 'publishpublisheddoc',
type : 'channelmaster',
desc : '发布已发文档及其概览',
title : '发布栏目的首页，并且发布指定时间范围的已发文档',
rightIndex : 17,
order : 24.1,
fn : pageObjMgr['publishpublisheddoc'],
isVisible : fnIsVisible
});
})();

Ext.ns('wcm.domain.DocumentMgr');
(function(){
Ext.apply(wcm.domain.DocumentMgr, {
defaultformat : function(event){
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'editor/defaultformat/read.jsp?ObjId=' + event.getHost().getId() + "&ObjType=" + event.getHost().getIntType(),
title : '默认排版设置',
callback : function(){
CMSObj[oParams["objectid"] > 0 ? 'afteredit' : 'afteradd'](event)({objType:WCMConstants.OBJ_TYPE_CHANNEL, objId:objId});
}
});
}
});
})();
(function(){
var pageObjMgr = wcm.domain.DocumentMgr;
var reg = wcm.SysOpers.register;
reg({
key : 'defaultformat',
type : 'documentInSite',
desc : '默认排版设置',
title : '默认排版设置的相关配置',
rightIndex : 1,
order : 500,
fn : pageObjMgr['defaultformat']
});
})();

Ext.ns('wcm.domain.DocumentMgr');
(function(){
Ext.apply(wcm.domain.DocumentMgr, {
docPropSet : function(event){
var hostId = event.getHost().getId();
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'website/document_props_showset.jsp?WebsiteId='+hostId,
title : wcm.LANG.CHANNEL_75 ||'文档编辑页面属性定制',
callback : function(){
CMSObj.afteredit(event)({objType:WCMConstants.OBJ_TYPE_WEBSITE,objId:hostId});
}
});
},
docViewProp : function(event){
var hostId = event.getHost().getId();
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'website/document_props_viewset.jsp?WebsiteId='+hostId,
title : '文档编辑页面属性视图定制',
callback : function(){
CMSObj.afteredit(event)({objType:WCMConstants.OBJ_TYPE_WEBSITE,objId:hostId});
}
});
}
});
})();
(function(){
var pageObjMgr = wcm.domain.DocumentMgr;
var reg = wcm.SysOpers.register;
reg({
key : 'docPropSet',
type : 'documentInSite',
desc : wcm.LANG.CHANNEL_75 ||'文档编辑页面属性定制',
title:'文档编辑页面属性定制...',
rightIndex : 13,
order : 501,
fn : pageObjMgr['docPropSet']
});
reg({
key : 'docViewProp',
type : 'documentInSite',
desc : '页面属性视图定制',
title:'文档编辑页面属性视图定制...',
rightIndex : 13,
order : 502,
fn : pageObjMgr['docViewProp']
});
})();

