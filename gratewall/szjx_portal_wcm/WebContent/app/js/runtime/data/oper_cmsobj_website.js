Ext.apply(wcm.LANG, {
WEBSITE_EDIT : '修改这个站点',
WEBSITE_EDIT_TITLE : '修改站点的基本属性和发布设置等相关信息',
WEBSITE_PREVIEW : '预览这个站点',
WEBSITE_PREVIEW_TITLE : '重新生成并打开这个站点的预览页面',
WEBSITE_ADDPUB : '增量发布这个站点',
WEBSITE_ADDPUB_TITLE : '发布站点和栏目的首页，并且发布所有处于可发布状态的文档',
WEBSITE_HOMEPUB : '仅发布这个站点首页',
WEBSITE_HOMEPUB_TITLE : '只更新和发布当前站点的首页',
WEBSITE_SYNTEMP : '同步模板到栏目',
WEBSITE_SYNTEMP_TITLE : '将当前站点的模板应用到指定的栏目上',
WEBSITE_SEP : '分隔线',
WEBSITE_EXPORT : '导出这个站点到',
WEBSITE_EXPORT_TITLE : '将当前站点内容导出成XML格式文件',
WEBSITE_COMPUB : '完全发布这个站点',
WEBSITE_COMPUB_TITLE : '重新生成这个站点的所有文件',
WEBSITE_UPDATEPUB : '更新发布这个站点',
WEBSITE_UPDATEPUB_TITLE : '更新当前站点和相关栏目的首页',
WEBSITE_CANCELPUB : '撤销发布这个站点',
WEBSITE_LIKECOPY : '类似创建',
WEBSITE_LIKECOPY_TITLE : '创建相似的站点（唯一标识和存放位置不同）',
WEBSITE_RECYCLE : '删除站点',
WEBSITE_RECYCLE_TITLE : '将站点放入回收站',
WEBSITE_RECYCLE_TO : '删除站点',
WEBSITE_NEW : '创建一个新站点',
WEBSITE_NEW_TITLE : '新建一个站点节点',
WEBSITE_QUICKNEW : '智能创建一个新站点',
WEBSITE_QUICKNEW_TITLE : '按照已经完成的站点样例智能创建一个相似的新站点',
WEBSITE_IMPORT : '从外部导入站点',
WEBSITE_IMPORT_TITLE : '读取外部站点文件（只支持XML和ZIP文件），并生成相应的站点',
WEBSITE_EXPORTSOME : '导出这些站点到',
WEBSITE_EXPORTSOME_TITLE : '导出这些站点，每个站点生成相应的XML文件',
WEBSITE_PREVIEWSOME : ' 预览这些站点',
WEBSITE_PREVIEWSOME_TITLE : ' 重新生成并打开这些站点的预览页面',
WEBSITE_ADDPUBSOME : '增量发布这些站点',
WEBSITE_ADDPUBSOME_TITLE : '发布选中站点和他们的栏目的首页，并且发布所有可发布状态的文档',
WEBSITE_HOMEPUBSOME : '仅发布这些站点首页',
WEBSITE_HOMEPUBSOME_TITLE : '重新生成并发布选中站点的首页',
WEBSITE_COMPUBSOME : '完全发布这些站点',
WEBSITE_COMPUBSOME_TITLE : '重新生成这些站点的所有文件',
WEBSITE_UPDATEPUBSOME : '更新发布这些站点',
WEBSITE_UPDATEPUBSOME_TITLE : '更新这些站点和相关栏目的首页',
WEBSITE_CANCELPUBSOME : '撤销发布这些站点',
WEBSITE_CONFIRM : '确实要将这{0}个站点放入站点回收站吗?',
WEBSITE_ALERT : '成功将当前站点模板同步到了其栏目下！',
WEBSITE_1 : '新建/修改站点',
WEBSITE_2 : "智能建站",
WEBSITE_3 : "类似创建站点",
WEBSITE_4 : '站点导入',
WEBSITE_SITEORDER : '默认排序',
WEBSITE_SITEDESC : '显示名称',
WEBSITE_SITENAME : '唯一标识',
WEBSITE_CRUSER : '创建者',
WEBSITE_ID : '站点ID',
WEBSITE_CRTIME : '创建时间',
WEBSITE_UNITNAME : '个',
WEBSITE_TYPENAME : '站点',
WEBSITE_TRUE : '确定',
WEBSITE_5 : "执行类似创建站点..",
WEBSITE_6 : '报告',
WEBSITE_7 : '导入站点..',
WEBSITE_8 : "文件路径为空，上传失败！",
WEBSITE_9 : "站点名称已经存在",
WEBSITE_10 : '执行智能建站',
WEBSITE_ALERT_1 : '当前站点可能已被放入站点回收站中，您暂时无法对其进行操作！',
WEBSITE_ALERT_2 : "开始时间不能大于/等于结束时间",
WEBSITE_ALERT_3 : "间隔时间为0或超出了运行设定时间",
WEBSITE_ALERT_4 : "设置时间不能为空",
WEBSITE_11 : "唯一标识不唯一",
WEBSITE_12 : "存放位置不唯一",
WEBSITE_13 : '小时',
WEBSITE_14 : '分钟',
WEBSITE_15 : '结束时间',
WEBSITE_16 : '间隔时间',
WEBSITE_NONE : "无",
WEBSITE_17:'存放位置',
WEBSITE_18:'新建',
WEBSITE_19:'新建一个站点',
WEBSITE_20:'修改',
WEBSITE_21:'修改这个站点',
WEBSITE_22:'导入站点',
WEBSITE_23:'导出站点',
WEBSITE_24:'删除',
WEBSITE_25:'删除这个/些站点',
WEBSITE_26:'刷新',
WEBSITE_27:'刷新列表',
WEBSITE_28:'站点列表管理',
WEBSITE_29:'确实要改变站点的排列顺序吗？',
WEBSITE_30:"确实要同步模板到栏目吗？<br><span style='color:red;font:16px;'>注意：<br>该操作会覆盖更改所有栏目的模板设置！</span>",
WEBSITE_31:'库站点操作任务',
WEBSITE_32:'文字库',
WEBSITE_33:'图片库',
WEBSITE_34:'视频库',
WEBSITE_35:'资源库',
WEBSITE_36:'站点显示名称',
WEBSITE_37:'站点唯一标识',
WEBSITE_38:'站点HTTP',
TEMPLATE_SELECT : '选择模板',
WEBSITE_FAUILD : '解锁失败.',
WEBSITE_COMMENTMGR : "管理评论",
WEBSITE_COMMENTMGR_TITLE : '管理该站点下的所有评论',
WEBSITE_BATCHNEW_TITLE : '从文件批量创建站点结构',
WEBSITE_BATCHNEW : '批量创建站点',
WEBSITE_PUBSTAT : '发文统计',
WEBSITE_PUBSTAT_TITLE : '发文统计',
WEBSITE_40 : '管理关键词',
WEBSITE_40_TITLE : '管理当前站点下的所有关键词',
WEBSITE_CREATE_FROMFILE : '批量创建',
WEBSITE_41 : '选择栏目',
WEBSITE_SITEDESC_LIST_ORDER : '显示名称',
WEBSITE_RECYCLE_PROCESSBAR : '将站点放入回收站',
WEBSITE_42 : '执行站点导出..'
});

Ext.ns('wcm.domain.WebSiteMgr');
(function(){
var m_nWebSiteObjType = 103;
var m_sServiceId = 'wcm61_website';
var m_oMgr = wcm.domain.WebSiteMgr;
function getHelper(){
return new com.trs.web2frame.BasicDataHelper();
}
function edit(event, oParams){
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'website/website_add_edit.jsp?' + $toQueryStr(oParams),
title : wcm.LANG.WEBSITE_1||'新建/修改站点',
callback : function(objId){
CMSObj[oParams.objectid>0 ? 'afteredit' : 'afteradd'](event)({objType:WCMConstants.OBJ_TYPE_WEBSITE, objId:objId});
}
});
}
Ext.apply(wcm.domain.WebSiteMgr, {
"new" : function(event){
edit(event, {
objectid : 0,
sitetype : event.getContext().get("siteType") || 0
});
},
edit : function(event){
edit(event, {
objectid : event.getObj().getId(),
sitetype : event.getContext().get("siteType") || 0
});
},
quicknew : function(event){
FloatPanel.open(WCMConstants.WCM6_PATH + 'website/website_create.jsp', wcm.LANG.WEBSITE_2||"智能建站", function(objId){
CMSObj.afteradd(event)({objType:WCMConstants.OBJ_TYPE_WEBSITE, objId:objId});
});
},
likecopy : function(event){
var id = event.getObj().getId();
FloatPanel.open(WCMConstants.WCM6_PATH + 'website/website_likecopy.html?siteid=' + id, wcm.LANG.WEBSITE_3||"类似创建站点",function(objId){
CMSObj.afteradd(event)({objType:WCMConstants.OBJ_TYPE_WEBSITE, objId:objId});
});
},
setAppendixSize : function(event){
var id = event.getObj().getId();
wcm.CrashBoarder.get('set_appendix_size').show({
title : wcm.LANG.website_2011 || '设置这个站点上传文档附件大小',
src : WCMConstants.WCM6_PATH + 'website/website_set_doc_appendix_size.jsp',
width:'550px',
height:'200px',
maskable:true,
params : {siteId : id}
});
}
});
function download(_sUrl){
var frm = $('iframe4download');
if(!frm) {
frm = document.createElement('IFRAME');
frm.id = "iframe4download";
frm.style.display = 'none';
document.body.appendChild(frm);
}
_sUrl = WCMConstants.WCM_ROOTPATH + "file/read_file.jsp?DownName=SITE&FileName=" + _sUrl;
frm.src = _sUrl;
}
Ext.apply(wcm.domain.WebSiteMgr, {
'import' : function(event){
FloatPanel.open(WCMConstants.WCM6_PATH + 'website/website_import.html', wcm.LANG.WEBSITE_4||'站点导入', function(objId){
CMSObj.afteradd(event)({objType:WCMConstants.OBJ_TYPE_WEBSITE, objId:objId});
});
},
'export' : function(event){
ProcessBar.start( wcm.LANG.WEBSITE_42||'执行站点导出..');
var aIds = event.getObjsOrHost().getIds();
getHelper().call(
m_sServiceId,
'export',
{objectids: aIds.join(",")},
true,
function(_oXMLHttp, _json){
ProcessBar.close();
download(_oXMLHttp.responseText);
}
);
},
createFromFile : function(event){
var nSiteType = event.getHost().getId();
FloatPanel.open(WCMConstants.WCM6_PATH + 'website/website_create_fromfile.html?SiteType=' + nSiteType, wcm.LANG.WEBSITE_CREATE_FROMFILE||'批量创建', function(){
CMSObj.afteradd(event)({objType:WCMConstants.OBJ_TYPE_WEBSITE,objId:0});
});
}
});
Ext.apply(wcm.domain.WebSiteMgr, {
"delete" : function(event){
this.recycle(event);
},
trash : function(event){
this.recycle(event);
},
recycle : function(event){
var aIds = event.getObjsOrHost().getIds();
var nCount = aIds.length == 1 ? "" : aIds.length;
Ext.Msg.confirm(
String.format('确实要将这{0}个站点放入站点回收站吗?<br /><br /><span style="color:red;">这是危险操作！</span>',nCount),
{ ok : function(){
verifyPassword(function(){
ProcessBar.start(wcm.LANG.WEBSITE_RECYCLE_PROCESSBAR||'将站点放入回收站');
getHelper().call(
m_sServiceId,
'delete',
{objectids:aIds.join(","), "drop":false},
true,
function(){
ProcessBar.close();
event.getObjsOrHost().afterdelete();
}
);
} ,
"删除站点-"
);
}
}
);
return false;
}
});
function resetTemplates(_nFolderId, _nObjType, _fCallBack){
getHelper().call('wcm6_template', 'impartTemplateConfig',
{objectId: _nFolderId, ObjectType:_nObjType}, true, _fCallBack);
}
function synchTemplates(_nFolderId, _nObjType, childObjIds, _fCallBack){
getHelper().call('wcm61_template', 'synTemplates',
{objectId: _nFolderId, ObjectType:_nObjType, objectIds : childObjIds}, true, _fCallBack);
}
function verifyPassword(validCallback ,operateName){
wcm.CrashBoarder.get('validate-password').show({
title : '<span style="color:red;" >'+operateName+'校验密码</span>',
src : WCMConstants.WCM6_PATH+'include/validate_password.html',
width : '400px',
height : '150px',
callback : function(params){
if(params=="true"){
this.close();
if(validCallback){
validCallback();
}
}
}
});
}
Ext.apply(wcm.domain.WebSiteMgr, {
synTemplates : function(event){
var objId = event.getObj().getId();
var params = {
objType:m_nWebSiteObjType,
objId:objId,
close : 0,
ExcludeTop : 1,
ExcludeInfoview : 0,
ExcludeLink : 1
};
FloatPanel.open({
src : WCMConstants.WCM6_PATH + 'website/object_select.html',
dialogArguments : params,
title : wcm.LANG.WEBSITE_41||'选择栏目',
callback : function(args){
if(args.allChildren){
var sHtml = wcm.LANG.WEBSITE_30||"确实要同步模板到子栏目吗?<br><span style=\'color:red;font:16px;\'>注意:<br>该操作会覆盖更改所有子栏目的模板设置!</span>";
Ext.Msg.confirm(sHtml, {
ok : function(){
verifyPassword(function(){
FloatPanel.close();
resetTemplates(objId, m_nWebSiteObjType);
},"同步模板到子栏目-");
}
});
}else{
FloatPanel.close();
synchTemplates(objId, m_nWebSiteObjType, args.ids.join());
}
}
});
}
});
Ext.apply(wcm.domain.WebSiteMgr, {
keyword : function(event){
var aId = event.getObjsOrHost().getIds();
var type = event.getObjsOrHost().objType;
var nId = parseInt(aId.join(","))||event.getContext().get('siteType');
var para = {};
if(type.toUpperCase() =="WEBSITEROOT"||type.toUpperCase()=="WEBSITEINROOT"){
para = {
siteType : nId,
siteId : 0
}
}else {
para = {
siteType : event.getContext().get('siteType'),
siteId : nId
}
}
wcm.CrashBoarder.get('DIALOG_KEYWORD_MGR').show({
title : wcm.LANG.WEBSITE_40 || '管理关键词',
src : WCMConstants.WCM6_PATH + 'keyword/keyword_list.html',
width:'850px',
height:'400px',
maskable:true,
params : para
});
}
});
function preview(_sId, _nObjectType){
wcm.domain.PublishAndPreviewMgr.preview(_sId, _nObjectType);
}
function publish(_sIds, _nObjectType, _sPublishTypeMethod){
wcm.domain.PublishAndPreviewMgr.publish(_sIds, _nObjectType, _sPublishTypeMethod);
}
Ext.apply(wcm.domain.WebSiteMgr, {
preview : function(event){
var aIds = event.getObjsOrHost().getIds();
preview(aIds.join(","), m_nWebSiteObjType);
},
quickpublish : function(event){
m_oMgr.homepublish(event);
},
homepublish : function(event){
m_oMgr.publish(event, "soloPublish");
},
increasepublish : function(event){
m_oMgr.publish(event, "increasingPublish");
},
completepublish : function(event){
m_oMgr.publish(event, "fullyPublish");
},
updatepublish : function(event){
m_oMgr.publish(event, "refreshPublish");
},
cancelpublish : function(event){
m_oMgr.publish(event, "recallPublish");
},
publish : function(event, sPublishTypeMethod){
var aIds = event.getObjsOrHost().getIds();
publish(aIds.join(","), m_nWebSiteObjType, sPublishTypeMethod);
}
});
function $openCentralWin(_sUrl, _sName){
var _WIN_WIDTH = window.screen.availWidth;
var _WIN_HEIGHT = window.screen.availHeight;
var y = _WIN_HEIGHT * 0.12;
var x = _WIN_HEIGHT * 0.17;
var w = _WIN_WIDTH - 2 * x;
var h = w * 0.618;
var sFeature = 'resizable=yes,top=' + y + ',left='
+ x + ',menubar =no,toolbar =no,width=' + w + ',height='
+ h + ',scrollbars=yes,location =no,status=no,titlebar=no';
var sName = _sName || "";
sName = sName.replace(/[^0-9a-zA-Z_]/g,'_');
var oWin = window.open(_sUrl, sName, sFeature);
if(oWin) oWin.focus();
}
Ext.apply(wcm.domain.WebSiteMgr, {
setSiteUser : function(event){
var id = event.getObj().getId();
$openCentralWin(WCMConstants.WCM6_PATH + "../console/channel/siteuser_list.jsp?SiteId=" + id, "wcm61-siteuser");
}
});
Ext.apply(wcm.domain.WebSiteMgr, {
commentmgr : function(event){
var hostId = event.getHost().getId();
var sIds = (event.getIds().length == 0)?hostId : event.getIds();
var oParams = {
SiteId : sIds
}
var sUrl = WCMConstants.WCM_ROOTPATH + 'comment/comment_mgr.jsp?' + $toQueryStr(oParams);
var sWinName = 'comment_name';
$openMaxWin(sUrl, sWinName);
}
});
Ext.apply(wcm.domain.WebSiteMgr, {
pubstat : function(event){
var hostId = event.getHost().getId();
var sIds = (event.getIds().length == 0)?hostId : event.getIds();
var oParams = {
SiteId : sIds
}
var sUrl = WCMConstants.WCM6_PATH + '../console/stat/doccount_site_byuser.jsp?' + $toQueryStr(oParams);
$openMaxWin(sUrl);
}
});
})();
(function(){
var pageObjMgr = wcm.domain.WebSiteMgr;
var reg = wcm.SysOpers.register;
reg({
key : 'edit',
type : 'website',
desc : wcm.LANG.WEBSITE_EDIT||'修改这个站点',
title : wcm.LANG.WEBSITE_EDIT_TITLE||'修改站点的基本属性和发布设置等相关信息',
rightIndex : 1,
order : 1,
fn : pageObjMgr['edit'],
quickKey : 'M'
});
reg({
key : 'preview',
type : 'website',
desc : wcm.LANG.WEBSITE_PREVIEW||'预览这个站点',
title : wcm.LANG.WEBSITE_PREVIEW_TITLE||'重新生成并打开这个站点的预览页面',
rightIndex : 3,
order : 2,
fn : pageObjMgr['preview'],
quickKey : 'R'
});
reg({
key : 'increasepublish',
type : 'website',
desc : wcm.LANG.WEBSITE_ADDPUB||'增量发布这个站点',
title : wcm.LANG.WEBSITE_ADDPUB_TITLE||'发布站点和栏目的首页，并且发布所有处于可发布状态的文档',
rightIndex : 5,
order : 3,
fn : pageObjMgr['increasepublish'],
quickKey : 'P'
});
reg({
key : 'homepublish',
type : 'website',
desc : wcm.LANG.WEBSITE_HOMEPUB||'仅发布这个站点首页',
title : wcm.LANG.WEBSITE_HOMEPUB_TITLE|| '只更新和发布当前站点的首页',
rightIndex : 5,
order : 4,
fn : pageObjMgr['homepublish']
});
reg({
key : 'synTemplates',
type : 'website',
desc : wcm.LANG.WEBSITE_SYNTEMP||'同步模板到栏目',
title : wcm.LANG.WEBSITE_SYNTEMP_TITLE||'将当前站点的模板应用到指定的栏目上',
rightIndex : 1,
order : 5,
fn : pageObjMgr['synTemplates']
});
reg({
key : 'seperate',
type : 'website',
desc : wcm.LANG.WEBSITE_SEP||'分隔线',
title : "分隔线",
rightIndex : -1,
order : 6,
fn : pageObjMgr['seperate']
});
reg({
key : 'export',
type : 'website',
desc : wcm.LANG.WEBSITE_EXPORT||'导出这个站点到',
title : wcm.LANG.WEBSITE_EXPORT_TITLE ||'将当前站点内容导出成XML格式文件',
rightIndex : 1,
order : 7,
fn : pageObjMgr['export'],
quickKey : 'X'
});
reg({
key : 'seperate',
type : 'website',
desc : wcm.LANG.WEBSITE_SEP||'分隔线',
rightIndex : -1,
order : 8,
fn : pageObjMgr['seperate']
});
reg({
key : 'completepublish',
type : 'website',
desc : wcm.LANG.WEBSITE_COMPUB||'完全发布这个站点',
title : wcm.LANG.WEBSITE_COMPUB_TITLE||'重新生成这个站点的所有文件',
rightIndex : 4,
order : 9,
fn : pageObjMgr['completepublish']
});
reg({
key : 'updatepublish',
type : 'website',
desc : wcm.LANG.WEBSITE_UPDATEPUB||'更新发布这个站点',
title : wcm.LANG.WEBSITE_UPDATEPUB_TITLE||'更新当前站点和相关栏目的首页',
rightIndex : 5,
order : 10,
fn : pageObjMgr['updatepublish']
});
reg({
key : 'seperate',
type : 'website',
desc : wcm.LANG.WEBSITE_SEP||'分隔线',
rightIndex : -1,
order : 12,
fn : pageObjMgr['seperate']
});
reg({
key : 'likecopy',
type : 'website',
desc : wcm.LANG.WEBSITE_LIKECOPY||'类似创建',
title : wcm.LANG.WEBSITE_LIKECOPY_TITLE||'创建相似的站点（唯一标识和存放位置不同）',
rightIndex : -2,
order : 13,
fn : pageObjMgr['likecopy']
});
reg({
key : 'seperate',
type : 'website',
desc : wcm.LANG.WEBSITE_SEP||'分隔线',
rightIndex : -1,
order : 14,
fn : pageObjMgr['seperate']
});
reg({
key : 'keyword',
type : 'website',
desc : wcm.LANG.WEBSITE_40||'管理关键词',
title : wcm.LANG.WEBSITE_40_TITLE||'管理当前站点下的所有关键词',
rightIndex : 1,
order : 16,
fn : pageObjMgr['keyword']
});
reg({
key : 'keyword',
type : 'websiteInRoot',
desc : wcm.LANG.WEBSITE_40||'管理关键词',
title : wcm.LANG.WEBSITE_40_TITLE||'管理当前站点下的所有关键词',
rightIndex : -2,
order : 5,
fn : pageObjMgr['keyword']
});
reg({
key : 'recycle',
type : 'website',
desc : wcm.LANG.WEBSITE_RECYCLE||'删除站点',
title : wcm.LANG.WEBSITE_RECYCLE_TITLE||'将站点放入回收站',
rightIndex : 2,
order : 15,
fn : pageObjMgr['recycle'],
quickKey : ['Delete', 'ShiftDelete']
});
reg({
key : 'new',
type : 'websiteInRoot',
desc : wcm.LANG.WEBSITE_NEW||'创建一个新站点',
title : wcm.LANG.WEBSITE_NEW_TITLE||'新建一个站点节点',
rightIndex : -2,
order : 1,
fn : pageObjMgr['new'],
quickKey : 'N'
});
reg({
key : 'quicknew',
type : 'websiteInRoot',
desc : wcm.LANG.WEBSITE_QUICKNEW||'智能创建一个新站点',
title : wcm.LANG.WEBSITE_QUICKNEW_TITLE||'按照已经完成的站点样例智能创建一个相似的新站点',
rightIndex : -2,
order : 2,
fn : pageObjMgr['quicknew'],
isVisible : function(event){
var context = event.getContext();
if(context.params["SITETYPE"] == 0){
return true;
}
return false;
}
});
reg({
key : 'import',
type : 'websiteInRoot',
desc : wcm.LANG.WEBSITE_IMPORT||'从外部导入站点',
title : wcm.LANG.WEBSITE_IMPORT_TITLE||'读取外部站点文件（只支持XML和ZIP文件），并生成相应的站点',
rightIndex : -2,
order : 3,
fn : pageObjMgr['import']
});
reg({
key : 'export',
type : 'websites',
desc : wcm.LANG.WEBSITE_EXPORTSOME||'导出这些站点到',
title : wcm.LANG.WEBSITE_EXPORTSOME_TITLE||'导出这些站点，每个站点生成相应的XML文件',
rightIndex : 1,
order : 22,
fn : pageObjMgr['export'],
quickKey : 'X'
});
reg({
key : 'recycle',
type : 'websites',
desc : wcm.LANG.WEBSITE_RECYCLE||'删除站点',
title : wcm.LANG.WEBSITE_RECYCLE_TITLE|| '将站点放入回收站',
rightIndex : 2,
order : 23,
fn : pageObjMgr['recycle'],
quickKey : ['Delete', 'ShiftDelete']
});
reg({
key : 'preview',
type : 'websites',
desc : wcm.LANG.WEBSITE_PREVIEWSOME||'预览这些站点',
title : wcm.LANG.WEBSITE_PREVIEWSOME_TITLE || '重新生成并打开这些站点的预览页面',
rightIndex : 3,
order : 24,
fn : pageObjMgr['preview'],
quickKey : 'R'
});
reg({
key : 'increasepublish',
type : 'websites',
desc : wcm.LANG.WEBSITE_ADDPUBSOME||'增量发布这些站点',
title : wcm.LANG.WEBSITE_ADDPUBSOME_TITLE||'发布选中站点和他们的栏目的首页，并且发布所有可发布状态的文档',
rightIndex : 5,
order : 25,
fn : pageObjMgr['increasepublish'],
quickKey : 'P'
});
reg({
key : 'homepublish',
type : 'websites',
desc : wcm.LANG.WEBSITE_HOMEPUBSOME||'仅发布这些站点首页',
title : wcm.LANG.WEBSITE_HOMEPUBSOME_TITLE||'重新生成并发布选中站点的首页',
rightIndex : 5,
order : 26,
fn : pageObjMgr['homepublish']
});
reg({
key : 'completepublish',
type : 'websites',
desc : wcm.LANG.WEBSITE_COMPUBSOME||'完全发布这些站点',
title : wcm.LANG.WEBSITE_COMPUBSOME_TITLE||'重新生成这些站点的所有文件',
rightIndex : 4,
order : 27,
fn : pageObjMgr['completepublish']
});
reg({
key : 'updatepublish',
type : 'websites',
desc : wcm.LANG.WEBSITE_UPDATEPUBSOME||'更新发布这些站点',
title : wcm.LANG.WEBSITE_UPDATEPUBSOME_TITLE||'更新这些站点和相关栏目的首页',
rightIndex : 5,
order : 28,
fn : pageObjMgr['updatepublish']
});
reg({
key : 'seperate',
type : 'websites',
desc : wcm.LANG.WEBSITE_SEP||'分隔线',
title : "分隔线",
rightIndex : -1,
order : 30,
fn : pageObjMgr['seperate']
});
reg({
key : 'createFromFile',
type : 'websiteInRoot',
desc : wcm.LANG.WEBSITE_BATCHNEW||'批量创建站点',
title : wcm.LANG.WEBSITE_BATCHNEW_TITLE||'从文件批量创建站点结构',
rightIndex : -2,
order : 4,
fn : pageObjMgr['createFromFile']
});
reg({
key : 'commentmgr',
type : 'website',
desc : wcm.LANG.WEBSITE_COMMENTMGR||'管理评论',
title : wcm.LANG.WEBSITE_COMMENTMGR_TITLE||'管理该站点下的所有评论',
rightIndex : 8,
order : 17,
fn : pageObjMgr['commentmgr'],
isVisible : function(event){
try{
return $MsgCenter.getActualTop().g_IsRegister['comment'];
}catch(err){
return false;
}
}
});
reg({
key : 'pubstat',
type : 'website',
desc : wcm.LANG.WEBSITE_PUBSTAT ||'发文统计',
titile : '发文统计',
rightIndex : 1,
order : 18,
fn : pageObjMgr['pubstat']
});
reg({
key : 'setappendixsize',
type : 'website',
desc : wcm.LANG.website_2011 || '设置这个站点文档附件大小',
title : wcm.LANG.website_2011 || '设置这个站点上传文档附件大小',
rightIndex : 1,
order : 10,
fn : pageObjMgr['setAppendixSize'],
isVisible : function(event){
return true;
}
});
})();

Ext.ns('wcm.WebSites', 'wcm.WebSite');
WCMConstants.OBJ_TYPE_WEBSITE = 'website';
wcm.WebSites = function(_config, _context){
this.objType = WCMConstants.OBJ_TYPE_WEBSITE;
wcm.WebSites.superclass.constructor.call(this, _config, _context);
}
Ext.extend(wcm.WebSites, wcm.CMSObjs, {
});
wcm.WebSite = function(_config, _context){
this.objType = WCMConstants.OBJ_TYPE_WEBSITE;
wcm.WebSite.superclass.constructor.call(this, _config, _context);
var arrRights = {
"view" : -1
};
for(rightName in arrRights){
var cameRightName = rightName.camelize();
var nRightIndex = parseInt(arrRights[rightName], 10);
this['can'+cameRightName] = function(){
return wcm.AuthServer.hasRight(this.right, nRightIndex);
}
}
}
CMSObj.register(WCMConstants.OBJ_TYPE_WEBSITE, 'wcm.WebSite');
Ext.extend(wcm.WebSite, wcm.CMSObj, {
});

Ext.ns('websitehelper.PageContext');
(function(){
var sName = wcm.LANG['WEBSITE'] || '站点';
wcm.PageOper.registerPanels({
WebSiteRoot : {
isHost : true,
title : wcm.LANG.WEBSITE_31 || '库站点操作任务',
displayNum : 5,
detail : function(cmsobjs, info){
var siteType = cmsobjs.getIds()[0] || 0;
var siteTypeNames = [wcm.LANG.WEBSITE_32 || '文字库', wcm.LANG.WEBSITE_33 || '图片库', wcm.LANG.WEBSITE_34 || '视频库', '', wcm.LANG.WEBSITE_35 || '资源库'];
return siteTypeNames[siteType];
}
},
websiteInRoot : {
isHost : true,
title : String.format(wcm.LANG['OPER_TITLE_INROOT'] || '库{0}操作任务', sName),
displayNum : 5
},
websiteInSite : {
isHost : true,
title : String.format(wcm.LANG['OPER_TITLE_INSITE'] || '站点{0}操作任务', sName),
displayNum : 5
},
websiteInChannel : {
isHost : true,
title : String.format(wcm.LANG['OPER_TITLE_INCHANNEL'] || '栏目{0}操作任务', sName),
displayNum : 5
},
website : {
title : String.format(wcm.LANG['OPER_TITLE_OBJ'] || '{0}操作任务', sName),
displayNum : 7,
url : '?serviceid=wcm61_website&methodname=jFindbyid',
detailMore : function(wcmEvent, opers, curDef){
wcm.domain.WebSiteMgr.edit(wcmEvent);
}
},
websites : {
title : String.format(wcm.LANG['OPER_TITLE_OBJ'] || '{0}操作任务', sName),
displayNum : 7
}
});
})();
ValidationHelper.bindValidations([
{
renderTo : 'SiteDesc',
type :'string',
required :'',
max_len :'200',
desc :wcm.LANG.WEBSITE_36 || '站点显示名称'
},
{
renderTo : 'SiteName',
type:'string',
required:'',
max_len:'50',
desc:wcm.LANG.WEBSITE_37 || '站点唯一标识',
methods : PageContext.validExistProperty()
},
{
renderTo : 'RootDomain',
type :'url',
required :'',
max_len :'200',
desc :wcm.LANG.WEBSITE_38 || '站点HTTP'
}
]);
Ext.apply(websitehelper.PageContext, {
selectTemplate : function(nTempId, nTempType){
var event = PageContext.event;
var website = event.getObj();
var sTempId = nTempId + '';
var oParams = {
objecttype: website.getIntType(),
objectid: website.getId(),
templatetype: nTempType,
templateIds: sTempId
};
wcm.CrashBoarder.get('TEMPLATE_SELECT_SOLO').show({
title : wcm.LANG.TEMPLATE_SELECT||'选择模板',
src : WCMConstants.WCM6_PATH + 'template/template_select_list.html',
width:'510px',
height:'240px',
maskable:true,
params : oParams,
callback : function(_args){
var oHelper = new com.trs.web2frame.BasicDataHelper();
var oPostData = {
objectid: oParams.objectid, 
objecttype: oParams.objecttype,
templateid: _args.selectedIds[0] || 0,
templatetype: oParams.templatetype
};
if(oParams.templateids == 0 && oPostData.templateid == 0)
return;
oHelper.call('wcm6_template', 'setDefaultTemplate', oPostData, true, function(){
CMSObj.afteredit(event)();
this.close();
}.bind(this));
}
});
},
editTemplate : function(_nTempId, _nTempType, bVisual){
_nTempId = parseInt(_nTempId);
var event = PageContext.event;
var website = event.getObjs().getAt(0) || event.getHost();
if(_nTempId > 0){
var newParams = {
objectid : _nTempId,
tempType : _nTempType,
callback : 'websitehelper.PageContext.notifyAddEditTemplate',
hostid :website.getId(),
hosttype : website.getIntType(),
typestub : 1
}
if(bVisual){
window.open('../special/design.jsp?templateId=' + _nTempId + 
'&HostType=' + website.getIntType() + '&HostId=' + website.getId());
}else{
$openMaxWin(WCMConstants.WCM6_PATH + 'template/template_add_edit.jsp?' + $toQueryStr(newParams));
}
}else{
var editParams = {
objectid : 0,
tempType : _nTempType,
callback : 'websitehelper.PageContext.notifyAddEditTemplate',
hostid :website.getId(),
hosttype : website.getIntType(),
typestub : 1
}
$openMaxWin(WCMConstants.WCM6_PATH + 'template/template_add_edit.jsp?' + $toQueryStr(editParams));
}
},
notifyAddEditTemplate : function(args){
var event = PageContext.event;
var webSiteId = args.hostId;
var siteType = args.hostType;
var tempId = args.objectId;
var tempType = args.tempType;
var savedTempId = args.saveTempId;
if(tempId > 0) {
CMSObj.afteredit(event)({objType:WCMConstants.OBJ_TYPE_WEBSITE, objId : webSiteId});
return;
}
var oPostData = {
objectid: webSiteId, 
objecttype: siteType,
templateid: savedTempId,
templatetype: tempType
};
var oHelper = new com.trs.web2frame.BasicDataHelper();
oHelper.call('wcm6_template', 'setDefaultTemplate', oPostData, true, function(){
CMSObj.afteredit(event)({objType:WCMConstants.OBJ_TYPE_WEBSITE, objId : webSiteId});
});
}
});

Ext.ns('wcm.domain.WebSiteMgr');
(function (){
var m_oMgr = wcm.domain.WebSiteMgr;
Ext.apply(wcm.domain.WebSiteMgr, {
'configWebSiteSCMpublishfield' : function(event){
var currObj = event.getObj();
var nHostId = currObj.getId();
var nHostType = currObj.getIntType();
var cbId = 'ConfigWebSiteSCMCrashBoard';//定义弹出框的唯一标识 
var crashboard = wcmXCom.get(cbId);
if(!crashboard){
crashboard = new wcm.CrashBoard({
id: cbId,
title:'配置从WCM发布微博时使用的文档字段',
maskable:true, 
draggable : true,
width : '530px',//宽度
height : '300px',//高度
params : {HostId:nHostId,HostType:nHostType,SiteType:0},
src: WCMConstants.WCM6_PATH + 'scm/config_documentfield_wcm.jsp',//内嵌页面地址 
callback : function(params){
var oHelper = new com.trs.web2frame.BasicDataHelper();
oHelper.Call('wcm61_scmmicrocontenttemplate', 'save', 
{ObjectId:params.ObjectId,HostId:params.HostId,HostType:params.HostType,MicroContentStyle:params.MicroContentStyle},
true, function(){
alert("设置成功！");
this.close();
});
}
});
crashboard.show();
}
}
});
})();
(function(){
var fnIsVisible = function(event){
if($MsgCenter.getActualTop().g_IsRegister['SCM']){
var currContext = event.getContext();
var sitetype = currContext.params.SITETYPE;
if(sitetype != undefined && sitetype != null && sitetype == "0" ){
var transport = ajaxRequest({
url : WCMConstants.WCM_ROOTPATH + 'center.do?serviceid=wcm61_scmgroup&methodname=isAdminsOfSCMGroups',
method : 'GET',
parameters : '',
asyn : false
});
if(transport != undefined && transport != null){
var json = parseXml(loadXml(transport.responseText));
return $a(json, "result") == 'true';
}
}
}
return false;
};
var reg = wcm.SysOpers.register;
reg({
key : 'configwebsitescmpublishfield',
type : 'website',
desc : '配置发微博文档字段',
title : '配置从WCM发布微博时使用的文档字段',
order: 19,
fn : function(event){
wcm.domain.WebSiteMgr.configWebSiteSCMpublishfield(event);
},
isVisible : fnIsVisible
});
})();

(function(){
var fnIsVisible = function(event){
var srcChannelId = event.getObj().getId();
var transport = ajaxRequest({
url : WCMConstants.WCM_ROOTPATH + 'center.do?serviceid=wcm61_mobileportal&methodname=isCanCreateMobile',
method : 'GET',
parameters : 'objectid='+srcChannelId +'&objecttype=103',
asyn : false
});
var json = parseXml(loadXml(transport.responseText));
if(json.RESULT == 'false'){
return false;
}
return true;
}
wcm.SysOpers.register({
key : 'create4mobile',
type : 'website',
desc : '智能创建移动站点',
title : '智能创建移动站点',
rightIndex : -2,
order : 2,
fn : function(event){
var siteId = event.getObj().getId();
$openMaxWin(WCMConstants.WCM6_PATH + 'mobile/mobile_create_from_site.html?siteid='+siteId, window.location.hostname.replace(/\.|-/g, "_") + 'mobile_create_from_site', true, true);
},
isVisible : fnIsVisible
});
})();

Ext.ns('wcm.domain.WebSiteMgr');
(function(){
function getHelper(){
return new com.trs.web2frame.BasicDataHelper();
}
Ext.apply(wcm.domain.WebSiteMgr, {
confphotolib : function(event){
FloatPanel.open(WCMConstants.WCM6_PATH +"photo/photolib_config.jsp",(wcm.LANG.PHOTO_LIB || "图片库设置"),680,280);
}
});
})();
(function(){
var pageObjMgr = wcm.domain.WebSiteMgr;
var reg = wcm.SysOpers.register;
reg({
key : 'confphotolib',
type : 'WebSiteInRoot',
desc : wcm.LANG.PHOTO_LIB || '图片库设置',
title : wcm.LANG.PHOTO_LIB || '图片库设置',
rightIndex : -2,
order : 4,
fn : pageObjMgr['confphotolib'],
isVisible : function(event){
var host = event.getHost();
if(host.getId()==1){
return true;
}
return false;
}
});
wcm.SysOpers.createInterceptor({
key : 'quicknew',
type : 'WebSiteInRoot',
isVisible : function(event){
var host = event.getHost();
if(host.getId()==1){
return false;
}
}
})
})();

Ext.ns('wcm.domain.WebSiteMgr');
(function (){
var m_oMgr = wcm.domain.WebSiteMgr;
Ext.apply(wcm.domain.WebSiteMgr, {
publishpublisheddoc : function(event){
wcm.CrashBoarder.get('publish_published_docs').show({
title : '发布已发文档及其概览',
src : WCMConstants.WCM6_PATH + 'document/publish_publisheddocs_and_folder.html',
width:'570px',
height:'250px',
maskable:true,
callback:function(args){
var extrtParam = {
'StartDocCrtime' : args['starttime'],
'EndDocCrtime' : args['endtime']
}
var aIds = event.getObjsOrHost().getIds();
wcm.domain.PublishAndPreviewMgr.publish(aIds, 103, 'publishpublisheddoc', extrtParam);
this.close();
}
});
}
});
})();
(function(){
var pageObjMgr = wcm.domain.WebSiteMgr;
var reg = wcm.SysOpers.register;
reg({
key : 'publishpublisheddoc',
type : 'website',
desc : '发布已发文档及其概览',
title : '发布站点和栏目的首页，并且发布指定时间范围的已发文档',
rightIndex : 5,
order : 4.1,
fn : pageObjMgr['publishpublisheddoc']
});
})();

Ext.ns('wcm.domain.WebSiteMgr');
(function(){
function getHelper(){
return new com.trs.web2frame.BasicDataHelper();
}
Ext.apply(wcm.domain.WebSiteMgr, {
confvideolib : function(){
var sFeature = 'location=no,resizable=yes,menubar=no,scrollbars=yes,status=yes,titlebar=no,toolbar=no,top=200,left=200,border=0,width=560,height=360';
window.open(WCMConstants.WCM6_PATH + "video/config.jsp", "_blank", sFeature);
},
sample : function(){
var sFeature = 'location=no,resizable=yes,menubar=no,scrollbars=yes,status=yes,titlebar=no,toolbar=no,top=100,left=100,border=0,width=1100,height=650';
window.open(WCMConstants.WCM6_PATH + "video/manSample.jsp", "_blank",sFeature);
}, 
confmas : function(){
var sFeature = 'location=no,resizable=yes,menubar=no,scrollbars=yes,status=yes,titlebar=no,toolbar=no,top=200,left=200,border=0,width=560,height=360';
window.open(WCMConstants.WCM6_PATH + "video/configMAS.jsp", "_blank",sFeature);
},
deleteFail : function(event){
window.open(WCMConstants.WCM6_PATH + "video/delete.jsp", "_blank",800,500);
}
});
})();
(function(){
var pageObjMgr = wcm.domain.WebSiteMgr;
var reg = wcm.SysOpers.register;
reg({
key : 'confvideolib',
type : 'WebSiteInRoot',
desc : wcm.LANG.VIDEO_PROCESS_219 || '视频库设置',
title : wcm.LANG.VIDEO_PROCESS_219 || '视频库设置',
rightIndex : -2,
order : 4,
fn : pageObjMgr['confvideolib'],
isVisible : function(event){
var host = event.getHost();
if(host.getId()==2){
return true;
}
return false;
}
});
reg({
key : 'sample',
type : 'WebSiteInRoot',
desc : wcm.LANG.VIDEO_PROCESS_234 || '样本库管理',
title : wcm.LANG.VIDEO_PROCESS_234 || '样本库管理',
rightIndex : -2,
order : 5,
fn : pageObjMgr['sample'],
isVisible : function(event){
var host = event.getHost();
var autoclip=$MsgCenter.getActualTop().autoclip;
if(host.getId()==2 && autoclip==true){
return true;
}
return false;
}
});
reg({
key : 'confmas',
type : 'WebSiteInRoot',
desc : wcm.LANG.videolib_102 || 'MAS推送设置',
title : wcm.LANG.videolib_102 || 'MAS推送设置',
rightIndex : -2,
order : 4,
fn : pageObjMgr['confmas'],
isVisible : function(event){
var host = event.getHost();
if(host.getId()==2){
return true;
}
return false;
}
});
reg({
key : 'deleteFail',
type : 'WebSiteInRoot',
desc : wcm.LANG.VIDEO_PROCESS_223 ||'删除转码失败的视频',
title : wcm.LANG.VIDEO_PROCESS_223 ||'删除转码失败的视频...',
rightIndex : 39,
order : 9,
fn : pageObjMgr['deleteFail'],
isVisible : function(event){
var host = event.getHost();
if(host.getId()==2){
return true;
}
return false;
}
});
wcm.SysOpers.createInterceptor({
key : 'quicknew',
type : 'WebSiteInRoot',
isVisible : function(event){
var host = event.getHost();
if(host.getId()==2){
return false;
}
}
})
})();

