<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
            "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title WCMAnt:param="video_list_editor.html.title">WCM通用列表页面-视频</title>
	<link href="../css/common_thumb.css" rel="stylesheet" type="text/css">
    <link href="../js/resource/all_widgets.css" rel="stylesheet" type="text/css">
<link href="../video/video_list_editor.css" rel="stylesheet" type="text/css">
<link href="../js/easyversion/resource/calendar.css" rel="stylesheet" type="text/css">
<link href="../video/video_thumb.css" rel="stylesheet" type="text/css">
</head>
<body>
<script src="../../app/js/easyversion/cssrender.js"></script>
<div class="layout_container">
	<div class="layout_center_container">
		<div class="layout_center">
			<div class="layout_container layout_innercontainer" style="padding-top:0px;">
				<div class="layout_center_container">
					<div class="layout_center layout_innercenter">
<div class="layout_container thumb_grid">
	<div class="layout_north thumb_grid_head" style="background-position-y:0px;width:600px;">
		<div class="search" id="search" style="float:left;"></div>
		<div id="list-order-box" style="float:right;margin-top:5px;margin-right:10px;"></div> 
	</div>
	<div id='wcm_table_grid' class="layout_center_container thumb_grid_data" style="height:570px;width:600px">
	</div>
	<div id="grid_navigator" class="layout_south table_grid_navigator" style="width:590px;">
		<div id="list_navigator" class="list_navigator_div">
		</div>
	</div>
</div>
					</div>
				</div>
				<div id="south_tabs" class="layout_south"></div>
			</div>
		</div>
		<div id="east_opers" class="layout_east"></div>
	</div>
</div>
<script src="../js/runtime/lightlib.js"></script>
<script src="../js/runtime/core_main.js"></script>
<script src="../js/runtime/abs_thumb.js"></script>
<script src="../js/runtime/data/list.js"></script>
<script src="../js/runtime/data/oper_channelwebsite.js"></script>
<script src="../js/runtime/data/oper_cmsobj_photo.js"></script>
<script language="javascript">
<!--
function checkConvertingVideos() {	
	// 1. 获取所有还没转换完的视频(截图显示为"转换中")
	var arr = document.getElementsByClassName('imgConverting');
	// 2. 对每个没有转换完的视频, 每隔20秒查询其是否转换完
	for(index=0; index<arr.length;index++){
		var img = arr[index];
		var curToken = img.getAttribute("videoToken");
		var curDocId = img.getAttribute("docid");
		var intervalID = setInterval("queryConvertStatus('" + curToken + "', '" + curDocId + "')", 20000);
		img.setAttribute("intervalID", intervalID);
		// ls@2007-11-19 15:53 立即查询一次，以disable掉转换失败的
		queryConvertStatus(curToken, curDocId);
	}
}
function queryConvertStatus(srcFileName, docid) {
    new Ajax.Request("./queryConverted.jsp?token=" + srcFileName + "&docId=" + docid,
					{method: "post", 
					onComplete:	gotConvertStatus.bind(this,srcFileName)
					});
}
function gotConvertStatus(srcFileName,request) {
	var resultStr = request.responseText;
	var json = eval('(' + resultStr + ')');
	if (json.THUMB) {
		var vToken = json.FILENAME;
		var curImg = document.getElementById("thumb_" + srcFileName);
		if (curImg) {
			curImg.src = document.getElementById("thumbUrl").value + "/" + json.THUMB;
			curImg.onclick = function() {
				var sFeature = "location=no,resizable=no,menubar=no,scrollbars=no,status=no,titlebar=no,toolbar=no,top=0,left=0,border=0,width=640,height=450";
				window.open("./player.jsp?v=" + vToken, "_blank", sFeature);
			}
			clearInterval(curImg.getAttribute("intervalID"));
		}
	} else if (json.CONVERT_STATUS == "-1") {
		var curImg = document.getElementById("thumb_" + srcFileName);
		curImg.src = "./convertFail.gif";
		clearInterval(curImg.getAttribute("intervalID"));
		var curRecId = curImg.getAttribute("itemId");
		Grid.setSelectDisable(curRecId);
		var curCheckbox = document.getElementById("cbx_" + curRecId);
		curCheckbox.disabled = true;
	}
}
function alertSaveConvertedFail(request) {
	alert("fail to saveConverted! responseText:\n" + request.responseText);
}
//-->
</script>
<script src="video_list_editor.html.compress.js"></script>
<script src="video_list_editor.js"></script>
</body>
</html>