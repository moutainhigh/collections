<!DOCTYPE html PUBLIC>
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="../../static/script/jazz.js" type="text/javascript"></script>
<script>
	
	function queryData(){
		$('div[name="gridpanel"]').gridpanel('option', 'dataurl',rootPath+
		'/dictionaryList/queryData.do');
		$('div[name="gridpanel"]').gridpanel('query', ['formpanel']);
	}
	
	function reset() {
		$("#formpanel").formpanel('reset');
	}

	
	var dmbId='';
	var dmbLx='';
	$(function(){
		dmbId = jazz.util.getParameter("dmbId");
		dmbLx = jazz.util.getParameter("dmbLx");
		$('div[name="dmbId"]').hiddenfield('setValue',dmbId);
		$('div[name="formpanel"]').formpanel('option', 'title',
				'数据查询');
		$('div[name="gridpanel"]').gridpanel('option', 'title','');
		$('div[name="gridpanel"]').gridpanel('option', 'dataurl',rootPath+
			'/dictionaryList/queryfordetails.do?dmbId='+dmbId);
		$('div[name="gridpanel"]').gridpanel('reload');
	});
	
	function editColumn(event,obj) {
		var data = obj.data;
		for(var i=0;i<data.length;i++){
			var htm = '<a href="javascript:void(0);" onclick="calledit(\''+data[i]["sjId"]+'\',\''+data[i]["dmbLx"]+'\')">'
				+ "编辑" + '</a>';
			data[i]["edit"] = htm; 
		}
		return data;
	}
	
	var winEdit
	function calledit(sjId) {
		winEdit = jazz.widget({
			     vtype: 'window',
			     frameurl: rootPath+'/page/dictionary/dictionary_detailsedit.html?sjId='+sjId+'&dmbLx='+dmbLx+'&update=true',
					name: 'win',
			    	title: '编辑',
			    	titlealign: 'center',
			    	titledisplay: true,
			        width: 900,
			        height: 400,
			        modal:true,
			        visible: true,
			      	resizable: true
				});
	
	}
	
	function addData(){
		winEdit = jazz.widget({
	   	     vtype: 'window',
	   	     frameurl: rootPath+'/page/dictionary/dictionary_detailsedit.html?dmbId='+dmbId+'&dmbLx='+dmbLx+'&update=false',
	  			name: 'win',
	  	    	title: '新增代码数据表',
	  	    	titlealign: 'center',
	  	    	titledisplay: true,
	  	        width: 900,
	  	        height: 400,
	  	        modal:true,
	  	        visible: true,
	  	      	resizable: true
	   		});
	}
	
	function deleteData(){
		var selected = $('div[name="gridpanel"]').gridpanel('getSelection');
		if (selected == null || selected.length<1 ){
			jazz.info("请选中至少一个目标");
		}else if(selected.length>=1){
			jazz.confirm("是否删除选中项", function(){
				var params = {
						url : rootPath+'/dictionaryList/deletedetails.do',
						components: ['gridpanel'],
						callback : function(data, r, res) { 
							if (res.getAttr("back") == 'success'){
								queryData();
								jazz.info("删除成功");
							}
						}
				}
				$.DataAdapter.submit(params);
			}, function(){})
		}
	}
	
</script>

</head>
<body>

	<div vtype="formpanel" id="formpanel" displayrows="1" name="formpanel"
		titleDisplay="true" showborder="true" width="100%" layout="table"
		layoutconfig="{cols:2, columnwidth: ['300px','360px']}" height="150"
		labelStyleClass="labelstyle" title="">

		<div name='dmbId' vtype="hiddenfield" label="代码表ID" labelAlign="right"
			width="300"></div>
		<div name='dm' vtype="textfield" label="代码" labelAlign="right"
			width="300"></div>
		<div name='wb' vtype="textfield" label="文本" labelAlign="right"
			width="300"></div>
		<div id="toolbar" name="toolbar" vtype="toolbar" location="bottom" align="center">
			<div name="query_button" vtype="button" text="查询"
				icon="../query/queryssuo.png" onclick="queryData();"></div>
			<div name="reset_button" vtype="button" text="重置"
				icon="../query/queryssuo.png" click="reset();"></div>
		</div>
	</div>
	<div vtype="gridpanel" name="gridpanel" height="300" showborder="true" width="100%" 
		datarender="editColumn" titleDisplay="true" title="" dataurl="" layout="fit"
		titleDisplay="false" >
		<div name="toolbar" vtype="toolbar">
			<div name="add_button" vtype="button" text="新增"
				icon="../query/queryssuo.png" onClick="addData();"></div>
			<div name="delete_button" vtype="button" text="删除"
				icon="../query/queryssuo.png" onClick="deleteData();"></div>
		</div>
		<!-- 表头 -->
		<div vtype="gridcolumn" name="grid_column">
			<div>
				<!-- 单行表头 -->
				<div name='sjId' text="数据ID" textalign="center" width='15%'></div>
				<div name='dmbId' text="代码表ID" textalign="center" width='10%'></div>
				<div name='dm' text="代码值" textalign="center" width='10%'></div>
				<div name='fdm' text="父代码值" textalign="center" width='10%'></div>
				<div name='wb' text="文本" textalign="center" width='20%'></div>
				<div name='qyBj' text="启用标记" textalign="center" width='10%'
					dataurl='[{"text":"启用","value":"1"},{"text":"停用","value":"0"}]'></div>
				<div name='cj' text="层级" textalign="center" width='10%'></div>
				<div name='edit' text="编辑" textalign="center" width='10%'></div>
			</div>
		</div>
		<!-- 表格 -->
		<!-- ../../grid/reg3.json -->
		<div vtype="gridtable" name="grid_table"></div>
		<!-- 分页 -->

		<div vtype="paginator" name="grid_paginator" theme="2" pagerows="5"></div>
	</div>


</body>
</html>