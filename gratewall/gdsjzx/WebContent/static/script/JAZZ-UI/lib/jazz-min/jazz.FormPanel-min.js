(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Panel","form/jazz.form.TextField","form/jazz.form.TextareaField","form/jazz.form.ComboxField","form/jazz.form.ComboxTree","form/jazz.form.AutocompletecomboxField","form/jazz.form.ColorField","form/jazz.form.DateField","form/jazz.form.CheckboxField","form/jazz.form.RadioField","form/jazz.form.NumberField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.formpanel",$.jazz.panel,{options:{vtype:"formpanel",layout:"table",layoutconfig:{cols:2,columnwidth:["50%","*"]},dataurl:null,dataurlparams:null,dataview:false,readonly:false},_create:function(){this._super();this.element.addClass("jazz-formpanel")},_init:function(){this._super();this.content.addClass("jazz-formpanel-content");if(this.options.dataurl){this.reload()}if(this.options.layout=="auto"){this.content.css("overflow","hidden")}},_ajax:function(){var param={url:this.options.dataurl,params:this.options.dataurlparams,async:true,showloading:false,callback:this._callback};$.DataAdapter.submit(param,this)},_callback:function(data,sourceThis){var jsonData=data;var $this=sourceThis;if(jsonData&&jsonData.data){$.each($this.getChildrenComponent(),function(name,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj),f=$this._filterVtype(childtype);var value=jsonData.data[name];if(isInited&&f){$this._runChildSetValue(childtype,value,obj)}})}if($.isFunction($this.callbackfunction)){$this.callbackfunction.call($this)}},_dataview:function(){var $this=this;$.each(this.getChildrenComponent(),function(name,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj),f=$this._filterVtype(childtype);if(isInited&&f){$this._readonly($obj.data(childtype))}})},_filterVtype:function(vtype){if(vtype=="toolbar"||vtype=="button"||vtype=="gridpanel"){return false}else{return true}},_getProperties:function(type,name){if(!name){var formJson={};formJson.name=this.options.name;formJson.vtype="formpanel";var formdata={};var $this=this;$.each(this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj),f=$this._filterVtype(childtype);if(isInited&&f){formdata[childname]=$obj[childtype](type)}});formJson.data=formdata;return formJson}else{var value="";$.each(this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj);if(isInited&&name==childname){value=$obj[childtype](type)}});return value}},_readonly:function(comp){if(this.options.dataview==true||this.options.readonly==true){comp.options.readonly=true;comp._readonly()}else{comp.options.readonly=false;comp._readonly()}},_runChildSetValue:function(vtype,value,obj){if(vtype=="datefield"&&(value+"").length>10){value=value.substring(0,10)}var comp=$(obj).data(vtype);comp.setValue(value)},_setOption:function(key,value){switch(key){case"dataurlparams":this.options.dataurlparams=value;break;case"dataurl":this.options.dataurl=value;break;case"dataview":case"readonly":if(value==true||value=="true"){this.options.dataview=true;this.options.readonly=true}else{this.options.dataview=false;this.options.readonly=false}this._dataview();break}this._super(key,value)},getValue:function(name){return this._getProperties("getValue",name)},getText:function(name){return this._getProperties("getText",name)},reload:function(data,callbackfunction){this.callbackfunction=callbackfunction;if(this.options.dataurl){this._ajax()}},reset:function(flag){$.each(this.getChildrenComponent(),function(i,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");if(childtype!="toolbar"&&childtype!="button"){if(!flag&&childtype=="hiddenfield"){return true}var isInited=jazz._isComponentInited($obj);if(isInited){$obj[childtype]("reset")}}})},setValue:function(name,value){if(name instanceof Object){this.options.data=name;this._callback(this.options.data,this)}else{$.each(this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj);if(childname==name&&isInited){$this._runChildSetValue(childtype,value,obj)}})}},validate:function(){var flag=true;var subElements=this.element.find("div[vtype]");if(subElements.length==0){}else{subElements.each(function(index,element){var el=$(element);var vtype=el.attr("vtype"),$field=el.data(vtype);var options=$field.options;var rule=options.rule;if(rule&&vtype!="gridpanel"&&vtype!="hiddenfield"&&vtype!="checkboxfield"&&vtype!="radiofield"&&options.isrule){var msg=options.msg;var f=jazz.doTooltip($field,$field.getText(),rule,msg);if(f==false){flag=false;$field._validateStyle(f)}}})}return flag}})});