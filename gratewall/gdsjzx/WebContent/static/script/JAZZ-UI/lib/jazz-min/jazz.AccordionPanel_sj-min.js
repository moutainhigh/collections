(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.accordionpanel",$.jazz.boxComponent,{options:{vtype:"accordionpanel",iconurl:"",iconselect:"",showborder:true,activeindex:0,multiple:false},_create:function(){this._super();this._showborder();if(this.options.multiple){var index=this.options.activeindex;this.options.activeindex=[];this._addToSelection(index)}this.element.addClass("jazz-accordion jazz-helper-reset");var $this=this;this.childrens=this.element.children();$.each(this.childrens,function(i,child){var childitem=$(child).children();$.each(childitem,function(i,item){$(item).addClass("jazz-accordion-content-item");if(i==childitem.length-1){$(item).css({"border-bottom":"none","margin-bottom":"5px"})}});$(child).addClass("jazz-accordion-content jazz-helper-reset jazz-widget-content");var childname=$(child).attr("name");var childid=$(child).attr("id");var compId=$this.getCompId();if(!childname){$(child).attr("name",compId+"_content"+i)}if(!childid){$(child).attr("id",compId+"_content"+i)}var headertext=$("<div class='jazz-accordion-headertext'></div>");var iconurl=$(child).attr("iconurl");if(iconurl){headertext.append('<span style="background:url('+iconurl+') 50% 50% no-repeat;" class="jazz-accordion-header-icon jazz-icon"></span>')}else{headertext.css("padding-left","5px")}headertext.append("<span title='"+$(child).attr("title")+"' class='jazz-accordion-header-text'>"+$(child).attr("title")+"</span>");var header=$("<div class='jazz-accordion-header jazz-helper-reset jazz-state-default'></div>");if(!childname){header.attr("name",compId+"_header"+i)}else{header.attr("name",childname)}if(!childid){header.attr("id",compId+"_header"+i)}else{header.attr("id",childid)}if($this.options.activeindex==i){header.addClass("jazz-state-active");iconurl=$(child).attr("iconselect");if(iconurl){headertext.find(".jazz-accordion-header-icon").css("background-image","url("+iconurl+")")}}else{$(child).addClass("jazz-helper-hidden")}header.append(headertext);var headermessage=$("<div class='jazz-accordion-message' id='"+compId+"'></div>");header.append(headermessage);$(child).before(header)})},_init:function(){this._compSize();this.headers=this.element.children(".jazz-accordion-header");this.panels=this.element.children(".jazz-accordion-content");this._bindEvents();var $this=this;if(this.options.multiple){$.each(this.options.activeindex,function(i,index){var panel=$this.panels.eq(index);$this._calscroll(panel)})}else{var panel=this.panels.eq(this.options.activeindex);this._calscroll(panel)}},_compSize:function(){this._width();this._height()},_showborder:function(){if(this.options.showborder){this.element.addClass("jazz-panel-border")}else{this.element.removeClass("jazz-panel-border")}},_width:function(){this._super();var $this=this;if(this.iscalculatewidth&&!!this.headers){$.each(this.headers,function(i,header){$(header).outerWidth($this.options.calculateinnerwidth);$(header).next($this.options.calculateinnerwidth);var headertextobj=$(header).children(".jazz-accordion-headertext");var iconurl=headertextobj.children(".jazz-accordion-header-icon");var headerWidth=$this.options.calculateinnerwidth-headertextobj.next().outerWidth(true);headertextobj.width(headerWidth);var textWidth=$this.options.calculateinnerwidth;if(iconurl){textWidth=headerWidth-headertextobj.children(".jazz-accordion-header-icon").outerWidth(true)}headertextobj.children(".jazz-accordion-header-text").outerWidth(textWidth)})}else{$.each(this.childrens,function(i,child){var childobj=$(child);childobj.outerWidth($this.options.calculateinnerwidth);childobj.prev($this.options.calculateinnerwidth);var headerobj=childobj.prev();var headertextobj=headerobj.children(".jazz-accordion-headertext");var iconurl=childobj.attr("iconurl");var headerWidth=$this.options.calculateinnerwidth-headertextobj.next().outerWidth(true);if(headertextobj.children(".jazz-accordion-header-icon")){headerWidth=headerWidth-5}headertextobj.width(headerWidth);var textWidth=$this.options.calculateinnerwidth;if(iconurl){textWidth=headerWidth-headertextobj.children(".jazz-accordion-header-icon").outerWidth(true)}headertextobj.children(".jazz-accordion-header-text").outerWidth(textWidth);headertextobj.append("<div style='clear: both;'></div>")})}},_height:function(){this._super();if(this.iscalculateheight&&!!this.panels){var panel=this.panels.eq(this.options.activeindex);this._calscroll(panel)}},_bindEvents:function(){var $this=this;this.headers.off("click.accordion").on("click.accordion",function(e){var element=$(this);if(!element.hasClass("jazz-state-disabled")){var tabIndex=element.index()/2;$this.options.activeLastIndex=tabIndex;if(element.hasClass("jazz-state-active")){$this.unselect(tabIndex)}else{$this.select(tabIndex)}}e.preventDefault()});if(jazz.isIE(6)){this.headers.hover(function(){var element=$(this);if(!element.hasClass("jazz-state-disabled")){element.addClass("jazz-state-hover")}},function(){var element=$(this);if(!element.hasClass("jazz-state-disabled")){element.removeClass("jazz-state-hover")}})}},_show:function(panel){var iconurl;if(!this.options.multiple){var oldHeader=this.headers.filter(".jazz-state-active");oldHeader.removeClass("jazz-state-active").next().hide();oldHeader.each(function(i,header){iconurl=$(header).next().attr("iconurl");$(header).find(".jazz-accordion-header-icon").css("background-image","url("+iconurl+")")})}var newHeader=panel.prev();newHeader.addClass("jazz-state-active");iconurl=panel.attr("iconselect");if(iconurl){newHeader.find(".jazz-accordion-header-icon").css("background-image","url("+iconurl+")")}panel.show()},_addToSelection:function(nodeId){this.options.activeindex.push(nodeId)},_removeFromSelection:function(index){this.options.activeindex=$.grep(this.options.activeindex,function(r){return r!=index})},select:function(index){var panel=this.panels.eq(index);this._calscroll(panel);this._event("change",panel);if(this.options.multiple){this.options.activeindex=[];this._addToSelection(index)}else{this.options.activeindex=index}$.each(panel.parents("div[vtype]:first").getChildrenComponent(),function(){var element=$(this);var vtype=element.attr("vtype");element.data(vtype)._resizeHeight()});this._show(panel)},unselect:function(index){var panel=this.panels.eq(index),header=panel.prev();header.removeClass("jazz-state-active");var iconurl=panel.attr("iconurl");header.find(".jazz-accordion-header-icon").css("background-image","url("+iconurl+")");panel.hide();this._removeFromSelection(index)},_calscroll:function(panel){var $this=this;var allheight=this.options.calculateinnerheight,otherheight=0;if(this.options.multiple){this.element.css({overflow:"auto"});var nScrollHight=this.element[0].scrollHeight;var nScrollTop=this.element[0].scrollTop;if(nScrollTop+allheight>=nScrollHight){$.each(this.headers,function(i,header){var headertextobj=$(header).children(".jazz-accordion-headertext");var iconurl=headertextobj.children(".jazz-accordion-header-icon");var headerWidth=$this.options.calculateinnerwidth-headertextobj.next().outerWidth(true)-jazz.config.scrollWidth;if(headertextobj.children(".jazz-accordion-header-icon")){headerWidth=headerWidth-5}headertextobj.width(headerWidth);var textWidth=$this.options.calculateinnerwidth;if(iconurl){textWidth=headerWidth-headertextobj.children(".jazz-accordion-header-icon").outerWidth()}headertextobj.children(".jazz-accordion-header-text").outerWidth(textWidth)})}}else{if(allheight!=-1){$.each(this.headers,function(i,head){otherheight=otherheight+$(head).outerHeight(true)});var panelheight=allheight-otherheight;panel.outerHeight(panelheight).css({overflow:"auto"})}}},_destroy:function(){}})});