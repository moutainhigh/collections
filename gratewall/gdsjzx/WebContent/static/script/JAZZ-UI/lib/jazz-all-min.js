(function($){window.undefined=window.undefined;var jazz={version:"1.0",namespace:function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=jazz;for(var i=(levels[0]=="jazz")?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj},log:function(info){if(this.config.logger){return console.log("***JAZZ-UI LOG.INFO***",info)}else{return false}}};jazz.namespace("layout");jazz.namespace("config");jazz.namespace("util");jazz.namespace("window");window.jazz=jazz})();(function($){$.extend(jazz,{vtypetree:function(element,createtype){if(!element.data("vtypetree")){var parent=element.parents("div[vtype]:first");if(parent.size()==0){parent=$("BODY")}var parentData=parent.data("vtypetree")||{parent:"",child:{},createtype:createtype};var childName=element.attr("name")||element.attr("id")||jazz.getId();parentData.child[childName]=element;parent.data("vtypetree",parentData);var nodeData={parent:"",child:{},createtype:createtype};nodeData.parent=parent;nodeData.vtype=element.attr("vtype");element.data("vtypetree",nodeData);_vtype.push(nodeData.vtype)}},_isComponentInited:function(element){var nodeData=element.data("vtypetree")||{};if(!!nodeData.vtype){return !!element.data(nodeData.vtype)}nodeData=null;return false},_parse:function(element){jazz.vtypetree(element,"0");var dataurl=element.attr("dataurl");if(dataurl&&!/^\s*[\[|{](.*)/.test(dataurl)){return[dataurl]}var valueSet=[];if("gridcolumn"===element.attr("vtype")){element.children().children().each(function(){var dataurl=$(this).attr("dataurl");if(dataurl&&!/^\s*[\[|{](.*)/.test(dataurl)){valueSet.push(dataurl)}});return valueSet}},_initComponent:function(element,options){var nodeData=element.data("vtypetree")||{};var el=$(element);if(!!nodeData.vtype){if(!jazz._isComponentInited(el)&&nodeData.createtype=="0"){var attrtooptions=jazz.attributeToOptions(el);if(!!options){attrtooptions=$.extend(attrtooptions,options)}attrtooptions.createtype=nodeData.createtype;(el[nodeData.vtype])(attrtooptions)}}var childNodes=nodeData.child;if(!!childNodes){for(var c in childNodes){jazz._initComponent(childNodes[c])}}if(!!nodeData.vtype&&jazz._isComponentInited(el)&&nodeData.createtype=="0"){(el[nodeData.vtype])("finish")}}});var _vtype=[];var _getRequireFile=function(vtype,fn){var vtypetree=[],files=[],filePath=jazz.config.jsFilePath||{};$.each(vtype,function(i,el){if($.inArray(el,vtypetree)===-1){vtypetree.push(el)}});$.each(vtypetree,function(i,v){if($.inArray(filePath[v],files)===-1){files.push(filePath[v])}});require(files,function(){fn()})};$.fn.parseComponent=function(options){var $this=$(this);var links=[],ret;if(!$this.data("vtypetree")){if($this.attr("vtype")){ret=jazz._parse($this);if(ret&&ret.length){links=links.concat(ret)}}$this.find("div[vtype]").each(function(i,obj){ret=jazz._parse($(this));if(ret&&ret.length){links=links.concat(ret)}})}if(jazz.config.isUseRequireJS===true){_getRequireFile(_vtype,function(){jazz._initComponent($this,options);if(window.G){G.processData(links,true)}else{}})}else{if(window.G){G.processData(links,true)}else{}jazz._initComponent($this,options)}};$.fn.getChildrenComponent=function(){var nodeData=$(this).data("vtypetree")||{};return nodeData.child||{}};$.fn.notifyResize=function(){var parent=$(this).parents("div[vtype]:first");var name=parent.attr("name")||"";if(name){$.each(parent.getChildrenComponent(),function(){var element=$(this);var vtype=element.attr("vtype");element.data(vtype)._resizeWidth();element.data(vtype)._resizeHeight()})}};$(function(){$("BODY").parseComponent()});var plugins=(function(){var ary=[],p;for(p in jazz.config.jsFilePath){if(jazz.config.jsFilePath.hasOwnProperty(p)){ary.push(p)}}return ary})();$.each(plugins,function(i,pluginName){$.fn[pluginName]=function(options,nodes){this.initflag=false;var that=this;if(!this.initflag){require([jazz.config.jsFilePath[pluginName]],function(){this.initflag=true;if(pluginName==="tree"){$.fn.zTree.init(that,options.setting,options.znodes)}else{that[pluginName](options)}})}else{jazz.log(" something unreachable unless error")}}})})(jQuery);(function($){jazz.config={contextpath:"JAZZ",compNumber:1000,errorMessageNumber:0,default_upload_url:"",default_download_url:"",default_preview_url:"",default_flash_url:"",default_flash9_url:"",delayButtonDisabled:false,fieldIconWidth:20,fieldBlankText:"",fieldDefaultWidth:150,fieldDefaultHeight:46,fieldLabelWidth:80,isGroupRequest:false,isUseRequireJS:false,jazzRoot:"/JAZZ/jazz/",jsFilePath:{accordionpanel:"jazz.AccordionPanel",attachment:"jazz.Attachment",button:"jazz.Button",date:"jazz.Date",DataAdapter:"DataAdapter",formpanel:"jazz.FormPanel",gridtable:"jazz.GridPanel",gridcolumn:"jazz.GridPanel",gridpanel:"jazz.GridPanel",icon:"jazz.Icon",imageviewer:"jazz.ImageView",layout:"jazz.Layout",loading:"jazz.Loading",menu:"jazz.Menu",contextmenu:"jazz.Menu",message:"jazz.Message",paginator:"jazz.Paginator",panel:"jazz.Panel",tabpanel:"jazz.TabPanel",toolbar:"jazz.Toolbar",tooltip:"jazz.Tooltip",tree:"jazz.Tree",zTree:"jazz.Tree",paginator:"jazz.Paginator",window:"jazz.Window",autocompletecombox:"form/jazz.form.AutocompleteComboxField",checkboxfield:"form/jazz.form.CheckboxField",colorfield:"form/jazz.form.ColorField",comboxfield:"form/jazz.form.ComboxField",comboxtreefield:"form/jazz.form.ComboxTree",datefield:"form/jazz.form.DateField",dropdownfield:"form/jazz.form.DropdownField",hiddenfield:"form/jazz.form.HiddenField",numberfield:"form/jazz.form.NumberField",passwordfield:"form/jazz.form.PasswordField",radiofield:"form/jazz.form.RadioField",textareafield:"form/jazz.form.TextareaField",textfield:"form/jazz.form.TextField"},logger:false,platForm:"other",prefixPosition:0,paginatorStyle:"text",ruleImgWidth:20,scrollWidth:17,submitShowLoading:false,valuetip:"",zindex:10000,i18n:{chooseFile:"请选择文件",password:"请输入密码",wait:"请稍后...",fileName:"文件名",fileSize:"文件大小",fileDelete:"删除",fileDownload:"下载",fileEdit:"编辑",fileAffix:"附件",fileAdd:"增加",fileCancel:"取消",number:"数字",numberInt:"整数",numberFloat:"浮点数",numberPlusInt:"大于等于0的整数",months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一","十二"],days:["日","一","二","三","四","五","六"],dateOrder:["年","月","日","时","分","秒"],bizSucMsg:"校验成功!",bizFaiMsg:"校验失败!",sysMsg:"系统错误!",saveSuc:"保存成功!",saveFai:"保存失败!",save:"提交",cancel:"取消",button:"按钮",firstPage:"首页",endPage:"末页",nextPage:"下一页",previousPage:"上一页",titleName:"提示框",okBtnName:"确定",cancelBtnName:"取消",defineBtnName:"自定义",boxMin:"最小化",boxMax:"最大化",boxNatural:"正常化",boxClose:"关闭",selectLoading:"正在加载数据请稍后...",toolEdit:"编辑",toolNew:"新建",toolDel:"删除",toolFresh:"刷新",toolOpen:"打开",toolFind:"查找",toolSave:"保存",toolBack:"返回",toolExport:"导出",toolAddtime:"增加时间",toolReducetime:"减少时间",toolAddright:"授权",toolReduceright:"撤权",num:"数字",numInt:"整数",numFloat:"浮点数",numScience:"科学计数法",character:"字符",chinese:"汉字",twoBytes:"双字节",english:"英文",date:"日期格式不正确",numChar:"数字或字符",numEnglish:"数字英文字符",qq:"QQ号码",telephone:"座机号码",cellphone:"手机号码",idcard:"请输入正确的身份证号码",postal:"邮政编码",currency:"美元",email:"邮箱地址",url:"URL地址",and1:",且",or:",或者",must:"不能为空",contrast:"数值",range:"数值范围为",customCheckStyle:"不允许输入以下字符",length1:"字符串长度为",customFunction:"自定义校验",area:["","","","","","","","","","","","北京","天津","河北","山西","内蒙古","","","","","","辽宁","吉林","黑龙江","","","","","","","","上海","江苏","浙江","安微","福建","江西","山东","","","","河南","湖北","湖南","广东","广西","海南","","","","重庆","四川","贵州","云南","西藏","","","","","","","陕西","甘肃","青海","宁夏","新疆","","","","","","台湾","","","","","","","","","","香港","澳门","","","","","","","","","国外"],tabMenuFresh:"刷新",tabMenuClose:"关闭当前项",tabMenuCloseAll:"关闭所有项",tabMenuCloseOthers:"关闭其他项"}};var _config=window.JAZZUICONFIG||{};$.extend(jazz.config,_config)})(jQuery);(function($){jazz.util={attributeToOptions:function(obj){var att=null;if(obj instanceof jQuery){if(obj.size()<1){jazz.log("未找到满足条件的对象，无法获取全部属性，直接返回空json");return{}}att=obj.get(0).attributes}else{att=obj.attributes}var j=0;var attObj="{";for(var i=0,len=att.length;i<len;i++){var o=att[i];if(o.specified){var _v=jQuery.trim(o.value+""),f=0;if(_v.length>0){_v=_v.replace(/[\r\n|\t]/g," ");if((_v+"").charAt(0)=="["||(_v+"").charAt(0)=="{"){f=1}}else{_v=""}if(j===0){attObj=attObj+'"'+o.name+'": '}else{attObj=attObj+', "'+o.name+'": '}if(f==0){attObj=attObj+'"'+_v+'"'}else{attObj=attObj+_v}j++}}attObj=attObj+"}";return jazz.stringToJson(attObj)},confirm:function(message,sure,cancel){if(jazz.config.isUseRequireJS===true){require(["jazz.Message"],function(){if(jazz.config.errorMessageNumber==0){$("<div>").appendTo(that.getBodyObject()).message({title:"确认信息",showtype:3,detail:message,sure:sure,cancel:cancel})}})}else{if(jazz.config.errorMessageNumber==0){$("<div>").appendTo(this.getBodyObject()).message({title:"确认信息",showtype:3,detail:message,sure:sure,cancel:cancel})}}},doTooltip:function($this,val,rule,regMsg){var ruleImg=$this.ruleImg,ruleType=$this.options.ruletype;obj=jazz_validator.doValidator(val,rule,regMsg,$this);if($this.options.msg){obj.msg=$this.options.msg}if(ruleType==2){$this.inputtext.tooltip({isbindevent:false,content:obj.msg,iconclass:"jazz-tooltip-default-icon",position:{at:"left bottom",my:"left top",collision:"flipfit flipfit",of:$this.inputtext}})}if(!obj.state){$this.parent.addClass("jazz_validator_border");if(ruleType!=2){ruleImg.removeClass("jazz-helper-hidden");ruleImg.attr("title",obj.msg)}else{if(ruleType==2){$this.inputtext.tooltip("show");$this.inputtext.off("mouseover.tooltip mouseout.tooltip blur.tooltip").on("mouseover.tooltip",function(){$this.inputtext.tooltip("show")}).on("mouseout.tooltip",function(){$this.inputtext.tooltip("hide")}).on("blur.tooltip",function(){$this.inputtext.tooltip("hide")})}}}else{$this.parent.removeClass("jazz_validator_border");if(ruleType!=2){ruleImg.addClass("jazz-helper-hidden")}else{if(ruleType==2){$this.inputtext.off("mouseover.tooltip mouseout.tooltip blur.tooltip");$this.inputtext.tooltip("hide")}}}return obj.state},escapeRegExp:function(string){return string.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},error:function(message,sure){var that=this;if(jazz.config.isUseRequireJS===true){if(jazz.config.errorMessageNumber==0){$("<div>").appendTo(that.getBodyObject()).message({title:"错误信息",showtype:1,detail:message,sure:sure})}}else{if(jazz.config.errorMessageNumber==0){$("<div>").appendTo(this.getBodyObject()).message({title:"错误信息",showtype:1,detail:message,sure:sure})}}},getBodyObject:function(){if(!this.$bodyobject){this.$bodyobject=$("body")}return this.$bodyobject},getId:function(){return"comp_j_"+jazz.getRandom()+"_"+(++jazz.config.compNumber)},getParameter:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");var r=window.location.search.substr(1).match(reg);if(r!=null){return unescape(r[2])}return null},getParameters:function(){var url=window.location.search;var params={};if(url.indexOf("?")!=-1){var str=url.substr(1);var strs=str.split("&");for(var i=0,len=strs.length;i<len;i++){params[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}}return params},getRandom:function(){return Math.random().toString().substr(2,8)},getTop:function(){var dom=window;if(dom.top.jazz){dom=dom.top.window}else{while(dom.parent){if(dom.parent==dom){break}dom=dom.parent}}if(dom.jazz){return dom}return dom},getIndex:function(){return jazz.config.zindex++},inArray:function(arr,item){for(var i=0,len=arr.length;i<len;i++){if(arr[i]===item){return true}}return false},info:function(message,sure){var that=this;if(jazz.config.isUseRequireJS===true){require(["jazz.Message"],function(){$("<div>").appendTo(that.getBodyObject()).message({title:"提示信息",showtype:0,detail:message,sure:sure})})}else{$("<div>").appendTo(this.getBodyObject()).message({title:"提示信息",showtype:0,detail:message,sure:sure})}},isArray:function(v){return Object.prototype.toString.apply(v)==="[object Array]"},isDate:function(v){return Object.prototype.toString.apply(v)==="[object Date]"},isIE:function(version){return($.browser.msie&&parseInt($.browser.version,10)===version)?true:false},isNumber:function(n){return $.isNumeric(n)},isNormalSize:function(n){if(/^(\d+(\.\d+)?|\d+(\.\d+)?%)$/.test(n)){return true}else{return false}},jsonToString:function(o){if(typeof o=="undefined"||o===null){return"null"}else{if(jazz.isArray(o)){var a=["["],b,i,l=o.length,v;for(i=0;i<l;i++){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(v===null?"null":jazz.jsonToString(v));b=true}}a.push("]");return a.join("")}else{if(jazz.isDate(o)){return'"'+o.getFullYear()+"-"+jazz.pad(o.getMonth()+1)+"-"+jazz.pad(o.getDate())+" "+jazz.pad(o.getHours())+":"+jazz.pad(o.getMinutes())+":"+jazz.pad(o.getSeconds())+'"'}else{if(typeof o=="string"){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(o)){return'"'+o.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c}c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+o+'"'}else{if(typeof o=="number"){return isFinite(o)?String(o):"null"}else{if(typeof o=="boolean"){return String(o)}else{var a=["{"],b,i,v;for(i in o){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(jazz.jsonToString(i),":",v===null?"null":jazz.jsonToString(v));b=true}}a.push("}");return a.join("").replace(/&nbsp;/ig," ")}}}}}}},pad:function(n){return n<10?"0"+n:n},parseDataByDataFormat:function(formatParams){if(!formatParams){return""}var cellvalue=formatParams.cellvalue;var datatype=formatParams.datatype;var dataformat=formatParams.dataformat;if(cellvalue==""||cellvalue==undefined||cellvalue==null){return""}if(!datatype){return cellvalue}var showvalue="";if(datatype=="date"||datatype=="datefield"){cellvalue=cellvalue.replace(/\.0*$/i,"");dataformat=dataformat||"YYYY-MM-DD HH:mm:ss";showvalue=jazz.dataFormater(cellvalue,dataformat)}else{if(datatype=="number"||datatype=="numberfield"){dataformat=dataformat||"";showvalue=jazz.dataFormater(cellvalue,dataformat)}else{showvalue=cellvalue}}return showvalue},stringToJson:function(string){if(string){if(string instanceof Object){return{}}else{return eval("("+string+")")}}else{return{}}},transformBoolean:function(b){return(b=="true"||b==true)?true:false},warn:function(message,sure){var that=this;if(jazz.config.isUseRequireJS===true){require(["jazz.Message"],function(){if(jazz.config.errorMessageNumber==0){$("<div>").appendTo(that.getBodyObject()).message({title:"警告信息",showtype:2,detail:message,sure:sure})}})}else{if(jazz.config.errorMessageNumber==0){$("<div>").appendTo(this.getBodyObject()).message({title:"警告信息",showtype:2,detail:message,sure:sure})}}},windowHeight:function(){if($.browser.msie){return document.compatMode=="CSS1Compat"?document.documentElement.clientHeight:(document.body&&document.body.clientHeight)}else{return self.innerHeight}},windowWidth:function(){if($.browser.msie){return document.compatMode=="CSS1Compat"?document.documentElement.clientWidth:(document.body&&document.body.clientWidth)}else{return self.innerWidth}}};jazz.window={close:function(e){var iframeNumber=0;var target=e.target,$target=$(target);var tParent=$target.parent();function _findWindow(tParent){var t=tParent;if(t.is("body")){var frameElement=window.frameElement;if(frameElement){var _divObj=$(frameElement).parent();var $div=$(_divObj);iframeNumber++;_findWindow($div)}else{jazz.log("jazz.window.close frame error.");return}}else{if(t.hasClass("jazz-window")){var dom=window;try{if(dom.top.$(t[0]).data("window")){dom.top.$(t[0]).data("window").close();return}else{while(dom){if(dom.$(t[0]).data("window")){dom.$(t[0]).data("window").close();return}else{dom=dom.parent}}}}catch(ex){jazz.log("jazz.window.close top error.");return}}else{if(t.parent()){_findWindow(t.parent())}}}}_findWindow(tParent)}};$.extend(jazz,jazz.util)})(jQuery);(function($){var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(len,radix){var chars=CHARS,uuid=[],i;radix=radix||chars.length;if(len){for(i=0;i<len;i++){uuid[i]=chars[0|Math.random()*radix]}}else{var r;uuid[8]=uuid[13]=uuid[18]=uuid[23]="-";uuid[14]="4";for(i=0;i<36;i++){if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[(i==19)?(r&3)|8:r]}}}return uuid.join("")};Math.uuidFast=function(){var chars=CHARS,uuid=new Array(36),rnd=0,r;for(var i=0;i<36;i++){if(i==8||i==13||i==18||i==23){uuid[i]="-"}else{if(i==14){uuid[i]="4"}else{if(rnd<=2){rnd=33554432+(Math.random()*16777216)|0}r=rnd&15;rnd=rnd>>4;uuid[i]=chars[(i==19)?(r&3)|8:r]}}}return uuid.join("")};Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:(r&3|8);return v.toString(16)})}})(jQuery);jazz.namespace("listener");(function($){jazz.listener={fitlistener:{pood:[],config:[],add:function(obj,config){this.pood.push(obj);this.config.push(config)},start:function(){var $this=this;var fitobject=null,parentobject=null,bodyobject=null,cacheFitHeight=[],parentHeight=0,siblingheight=0,overflow_x=null,overflow_x=null;if(this.cleartimeout){this.stop()}this.cleartimeout=setInterval(function(){for(var i=0,len=$this.pood.length;i<len;i++){fitobject=$this.pood[i];parentobject=fitobject.parent();if(parentobject[0].nodeName=="BODY"){bodyobject=$(document.body);parentHeight=jazz.util.windowHeight()-(bodyobject.outerHeight(true)-bodyobject.height())}else{parentHeight=parentobject.height()}$.each(fitobject.siblings(),function(){if($(this).css("display")!="none"&&$(this).attr("islayout")!="no"&&$(this).css("position")!="fixed"&&$(this).css("position")!="absolute"){siblingheight+=$(this).outerHeight(true)}});fitHeight=parentHeight-siblingheight;if(cacheFitHeight[i]!=fitHeight){overflow_x=parentobject.css("overflow-x");overflow_y=parentobject.css("overflow-y");parentobject.css("overflow-x","hidden");parentobject.css("overflow-y","hidden");fitobject.outerHeight(fitHeight,true);cacheFitHeight[i]=fitHeight;if($this.config[i]&&$this.config[i].callback&&($.isFunction($this.config[i].callback))){$this.config[i].callback.call($this)}parentobject.css("overflow-x",overflow_x);parentobject.css("overflow-y",overflow_y)}siblingheight=0}},300)},stop:function(){if(this.cleartimeout){clearInterval(this.cleartimeout)}}}}})(jQuery);(function($){if(!jazz.isIE(6)){var _winWidth=jazz.windowWidth(),_winHeight=jazz.windowHeight();var timerID="timerLayout_"+jazz.getRandom();$(window).off("resize.jazzwindow").on("resize.jazzwindow",function(){if(window[timerID]){clearTimeout(window[timerID])}window[timerID]=null;window[timerID]=setTimeout(function(){resizeAll()},100)});function resizeAll(){var _width=jazz.windowWidth(),_height=jazz.windowHeight();var body=$("body");var overflow_x=body.css("overflow-x");body.css("overflow-x","hidden");$.each($("body").getChildrenComponent(),function(i,obj){var element=$(this);var vtype=element.attr("vtype"),el=element.data(vtype)||"";if(el){if(_winWidth!=_width){el._resizeWidth()}if(_winHeight!=_height){el._resizeHeight()}}});body.css("overflow-x",overflow_x);_winWidth=_width;_winHeight=_height}}})(jQuery);(function($){$(document).off("mousedown").on("mousedown",function(e){var target=e.target,$target=$(target);var droppanels=$("div.jazz-dropdown-panel.jazz-widget-content.jazz-helper-hidden");$.each(droppanels,function(){if($(this).is(":hidden")){return}var dropvtype=$(this).attr("type");if(dropvtype=="datefield"||dropvtype=="colorfield"||dropvtype=="autocompletecomboxfield"||dropvtype=="comboxfield"||dropvtype=="comboxtreefield"){var dropname=$(this).attr("name").substring(14);var dropinput=$("div[name="+dropname+"]").data(dropvtype).inputtext;var droptrigger=$("div[name="+dropname+"]").data(dropvtype).trigger;if(target==dropinput.get(0)||target==droptrigger.get(0)){return}var dropprefix=$("div[name="+dropname+"]").data(dropvtype).prefix;if(dropprefix){if(target==dropprefix.get(0)){return}}var dropsuffix=$("div[name="+dropname+"]").data(dropvtype).suffix;if(dropsuffix){if(target==dropsuffix.get(0)){return}}}var offset=$(this).offset();if(e.pageX<offset.left||e.pageX>offset.left+$(this).width()||e.pageY<offset.top||e.pageY>offset.top+$(this).height()){$(this).hide();if(dropvtype=="datefield"||dropvtype=="colorfield"||dropvtype=="autocompletecomboxfield"||dropvtype=="comboxfield"||dropvtype=="comboxtreefield"){var data=$("div[name="+dropname+"]").data(dropvtype)._changeData();$("div[name="+dropname+"]").data(dropvtype)._event("change",e,data)}}if($(".jazz-date-list-year").children().length>0){$(".jazz-date-list-year").hide()}if($(".jazz-date-list-month").children().length>0){$(".jazz-date-list-month").hide()}})})})(jQuery);var G=window.G||{};G.pageCache=[];G.isGetAll=jazz.config.isGroupRequest||false;G.groupUrl={};G.processData=function(links,type){if(G.isGetAll==false){return}var $this=this,use=G.groupUrl;var counter=0,tmpUse=[];for(var i=0,len=links.length;i<len;i++){var key=links[i].replace(/([\s|\S]+=)((\w+,)*\w+)$/g,"$1"),param=links[i].replace(/([\s|\S]+=)((\w+,)*\w+)$/g,"$2");if(/(\/JAZZ\/dictionary\/queryData\.do\?dicId=)((\w+,)*\w+)$/.test(links[i])){if(use.hasOwnProperty(key)){if(use[key].indexOf("@@")==-1){tmpUse.push(links[i])}else{tmpUse.push(key+param)}use[key]+=("@@"+param)}else{use[key]=param;tmpUse.push(key+param)}counter++}}if(counter>1){for(var i=0,len=tmpUse.length;i<len;i++){$this._beforeRequestByGroup(tmpUse[i])}}for(var key in use){use[key]=use[key].replace(/@@/g,",");$this.getPageDataSetCache(key+use[key])}};G._setPageCacheByURL=function(cacheName,cacheParam){cacheParam=cacheParam||"";var i=0,$this=this;while(i<G.pageCache.length){if(cacheName==G.pageCache[i].cacheName&&cacheParam==G.pageCache[i].cacheParam){return}i++}G.pageCache.push({cacheName:cacheName,cacheParam:cacheParam,data:[],status:"ready"});$.ajax({type:"POST",url:cacheName,dataType:"text",success:function(data){var i=0,tmpdata;while(i<G.pageCache.length){if(cacheName==G.pageCache[i].cacheName){tmpdata=eval("("+data+")");if(jazz.config.platForm=="sword"&&!!tmpdata.data[0]){tmpdata.data=tmpdata.data[0].data}G.pageCache[i].data=tmpdata;G.pageCache[i].status="success";break}i++}},error:function(data){var i=0;while(i<G.pageCache.length){if(cacheName==G.pageCache[i].cacheName){G.pageCache[i].status="error";break}i++}},complete:function(data){}})};G._beforeRequestByGroup=function(cacheName,cacheParam){if(!G.isGetAll){return}var i=0,$this=this;cacheParam=cacheParam||"";while(i<G.pageDataSetCache.length){if(cacheName==G.pageDataSetCache[i].cacheName&&cacheParam==G.pageDataSetCache[i].cacheParam){return}i++}G.pageDataSetCache.push({cacheName:cacheName,cacheParam:cacheParam,data:[],status:"ready"})};G._getCacheNameIndex=function(cacheParam){var $this=this;for(var i=0,len=$this.pageDataSetCache.length;i<len;i++){if($this.pageDataSetCache[i]["cacheName"].indexOf(cacheParam)>-1){return i}}};G.getPageCacheByCode=function(cacheName,code,cacheParam){cacheParam=cacheParam||"";var i=0;while(i<G.pageCache.length){if(cacheName==G.pageCache[i].cacheName&&cacheParam==G.pageCache[i].cacheParam&&G.pageCache[i].data.data!=undefined){var j=0;while(j<G.pageCache[i].data.data.length){if(G.pageCache[i].data.data[j].id){if(code==G.pageCache[i].data.data[j].id){var d={status:G.pageCache[i].status,data:G.pageCache[i].data.data[j].name};return d}}if(G.pageCache[i].data.data[j].value){if(code==G.pageCache[i].data.data[j].value){var d={status:G.pageCache[i].status,data:G.pageCache[i].data.data[j].label};return d}}j++}}i++}G._setPageCacheByURL(cacheName,cacheParam);var d={status:"ready",data:undefined};return d},G.getPageCache=function(cacheName,cacheParam){cacheParam=cacheParam||"";var i=0;while(i<G.pageCache.length){if(cacheName==G.pageCache[i].cacheName&&cacheParam==G.pageCache[i].cacheParam){var d={status:G.pageCache[i].status,data:G.pageCache[i].data};return d}i++}G._setPageCacheByURL(cacheName,cacheParam);var d={status:"ready",data:[]};return d};G.getPageCacheByParentId=function(cacheName,key){var dataArray=[];var i=0;while(i<G.pageCache.length){if(cacheName==G.pageCache[i].cacheName){if(key!=undefined){var j=0;while(j<G.pageCache[i].data.data.length){if(key==G.pageCache[i].data.data[j].parentFloatId){dataArray.push(G.pageCache[i].data.data[j])}j++}return dataArray}else{return G.pageCache[i].data.data}break}i++}return null};G.pageDataSetCache=[];G._setPageDataSetCacheByURL=function(cacheName,cacheParams,flag){var i=0,$this=this;while(i<G.pageDataSetCache.length){if(cacheName==G.pageDataSetCache[i].cacheName){if(!flag){return}}i++}G.pageDataSetCache.push({cacheName:cacheName,cacheParams:cacheParams,data:{},status:"ready"});this.r_jazzData=new Object();this.r_dataArray=new Array();this.r_jazzData.data=this.r_dataArray;var postData=null;if(jazz.config.platForm=="sword"){this.r_jazzData=new Object();this.r_dataArray=new Array();this.r_jazzData.data=this.r_dataArray;if(jazz.isIE(7)||jazz.isIE(6)){if(typeof(cacheParams)!="object"){cacheParams=jazz.stringToJson(cacheParams)}}if(!!cacheParams){$.each(cacheParams,function(param,i){var _newDataObj={};_newDataObj.sword="attr";_newDataObj.name=param;_newDataObj.value=cacheParams[param]+"";$this.r_dataArray.push(_newDataObj)})}else{var index=decodeURI(cacheName).indexOf("?");var params=decodeURI(cacheName).substring(index+1).split("&");$.each(params,function(i,param){var data=param.split("=");var _newDataObj={};_newDataObj.sword="attr";_newDataObj.name=data[0];_newDataObj.value=data[1]+"";$this.r_dataArray.push(_newDataObj)})}this.r_jazzData.tid=decodeURI(cacheName)}else{if(!!cacheParams){$.each(cacheParams,function(param,i){var _newDataObj={};_newDataObj.vtype="attr";_newDataObj.name=param;_newDataObj.data=cacheParams[param];$this.r_dataArray.push(_newDataObj)})}else{var index=decodeURI(cacheName).indexOf("?");var params=decodeURI(cacheName).substring(index+1).split("&");$.each(params,function(i,param){var data=param.split("=");var _newDataObj={};_newDataObj.vtype="attr";_newDataObj.name=data[0];_newDataObj.data=data[1];if(!!data[1]){$this.r_dataArray.push(_newDataObj)}})}}postData={};postData.postData=jazz.jsonToString(this.r_jazzData);if($this.isGetAll){var params=cacheName.split("=");if(params.length==2){for(var key in G.groupUrl){if(G.groupUrl[key]!=params[1]&&G.groupUrl[key].indexOf(params[1])>-1){var index=$this._getCacheNameIndex(cacheName);if($this.pageDataSetCache[index]["status"]!="success"){return}}}}}$.ajax({type:"POST",url:cacheName,dataType:"text",data:postData,success:function(data){var datajson=null;if(jazz.config.platForm=="sword"){var newdata=data.replace(/label/g,"text");var newdatajson=jazz.stringToJson(newdata);datajson={data:{}};if(!!newdatajson.data[0]){datajson.data=newdatajson.data[0].data}datajson=jazz.jsonToString(datajson)}else{datajson=data}var i=0;while(i<G.pageDataSetCache.length){if(cacheName==G.pageDataSetCache[i].cacheName){var requestParams=G._isInGroupUrl(cacheName);if(requestParams){var group=requestParams.params.split(","),groupData=jazz.stringToJson(datajson);for(var j=0;j<group.length;j++){var pi=$this._getCacheNameIndex(requestParams.url+group[j]);G.pageDataSetCache[pi].data=groupData.data[j];G.pageDataSetCache[pi].status="success"}}datajson=jazz.stringToJson(datajson);G.pageDataSetCache[i].data=datajson.data;G.pageDataSetCache[i].status="success";break}i++}},error:function(data){var i=0;while(i<G.pageDataSetCache.length){if(cacheName==G.pageDataSetCache[i].cacheName){G.pageDataSetCache[i].status="error";break}i++}},complete:function(data){}})};G._isInGroupUrl=function(cacheName){if(!G.isGetAll){return false}for(var key in G.groupUrl){if(cacheName.indexOf(key+G.groupUrl[key])>-1){return{url:key,params:G.groupUrl[key]}}}return false};G.getPageDataSetCache=function(cacheName,cacheParams,flag){var i=0;while(i<G.pageDataSetCache.length){if(cacheName==G.pageDataSetCache[i].cacheName){if((flag==true&&(G.pageDataSetCache[i]["status"]!="ready"&&G.pageDataSetCache[i]["status"]=="success"))||(flag==true&&G.pageDataSetCache[i]["status"]=="success")||(G._isInGroupUrl(cacheName))){if(!!cacheName){G._setPageDataSetCacheByURL(cacheName,cacheParams,flag)}}var d={cacheName:cacheName,cacheParams:cacheParams,status:G.pageDataSetCache[i].status,data:G.pageDataSetCache[i].data};return d}i++}if(!!cacheName){G._setPageDataSetCacheByURL(cacheName,cacheParams)}var d={cacheName:cacheName,cacheParams:cacheParams,status:"ready",data:{}};return d};(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.component",{options:{name:"",content:null,items:null},_create:function(){this._attrToOptions();this.element.attr("vtype",this.options.vtype);var name=this.options.name;if(!name){this.options.name=name=this.options.id||this.getCompId()}this.element.attr("name",name);var $this=this;this.options.create=function(){$this.content_number=1;$this.items_number=1;$this._vtypetree()}},_init:function(){},_attrToOptions:function(){var c_a=jazz.attributeToOptions(this.element.get(0));for(var p in c_a){if(c_a[p]==="true"){c_a[p]=true}else{if(c_a[p]==="false"){c_a[p]=false}}}$.extend(this.options,c_a)},_createContent:function(obj){if(obj instanceof $&&this.content_number===1){$.each(obj.find("div[vtype]"),function(){$(this).parseComponent()});this.content_number++}},_createItems:function(obj){var items=this.options.items;if($.isArray(items)){if(obj instanceof $&&this.items_number===1){$.each(items,function(i,item){var vtype=item.vtype;if(vtype){var v=$("<div>").appendTo(obj);v[vtype](item)}});this.items_number++}}},_customopration:function(){if(arguments.length==0){return false}var cb=arguments[0];var params=[];if(cb){for(var i=1;i<arguments.length;i++){params.push(arguments[i])}if($.isFunction(cb)){return cb.apply(this,params)}else{if(cb.indexOf("(")!=-1){cb=cb.substr(0,cb.indexOf("("))}return eval(cb).apply(this,params)}}},_event:function(eventName,event,data){var _ename=eventName;var callback=this.options[_ename];if(!$.isFunction(callback)){var reg=/\(/;if(reg.test(callback)){callback=callback.split("(")[0]||null;if(callback==null){return false}}callback=eval(callback+"")}data=data||{};event=$.Event(event);event.type=(eventName===this.options.vtype?eventName:this.options.vtype+eventName).toLowerCase();event.currentClass=this;event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop]}}}this.element.trigger(event,data);return !($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented())},_vtypetree:function(){if(this.options.createtype!="0"){jazz.vtypetree(this.element,"1")}},finish:function(){},getCompId:function(){var id=jazz.getId();return id},getParentComponent:function(){var nodeData=this.element.data("vtypetree")||{};return nodeData.parent||{}},getChildrenComponent:function(){var nodeData=this.element.data("vtypetree")||{};return nodeData.child||{}},getChildrenComponentByVtype:function(vtype){var element=null;var nodeData=this.element.data("vtypetree")||{};for(var childname in nodeData.child){var data=nodeData.child[childname].data("vtypetree");if(data.vtype==vtype){element=nodeData.child[childname];break}}return element}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery"],factory)}else{factory($)}})(jQuery,function($){jazz.layout={auto:"autolayout",border:"borderlayout",column:"columnlayout",fit:"fitlayout",row:"rowlayout",vbox:"vboxlayout",hbox:"hboxlayout",table:"tablelayout",query:"querylayout",card:"cardlayout",anchor:"anchorlayout"};$.widget("jazz.containerlayout",{options:{container:null,layoutconfig:{}},reflashLayout:function(componentObject,layoutcontainer,layoutconfig){this.layout(componentObject,layoutcontainer,layoutconfig)},reflashLayoutBefore:function(){},reflashLayoutAfter:function(){}})});(function($){$.widget("jazz.anchorlayout",$.jazz.containerlayout,{layout:function(cthis,container,config){var anchor=config.anchor;var points=config.point;container.addClass("jazz-layout");container.css({border:"5px solid red"});if(anchor==null){if(config.type=="1"){var page=this._getPageSize();var x=page.windowWidth/2,y=page.windowHeight/2;anchor=config.anchor={x:x,y:y}}else{container.css({width:1200,height:400});var top=container.offset().top;var left=container.offset().left;var cw=container.width()/2;var ch=container.height()/2;top=parseInt(top+ch);left=parseInt(left+cw);anchor=config.anchor={x:left,y:top}}}var cheight=0;$.each(points,function(i,p){if(!!p.id){var x=parseInt(anchor.x)+parseInt(p.offset.x);var y=parseInt(anchor.y)+parseInt(p.offset.y);var n=$("#"+p.id).outerHeight(true)+y;if(n>cheight){cheight=n}$("#"+p.id).appendTo(container);$("#"+p.id).css({position:"absolute",top:y,left:x})}});container.height(cheight+20)},_getPageSize:function(){var xScroll,yScroll;if(window.innerHeight&&window.scrollMaxY){xScroll=window.innerWidth+window.scrollMaxX;yScroll=window.innerHeight+window.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){xScroll=document.body.scrollWidth;yScroll=document.body.scrollHeight}else{xScroll=document.body.offsetWidth;yScroll=document.body.offsetHeight}}var windowWidth,windowHeight;if(self.innerHeight){if(document.documentElement.clientWidth){windowWidth=document.documentElement.clientWidth}else{windowWidth=self.innerWidth}windowHeight=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){windowWidth=document.documentElement.clientWidth;windowHeight=document.documentElement.clientHeight}else{if(document.body){windowWidth=document.body.clientWidth;windowHeight=document.body.clientHeight}}}if(yScroll<windowHeight){pageHeight=windowHeight}else{pageHeight=yScroll}if(xScroll<windowWidth){pageWidth=xScroll}else{pageWidth=windowWidth}return{pageWidth:pageWidth,pageHeight:pageHeight,windowWidth:windowWidth,windowHeight:windowHeight}}})})(jQuery);(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","layout/jazz.ContainerLayout"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.autolayout",$.jazz.containerlayout,{layout:function(cthis,container,layoutconfig){}})});(function($){$.widget("jazz.boxlayout",$.jazz.containerlayout,{options:{interval:10,top:20,left:10},_create:function(){}})})(jQuery);(function($){$.widget("jazz.hboxlayout",$.jazz.boxlayout,{layout:function(cthis,container,config){cthis.content.addClass("jazz-layout");var items=container.children();var bc={top:0,left:0,width:0};this._align(cthis,items,container,config,bc)},_align:function(cthis,items,container,config,bc){for(var i=0,len=items.length;i<len;i++){var left=0;if(i==0){left=bc.left=0}else{left=bc.left=bc.width+bc.left}bc.width=items.eq(i).outerWidth(true);items.eq(i).css({position:"absolute",top:0,left:left})}if(cthis.options.height===-1){container.height(allheight+parseInt(config.margin.top)+parseInt(config.margin.bottom))}}})})(jQuery);(function($){$.widget("jazz.vboxlayout",$.jazz.boxlayout,{layout:function(cthis,container,config){container.addClass("jazz-layout");var items=container.children();var bc={top:0,left:0,height:0};this._align(cthis,items,container,config,bc)},_align:function(cthis,items,container,config,bc){for(var i=0,len=items.length;i<len;i++){var top=0;if(i==0){top=bc.top=0}else{top=bc.top=bc.height+bc.top}bc.height=items.eq(i).outerHeight(true);items.eq(i).css({position:"absolute",top:top,left:0})}if(cthis.options.height===-1){container.height(bc.height+bc.top)}}})})(jQuery);(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","layout/jazz.ContainerLayout"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.rowlayout",$.jazz.containerlayout,{layout:function(cthis,container,layoutconfig){container.css("overflow","hidden");var containerHeight=container.height();var $this=this;this.layoutconfig=layoutconfig;this.cthis=cthis;this.border=(layoutconfig.border==true||layoutconfig.border=="true")||this.border||false;this.draggable=(layoutconfig.draggable==true||layoutconfig.draggable=="true")||this.draggable||false;this.rowheights=layoutconfig.rowheight||layoutconfig.height||this.rowheights;var isborderlayout=layoutconfig.isborderlayout||false;var north_show_border=(layoutconfig.north_show_border==false||layoutconfig.north_show_border=="false")?false:true;var south_show_border=(layoutconfig.south_show_border==false||layoutconfig.south_show_border=="false")?false:true;var north_show_switch=(layoutconfig.north_show_switch==false||layoutconfig.north_show_switch=="false")?false:true;var south_show_switch=(layoutconfig.south_show_switch==false||layoutconfig.south_show_switch=="false")?false:true;var north_drag=(layoutconfig.north_drag==false||layoutconfig.north_drag=="false")?false:true;var south_drag=(layoutconfig.south_drag==false||layoutconfig.south_drag=="false")?false:true;var north_drag_min=layoutconfig.north_drag_min?parseInt(layoutconfig.north_drag_min):0;var north_drag_max=layoutconfig.north_drag_max?parseInt(layoutconfig.north_drag_max):0;var south_drag_min=layoutconfig.south_drag_min?parseInt(layoutconfig.south_drag_min):0;var south_drag_max=layoutconfig.south_drag_max?parseInt(layoutconfig.south_drag_max):0;this.north_open=(layoutconfig.north_open==false||layoutconfig.north_open=="false")?false:true;this.south_open=(layoutconfig.south_open==false||layoutconfig.south_open=="false")?false:true;if(isborderlayout==true){this.isrowlayout=false;this.border=true;this.bobject=layoutconfig.bobject;this.isnorth=layoutconfig.regionnumber.north==1?true:false;this.issouth=layoutconfig.regionnumber.south==1?true:false}else{this.isrowlayout=true}var rows=this.rowheights.length||0;if(rows==0){jazz.error("行布局的rowheight设置错误, 例： ['200', '30%', '*']")}this.borderHeight=0;this.fixRowHeight=0;this.noFixRow=[];this.topval=0;this.bottomval=0;if(this.border==true&&rows>1){this.bordernumber=0;if(!this.borderObj){this.borderObj=[]}$.each(this.borderObj,function(i,obj){$(obj).remove()});this.borderObj=[]}this.layoutdiv=container.children().filter(":visible");for(var i=0;i<rows;i++){var tempObject=$(this.layoutdiv[i]);tempObject.addClass("jazz-row-element");if(this.border==true&&rows>1&&(i+1)!=rows){if((isborderlayout==true&&((north_show_border&&this.isnorth&&i==0)||(south_show_border&&this.issouth&&(i+2)==rows)))||this.isrowlayout){var div='<div index="'+i+'" class="jazz-row-border"></div>';var $b=$(div);if(isborderlayout==true&&(north_show_switch&&this.isnorth&&i==0)){this.switchTop=$('<div class="jazz-row-btn jazz-row-btn-t"></div>').appendTo($b)}else{if(isborderlayout==true&&(south_show_switch&&this.issouth&&(i+2)==rows)){this.switchBottom=$('<div class="jazz-row-btn jazz-row-btn-b"></div>').appendTo($b)}}tempObject.after($b);this.borderObj.push($b);this.bordernumber+=1;if((isborderlayout==true&&((north_drag==true&&this.isnorth&&i==0)||(south_drag==true&&this.issouth&&(i+2)==rows)))||(this.isrowlayout&this.draggable)){$b.addClass("jazz-row-border-cursor")}this.borderHeight=$b.outerHeight()||0;if(isborderlayout==true&&((north_show_switch&&this.isnorth&&i==0)||(south_show_switch&&this.issouth&&(i+2)==rows))){$b.children(".jazz-row-btn").off("click.rt").on("click.rt",function(){var p=$(this).parent();var $pre=p.prev(),$next=p.next();var index=p.attr("index");$this._switch(cthis,$pre,$next,index,rows,true);cthis._reflashChildHeight()})}}}var _rh=this.rowheights[i]+"";if(_rh!="*"&&_rh.indexOf("%")==-1){tempObject.outerHeight(_rh);this.fixRowHeight=this.fixRowHeight+tempObject.outerHeight(true)}else{this.noFixRow.push(tempObject)}}var $this=this;container.off("mousedown.row").on("mousedown.row",function(event){var target=event.target,$target=$(target);$this.topborder=[],$this.areaheight=[],$this.areaobject=[];if($target.is(".jazz-row-border")){var index=parseInt($target.attr("index"));if((isborderlayout==true&&((north_drag&&index==0&&$this.isnorth)||(south_drag&&(index+2)==rows&&$this.issouth)))||($this.draggable&&$this.isrowlayout)){$this.row_y=$target.offset().top;$this.dragrow=$('<div class="jazz-row-drag" style="display:none" islayout="no"></div>').appendTo(document.body);$this.dragrow.css({display:"block",top:$this.row_y,left:$target.offset().left,width:$target.width()-2});if(!$.browser.mozilla){$(document).on("selectstart",function(){return false})}else{$("body").css("-moz-user-select","none")}$.each(container.children(".jazz-row-element"),function(i,obj){$this.topborder.push($(obj).offset().top);$this.areaheight.push($(obj).height());$this.areaobject.push($(obj))});var tdragwidth=$this.areaheight[index];var bdragwidth=$this.areaheight[index+1];if(isborderlayout==true){if(index==0&&$this.isnorth){if(!$this.north_open){tdragwidth=0}cthis._event("northdragstart",null,{north:{height:tdragwidth},center:{height:bdragwidth}})}else{if(!$this.south_open){bdragwidth=0}cthis._event("southdragstart",null,{center:{height:tdragwidth},south:{height:bdragwidth}})}}else{cthis._event("rowdragstart",null,{index:index,top:tdragwidth,bottom:bdragwidth})}$(document).off("mousemove.row mouseup.row").on("mousemove.row",function(e){if($this.dragrow){var topborder=$this.topborder[index];var bottomborder=$this.topborder[index+1]+$this.areaheight[index+1]-$this.dragrow.outerHeight();if($this.issouth&&!$this.south_open&&(index+2)==rows){bottomborder=$target.offset().top}var eY=e.pageY;if(isborderlayout==true&&(topborder<eY&&eY<bottomborder)){if(index==0&&$this.isnorth){if((north_drag_min<eY&&eY<north_drag_max)||(north_drag_min===0&&north_drag_max===0)){$this.moving=eY;$this.dragrow.css({top:$this.moving})}}else{if(((containerHeight-south_drag_max)<eY&&eY<(containerHeight-south_drag_min))||(south_drag_max===0&&south_drag_min===0)){$this.moving=eY;$this.dragrow.css({top:$this.moving})}}}else{if(topborder<eY&&eY<bottomborder){$this.moving=eY;$this.dragrow.css({top:$this.moving})}}}}).on("mouseup.row",function(e){var _bh=$this.areaheight[index+1];var _th=$this.areaheight[index];if($this.moving){var _y=$this.dragrow.offset().top-$this.row_y;var b=$this.areaobject[index+1];var t=$this.areaobject[index];if(isborderlayout==true){if(index==0&&$this.isnorth){if(!$this.north_open){_th=0;if(_y>0){$this.north_open=true}}_bh=_bh-_y;_th=_th+_y;b.outerHeight(_bh);t.show().outerHeight(_th)}else{if($this.issouth){if(!$this.south_open){_bh=0;if(_y<0){$this.south_open=true}}_bh=_bh-_y;_th=_th+_y;t.outerHeight(_th);b.show().outerHeight(_bh)}}}else{_bh=_bh-_y;_th=_th+_y;b.outerHeight(_bh);t.outerHeight(_th)}if(isborderlayout==true){if(index==0&&$this.isnorth){cthis._event("northdragstop",null,{north:{height:_th},center:{height:_bh}})}else{cthis._event("southdragstop",null,{center:{height:_th},south:{height:_bh}})}}else{cthis._event("rowdragstop",null,{index:index,top:_th,bottom:_bh})}cthis._reflashChildHeight()}else{if(tdragwidth!=_th&&bdragwidth!=_bh){if(isborderlayout==true){if(index==0&&$this.isnorth){cthis._event("northdragstop",null,{north:{height:_th},center:{height:_bh}})}else{cthis._event("southdragstop",null,{center:{height:_th},south:{height:_bh}})}}else{cthis._event("rowdragstop",null,{index:index,top:_th,bottom:_bh})}}}$this.dragrow.remove();$this.moving="";if(!$.browser.mozilla){$(document).off("selectstart")}else{$("body").css("-moz-user-select","auto")}$(document).off("mousemove.row mouseup.row")})}}});this._calculateHeight(containerHeight,this.layoutdiv,rows);if(isborderlayout==true){if(this.north_open==false&&this.isnorth){this.north_open=true;this._switch(cthis,this.bobject.north.object,layoutconfig.centerobject,0,rows)}if(this.south_open==false&&this.issouth){this.south_open=true;this._switch(cthis,layoutconfig.centerobject,this.bobject.south.object,1,rows)}}},_switch:function(cthis,$pre,$next,index,rows,e,num){if((index==0&&this.isnorth)||(this.isrowlayout&&index==0)){var pre=$pre,center=$next,theight=0,cheight=0;var topheight=pre.height(),centerheight=center.height();if(!num){num=0}if(this.north_open){cheight=topheight+centerheight-num;theight=num;if(num==0){pre.hide()}else{pre.height(num)}center.height(cheight);this.topval=topheight;this.north_open=false;this.switchTop.removeClass("jazz-row-btn-t").addClass("jazz-row-btn-b")}else{var tval=centerheight-(this.topval-num);if(tval<0){theight=centerheight;center.height(cheight);pre.height(theight);if(num==0){pre.show()}else{pre.height(theight)}}else{theight=this.topval;cheight=centerheight-(this.topval-num);center.height(cheight);if(num==0){pre.show()}else{pre.height(theight)}}this.north_open=true;this.switchTop.removeClass("jazz-row-btn-b").addClass("jazz-row-btn-t")}if(e){cthis._event("northswitch",null,{north:{height:theight},center:{height:cheight}})}}else{if(((parseInt(index)+2)==rows&&this.issouth)||(this.isrowlayout&&(parseInt(index)+2)==rows)){var center=$pre,next=$next,bheight=0,cheight=0;var centerheight=center.height(),bottomheight=next.height();if(!num){num=0}if(this.south_open){cheight=centerheight+bottomheight-num;bheight=num;if(num==0){next.hide()}else{next.height(num)}center.height(cheight);this.bottomval=bottomheight;this.south_open=false;this.switchBottom.removeClass("jazz-row-btn-b").addClass("jazz-row-btn-t")}else{var tval=centerheight-(this.bottomval-num);if(tval<0){bheight=centerheight;center.height(cheight);next.height(bheight);if(num==0){next.show()}else{next.height(bheight)}}else{bheight=this.bottomval;cheight=centerheight-(this.bottomval-num);center.height(cheight);if(num==0){next.show()}else{next.height(bheight)}}this.south_open=true;this.switchBottom.removeClass("jazz-row-btn-t").addClass("jazz-row-btn-b")}if(e){cthis._event("southswitch",null,{south:{height:bheight},center:{height:cheight}})}}}},_calculateHeight:function(containerHeight,element,rows){var otherHeight=0;if(this.border==true&&rows>1){containerHeight=containerHeight-this.borderHeight*this.bordernumber;otherHeight=containerHeight-this.fixRowHeight}otherHeight=containerHeight-this.fixRowHeight;this.percentHeight=0;for(var i=0;i<rows;i++){var rowheight=this.rowheights[i];var tempObject=$(element[i]);if(!!rowheight&&rowheight.indexOf("%")!=-1){var n=parseInt(rowheight.substring(0,rowheight.indexOf("%")));rowheight=(n/100)*otherHeight;rowheight=Math.floor(rowheight);tempObject.outerHeight(rowheight);this.percentHeight+=tempObject.outerHeight()}if($.trim(rowheight)=="*"){this.emptyRow=tempObject}}this.autoHeight=containerHeight-this.fixRowHeight-this.percentHeight;if(this.emptyRow){this.emptyRow.outerHeight(this.autoHeight)}this.cacheHeight=containerHeight},layoutSwitch:function(region,regionNumber,showHeight){var isborderlayout=this.layoutconfig.isborderlayout||false;if(isborderlayout==true){if(region=="north"){this._switch(this.cthis,this.bobject.north.object,this.layoutconfig.centerobject,0,regionNumber,true,showHeight);this.cthis._reflashChildHeight()}if(region=="south"){this._switch(this.cthis,this.layoutconfig.centerobject,this.bobject.south.object,1,regionNumber,true,showHeight);this.cthis._reflashChildHeight()}}},reflashLayoutBefore:function(){var cols=this.rowheights.length||0;this._overflow_xy=[];for(var i=0,len=cols;i<len;i++){var obj=$(this.layoutdiv[i]);this._overflow_xy.push({x:obj.css("overflow-x"),y:obj.css("overflow-y")});obj.css("overflow-x","hidden");obj.css("overflow-y","hidden")}},reflashLayoutAfter:function(){if(this._overflow_xy.length>1){var cols=this.rowheights.length||0;for(var i=0,len=cols;i<len;i++){var obj=$(this.layoutdiv[i]);obj.css("overflow-x",this._overflow_xy[i]["x"]);obj.css("overflow-y",this._overflow_xy[i]["y"])}this._overflow_xy=[]}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","layout/jazz.ContainerLayout"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.columnlayout",$.jazz.containerlayout,{layout:function(cthis,container,layoutconfig){container.css("overflow","hidden");var containerWidth=container.width();var $this=this;this.layoutconfig=layoutconfig;this.cthis=cthis;this.border=(layoutconfig.border==true||layoutconfig.border=="true")||this.border||false;this.draggable=(layoutconfig.draggable==true||layoutconfig.draggable=="true")||this.draggable||false;this.colwidths=layoutconfig.columnwidth||layoutconfig.width||this.colwidths;var isborderlayout=layoutconfig.isborderlayout||false;var west_show_border=(layoutconfig.west_show_border==false||layoutconfig.west_show_border=="false")?false:true;var east_show_border=(layoutconfig.east_show_border==false||layoutconfig.east_show_border=="false")?false:true;var west_show_switch=(layoutconfig.west_show_switch==false||layoutconfig.west_show_switch=="false")?false:true;var east_show_switch=(layoutconfig.east_show_switch==false||layoutconfig.east_show_switch=="false")?false:true;var west_drag=(layoutconfig.west_drag==false||layoutconfig.west_drag=="false")?false:true;var east_drag=(layoutconfig.east_drag==false||layoutconfig.east_drag=="false")?false:true;var west_drag_min=layoutconfig.west_drag_min?parseInt(layoutconfig.west_drag_min):0;var west_drag_max=layoutconfig.west_drag_max?parseInt(layoutconfig.west_drag_max):0;var east_drag_min=layoutconfig.east_drag_min?parseInt(layoutconfig.east_drag_min):0;var east_drag_max=layoutconfig.east_drag_max?parseInt(layoutconfig.east_drag_max):0;this.west_open=(layoutconfig.west_open==false||layoutconfig.west_open=="false")?false:true;this.east_open=(layoutconfig.east_open==false||layoutconfig.east_open=="false")?false:true;if(isborderlayout==true){this.iscolumnlayout=false;this.border=true;this.bobject=layoutconfig.bobject;this.iswest=layoutconfig.regionnumber.west==1?true:false;this.iseast=layoutconfig.regionnumber.east==1?true:false}else{this.iscolumnlayout=true}var cols=this.colwidths.length||0;if(cols==0){jazz.error("行布局的rowheight设置错误, 例： ['200', '30%', '*']")}this.borderWidth=0;this.fixColumnWidth=0;this.noFixColumn=[];this.leftval=0;this.rightval=0;if(this.border==true&&cols>1){this.bordernumber=0;if(!this.borderObj){this.borderObj=[]}$.each(this.borderObj,function(i,obj){$(obj).remove()});this.borderObj=[]}this.layoutdiv=container.children().filter(":visible");for(var i=0;i<cols;i++){var tempObject=$(this.layoutdiv[i]);tempObject.addClass("jazz-column-element");if(this.border==true&&cols>1&&(i+1)!=cols){if((isborderlayout==true&&((west_show_border&&this.iswest&&i==0)||(east_show_border==true&&this.iseast&&(i+2)==cols)))||this.iscolumnlayout){var div='<div index="'+i+'" class="jazz-column-border"></div>';var $b=$(div);if(isborderlayout==true&&(west_show_switch&&this.iswest&&i==0)){this.switchLeft=$('<div class="jazz-column-btn jazz-column-btn-l"></div>').appendTo($b)}else{if(isborderlayout==true&&(east_show_switch&&this.iseast&&(i+2)==cols)){this.switchRight=$('<div class="jazz-column-btn jazz-column-btn-r"></div>').appendTo($b)}}tempObject.after($b);this.borderObj.push($b);this.bordernumber+=1;if((isborderlayout==true&&((west_drag&&this.iswest&&i==0)||(east_drag&&this.iseast&&(i+2)==cols)))||(this.iscolumnlayout&&this.draggable)){$b.addClass("jazz-column-border-cursor")}this.borderWidth=$b.outerWidth()||0;if(isborderlayout==true&&((west_show_switch&&this.iswest&&i==0)||(east_show_switch&&this.iseast&&(i+2)==cols))){$b.children(".jazz-column-btn").off("click.ct").on("click.ct",function(){var p=$(this).parent();var $pre=p.prev(),$next=p.next();var index=p.attr("index");$this._switch(cthis,$pre,$next,index,cols,true);cthis._reflashChildWidth()})}}}var _cw=this.colwidths[i]+"";if(_cw!="*"&&_cw.indexOf("%")==-1){tempObject.outerWidth(_cw);this.fixColumnWidth=this.fixColumnWidth+tempObject.outerWidth()}else{this.noFixColumn.push(tempObject)}}container.off("mousedown.column").on("mousedown.column",function(event){var target=event.target,$target=$(target);$this.leftborder=[],$this.areawidth=[],$this.areaobject=[];if($target.is(".jazz-column-border")){var index=parseInt($target.attr("index"));if((isborderlayout==true&&((west_drag&&index==0&&$this.iswest)||(east_drag&&(index+2)==cols&&$this.iseast)))||($this.draggable==true&&$this.iscolumnlayout)){$this.clo_x=$target.offset().left;$this.dragcol=$('<div class="jazz-column-drag" style="display:none" islayout="no"></div>').appendTo(document.body);$this.dragcol.css({display:"block",top:$target.offset().top,left:$this.clo_x,height:$target.height()-2});if(!$.browser.mozilla){$(document).on("selectstart",function(){return false})}else{$("body").css("-moz-user-select","none")}$.each(container.children(".jazz-column-element"),function(i,obj){$this.leftborder.push($(obj).offset().left);$this.areawidth.push($(obj).width());$this.areaobject.push($(obj))});var ldragwidth=$this.areawidth[index];var rdragwidth=$this.areawidth[index+1];if(isborderlayout==true){if(index==0&&$this.iswest){if(!$this.west_open){ldragwidth=0}cthis._event("westdragstart",null,{west:{width:ldragwidth},center:{width:rdragwidth}})}else{if(!$this.east_open){rdragwidth=0}cthis._event("eastdragstart",null,{center:{width:ldragwidth},east:{width:rdragwidth}})}}else{cthis._event("columndragstart",null,{index:index,left:ldragwidth,right:rdragwidth})}$(document).off("mousemove.column mouseup.column").on("mousemove.column",function(e){if($this.dragcol){var leftborder=$this.leftborder[index];var rightborder=$this.leftborder[index+1]+$this.areawidth[index+1]-$this.dragcol.outerWidth();if($this.iseast&&!$this.east_open&&(index+2)==cols){rightborder=$target.offset().left}var eX=e.pageX;if(isborderlayout==true&&(leftborder<eX&&eX<rightborder)){if(index==0&&$this.iswest){if((west_drag_min<eX&&eX<west_drag_max)||(west_drag_min===0&&west_drag_max===0)){$this.moving=eX;$this.dragcol.css({left:$this.moving})}}else{if(((containerWidth-east_drag_max)<eX&&eX<(containerWidth-east_drag_min))||(east_drag_max===0&&east_drag_min===0)){$this.moving=eX;$this.dragcol.css({left:$this.moving})}}}else{if(leftborder<eX&&eX<rightborder){$this.moving=eX;$this.dragcol.css({left:$this.moving})}}}}).on("mouseup.column",function(e){var _rw=$this.areawidth[index+1];var _lw=$this.areawidth[index];if($this.moving){var _x=$this.dragcol.offset().left-$this.clo_x;var r=$this.areaobject[index+1];var l=$this.areaobject[index];if(isborderlayout==true){if(index==0&&$this.iswest){if(!$this.west_open){_lw=0;if(_x>0){$this.west_open=true}}_rw=_rw-_x;_lw=_lw+_x;r.outerWidth(_rw);l.show().outerWidth(_lw)}else{if($this.iseast){if(!$this.east_open){_rw=0;if(_x<0){$this.east_open=true}}_rw=_rw-_x;_lw=_lw+_x;l.outerWidth(_lw);r.show().outerWidth(_rw)}}}else{_rw=_rw-_x;_lw=_lw+_x;r.outerWidth(_rw);l.outerWidth(_lw)}if(isborderlayout==true){if(index==0&&$this.iswest){cthis._event("westdragstop",null,{west:{width:_lw},center:{width:_rw}})}else{cthis._event("eastdragstop",null,{center:{width:_lw},east:{width:_rw}})}}else{cthis._event("columndragstop",null,{index:index,left:_lw,right:_rw})}cthis._reflashChildWidth()}else{if(ldragwidth!=_lw&&rdragwidth!=_rw){if(isborderlayout==true){if(index==0&&$this.iswest){cthis._event("westdragstop",null,{west:{width:_lw},center:{width:_rw}})}else{cthis._event("eastdragstop",null,{center:{width:_lw},east:{width:_rw}})}}else{cthis._event("columndragstop",null,{index:index,left:_lw,right:_rw})}}}$this.dragcol.remove();$this.moving="";if(!$.browser.mozilla){$(document).off("selectstart")}else{$("body").css("-moz-user-select","auto")}$(document).off("mousemove.column mouseup.column")})}}});this._calculateWidth(containerWidth,this.layoutdiv,cols);if(isborderlayout==true){if(this.west_open==false&&this.iswest){this.west_open=true;this._switch(cthis,this.bobject.west.object,this.bobject.center.object,0,cols,false)}if(this.east_open==false&&this.iseast){this.east_open=true;this._switch(cthis,this.bobject.center.object,this.bobject.east.object,1,cols,false)}}},_switch:function(cthis,$pre,$next,index,cols,e,num){if((index==0&&this.iswest)||(this.iscolumnlayout&&index==0)){var pre=$pre,center=$next,lwidth=0,cwidth=0;var leftwidth=pre.width(),centerwidth=center.width();if(!num){num=0}if(this.west_open){cwidth=leftwidth+centerwidth-num;lwidth=num;if(num==0){pre.hide()}else{pre.width(num)}center.width(cwidth);this.leftval=leftwidth;this.west_open=false;this.switchLeft.removeClass("jazz-column-btn-l").addClass("jazz-column-btn-r")}else{var tval=centerwidth-(this.leftval-num);if(tval<0){lwidth=centerwidth;center.width(cwidth);pre.width(lwidth);if(num==0){pre.show()}else{pre.width(lwidth)}}else{lwidth=this.leftval;cwidth=centerwidth-(this.leftval-num);center.width(cwidth);if(num==0){pre.show()}else{pre.width(lwidth)}}this.west_open=true;this.switchLeft.removeClass("jazz-column-btn-r").addClass("jazz-column-btn-l")}if(e){cthis._event("westswitch",null,{west:{width:lwidth},center:{width:cwidth}})}}else{if(((parseInt(index)+2)==cols&&this.iseast)||(this.iscolumnlayout&&index==(parseInt(index)+2)==cols)){var center=$pre,next=$next,rwidth=0,cwidth=0;var centerwidth=center.width(),rightwidth=next.width();if(!num){num=0}if(this.east_open){cwidth=centerwidth+rightwidth-num;rwidth=num;if(num==0){next.hide()}else{next.width(num)}center.width(cwidth);this.rightval=rightwidth;this.east_open=false;this.switchRight.removeClass("jazz-column-btn-r").addClass("jazz-column-btn-l")}else{var tval=centerwidth-(this.rightval-num);if(tval<0){rwidth=centerwidth;center.width(cwidth);next.width(rwidth);if(num==0){next.show()}else{next.width(rwidth)}}else{rwidth=this.rightval;cwidth=centerwidth-(this.rightval-num);center.width(cwidth);if(num==0){next.show()}else{next.width(rwidth)}}this.east_open=true;this.switchRight.removeClass("jazz-column-btn-l").addClass("jazz-column-btn-r")}if(e){cthis._event("eastswitch",null,{east:{width:rwidth},center:{width:cwidth}})}}}},_calculateWidth:function(containerWidth,element,cols){var otherWidth=0;if(this.border==true&&cols>1){containerWidth=containerWidth-this.borderWidth*this.bordernumber;otherWidth=containerWidth-this.fixColumnWidth}otherWidth=containerWidth-this.fixColumnWidth;this.percentWidth=0;for(var i=0;i<cols;i++){var colwidth=this.colwidths[i];var tempObject=$(element[i]);if(!!colwidth&&colwidth.indexOf("%")!=-1){var n=parseInt(colwidth.substring(0,colwidth.indexOf("%")));colwidth=(n/100)*otherWidth;colwidth=Math.floor(colwidth);tempObject.outerWidth(colwidth);this.percentWidth+=tempObject.outerWidth()}if($.trim(colwidth)=="*"){this.emptyColumn=tempObject}}this.autoWidth=containerWidth-this.fixColumnWidth-this.percentWidth;if(this.emptyColumn){this.emptyColumn.outerWidth(this.autoWidth)}this.cacheWidth=containerWidth},layoutSwitch:function(region,regionNumber,showWidth){var isborderlayout=this.layoutconfig.isborderlayout||false;if(isborderlayout==true){if(region=="west"){this._switch(this.cthis,this.bobject.west.object,this.bobject.center.object,0,regionNumber,true,showWidth);this.cthis._reflashChildWidth()}if(region=="east"){this._switch(this.cthis,this.bobject.center.object,this.bobject.east.object,1,regionNumber,true,showWidth);this.cthis._reflashChildWidth()}}},reflashLayoutBefore:function(){var cols=this.colwidths.length||0;this._overflow_xy=[];for(var i=0,len=cols;i<len;i++){var obj=$(this.layoutdiv[i]);this._overflow_xy.push({x:obj.css("overflow-x"),y:obj.css("overflow-y")});obj.css("overflow-x","hidden");obj.css("overflow-y","hidden")}},reflashLayoutAfter:function(){if(this._overflow_xy.length>1){var cols=this.colwidths.length||0;for(var i=0,len=cols;i<len;i++){var obj=$(this.layoutdiv[i]);obj.css("overflow-x",this._overflow_xy[i]["x"]);obj.css("overflow-y",this._overflow_xy[i]["y"])}this._overflow_xy=[]}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","layout/jazz.ContainerLayout"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.tablelayout",$.jazz.containerlayout,{layout:function(cthis,container,config){container.addClass("jazz-layout");var flag=false;var columnwidth=config.columnwidth||config.width;if(!this.oldcols){this.oldcols=columnwidth.length;this.newcols=1;this.olditems=container.children()}else{this.newcols=columnwidth.length||1;flag=true}this._align(this.olditems,container,config);this.oldcols=this.newcols;if(flag){cthis._reflashChildWidth()}},_align:function(items,container,config){if(items&&items.length>0){var columnwidth=config.columnwidth||config.width;var cols=columnwidth.length;if(columnwidth.length==0){jazz.info("【table 布局】width未设置布局列宽，请确定重设。");return false}if(!this.validateColumnWidthFormat(columnwidth,tableWidth)){jazz.info("【table 布局】width设置数值格式不正确。");return false}var tableWidth=$(container).outerWidth(true)-$(container).scrollLeft();var item;this.tempCachePool=$('<div style="display:none"></div>');this.tempCachePool.appendTo(this.element);for(var i=0,i_len=items.length;i<i_len;i++){item=$(items[i]);this.tempCachePool.append(item)}if(!!this.table){this.table.children().remove()}else{this.table=$("<table cellspacing='0' cellpadding='0' style='border-collapse: collapse; table-layout: fixed; width: 100%;'></table>");this.table.appendTo(container)}if($(items[0]).attr("vtype")=="toolbar"){this.table.before($(items[0]))}else{if($(items[i_len-1]).attr("vtype")=="toolbar"){this.table.after($(items[i_len-1]))}}var colgroup="<colgroup>";for(var i=0;i<cols;i++){colgroup+="<col />"}colgroup+="</colgroup>";colgroup=$(colgroup).appendTo(this.table);this._calculateTableWidth($(this.table),columnwidth);var $this=this;$this.options.cacheContainerWidth=tableWidth;this.tbody=$("<tbody></tbody>").appendTo(this.table);var tr=null;if(!!config.rowheight){tr=$("<tr style='height:"+config.rowheight+"'></tr>")}else{tr=$("<tr></tr>")}var td=$("<td style='vertical-align: top;'></td>");if(config.border){td.addClass("jazz-table-innerborder")}for(var i=0;i<cols;i++){var newtd=td.clone();newtd.appendTo(tr)}tr.clone().appendTo(this.tbody);var rowIndex=0,colIndex=0;for(var i=0;i<items.length;i++){var item=items[i];var vtype=$(item).attr("vtype");if(vtype=="hiddenfield"||vtype=="toolbar"){this.table.after($(items[i]));continue}var rowspanNum=parseInt($(item).attr("rowspan"))||1;var colspanNum=parseInt($(item).attr("colspan"))||1;if(colspanNum>cols){jazz.info("【跨列布局错误】当前容器中第"+(i+1)+"个元素colspan='"+colspanNum+"' 大于布局列数 cols='"+cols+"'。 ");break}else{var nextIndex=this._combinedTdCell(item,tr,cols,rowIndex,colIndex,rowspanNum,colspanNum);rowIndex=nextIndex.rowIndex;colIndex=nextIndex.colIndex}}this.tempCachePool.remove();this.tempCachePool=null}},_calculateTableWidth:function(table,columnWidth){var width_table=$(table).width();var re=/^[0-9]+.?[0-9]*$/;var fixedColumnWidth=0;var exceptFixedColumnWidth=0;var percentColumnWidth=0;var hasPercentWidth=false;var autoWidthNums=0;var tempColumnWidth=[];for(var i=0,m=columnWidth.length;i<m;i++){var temp=columnWidth[i];if(temp.indexOf("px")!=-1||re.test(temp)){fixedColumnWidth+=parseFloat(columnWidth[i])}if(!hasPercentWidth&&temp.indexOf("%")!=-1){hasPercentWidth=true}if($.trim(temp)=="*"){autoWidthNums++}tempColumnWidth[i]=temp}exceptFixedColumnWidth=width_table-fixedColumnWidth;if(hasPercentWidth){for(var i=0,m=tempColumnWidth.length;i<m;i++){var temp=tempColumnWidth[i];if(temp.indexOf("%")!=-1){var a=temp.substring(0,temp.indexOf("%"));var b=Math.round((a/100)*exceptFixedColumnWidth);tempColumnWidth[i]=b+"px";percentColumnWidth+=b}}}if(autoWidthNums>0){var leftColumnWidth=exceptFixedColumnWidth-percentColumnWidth;for(var i=0,m=tempColumnWidth.length;i<m;i++){if($.trim(tempColumnWidth[i])=="*"){tempColumnWidth[i]=Math.round(leftColumnWidth/autoWidthNums)+"px"}}}for(var i=0;i<tempColumnWidth.length;i++){$(table).find("colgroup").children().eq(i).attr("width",tempColumnWidth[i])}},validateColumnWidthFormat:function(colsWidth,tableWidth){var re=/^[0-9]+.?[0-9]*[(px)%]?$/;var totalWidth=0;var flag=true;for(var i=0;i<colsWidth.length;i++){var temp=colsWidth[i];if(re.test(temp)||$.trim(temp)=="*"){}else{flag=false;break}}return flag},_combinedTdCell:function(item,tr,cols,rowIndex,colIndex,rowspanNum,colspanNum){var flag=true;while(flag){if(colIndex+colspanNum>cols){colIndex=0;rowIndex++}var trs=this.tbody.children("tr").length;if(rowIndex+1>trs){$(tr).clone().appendTo(this.tbody);colIndex=0;flag=false}else{this.tbody.children("tr:eq("+rowIndex+")").children("td").each(function(i){if(i>=colIndex&&i<cols){if($(this).css("display")!="none"){colIndex=i;return false}}});if(colIndex+colspanNum>cols){}else{var isContinus=true;this.tbody.children("tr:eq("+rowIndex+")").children("td").each(function(i){if(i>=colIndex&&i<colIndex+colspanNum){if($(this).css("display")=="none"){isContinus=false}}});if(isContinus){flag=false}else{colIndex++}}}}var targetTD=this.tbody.children("tr:eq("+rowIndex+")").children("td:eq("+colIndex+")");$(item).appendTo(targetTD);if(rowspanNum>1||colspanNum>1){var trCounts=this.tbody.children("tr").length;if(rowspanNum+rowIndex>trCounts){for(var r=1;r<=rowspanNum+rowIndex-trCounts;r++){var newtr=tr.clone();newtr.appendTo(this.tbody)}}this.tbody.children("tr").each(function(n){if(n>=rowIndex&&n<rowIndex+rowspanNum){$(this).children("td").each(function(m){if(m>=colIndex&&m<colIndex+colspanNum){if(n==rowIndex&&m==colIndex){$(this).attr({rowspan:rowspanNum,colspan:colspanNum})}else{$(this).remove()}}})}})}if(colIndex+colspanNum<cols){colIndex+=colspanNum}else{colIndex=0;rowIndex++}var next=true;var nextTdIndex=null;while(next){var trsum=this.tbody.children("tr").length;if(rowIndex+1>trsum){colIndex=0;next=false}else{this.tbody.children("tr:eq("+rowIndex+")").children("td").each(function(i){if(i>=colIndex&&i<cols){if($(this).css("display")!="none"){colIndex=i;next=false;return false}}})}if(next){colIndex=0;rowIndex++}else{nextTdIndex={rowIndex:rowIndex,colIndex:colIndex}}}return nextTdIndex},hiddenRowByRowIndex:function(rowIndex){var that=this},showRowByRowIndex:function(rowIndex){var that=this;$(that.element[0]).find("table tr:eq("+(rowIndex-1)+")").css("display","")}})});(function($){$.widget("jazz.cardlayout",$.jazz.containerlayout,{layout:function(cthis,container,config){var buttondisplay=this.options.cardlayoutObject.buttondisplay=config.buttondisplay;var cardlayoutObject=this.options.cardlayoutObject;cardlayoutObject.container=container;cardlayoutObject.$this=this;var obj=container.children();if(!obj[0]){jazz.error("card layout is error!");return false}var w=obj[0].width||$(obj[0]).outerWidth(true);var num=obj.size();var ulWidth=num*w;cardlayoutObject.width=w;cthis.element.addClass("jazz-cardpanel");var box=$('<div class="jazz-cardpanel-box"></div>').appendTo(container);var content=$('<div class="jazz-cardpanel-content"></div>').appendTo(box);var ul=$('<div class="jazz-cardpanel-ul" style="width:'+ulWidth+'px"></div>').appendTo(content);$.each(obj,function(i,el){var li=$('<div class="jazz-cardpanel-li" style="width:'+cardlayoutObject.width+'px" >').appendTo(ul);li.append(el)});var h=ul.height();if(buttondisplay===true){this.paginator=$("<div></div>").appendTo(box);this.paginator.paginator({template:"{PageLinks}",rows:1,totalRecords:obj.size(),click:function(e,ui){cardlayoutObject.point(ui.page,num)}});this.paginator.removeClass("jazz-widget-header");cardlayoutObject.paginator=this.paginator}$.each(obj,function(i,el){$(el).height(h-cardlayoutObject.height)});if(buttondisplay===true){this._buildButton(box,num)}box.css({height:h});content.css({width:cardlayoutObject.width,height:h-cardlayoutObject.height})},_buildButton:function(box,num){var $this=this;var cardlayoutObject=this.options.cardlayoutObject;this.leftButton=$('<a href="javascript:void(0);" target="_self"></a>').appendTo(box);this.rightButton=$('<a href="javascript:void(0);" target="_self"></a>').appendTo(box);this.leftButton.on("click",function(){if(cardlayoutObject.activeIndex>0){cardlayoutObject.slide("l",num)}});this.rightButton.on("click",function(){if(cardlayoutObject.activeIndex<num-1){cardlayoutObject.slide("r",num)}});box.hover(function(){if(cardlayoutObject.activeIndex>0){$this.leftButton.addClass("jazz-cardpanel-leftbtn")}if(cardlayoutObject.activeIndex<num-1){$this.rightButton.addClass("jazz-cardpanel-rightbtn")}},function(){$this.leftButton.removeClass("jazz-cardpanel-leftbtn");$this.rightButton.removeClass("jazz-cardpanel-rightbtn")})},previousPage:function(n){return this.options.cardlayoutObject.slide("l",n)},nextPage:function(n){return this.options.cardlayoutObject.slide("r",n)},options:{cardlayoutObject:{height:25,width:400,activeIndex:0,paginator:null,container:null,$this:null,buttondisplay:true,point:function(index,num){this.activeIndex=index;this.switching(index,num)},slide:function(lr,num){var idx=this.index(lr,num);if(idx<0){idx=0}else{if(idx>=num){idx=4}}this.switching(idx,num);return idx},index:function(lr,num){if(lr=="l"){this.activeIndex=this.activeIndex-1;if(this.activeIndex<0){this.activeIndex=0}}else{this.activeIndex=this.activeIndex+1;if(this.activeIndex>=num){this.activeIndex=num-1}}if(this.buttondisplay===true){this.paginator.paginator("option","page",this.activeIndex)}return this.activeIndex},switching:function(index,num){this.container.find(".jazz-cardpanel-ul").animate({marginLeft:(0-this.width*index)},500);if(this.buttondisplay===true){if(this.activeIndex>0){this.$this.leftButton.addClass("jazz-cardpanel-leftbtn")}else{this.$this.leftButton.removeClass("jazz-cardpanel-leftbtn")}if(this.activeIndex<num-1){this.$this.rightButton.addClass("jazz-cardpanel-rightbtn")}else{this.$this.rightButton.removeClass("jazz-cardpanel-rightbtn")}}}}}})})(jQuery);(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","layout/jazz.ContainerLayout"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.fitlayout",$.jazz.containerlayout,{layout:function(cthis,container,layoutconfig){jazz.listener.fitlistener.add(cthis.element,layoutconfig);jazz.listener.fitlistener.start()},reflashLayout:function(componentObject,layoutcontainer,layoutconfig){}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","layout/jazz.RowLayout","layout/jazz.ColumnLayout"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.borderlayout",$.jazz.containerlayout,{layout:function(cthis,container,layoutconfig){container.css("overflow","hidden");this.cwidth=container.width();this.cheight=container.height();var childs=container.find("div[region]");if(childs.length>5){jazz.error("border布局定义错误, 只能定义 east south west north center 五个部分，且只能定义一次！");return false}this.bobject={north:"",west:"",center:"",east:"",south:""};this.regionnumber={north:0,west:0,center:0,east:0,south:0};this.by=[];var yn=0;this.bx=[];var xn=0;var $this=this,f=false;$.each(childs,function(i,obj){var $obj=$(obj);var region=$obj.attr("region");if(region=="center"){f=true}if(region){region=$.trim(region);$this.regionnumber[region]+=1;if($this.regionnumber[region]>1){jazz.error('border布局的region属性设置错误, region="'+region+'", 重复设置！');return false}if(" east west ".indexOf(region)>=0){$this.bobject[region]={index:i,object:$obj,width:$obj.attr("width")};xn+=1}else{if(" north south ".indexOf(region)>=0){$this.bobject[region]={index:i,object:$obj,height:$obj.attr("height")};yn+=1}else{if(" center ".indexOf(region)>=0){$this.bobject[region]={index:i,object:$obj};yn+=1;xn+=1}}}}else{jazz.error('border布局的region属性设置错误, region="east" region="south" region="west" region="north" region="center"');return false}});if(!f){jazz.error('border布局的regsion属性设置错误, 必须要有region="center"');return false}layoutconfig.regionnumber=this.regionnumber;layoutconfig.bobject=this.bobject;var defaultheight="150",defaultwidth="200";var centerObj=this.bobject.center.object;if(yn==1&&xn==1){centerObj.css({border:0,margin:0,padding:0,width:"100%",height:"100%"})}if(xn>1){this.colcontainerObj=$('<div style="overflow: hidden; height: 100%;">');centerObj.before(this.colcontainerObj);var westObj=this.bobject.west.object,eastObj=this.bobject.east.object;if(westObj){this.colcontainerObj.append(westObj);var _width=this.bobject.west.width;if(!_width){_width=defaultwidth}$this.bx.push(_width)}this.colcontainerObj.append(centerObj);this.bx.push("*");if(eastObj){this.colcontainerObj.append(eastObj);var _width=this.bobject.east.width;if(!_width){_width=defaultwidth}$this.bx.push(_width)}}if(yn>1){var northObj=this.bobject.north.object,southObj=this.bobject.south.object;if(northObj){if(this.bobject.north.index!=0){container.prepend(northObj)}var _height=this.bobject.north.height;if(!_height){_height=defaultheight}$this.by.push(_height)}$this.by.push("*");if(southObj){var t=container.children("div:last-child");if(" south ".indexOf(t.attr("region"))<0){container.append(southObj)}var _height=this.bobject.south.height;if(!_height){_height=defaultheight}$this.by.push(_height)}this._rowLayout(cthis,container,layoutconfig)}if(xn>1){this._columnLayout(cthis,container,layoutconfig)}this.$cthis=cthis;this.$container=container;this.$layoutconfig=layoutconfig;this.$xn=xn;this.$yn=yn},_columnLayout:function(cthis,container,layoutconfig,f){var _col=jazz.layout.column;container[_col]();layoutconfig.width=this.bx;layoutconfig.isborderlayout=true;this.obj_c=container.data(_col);this.obj_c.layout(cthis,this.colcontainerObj,layoutconfig)},_rowLayout:function(cthis,container,layoutconfig){var _row=jazz.layout.row;container[_row]();layoutconfig.height=this.by;layoutconfig.isborderlayout=true;layoutconfig.centerobject=this.colcontainerObj;this.obj_r=container.data(_row);this.obj_r.layout(cthis,container,layoutconfig)},resizeBorder:function(){if(this.$yn>1){this._rowLayout(this.$cthis,this.$container,this.$layoutconfig)}if(this.$xn>1){this._columnLayout(this.$cthis,this.$container,this.$layoutconfig,true)}var ui={};if(this.regionnumber.north==1){ui.north={height:this.bobject.north.object.height(),width:this.bobject.north.object.width()}}if(this.regionnumber.south==1){ui.south={height:this.bobject.south.object.height(),width:this.bobject.south.object.width()}}if(this.regionnumber.center==1){ui.center={height:this.bobject.center.object.height(),width:this.bobject.center.object.width()}}if(this.regionnumber.west==1){ui.west={height:this.bobject.west.object.height(),width:this.bobject.west.object.width()}}if(this.regionnumber.east==1){ui.east={height:this.bobject.east.object.height(),width:this.bobject.east.object.width()}}this.$cthis._event("borderresize",null,ui)},reflashLayout:function(componentObject,layoutcontainer,layoutconfig){this.resizeBorder()},layoutSwitch:function(region,showSize){if("east"==region||"west"==region){this.$container.data(jazz.layout.column).layoutSwitch(region,this.$xn,showSize)}else{if("north"==region||"south"==region){this.$container.data(jazz.layout.row).layoutSwitch(region,this.$yn,showSize)}}},reflashLayoutBefore:function(){if(this.$yn>1){this.obj_r.reflashLayoutBefore()}if(this.$xn>1){this.obj_c.reflashLayoutBefore()}},reflashLayoutAfter:function(){if(this.$yn>1){this.obj_r.reflashLayoutAfter()}if(this.$xn>1){this.obj_c.reflashLayoutAfter()}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Component"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.boxComponent",$.jazz.component,{options:{calculateheight:-1,calculatewidth:-1,calculateinnerheight:-1,calculateinnerwidth:-1,height:-1,width:-1,resize:null},_create:function(){this._super()},_init:function(){this._super()},_getCalculatePercentHeight:function(height){var parent=this.element.parent(),parentinnerheight;if(parent[0].nodeName=="BODY"){parentinnerheight=jazz.util.windowHeight()-(parent.outerHeight(true)-parent.height())}else{parentinnerheight=this.element.parent().height()}var n=parseFloat(height.substring(0,(height+"").length-1));n=(n/100)*parentinnerheight;return Math.floor(n)},_getCalculatePercentWidth:function(width){var parent=this.element.parent(),parentinnerwidth;if(parent[0].nodeName=="BODY"){parentinnerwidth=jazz.util.windowWidth()-(parent.outerWidth(true)-parent.width())}else{parentinnerwidth=parent.width()}var n=parseFloat(width.substring(0,(width+"").length-1));n=(n/100)*parentinnerwidth;return Math.floor(n)},_height:function(){var height=this.options.height;if(jazz.isNormalSize(height)&&this.options.calculateheight!=height){if(jazz.isNumber(height)){this.element.outerHeight(height,true);this.options.calculateheight=height;this.options.calculateinnerheight=this.element.height();this.iscalculateheight=true}else{if(/^\d+(\.\d+)?%$/.test(height)){var n=this._getCalculatePercentHeight(height);if(this.options.calculateheight===n){this.iscalculateheight=false}else{this.element.outerHeight(n,true);this.options.calculateheight=n;this.options.calculateinnerheight=this.element.height();this.iscalculateheight=true}}}}else{this.iscalculateheight=false}},_width:function(){var width=this.options.width;if(this.options.width==-1){width="100%"}if(jazz.isNormalSize(width)&&this.options.calculatewidth!=width){if(jazz.isNumber(width)){this.element.outerWidth(width,true);this.options.calculatewidth=width;this.options.calculateinnerwidth=this.element.width();this.iscalculatewidth=true}else{if(/^\d+(\.\d+)?%$/.test(width)){var n=this._getCalculatePercentWidth(width);if(this.options.calculatewidth===n){this.iscalculatewidth=false}else{this.element.outerWidth(n,true);this.options.calculatewidth=n;this.options.calculateinnerwidth=this.element.width();this.iscalculatewidth=true}}}}else{this.iscalculatewidth=false}},_reflashLayout:function(){if(this.layoutobject){this.layoutobject.reflashLayout(this,this.layoutcontainer,this.options.layoutconfig)}},_reflashChildHeight:function(){$.each(this.getChildrenComponent(),function(i,obj){var element=$(this);var vtype=element.attr("vtype");element.data(vtype)._resizeHeight()})},_reflashChildWidth:function(){$.each(this.getChildrenComponent(),function(i,obj){var element=$(this);var vtype=element.attr("vtype");element.data(vtype)._resizeWidth()})},_resizeHeight:function(){var y="";if(this.content){y=this.content.css("overflow-y");this.content.css("overflow-y","hidden")}this._height();if(this.iscalculateheight){if(this.layoutobject){this.layoutobject.reflashLayoutBefore()}this._reflashLayout();this._reflashChildHeight();if(this.layoutobject){this.layoutobject.reflashLayoutAfter()}}if(this.content){this.content.css("overflow-y",y)}},_resizeWidth:function(){var x="";if(this.content){x=this.content.css("overflow-x");this.content.css("overflow-x","hidden")}this._width();if(this.iscalculatewidth){if(this.layoutobject){this.layoutobject.reflashLayoutBefore()}this._reflashLayout();this._reflashChildWidth();if(this.layoutobject){this.layoutobject.reflashLayoutAfter()}}if(this.content){this.content.css("overflow-x",x)}},_setOption:function(key,value){switch(key){case"width":if(jazz.isNormalSize(value)){this.options.width=value;this._width();if(this.iscalculatewidth){this._reflashLayout();this._reflashChildWidth()}}break;case"height":if(jazz.isNormalSize(value)){this.options.height=value;this._height();if(this.iscalculateheight){this._reflashLayout();this._reflashChildHeight()}}break}this._super(key,value)},layoutSwitch:function(region,showSize){if(this.layoutobject){this.layoutobject.layoutSwitch(region,showSize)}},getPageSize:function(){var xScroll,yScroll;if(window.innerHeight&&window.scrollMaxY){xScroll=window.innerWidth+window.scrollMaxX;yScroll=window.innerHeight+window.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){xScroll=document.body.scrollWidth;yScroll=document.body.scrollHeight}else{xScroll=document.body.offsetWidth;yScroll=document.body.offsetHeight}}var windowWidth,windowHeight;if(self.innerHeight){if(document.documentElement.clientWidth){windowWidth=document.documentElement.clientWidth}else{windowWidth=self.innerWidth}windowHeight=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){windowWidth=document.documentElement.clientWidth;windowHeight=document.documentElement.clientHeight}else{if(document.body){windowWidth=document.body.clientWidth;windowHeight=document.body.clientHeight}}}if(yScroll<windowHeight){pageHeight=windowHeight}else{pageHeight=yScroll}if(xScroll<windowWidth){pageWidth=xScroll}else{pageWidth=windowWidth}return{pageWidth:pageWidth,pageHeight:pageHeight,windowWidth:windowWidth,windowHeight:windowHeight}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","layout/jazz.AutoLayout","layout/jazz.ColumnLayout","layout/jazz.FitLayout","layout/jazz.RowLayout","layout/jazz.TableLayout","layout/jazz.BorderLayout","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.layout",$.jazz.boxComponent,{options:{vtype:"layout",layout:"auto",layoutconfig:{}},_create:function(){this._super();this.layoutcontainer=this.element},_init:function(){this._super();var layoutvtype=jazz.layout[this.options.layout];var obj=this.layoutcontainer[layoutvtype]();this.layoutobject=obj.data(layoutvtype);this.layoutobject.layout(this,this.layoutcontainer,this.options.layoutconfig)},_resizeHeight:function(){this._height();this._reflashLayout();this._reflashChildHeight()},_resizeWidth:function(){this._width();this._reflashLayout();this._reflashChildWidth()},_setOption:function(key,value){if(key=="layoutconfig"&&typeof value=="object"){this.options.layoutconfig=value;try{this.layoutobject.data(jazz.layout[this.options.layout]).layout(this.cthis,this.layoutcontainer,this.options.layoutconfig)}catch(e){jazz.error("错误的修改布局！！！")}}this._super(key,value)},getLayoutobject:function(){return this.layoutobject},reflashLayout:function(componentObject,layoutcontainer,layoutconfig){if(this.layoutobject){this.layoutobject.reflashLayout(this,this.layoutcontainer,this.options.layoutconfig)}},reflashLayoutBefore:function(){this.layoutobject.reflashLayoutBefore()},reflashLayoutAfter:function(){this.layoutobject.reflashLayoutAfter()}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","layout/jazz.Layout"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.container",$.jazz.boxComponent,{options:{layout:"auto",layoutconfig:{}},_create:function(){this._super()},_init:function(){this._super()},_setOption:function(key,value){if(key=="layoutconfig"&&typeof value=="object"){this.options.layoutconfig=value;try{this.layoutobject.layout(this,this.layoutcontainer,value)}catch(e){jazz.error("错误的修改布局！！！")}}this._super(key,value)},doLayout:function(container){var _layout=this.options.layout,comp=jazz.layout[_layout],obj,that=this;function replaceLetter(str){var reg=/\b(\w)|\s(\w)/g;return str.replace(reg,function(m){return m.toUpperCase()})}this.layoutcontainer=container;if(typeof jazz.layout[_layout]=="undefined"){_layout=jazz.layout.auto}if(!(typeof(this.options.layoutconfig)=="object")){this.options.layoutconfig=jazz.stringToJson(this.options.layoutconfig)}if(_layout=="fit"){var $this=this;this.element.layout({layout:"fit",layoutconfig:{callback:function(){$this._panelFitCallback($this)}}})}else{if(jazz.config.isUseRequireJS===true){require(["layout/jazz."+replaceLetter(_layout)+"Layout"],function(){obj=that.layoutcontainer[comp]();that.layoutobject=obj.data(comp);that.layoutobject.layout(that,that.layoutcontainer,that.options.layoutconfig)})}else{obj=this.layoutcontainer[comp]();this.layoutobject=obj.data(comp);this.layoutobject.layout(this,this.layoutcontainer,this.options.layoutconfig)}}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Container","jazz.Toolbar"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.panel",$.jazz.container,{options:{vtype:"panel",bgcolor:null,buttons:null,closable:false,collapsable:false,customtitlebutton:null,framename:"",frameurl:null,showborder:true,titledisplay:false,title:"",titlealign:"left",titleicon:null,titlebuttonalign:"right",toggleable:false,toggleorientation:"vertical",beforeclose:null,afterclose:null,beforecollapse:null,aftercollapse:null,beforeexpand:null,afterexpand:null},_create:function(){this._super();this.compId=this.getCompId();var title=this.element.attr("title");if(title){this.element.removeAttr("title")}this.element.css("overflow","hidden").addClass("jazz-panel");this._createPanelElement()},_init:function(){this._super();this._showborder();this._title();this._titleButton();this._closable();this._customTitleButton();this._toggleable();this._titledisplay();this._bgcolor();this._width();this._buttons();this._height();this._frameurl();this.doLayout(this.content);if(this.options.content){this._createContent(this.content)}if(this.options.items){this._createItems(this.content)}this._collapsable()},_bgcolor:function(){if(this.options.bgcolor!=null){this.content.css("background",this.options.bgcolor)}},_buttons:function(){var buttons=this.options.buttons;if($.isArray(buttons)){if(this.toolbar){this.toolbar.remove()}this.toolbar=$("<div>").appendTo(this.element);for(var i=0,len=buttons.length;i<len;i++){buttons[i]["vtype"]="button"}this.toolbar.addClass("jazz-panel-toolbar").toolbar({items:buttons})}},_closable:function(){if(this.options.closable){var $this=this;var a=this.titlebar.find(".jazz-panel-titlebar-close");if(a.hasClass("jazz-panel-titlebar-close")){a.remove()}var obj=this._renderTitleButton("jazz-panel-titlebar-close","jazz-titlebar-icon-close");obj.off("click.panelclose").on("click.panelclose",function(e){$this.close();e.preventDefault()})}else{this.titlebar.find(".jazz-panel-titlebar-close").remove()}},_collapsable:function(){if(this.options.toggleable){if(this.options.collapsable){this.collapse()}}},_createPanelElement:function(){var compId=this.compId,el=this.element,vtype=this.options.vtype;var div=[];div.push('<div id = "');div.push(compId);div.push('_content" class="jazz-panel-content"></div>');el.wrapInner(div.join(""));div=[];div.push('<div id = "'+compId+'_titlebar" class="jazz-panel-titlebar jazz-panel-header jazz-');div.push(vtype);div.push('-titlebar" style="text-align: left;"><div id="');div.push(compId);div.push('_titlebar_inner" class="jazz-');div.push(vtype);div.push('-titlebar-inner" style="width:100%; height:100%"></div></div>');el.prepend(div.join(""));this.titlebar=$("#"+compId+"_titlebar");this.titlebarInner=$("#"+compId+"_titlebar_inner");this.content=$("#"+compId+"_content");if(this.options.content){this.content.append(this.options.content)}},_compSize:function(){this._width();this._height()},_customTitleButton:function(){var ctb=this.options.customtitlebutton;if(ctb){if(!$.isArray(ctb)){ctb=jazz.stringToJson(ctb)}var $this=this;$.each(ctb,function(i,handler){var customIcons=$this.handlerIcons1;if(handler.align=="right"){customIcons=$this.handlerIcons2}$this._customIcon(handler,customIcons,handler.icon)})}},_customIcon:function(handler,handlerIcons,icon,iconClass){var $this=this;var f="float: left";if(handler.align=="right"){f="float: right"}if(!iconClass){iconClass=""}if(icon){icon="style=\"background: url('"+icon+"') no-repeat\""}else{icon=""}var c=$('<a id="'+handler.id+'" class="jazz-panel-titlebar-icon jazz-panel-titlebar-custom" style="'+f+'"><span '+icon+' class="jazz-titlebar-icon jazz-titlebar-icon-custom '+iconClass+' " /></a>').appendTo(handlerIcons);c.on("click",function(e){if($.isFunction(handler.click)){handler.click.call(this,e,{object:$this,element:$this.element})}})},_frameurl:function(){if(this.options.frameurl!=null){this.content.empty();var framename=this.options.framename;if(framename){this.frameId=framename}else{var name=this.options.name;if(name){this.frameId="frame_"+name}else{this.frameId="frame_"+jazz.getRandom()}}var width=this.content.width(),height=this.content.height();this.frameObject=$('<iframe name="'+this.frameId+'" id="'+this.frameId+'" frameBorder="0"></iframe>');this.displayDiv=$('<div style="display:none; width:100%; height:100%; background:#FFFFFF;"></div>').appendTo(this.content);this.content.css("overflow","hidden").append(this.frameObject);this.frameObject.css({width:width,height:height}).attr("src",this.options.frameurl||"");this.pageParams=[];this.pageParams.push({url:this.options.frameurl})}},_height:function(){var layout=this.options.layout;if(layout!="fit"){if(layout=="border"){this.options.height="100%"}this._super();if(this.iscalculateheight){var h=0;if(this.toolbar&&this.options.vtype!="gridpanel"){h=this.toolbar.outerHeight(true)}var titleHeight=0;if(this.options.titledisplay){titleHeight=this.titlebar.outerHeight(true)}this.content.outerHeight(this.options.calculateinnerheight-titleHeight-h,true)}if(this.options.frameurl!=null&&this.frameObject){this.frameObject.height(this.content.height())}}},_titleButton:function(){var icon_width="";if(jazz.isIE(7)||jazz.isIE(6)){icon_width+="width:100px"}this.handlerIcons1=$('<span class="jazz-panel-rtl-left" style="'+icon_width+'"></span>').appendTo(this.titlebarInner);this.handlerIcons2=$('<span class="jazz-panel-rtl-right" style="'+icon_width+'"></span>').appendTo(this.titlebarInner);var handlerIcons=this.handlerIcons1;if(this.options.titlebuttonalign=="right"){handlerIcons=this.handlerIcons2}this.handlerIcons=handlerIcons},_titledisplay:function(){if(!this.options.titledisplay){this.titlebar.css("display","none")}else{this.titlebar.css("display","")}},_panelFitCallback:function($this){var h=0;if($this.toolbar){h=$this.toolbar.outerHeight(true)}if($this.options.titledisplay){$this.content.outerHeight($this.element.height()-$this.titlebar.outerHeight(true)-h,true)}else{$this.content.outerHeight($this.element.height()-h,true)}if($this.options.frameurl){$this.content.css({overflow:"hidden"});if($this.options.frameurl!=null){$this.frameObject.outerHeight($this.content.height(),true)}}if($this.options.vtype=="gridpanel"&&$this.options.layout=="fit"){$this._height()}else{this._reflashChildHeight()}},_renderTitleButton:function(styleClass,icon,id){var f="float:"+this.options.titlebuttonalign;var _id=id?'id="'+id+'"':"";var obj=$("<a "+_id+' class="jazz-panel-titlebar-icon '+styleClass+'" style="'+f+'" ><span class="jazz-titlebar-icon '+icon+'"></span></a>');if("jazz-panel-titlebar-close"==styleClass){if(this.options.titlebuttonalign=="left"){this.handlerIcons.append(obj)}else{this.handlerIcons.prepend(obj)}}else{this.handlerIcons.append(obj)}return obj},_setOption:function(key,value){switch(key){case"title":this.options.title=value;this.title.html(value);break;case"titlealign":this.options.titlealign=value;this.titlebar.css({"text-align":value});break;case"titleicon":this.options.titleicon=value;this.title.css({background:'url("'+value+'")',"background-repeat":"no-repeat","padding-left":"22px"});break;case"bgcolor":this.options.bgcolor=value;this.content.css("background-color",value);break;case"toggleable":this.options.toggleable=value;this._toggleable();if(this.options.collapsable){this.collapse()}else{this.expand()}break;case"collapsable":if(this.options.toggleable){if(value=="true"||value==true){this.collapse()}else{this.expand()}}else{this.options.collapsable=value}break;case"titlebuttonalign":var align=value=="left"?"left":"right";if(align==="left"){if(this.options.titlebuttonalign=="right"){this.handlerIcons1.append(this.handlerIcons2.contents());this.handlerIcons2.empty();this.handlerIcons=this.handlerIcons1}}else{if(this.options.titlebuttonalign=="left"){this.handlerIcons2.append(this.handlerIcons1.contents());this.handlerIcons1.empty();this.handlerIcons=this.handlerIcons2}}this.options.titlebuttonalign=align;break;case"customtitlebutton":this.options.customtitlebutton=value;this._customTitleButton();break;case"closable":if(value=="true"||value==true){this.options.closable=true}else{this.options.closable=false}this._closable();break;case"showborder":if(value=="true"||value==true){this.options.showborder=true}else{this.options.showborder=false}this._showborder();this._compSize();break;case"frameurl":if(this.options.frameurl==null){this.options.frameurl=value;this._frameurl()}else{this.options.frameurl=value;this.frameObject.attr("src",value)}break;case"titledisplay":this.options.titledisplay=value;this._compSize();this._titledisplay();break;case"buttons":var b=this.options.buttons;this.options.buttons=value;this._buttons();if(b==null){this._compSize()}break}this._super(key,value)},_slideUp:function(){this._event("beforecollapse");if(this.options.calculateinnerheight!=-1){this.content_height=this.content.height();this.element.height("auto")}this.content.css("display","none");this._event("aftercollapse");this.options.collapsable=true},_slideDown:function(){this._event("beforeexpand");if(this.options.calculateinnerheight!=-1){this.element.height(this.options.calculateinnerheight);this.content.height(this.content_height)}this.content.css("display","block");this._event("afterexpand");this.options.collapsable=false},_slideLeft:function(){var $this=this;this.originalWidth=this.options.calculateinnerwidth;this.title.hide();this.toggler.hide();this.content.hide();this.element.animate({width:"42px"},this.options.toggleSpeed,"easeInOutCirc",function(){$this.toggler.show();$this.element.addClass("jazz-panel-collapsed-h");$this.options.collapsable=!$this.options.collapsable})},_slideRight:function(){var $this=this,expandWidth=this.originalWidth||"100%";this.toggler.hide();this.element.animate({width:expandWidth},this.options.toggleSpeed,"easeInOutCirc",function(){$this.element.removeClass("jazz-panel-collapsable-h");$this.title.show();$this.toggler.show();$this.options.collapsable=!$this.options.collapsable;$this.content.css({visibility:"visible",display:"block",height:"auto"})})},_showborder:function(){if(this.options.showborder){this.element.addClass("jazz-panel-border")}else{this.element.removeClass("jazz-panel-border")}},_title:function(){var title=this.options.title||"";this.titlebarInner.children().remove();var titleicon="";if(this.options.titleicon){titleicon="style=\"background: url('"+this.options.titleicon+"') no-repeat; padding-left: 22px; \""}var tfontclass="jazz-panel-title-font jazz-"+this.options.vtype+"-title-font";if(this.options.titlealign){this.titlebar.css({"text-align":this.options.titlealign})}this.titlebarInner.append('<span id="'+this.compId+'_title" class="'+tfontclass+'" '+titleicon+" >"+title+"&nbsp;</span>");this.title=$("#"+this.compId+"_title")},_toggleable:function(){var $this=this;if(this.options.toggleable){var icon=this.options.collapsable?"jazz-titlebar-icon-expand":"jazz-titlebar-icon-collapse";this.titlebar.find("#toggleableId").remove();this.toggler=this._renderTitleButton("",icon,"toggleableId");this.toggler.off("click.toggler").on("click.toggler",function(e){if($this.options.collapsable){$this.expand()}else{$this.collapse()}e.preventDefault()})}else{this.titlebar.find("#toggleableId").remove()}},_width:function(){this._super();if(this.iscalculatewidth){this.content.outerWidth(this.options.calculateinnerwidth,true);if(this.options.titledisplay){this.titlebar.width("auto")}if(this.options.frameurl!=null&&this.frameObject){this.frameObject.width(this.content.width())}}},addTitleButton:function(handlers){var $this=this;if($.isArray(handlers)){$.each(handlers,function(i,handler){var customIcons=$this.handlerIcons1;if(handler.align=="right"){customIcons=$this.handlerIcons2}$this._customIcon(handler,customIcons,handler.icon,handler.iconClass)})}},close:function(){var $this=this;this._event("beforeclose",null);this.element.fadeOut("normal",function(){$this._event("afterclose",null)})},collapse:function(){this.toggler.children("span.jazz-titlebar-icon").removeClass("jazz-titlebar-icon-collapse").addClass("jazz-titlebar-icon-expand");if(this.options.toggleorientation==="vertical"){this._slideUp()}else{if(this.options.toggleorientation==="horizontal"){this._slideLeft()}}},expand:function(){this.toggler.children("span.jazz-titlebar-icon").removeClass("jazz-titlebar-icon-expand").addClass("jazz-titlebar-icon-collapse");if(this.options.toggleorientation==="vertical"){this._slideDown()}else{if(this.options.toggleorientation==="horizontal"){this._slideRight()}}},getTitle:function(){return this.options.title},hideTitleButton:function(r){$(r+"").hide()},iframeSrcHandler:function(src){if(this.frameObject){this.content.loading();this.frameObject.attr("src",src);var $this=this;this.frameObject.load(function(){$this.content.loading("hide")})}},open:function(){var $this=this;this._event("beforeopen",null);this.element.fadeIn("normal",function(){$this._event("afteropen",null)})},removeTitleButton:function(r){$(r+"").remove()},showTitleButton:function(r){$(r+"").show()}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.loading","jazz.Panel"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.window",$.jazz.panel,{options:{vtype:"window",closable:true,closeonescape:false,closestate:true,draggable:true,height:230,maximize:false,minwidth:200,minheight:200,minimizable:false,maximizable:false,modal:false,resizable:false,taskbar:null,titledisplay:true,visible:false,width:300,afteropen:null,beforeopen:null,maximize:null,minimize:null},_create:function(){this._super()},_init:function(){this._super();this.element.addClass("jazz-window jazz-helper-hidden");this.icons=this.titlebarInner.find(".jazz-panel-titlebar-icon");this.closeIcon=this.handlerIcons.children(".jazz-panel-titlebar-close");this._maximizable();this._minimizable();this._esc();this.blockEvents="focus.window mousedown.window mouseup.window keydown.window keyup.window";this.parent=this.element.parent();this._winbindEvents();this._draggable();if(this.options.resizable){this._setupResizable()}if(this.options.maximize){this.toggleMaximize()}if($(document.body).children(".jazz-window-docking-zone").length===0){$(document.body).append('<div class="jazz-window-docking-zone"></div>')}if(this.options.visible){this.open()}this.pageindex=0},_applyFocus:function(){this.element.find(":not(:submit):not(:button):input:visible:enabled:first").focus()},_draggable:function(){if(this.options.draggable){this.titlebar.addClass("jazz-panel-move-titlebar");if(this.options.maximizable){this._setupDraggable()}else{if(!this.options.maximize){this._setupDraggable()}}}else{this.titlebar.removeClass("jazz-panel-move-titlebar");this.element.draggable("option","disabled",true)}},_disableModality:function(){this.modality.loading("destroy");this.modality=null;$(document).unbind(this.blockEvents).unbind("keydown.window")},_dock:function(zone){this.element.appendTo(zone).css("position","static");this.element.css({height:"auto",width:"auto","float":"left"});this.content.hide();this.handlerIcons.find(".jazz-titlebar-icon-minus").removeClass("jazz-titlebar-icon-minus").addClass("jazz-titlebar-icon-plus");this.minimized=true;if(this.options.resizable){this.resizers.hide()}zone.css("z-index",++jazz.config.zindex);this._event("minimize")},_esc:function(){if(this.options.closeonescape){var $this=this;$(document).on("keydown.window",function(e){var keyCode=$.ui.keyCode,active=parseInt($this.element.css("z-index"),10)===jazz.config.zindex;if(e.which===keyCode.ESCAPE&&$this.element.is(":visible")&&active){$this.close()}})}else{$(document).off("keydown.window")}},_enableModality:function(){var $this=this;var _height="100%";if(jazz.isIE(6)){_height=jazz.util.windowHeight()}this.modality=$("<div></div>").addClass("jazz-window-modal").css({top:"0px",left:"0px",width:"100%",height:_height,"z-index":$this.element.css("z-index")-1}).appendTo(document.body).loading({blank:true})},_initPosition:function(){if(this.options.maximize){this.element.css({top:0,left:0})}else{var windowWidth=jazz.util.windowWidth(),windowHeight=jazz.util.windowHeight();var eleWidth=this.element.width(),eleHeight=this.element.height();var top=0,left=0;if(eleWidth>windowWidth){left=0}else{left=Math.ceil((windowWidth-eleWidth)/2)}if(eleHeight>windowHeight){top=0}else{top=Math.ceil((windowHeight-eleHeight)/2)}this.element.css({top:top,left:left})}this.positionInitialized=true},_maximizable:function(){if(this.options.maximizable===true){var $this=this;var a=this.titlebarInner.find(".jazz-titlebar-icon-extlink");if(a.hasClass("jazz-titlebar-icon-extlink")){this.titlebarInner.find(".jazz-panel-titlebar-maximize").remove()}var obj=this._renderTitleButton("jazz-panel-titlebar-maximize","jazz-titlebar-icon-extlink");this.titlebar.off("dblclick.window").on("dblclick.window",function(e){$this.toggleMaximize();e.preventDefault()});obj.off("click.panelmax").on("click.panelmax",function(e){$this.toggleMaximize();e.preventDefault()})}else{this.titlebarInner.find(".jazz-panel-titlebar-maximize").remove()}},_minimizable:function(){if(this.options.minimizable===true){var $this=this;var a=this.titlebarInner.find(".jazz-titlebar-icon-minus");if(a.hasClass("jazz-titlebar-icon-minus")){this.titlebarInner.find(".jazz-panel-titlebar-minimize").remove()}var obj=this._renderTitleButton("jazz-panel-titlebar-minimize","jazz-titlebar-icon-minus");obj.on("click.panelmin",function(e){$this.toggleMinimize();e.preventDefault()})}else{this.titlebarInner.find(".jazz-panel-titlebar-minimize").remove()}},_maxToResotre:function(){this.element.removeClass("jazz-window-maximized");this._restoreState();this.handlerIcons.find(".jazz-titlebar-icon-newwin").removeClass("jazz-titlebar-icon-newwin").addClass("jazz-titlebar-icon-extlink");this.maximized=false},_moveToTop:function(){this.element.css("z-index",++jazz.config.zindex)},_postShow:function(){this._event("afteropen",null);this._applyFocus()},_restoreState:function(){this.element.width(this.state.width).height(this.state.height);this._winCompSize(this.state.height);var win=$(window);this.element.offset({top:this.state.offset.top+(win.scrollTop()-this.state.windowScrollTop),left:this.state.offset.left+(win.scrollLeft()-this.state.windowScrollLeft)})},_setOption:function(key,value){switch(key){case"closeonescape":if(value=="true"||value==true){this.options.closeonescape=true}else{this.options.closeonescape=false}this._esc();break;case"draggable":if(value=="true"||value==true){this.options.draggable=true}else{this.options.draggable=false}this._draggable();break;case"resizable":if(value=="true"||value==true){this.options.resizable=true}else{this.options.resizable=false}this._setupResizable();break;case"maximize":if(value=="true"||value==true){this.options.maximize=true;if(!this.maximized){this.toggleMaximize()}}else{if(this.maximized){this._maxToResotre()}this.options.maximize=false}break;case"maximizable":if(value=="true"||value==true){this.options.maximizable=true}else{this.options.maximizable=false}this._maximizable();break;case"minimizable":if(value=="true"||value==true){this.options.minimizable=true}else{this.options.minimizable=false}this._minimizable();break;case"visible":if(value=="true"||value==true){this.options.visible=true;this.element.show()}else{this.options.visible=false;this.element.hide()}break}this._super(key,value)},_setupDraggable:function(){var $this=this;var xWidth=jazz.util.windowWidth()-$this.options.calculatewidth;var yHeight=jazz.util.windowHeight()-$this.titlebar.outerHeight()-5;this.element.draggable({cancel:".jazz-panel-content, .jazz-panel-titlebar-close",handle:".jazz-panel-titlebar",containment:[0,0,xWidth,yHeight],start:function(e,ui){if($this.maximized){$this.toggleMaximize()}var el=$this.element;xWidth=jazz.util.windowWidth()-$this.options.calculatewidth;yHeight=jazz.util.windowHeight()-$this.titlebar.outerHeight()-5;el.draggable("option","containment",[0,0,xWidth,yHeight]);if($this.frameObject!=null){$this.frameObject.css("marginLeft","-4000px");$this.displayDiv.css("display","block")}el.css("z-index",++jazz.config.zindex)},drag:function(e,ui){},stop:function(e,ui){if($this.frameObject!=null){$this.displayDiv.css("display","none");$this.frameObject.css("marginLeft","0px")}}})},_setupResizable:function(){if(this.options.resizable===true){var $this=this;this.element.resizable({minWidth:this.options.minwidth,minHeight:this.options.minheight,start:function(e,ui){if($this.options.frameurl!=null){$this.frameObject.css("marginLeft","-4000px");$this.displayDiv.addClass("jazz-window-framemb")}$this.content.width("100%")},resize:function(){},stop:function(e,ui){var width=ui.size.width;var toHeight=ui.size.height;if($this.titlebar){toHeight-=$this.titlebar.outerHeight()}if($this.toolbar){toHeight-=$this.toolbar.outerHeight()}$this.content.outerWidth(width);$this.content.outerHeight(toHeight);if($this.options.frameurl!=null){$this.displayDiv.removeClass("jazz-window-framemb");$this.frameObject.outerWidth($this.content.width()).outerHeight($this.content.height()).css("marginLeft","0px")}}});this.resizers=this.element.children(".jazz-resizable-handle")}else{this.element.resizable("destroy")}},_saveState:function(){var el=this.element,win=$(window);this.state={width:el.width(),height:el.height(),offset:el.offset(),windowScrollLeft:win.scrollLeft(),windowScrollTop:win.scrollTop()}},_winbindEvents:function(){var $this=this,el=this.element;el.on("click.window",function(e){el.css("z-index",++jazz.config.zindex)});if(this.options.frameurl!=null){$("#"+this.frameId).load(function(){$("#"+$this.frameId).contents().find("body").bind("mousedown.iframe",function(e){$this.element.css("z-index",++jazz.config.zindex)})})}},_winCompSize:function(height){var h=0;if(this.toolbar){h=this.toolbar.outerHeight()}this.content.width("auto").outerHeight(height-this.titlebar.outerHeight()-h);if(this.options.frameurl!=null){var h=this.content.height();this.frameObject.width("100%").outerHeight(h).load(function(){$(this).width("100%").outerHeight(h)})}},close:function(trigger){if(this.options.taskbar instanceof jQuery){var id=$("#"+this.liId);if(id instanceof jQuery){id.remove()}}if(this.options.closestate==true){if(!trigger){this._event("beforeclose",null)}if(this.options.frameurl!=null){this.frameObject.attr("src","about:blank");try{var dom=this.frameObject.get(0);dom.contentWindow.document.write("");dom.contentWindow.document.clear()}catch(e){this.frameObject.remove()}}this.element.remove();this.destroy();if(this.options.modal){this._disableModality()}if(!trigger){this._event("afterclose",null)}}else{this.element.hide();if(this.options.afterhidden){this._event("afterhidden",null)}if(this.options.modal){this._disableModality()}}},currentPage:function(url,align){var obj={url:url};this.pageParams.push(obj);this.pageindex=this.pageindex+1;this.slider("left",url);if(this.pageindex===1){this.customIconId="customIconId"+jazz.getRandom();var $this=this;this.addTitleButton([{id:this.customIconId,align:align,iconClass:"jazz-leftarrow-icon",click:function(e,ui){$this.previous()}}])}},next:function(){var index=this.pageindex+1;if(index!=this.pageParams.length){var obj=this.pageParams[index];if(!!obj){this.slider("right",obj.url);this.pageindex=this.pageindex+1}}},open:function(){this.element.css("z-index",++jazz.config.zindex);if(this.element.is(":visible")){return}this._event("beforeopen",null);if(!this.positionInitialized){this._initPosition()}this.element.show();var _url=this.options.frameurl;if(_url!=null){if(this.options.closestate==false){if(!this.frameObject.attr("src")){this.frameObject.attr("src",_url)}}else{this.frameObject.attr("src",_url)}}this._postShow();this._moveToTop();if(this.options.modal){this._enableModality()}if(this.options.taskbar instanceof jQuery){var s="";if(this.options.titleicon){s='style="background: url('+this.options.titleicon+') no-repeat center center "'}this.liId="li_id_"+jazz.getRandom();var id=this.options.id?this.options.id:this.options.name;$('<li id="'+this.liId+'" winid="'+id+'"><div><span class="jazz-portal-bottom-li-img" '+s+'></span><span class="jazz-portal-bottom-li-word">'+this.getTitle()+'</span><span class="jazz-portal-bottom-li-close"></span></div></li>').appendTo(this.options.taskbar)}},previous:function(){var index=this.pageindex-1;if(index>-1){var obj=this.pageParams[index];if(!!obj){this.slider("left",obj.url);this.pageindex=this.pageindex-1;if(this.pageindex===0){this.removeTitleButton("#"+this.customIconId)}}}},slider:function(align,url){if(!!url){var $this=this;this.content.loading();var margin={marginLeft:(0-parseInt(this.element.width()))};if(align=="right"){margin={marginLeft:parseInt(this.element.width())}}if(this.options.frameurl!=null){this.frameObject.animate(margin,200,null,function(){$this.frameObject.attr("src",url);$this.frameObject.load(function(){$this.content.loading("hide");$this.frameObject.css({marginLeft:0})})})}}},toggleMaximize:function(){if(this.minimized){this.toggleMinimize()}if(this.maximized){this._maxToResotre()}else{this._saveState();var winTop=this.state.windowScrollTop;var winLeft=this.state.windowScrollLeft;var page=this.getPageSize();var winHeight=page.windowHeight,winWidth=page.windowWidth;if(this.options.taskbar instanceof jQuery){winHeight=winHeight-this.options.taskbar.outerHeight()}this.element.addClass("jazz-window-maximized").outerWidth(winWidth).outerHeight(winHeight).offset({top:winTop,left:winLeft});this._winCompSize(winHeight);this.handlerIcons.find(".jazz-titlebar-icon-extlink").removeClass("jazz-titlebar-icon-extlink").addClass("jazz-titlebar-icon-newwin");this.maximized=true;this._event("maximize")}},toggleMinimize:function(){var animate=true,dockingZone=$(document.body).children(".jazz-window-docking-zone");if(this.maximized){if(this.options.maximizable){this.toggleMaximize()}animate=false}var $this=this;if(this.minimized){this._restoreState();this.content.show();this.handlerIcons.find(".jazz-titlebar-icon-plus").removeClass("jazz-titlebar-icon-plus").addClass("jazz-titlebar-icon-minus");this.minimized=false;if(this.options.resizable){this.resizers.show()}}else{this._saveState();if(this.options.taskbar instanceof jQuery){this.element.css({"margin-left":"-3000px"})}else{if(animate){this.element.effect("transfer",{to:dockingZone,className:"jazz-window-minimizing"},300,function(){$this._dock(dockingZone);var width=$this.handlerIcons1.width()*2;if($this.handlerIcons1.width()<$this.handlerIcons2.width()){width=$this.handlerIcons2.width()*2}$this.element.width(width+$this.titlebar.width()+40)})}else{this._dock(dockingZone);var width=$this.handlerIcons1.width()*2;if($this.handlerIcons1.width()<$this.handlerIcons2.width()){width=$this.handlerIcons2.width()*2}$this.element.width(width+$this.titlebar.width()+40)}}}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Panel","form/jazz.form.TextField","form/jazz.form.TextareaField","form/jazz.form.ComboxField","form/jazz.form.ComboxTree","form/jazz.form.AutocompletecomboxField","form/jazz.form.ColorField","form/jazz.form.DateField","form/jazz.form.CheckboxField","form/jazz.form.RadioField","form/jazz.form.NumberField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.formpanel",$.jazz.panel,{options:{vtype:"formpanel",layout:"table",layoutconfig:{cols:2,columnwidth:["50%","*"]},dataurl:null,dataurlparams:null,dataview:false,readonly:false},_create:function(){this._super();this.element.addClass("jazz-formpanel")},_init:function(){this._super();this.content.addClass("jazz-formpanel-content");if(this.options.dataurl){this.reload()}if(this.options.layout=="auto"){this.content.css("overflow","hidden")}},_ajax:function(){var param={url:this.options.dataurl,params:this.options.dataurlparams,async:true,showloading:false,callback:this._callback};$.DataAdapter.submit(param,this)},_callback:function(data,sourceThis){var jsonData=data;var $this=sourceThis;if(jsonData&&jsonData.data){$.each($this.getChildrenComponent(),function(name,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj),f=$this._filterVtype(childtype);var value=jsonData.data[name];if(isInited&&f){$this._runChildSetValue(childtype,value,obj)}})}if($.isFunction($this.callbackfunction)){$this.callbackfunction.call($this)}},_dataview:function(){var $this=this;$.each(this.getChildrenComponent(),function(name,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj),f=$this._filterVtype(childtype);if(isInited&&f){$this._readonly($obj.data(childtype))}})},_filterVtype:function(vtype){if(vtype=="toolbar"||vtype=="button"||vtype=="gridpanel"){return false}else{return true}},_getProperties:function(type,name){if(!name){var formJson={};formJson.name=this.options.name;formJson.vtype="formpanel";var formdata={};var $this=this;$.each(this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj),f=$this._filterVtype(childtype);if(isInited&&f){formdata[childname]=$obj[childtype](type)}});formJson.data=formdata;return formJson}else{var value="";$.each(this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj);if(isInited&&name==childname){value=$obj[childtype](type)}});return value}},_readonly:function(comp){if(this.options.dataview==true||this.options.readonly==true){comp.options.readonly=true;comp._readonly()}else{comp.options.readonly=false;comp._readonly()}},_runChildSetValue:function(vtype,value,obj){if(vtype=="datefield"&&(value+"").length>10){value=value.substring(0,10)}var comp=$(obj).data(vtype);comp.setValue(value)},_setOption:function(key,value){switch(key){case"dataurlparams":this.options.dataurlparams=value;break;case"dataurl":this.options.dataurl=value;break;case"dataview":case"readonly":if(value==true||value=="true"){this.options.dataview=true;this.options.readonly=true}else{this.options.dataview=false;this.options.readonly=false}this._dataview();break}this._super(key,value)},getValue:function(name){return this._getProperties("getValue",name)},getText:function(name){return this._getProperties("getText",name)},reload:function(data,callbackfunction){this.callbackfunction=callbackfunction;if(this.options.dataurl){this._ajax()}},reset:function(flag){$.each(this.getChildrenComponent(),function(i,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");if(childtype!="toolbar"&&childtype!="button"){if(!flag&&childtype=="hiddenfield"){return true}var isInited=jazz._isComponentInited($obj);if(isInited){$obj[childtype]("reset")}}})},setValue:function(name,value){if(name instanceof Object){this.options.data=name;this._callback(this.options.data,this)}else{$.each(this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj);if(childname==name&&isInited){$this._runChildSetValue(childtype,value,obj)}})}},validate:function(){var flag=true;var subElements=this.element.find("div[vtype]");if(subElements.length==0){}else{subElements.each(function(index,element){var el=$(element);var vtype=el.attr("vtype"),$field=el.data(vtype);var options=$field.options;var rule=options.rule;if(rule&&vtype!="gridpanel"&&vtype!="hiddenfield"&&vtype!="checkboxfield"&&vtype!="radiofield"&&options.isrule){var msg=options.msg;var f=jazz.doTooltip($field,$field.getText(),rule,msg);if(f==false){flag=false;$field._validateStyle(f)}}})}return flag}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.tabpanel",$.jazz.boxComponent,{options:{vtype:"tabpanel",activeindex:0,showborder:true,overflowtype:2,tabtitlewidth:null,tabalign:"left",orientation:"top",showtabclose:true,change:null,close:null},_create:function(){this._super();this._showborder();var element=this.element;this.options.selected=this.options.activeindex;element.addClass("jazz-tabview jazz-widget jazz-hidden-container").addClass("jazz-tabview-"+this.options.orientation);this.navContainer=element.find("ul:first");this.panelContainer=element.find(">div:first");this.navContainer.find("li").addClass("jazz-tabview-default").css({width:this.options.tabtitlewidth}).eq(this.options.activeindex).addClass("jazz-tabview-selected jazz-state-active").css({"z-index":"3"});this.navContainer.find("li:last").after('<div class="jazz-clearfix"></div>').end().addClass("jazz-tabview-nav jazz-helper-reset jazz-helper-clearfix").wrap('<div class="jazz-tabview-header"></div>').wrap('<div class="jazz-tabview-wrap"></div>');this.navContainer.find("li:eq(0)").children().before("<div class ='nav-content-left'></div><div class ='nav-content-right-first'></div>");this.navContainer.find("li:gt(0)").children().before("<div class ='nav-content-left'></div><div class ='nav-content-right'><span class='jazz-icon-close nav-close'></span></div>");this.templeft=this.navContainer.find("li .nav-content-left").width(),this.tempright=this.navContainer.find("li .nav-content-right").width();this.tempwidth=this.templeft+this.tempright;if(this.templeft!=0){this.tempwidth=this.navContainer.find("li").width()-this.tempwidth;this.navContainer.find("li a ").css({width:this.tempwidth}).addClass("nav-content-middle")}this.panelContainer.addClass("jazz-tabview-panels").children().addClass("jazz-tabview-panel jazz-widget-content").end().find("div.jazz-tabview-panel:not(:eq("+this.options.activeindex+"))").css({"margin-left":"-3000px","z-index":"-1000"}).end();this.tabswrapContainer=element.find(".jazz-tabview-wrap");this.tabsHeader=element.find(".jazz-tabview-header");if((this.options.orientation=="top"||this.options.orientation=="bottom")){this.navContainer.css({margin:"0 2px 0 0"}).find("li").addClass("jazz-tabview-tabalign-"+this.options.tabalign)}this.isInner=false},_init:function(){this._compSize();this.tablefttitleheight=this.navContainer.find("li").outerHeight(true);this.tablefttitlewidth=this.navContainer.find("li").outerWidth(true);this.isorientation=true;this._tabsPositionInit();this._innerWidth();this._innerHeight();this.isInner=true;this._bindEvents()},_compSize:function(){this._width();this._height()},_showborder:function(){if(this.options.showborder){this.element.addClass("jazz-panel-border")}else{this.element.removeClass("jazz-panel-border")}},_width:function(){this._super();if(this.isInner){this._innerWidth()}},_innerWidth:function(){if((this.options.orientation=="top"||this.options.orientation=="bottom")){if(this.isInner){this.tabswrapContainer.width(this.options.calculateinnerwidth)}this.panelContainer.outerWidth(this.options.calculateinnerwidth)}else{this.tabsHeaderWidth=this.tabsHeader.outerWidth(true);var tabwidth=this.options.calculateinnerwidth-this.tabsHeaderWidth;if(jazz.isIE(7)||jazz.isIE(6)){tabwidth=tabwidth-5}this.panelContainer.outerWidth(tabwidth)}},_height:function(){this._super();if(this.isInner){this._innerHeight()}},_innerHeight:function(){this.tabsHeaderHeight=this.tabsHeader.outerHeight(true);if((this.options.orientation=="top"||this.options.orientation=="bottom")){if(this.options.calculateinnerheight!="-1"){this.panelContainer.height(this.options.calculateinnerheight-this.tabsHeaderHeight)}}else{if(this.isInner){this.tabsHeader.outerHeight(this.options.calculateinnerheight);this.tabswrapContainer.outerHeight(this.tabsHeaderHeight)}if(this.options.calculateinnerheight=="-1"){this.options.calculateinnerheight=this.tabsHeader.outerHeight(true)}this.tabsHeader.find(".jazz-tabview-header-"+this.options.orientation).outerHeight(this.tabsHeaderHeight);this.panelContainer.height(this.options.calculateinnerheight)}},_tabsPositionInit:function(){var that=this;if(that.options.orientation=="top"||that.options.orientation=="bottom"){if(that.options.orientation=="bottom"){if(this.isorientation){that.element.append(that.tabsHeader);that.tabsHeader.prepend("<div class='jazz-tabview-header-"+that.options.orientation+"'></div>");this.isorientation=false}}else{if(this.isorientation){that.tabsHeader.append("<div class='jazz-tabview-header-"+that.options.orientation+"'></div>");this.isorientation=false}}if(that.options.overflowtype==1){that.tabs_more_horizon=$('<div class="tabs-more-horizon"></div>').appendTo(that.tabsHeader);that._initSelectableTopAndBottom()}else{if(that.options.overflowtype==2){that._computeTabsHeader()}}}else{if(that.options.orientation=="left"||that.options.orientation=="right"){if(this.isorientation){if(this.iscalculateheight){that.tabsHeader.outerHeight(this.options.calculateinnerheight);that.tabswrapContainer.outerHeight(that.tabsHeader.height())}that.tabsHeader.prepend("<div class='jazz-tabview-header-"+that.options.orientation+"' style='height:"+this.tabsHeader.height()+"px;'></div>");that.tabsHeader.width(that.tabswrapContainer.find("li:first").width()+that.tabsHeader.find(".jazz-tabview-header-"+that.options.orientation).outerWidth(true));this.isorientation=false}if(that.options.overflowtype==1){that.tabs_more_vertical=$('<div class="tabs-more-vertical"></div>').appendTo(that.tabsHeader);that._initSelectableLeftAndRight()}else{if(that.options.overflowtype==2){that._computeTabsHeader()}}}}},_computeTabsHeader:function(){var that=this,orientation=that.options.orientation,tempTabsWidth=0,tempTabsHeight=0;if(orientation=="top"||orientation=="bottom"){tempTabsWidth=that.navContainer.outerWidth(true)-that.navContainer.outerWidth();that.navContainer.find("li:visible").each(function(i){tempTabsWidth+=$(this).outerWidth(true)});that.tabswrapContainer.scrollLeft(0);if(tempTabsWidth>that.tabswrapContainer.width()){if(!this._isResetMoreTab()){return}that.navContainer.addClass("jazz-tabview-wrap-more");!that.tabs_scroller_left&&(that.tabs_scroller_left=$('<a class="tabs-scroller-left"></a>').appendTo(that.tabsHeader).css({height:that.tabswrapContainer.height()+"px",display:"block"}));!that.tabs_scroller_right&&(that.tabs_scroller_right=$('<a class="tabs-scroller-right"></a>').appendTo(that.tabsHeader).css({height:that.tabswrapContainer.height()+"px",display:"block"}));if(that.options.tabalign=="right"){that.tabswrapContainer.scrollLeft(that.navContainer.outerWidth(true))}if(orientation=="bottom"){that.tabs_scroller_left.css({bottom:0,top:"auto"});that.tabs_scroller_right.css({bottom:0,top:"auto"})}var wrapwidth=that.tabswrapContainer.outerWidth(true)-32;that.tabswrapContainer.css({width:wrapwidth,margin:"0px 16px"})}else{if(that.tabs_scroller_left){that.tabs_scroller_left.remove();that.tabs_scroller_left=null}if(that.tabs_scroller_right){that.tabs_scroller_right.remove();that.tabs_scroller_right=null}if(that.options.tabalign=="right"){that.tabswrapContainer.scrollLeft(that.navContainer.outerWidth(true))}that.tabswrapContainer.css({margin:"0px"})}}else{if(that.options.orientation=="left"||this.options.orientation=="right"){that.navContainer.find("li:visible").each(function(i){tempTabsHeight+=$(this).outerHeight(true)});that.tabswrapContainer.scrollTop(0);if(tempTabsHeight>that.tabswrapContainer.height()){if(!this._isResetMoreTab()){return}!that.tabs_scroller_top&&(that.tabs_scroller_top=$('<a class="tabs-scroller-top"></a>').prependTo(that.tabsHeader));!that.tabs_scroller_bottom&&(that.tabs_scroller_bottom=$('<a class="tabs-scroller-bottom"></a>').appendTo(that.tabsHeader));that.navContainer.addClass("jazz-tabview-wrap-hmore");that.tabswrapContainer.height(that.tabsHeader.height()-that.tabs_scroller_top.height()-that.tabs_scroller_bottom.height()).width(that.options.tabtitlewidth||(that.tabsHeader.width()-that.tabs_more_horizon.width()));that.tabs_scroller_top.css({width:(that.options.tabtitlewidth.replace(/px/g,"")+"px"||that.tabsHeader.width()),display:"block"});that.tabs_scroller_bottom.css({width:(that.options.tabtitlewidth.replace(/px/g,"")+"px"||that.tabsHeader.width()),display:"block"})}else{if(that.tabs_scroller_top){that.tabs_scroller_top.remove();that.tabs_scroller_top=null}if(that.tabs_scroller_bottom){that.tabs_scroller_bottom.remove();that.tabs_scroller_bottom=null}that.tabswrapContainer.height(that.tabsHeader.height())}}}},_computeTabsHeaderMore:function(){var that=this;if(that.options.orientation=="top"||that.options.orientation=="bottom"){var tempTabsWidth=that.navContainer.outerWidth(true)-that.navContainer.outerWidth();that.navContainer.find("li:visible").each(function(i){tempTabsWidth+=$(this).outerWidth(true)});if(tempTabsWidth>=that.tabswrapContainer.width()){that.navContainer.width(5000+"px");that.tabswrapContainer.width(that.options.tabtitlewidth||(that.tabsHeader.width()-that.tabs_more_horizon.width()));that.tabs_more_horizon.css({height:that.tabswrapContainer.height()+"px",display:"inline-block","*display":"inline",zoom:"1"});if(that.tabsMoreDisplayDiv&&that.tabsMoreDisplayDiv.length>1){that.tabsMoreDisplayDiv.children().remove()}else{that.tabsMoreDisplayDiv=$('<div style="width:70px;position:absolute;display:none;"></div>').appendTo(document.body)}that.navContainer.clone().css("width","auto").appendTo(that.tabsMoreDisplayDiv);this._bindMoreHorizonEvents()}else{that.navContainer.css("width","auto");that.tabswrapContainer.width(that.tabsHeader.width());that.tabs_scroller_right.css({display:"none"})}}else{if(that.options.orientation=="left"||this.options.orientation=="right"){var tempTabsHeight=0;that.navContainer.find("li").each(function(i){if($(this).css("display")!="none"){tempTabsHeight+=$(this).outerHeight()}});if(tempTabsHeight>that.tabswrapContainer.height()){that.navContainer.height(5000+"px");that.tabswrapContainer.width(that.options.tabtitlewidth||(that.tabsHeader.width()-that.tabs_more_horizon.width()));that.tabs_more_vertical.css({width:that.tabsHeader.width(),display:"block"});if(that.tabsMoreDisplayDiv&&that.tabsMoreDisplayDiv.length>1){that.tabsMoreDisplayDiv.children().remove()}else{that.tabsMoreDisplayDiv=$('<div style="width:70px;position:absolute;display:none;"></div>').appendTo(document.body)}that.navContainer.clone().css("height","auto").appendTo(that.tabsMoreDisplayDiv);this._bindMoreVerticalEvents()}else{that.navContainer.css("height","auto");that.tabswrapContainer.height(that.tabsHeader.height());that.tabs_more_vertical.css("display","none")}}}},_isResetMoreTab:function(){if(this.tabsHeader.children('div[class^="tabs-scroller"]').length){return false}return true},_initSelectableTopAndBottom:function(){var that=this;var tempTabsWidth=that.navContainer.outerWidth(true)-that.navContainer.outerWidth();that.navContainer.find("li").each(function(i){if($(this).css("display")!="none"){tempTabsWidth+=$(this).outerWidth(true)}});if(tempTabsWidth>=that.tabswrapContainer.width()){that.navContainer.width(5000+"px");that.tabswrapContainer.width(that.tabsHeader.width()-that.tabs_more_horizon.width());that.tabs_more_horizon.css({height:that.tabswrapContainer.height()+"px",display:"inline-block","*display":"inline",zoom:"1"});that.tabsMoreDisplayDiv=$('<div style="width:70px;position:absolute;display:none;"></div>').appendTo(document.body);that.navContainer.clone().css("width","auto").appendTo(that.tabsMoreDisplayDiv);this._bindMoreHorizonEvents();if(that.options.tabalign=="right"){that.tabswrapContainer.scrollLeft(that.navContainer.outerWidth(true))}}else{that.navContainer.css("width","auto");that.tabswrapContainer.width(that.tabsHeader.width());that.tabs_scroller_right.css({display:"none"});if(that.options.tabalign=="right"){that.tabswrapContainer.scrollLeft(that.navContainer.outerWidth(true))}}},_initSelectableLeftAndRight:function(){var that=this;var tempTabsHeight=0;that.navContainer.find("li").each(function(i){if($(this).css("display")!="none"){tempTabsHeight+=$(this).outerHeight()}});if(tempTabsHeight>that.tabswrapContainer.height()){that.navContainer.height(5000+"px");that.tabswrapContainer.height(that.tabsHeader.height()-that.tabs_more_vertical.height());that.tabs_more_vertical.css({width:that.tabsHeader.width(),display:"block"});that.tabsMoreDisplayDiv=$('<div style="width:70px;position:absolute;display:none;"></div>').appendTo(document.body);that.navContainer.clone().css("height","auto").appendTo(that.tabsMoreDisplayDiv);this._bindMoreVerticalEvents()}else{that.navContainer.css("height","auto");that.tabswrapContainer.height(that.tabsHeader.height());that.tabs_more_vertical.css("display","none")}},_bindMoreHorizonEvents:function(){var that=this;that.tabs_more_horizon.off("click.more").on("click.more",function(){that.tabsMoreDisplayDiv.css({left:"",top:""}).position({my:"left top",at:"right top",of:that.tabs_more_horizon}).show()});that.tabsMoreDisplayDiv.find("li").off("click.morerli").on("click.moreli",function(e){var element=$(this);if($(e.target).is(":not(.jazz-icon-close)")){var index=element.index();if(!element.hasClass("jazz-state-disabled")&&index!=that.options.selected){that._selectMoreLi(index);that.select(index)}var el=that.navContainer.find("li:eq("+index+")");var tabsTotalWidth=$(el).outerWidth(true);$(el).prevAll().each(function(i){if($(this).css("display")!="none"){tabsTotalWidth+=$(this).outerWidth(true)}});var scrollTotalWidth=tabsTotalWidth-that.tabswrapContainer.width();if(scrollTotalWidth>0){that.tabswrapContainer.scrollLeft(scrollTotalWidth)}else{that.tabswrapContainer.scrollLeft(0)}}e.preventDefault()});this.tabsMoreDisplayDiv.find("li .jazz-icon-close").off("click.tab").on("click.tab",function(e){var index=$(this).parent().parent().index();$this.remove(index);e.preventDefault()});$(document).off("click.jazz-tabpanel-other").on("click.jazz-tabpanel-other",function(e){if($(that.tabsMoreDisplayDiv).is(":hidden")){return}var target=$(e.target);if(target.is($(that.tabsMoreDisplayDiv))||$(that.tabsMoreDisplayDiv).has(target).length>0){return}if(target.is(that.tabs_more_horizon)||that.tabs_more_horizon.has(target).length>0){return}var offset=$(that.tabsMoreDisplayDiv).offset();if(e.pageX<offset.left||e.pageX>offset.left+$(that.tabsMoreDisplayDiv).width()||e.pageY<offset.top||e.pageY>offset.top+$(that.tabsMoreDisplayDiv).height()){$(that.tabsMoreDisplayDiv).hide()}})},_bindMoreVerticalEvents:function(){var that=this;that.tabs_more_vertical.off("click.more").on("click.more",function(){that.tabsMoreDisplayDiv.css({left:"",top:""}).position({my:"left top",at:"right top",of:that.tabs_more_vertical}).show()});that.tabsMoreDisplayDiv.find("li").off("click.moreli").on("click.moreli",function(e){var element=$(this);if($(e.target).is(":not(.jazz-icon-close)")){var index=element.index();if(!element.hasClass("jazz-state-disabled")&&index!=that.options.selected){that._selectMoreLi(index);that.select(index)}var el=that.navContainer.find("li:eq("+index+")");var tabsTotalWidth=$(el).outerHeight(true);$(el).prevAll().each(function(i){if($(this).css("display")!="none"){tabsTotalWidth+=$(this).outerHeight(true)}});var scrollTotalWidth=tabsTotalWidth-that.tabswrapContainer.height();if(scrollTotalWidth>0){that.tabswrapContainer.scrollTop(scrollTotalWidth)}else{that.tabswrapContainer.scrollTop(0)}}e.preventDefault()});this.tabsMoreDisplayDiv.find("li .jazz-icon-close").off("click.tab").on("click.tab",function(e){var index=$(this).parent().parent().index();$this.remove(index);e.preventDefault()});$(document.body).bind("mousedown.jazz-tabpanel-other",function(e){if($(that.tabsMoreDisplayDiv).is(":hidden")){return}var target=$(e.target);if(target.is($(that.tabsMoreDisplayDiv))||$(that.tabsMoreDisplayDiv).has(target).length>0){return}if(target.is(that.tabs_more_vertical)||that.tabs_more_vertical.has(target).length>0){return}var offset=$(that.tabsMoreDisplayDiv).offset();if(e.pageX<offset.left||e.pageX>offset.left+$(that.tabsMoreDisplayDiv).width()||e.pageY<offset.top||e.pageY>offset.top+$(that.tabsMoreDisplayDiv).height()){$(that.tabsMoreDisplayDiv).hide()}})},_selectMoreLi:function(index){var headers=this.tabsMoreDisplayDiv.find("li"),oldHeader=headers.filter(".jazz-state-active"),newHeader=headers.eq(index);oldHeader.attr("aria-expanded",false);newHeader.attr("aria-expanded",true);oldHeader.removeClass("jazz-tabview-selected jazz-state-active");newHeader.removeClass("jazz-tabview-hover").addClass("jazz-tabview-selected jazz-state-active")},_bindTopAndBottomScrollEvent:function(){var that=this,scrollwidth=this.tablefttitlewidth;that.tabsHeader.off("click.left",".tabs-scroller-left").on("click.left",".tabs-scroller-left",function(){var scrollleft=that.tabswrapContainer.scrollLeft()+scrollwidth;if(that.options.tabalign=="right"){that.tabswrapContainer.scrollLeft(scrollleft)}else{var tabsTotalWidth=0;that.navContainer.children("li:visible").each(function(i){tabsTotalWidth+=$(this).outerWidth()});var scrollTotalWidth=tabsTotalWidth-that.tabswrapContainer.width();if(scrollleft>scrollTotalWidth){that.tabswrapContainer.scrollLeft(scrollTotalWidth+24)}else{that.tabswrapContainer.scrollLeft(scrollleft)}}});that.tabsHeader.off("click.right").on("click.right",".tabs-scroller-right",function(){var wrapcontainerScrollWidth=that.tabswrapContainer[0].scrollWidth;var scrollleft=that.tabswrapContainer.scrollLeft()-scrollwidth;if(that.options.tabalign=="right"){var tabsTotalWidth=0;that.navContainer.find("li:visible").each(function(i){tabsTotalWidth+=$(this).outerWidth()});if(that.tabswrapContainer.scrollLeft()<(wrapcontainerScrollWidth-tabsTotalWidth)){scrollleft=wrapcontainerScrollWidth-tabsTotalWidth-24}}that.tabswrapContainer.scrollLeft(scrollleft)})},_bindLeftAndRightScrollEvent:function(){var that=this,scrollheight=this.tablefttitleheight,singleLiHeight=0;that.tabsHeader.off("click.top").on("click.top",".tabs-scroller-top",function(){var tabsTotalHeight=0;that.navContainer.children("li:visible").each(function(i){tabsTotalHeight+=$(this).outerHeight(true);singleLiHeight=$(this).outerHeight(true)});var scrollTotalHeight=tabsTotalHeight-that.tabswrapContainer.height();var scrolltop=that.tabswrapContainer.scrollTop()+scrollheight;if(scrolltop>scrollTotalHeight){that.tabswrapContainer.scrollTop(scrollTotalHeight+singleLiHeight)}else{that.tabswrapContainer.scrollTop(scrolltop)}});that.tabsHeader.off("click.bottom").on("click.bottom",".tabs-scroller-bottom",function(){var scrolltop=that.tabswrapContainer.scrollTop()-scrollheight;that.tabswrapContainer.scrollTop(scrolltop)})},_bindEvents:function(){var $this=this;this.navContainer.off("click.tab","li").on("click.tab","li",function(e){var element=$(this);if($(e.target).is(":not(.jazz-icon-close)")){var index=element.index();if(!element.hasClass("jazz-state-disabled")&&index!=$this.options.selected){$this.select(index)}}e.preventDefault()});this.navContainer.off("click.tabclose","li .jazz-icon-close").on("click.tabclose","li .jazz-icon-close",function(e){var index=$(this).parent().parent().index();$this.remove(index);e.preventDefault()});if(this.options.orientation=="top"||this.options.orientation=="bottom"){this._bindTopAndBottomScrollEvent()}else{if(this.options.orientation=="left"||this.options.orientation=="right"){this._bindLeftAndRightScrollEvent()}}},select:function(index){this.options.selected=index;var newPanel=this.panelContainer.children().eq(index),headers=this.navContainer.children(),oldHeader=headers.filter(".jazz-state-active"),newHeader=headers.eq(newPanel.index()),oldPanel=this.panelContainer.children(".jazz-tabview-panel:visible"),$this=this;oldHeader.removeClass("jazz-tabview-selected jazz-state-active");oldPanel.css({"margin-left":"-3000px","z-index":"-1000"});newHeader.removeClass("jazz-tabview-hover").addClass("jazz-tabview-selected jazz-state-active");newPanel.css({"margin-left":"0px","z-index":"0"});this._event("change",null,index);var nowPosition=this._isOnScreen(index);if(nowPosition!=true){this.tabswrapContainer[nowPosition.direction](nowPosition.scrollNum)}},remove:function(index){if(index<0||index>this.getLength()){return false}var header=this.navContainer.children().eq(index),panel=this.panelContainer.children().eq(index);this._event("close",null,index);header.remove();panel.remove();if(index==this.options.selected){var newIndex=this.options.selected==this.getLength()?(this.options.selected-1):this.options.selected;this.select(newIndex)}if(index==this.options.activeindex){if(index==0){this.select(0)}else{if(index==this.getLength()){this.select(index-1)}}}else{this.select(this.options.activeindex)}if(this.options.overflowtype==2){this._computeTabsHeader()}else{if(this.options.overflowtype==1){this._computeTabsHeaderMore()}}},_beforeAddTab:function(taboption){var prefix="jazz_tabpanel_custom_";if(!taboption.tabid){jazz.warn("参数中未找到属性[tabid]");return false}if(!taboption.tabtitle){jazz.warn("参数中未找到属性[tabtitle]");return false}if(this.element.find("#"+prefix+taboption.tabid).length){jazz.warn("参数中未找到属性[tabtitle]");return false}return true},addTab:function(taboption){var $this=this,prefix="jazz_tabpanel_custom_",tabLength=$this.getLength(),index=taboption.tabindex?taboption.tabindex:(tabLength+1),tabli="<li class='jazz-tabview-default'><div class ='nav-content-left'></div><div class ='nav-content-right'><span class='jazz-icon-close nav-close'></span></div><a style='width:"+this.tempwidth+"px;' class='nav-content-middle' href='"+prefix+taboption.tabid+"'>"+taboption.tabtitle+"</a><span style='display:none;' class='jazz-icon jazz-icon-close'></span></li>",tabdiv="<div class='jazz-tabview-panel jazz-widget-content' style='margin-left:-3000px;' id='"+prefix+taboption.tabid+"'>"+(taboption.tabcontent||"")+"</div>";if(taboption.taburl){tabdiv="<div class='jazz-tabview-panel jazz-widget-content' style='margin-left:-3000px;' id='"+prefix+taboption.tabid+"'><iframe src='"+taboption.taburl+"' id='"+prefix+taboption.tabid+"_"+$this.options.frameName+"' name='"+prefix+taboption.tabid+"_iframepage' frameBorder='0' scrolling='yes' width='100%' height='100%'></iframe></div>"}index=index>(tabLength+1)?(tabLength+1):index;var tabIndex=index-1;if(!this._beforeAddTab(taboption)){return}if(index>tabLength){$this.navContainer.children(":last").before(tabli);$this.panelContainer.append(tabdiv)}else{$this.navContainer.children(":eq("+tabIndex+")").before(tabli);$this.panelContainer.children(":eq("+tabIndex+")").before(tabdiv)}if((this.options.orientation=="top"||this.options.orientation=="bottom")){this.navContainer.children(":eq("+(index-1)+")").addClass("jazz-tabview-tabalign-"+this.options.tabalign);this.panelContainer.children(":eq("+(index-1)+")").css({width:this.options.calculateinnerwidth,height:this.options.calculateinnerheight-this.tabsHeaderHeight})}else{this.panelContainer.children(":eq("+(index-1)+")").css({width:this.options.calculateinnerwidth-this.tabsHeaderWidth,height:this.options.calculateinnerheight})}this.navContainer.children(":eq("+tabIndex+")").css({width:this.options.tabtitlewidth});$this.select(tabIndex);if(this.options.overflowtype==2){this._computeTabsHeader()}else{if(this.options.overflowtype==1){this._computeTabsHeaderMore()}}},addTabCustom:function(index,tabid,tabname,taburl){if($("#"+tabid).length>0){var tabindex=0;this.panelContainer.children().each(function(i){var id=$(this).attr("id");if(tabid==id){tabindex=i}});this.select(tabindex)}else{var tablength=this.getLength();if(index>tablength){index=tablength-1}if(index<0){index=0}var tabli="<li><div class ='nav-content-left'></div><div class ='nav-content-right'><span class='jazz-icon-close nav-close'></span></div><a style='width:"+this.tempwidth+"px;' class='nav-content-middle' href='#"+tabid+"'>"+tabname+"</a></li>";var tabdiv="<div id='"+tabid+"'>"+tabname+"</div>";if(taburl!=null&&taburl!=""){tabdiv="<div id='"+tabid+"'><iframe src='"+taburl+"' id='"+this.options.frameName+"' name='iframepage' frameBorder='0' scrolling='yes' width='100%' height='100%'></iframe></div>"}this.navContainer.children(":eq("+index+")").before(tabli);this.panelContainer.children(":eq("+index+")").before(tabdiv);tabli=this.navContainer.find("li:eq("+index+")");tabdiv=this.panelContainer.find("div:eq("+index+")");this.navContainer.children(":not(:eq("+index+"))").removeClass("jazz-tabview-selected  jazz-state-active");this.panelContainer.children(":not(:eq("+index+"))").css({"margin-left":"-3000px","z-index":"-1000"});tabli.addClass("jazz-tabview-default jazz-tabview-selected jazz-state-active").css("width",this.options.tabtitlewidth);if((this.options.orientation=="top"||this.options.orientation=="bottom")){this.navContainer.children(":eq("+(index)+")").addClass("jazz-tabview-tabalign-"+this.options.tabalign);tabdiv.addClass("jazz-tabview-panel jazz-widget-content").css({width:this.options.calculateinnerwidth,height:this.options.calculateinnerheight-this.tabsHeaderHeight})}else{tabdiv.addClass("jazz-tabview-panel jazz-widget-content").css({width:this.options.calculateinnerwidth-this.tabsHeaderWidth,height:this.options.calculateinnerheight})}var $this=this;tabli.off("click.tab").on("click.tab",function(e){var element=$(this);if($(e.target).is(":not(.jazz-icon-close)")){var index=element.index();if(!element.hasClass("jazz-state-disabled")&&index!=$this.options.selected){$this.select(index)}}e.preventDefault()});this.select(tablength);this._computeTabsHeader()}},_isOnScreen:function(index){var win=this.tabsHeader,viewport={top:win.scrollTop(),left:win.scrollLeft()},ele=this.navContainer.children(":eq("+index+")"),eleHeight=ele.outerHeight(true),eleWidth=ele.outerWidth(true),orientation=this.options.orientation,tabalign=this.options.tabalign,scrollNum=0;viewport.right=viewport.left+win.width();viewport.bottom=viewport.top+win.height();var bounds=ele.offset();bounds.right=bounds.left+ele.outerWidth();bounds.bottom=bounds.top+ele.outerHeight();if(/(left|right)/i.test(orientation)){if(viewport.bottom<bounds.bottom){scrollNum=this.tabswrapContainer.scrollTop()+bounds.bottom-viewport.bottom;return{scrollNum:scrollNum,direction:"scrollTop"}}if(viewport.top>bounds.top){scrollNum=viewport.top;return{scrollNum:scrollNum,direction:"scrollTop"}}}if(/(top|bottom)/i.test(orientation)){if(viewport.left>bounds.left){scrollNum=viewport.left;if(tabalign=="right"){scrollNum=(this.tabswrapContainer.scrollLeft()-Math.abs(viewport.left-bounds.left))}return{scrollNum:scrollNum,direction:"scrollLeft"}}if(viewport.right<bounds.right){scrollNum=(this.tabswrapContainer.scrollLeft()+bounds.right-viewport.right);if(tabalign=="right"){scrollNum=(this.tabswrapContainer.scrollLeft()+(bounds.right-viewport.right))}return{scrollNum:scrollNum,direction:"scrollLeft"}}}return true},_setOption:function(key,value){this._super(key,value);if("width"==key||"height"==key){this._tabsPositionInit()}},_setOptions:function(options){this._super(options)},getLength:function(){return this.navContainer.children().length-1},getActiveIndex:function(){return this.options.selected},_markAsLoaded:function(panel){panel.data("loaded",true)},_isLoaded:function(panel){return panel.data("loaded")===true},disable:function(index){this.navContainer.children().eq(index).addClass("jazz-state-disabled");this.navContainer.children().eq(index).find(".jazz-icon-close").off("click.tab").on("click.tab",function(e){e.stopPropagation()})},enable:function(index){this.navContainer.children().eq(index).removeClass("jazz-state-disabled")}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Validator","../jazz.Tooltip"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.field",$.jazz.boxComponent,{options:{defaultvalue:"",disabled:false,editable:true,isrule:true,label:"",labelalign:"right",labelwidth:"",labelsplit:":",prefix:"",readonly:false,rule:"",ruletype:0,suffix:"",tooltip:"",valuetip:""},_create:function(){this._super();var el=this.element;if(this.element.prop("disabled")){this.element.removeAttr("disabled")}this.compId=this.getCompId();el.addClass("jazz-field-comp").addClass("jazz-"+this.options.vtype+"-comp");var comp='<label id="'+this.compId+'_label" class="jazz-field-comp-label jazz-form-text-label" for="'+this.compId+'_input"></label><div id="'+this.compId+'_out" class="jazz-field-comp-out"><div id="'+this.compId+'_in" class="jazz-field-comp-in jazz-field-comp-in2"><span id="'+this.compId+'_prefix" class="jazz-field-comp-prefix"></span><div id="'+this.compId+'_frame" class="jazz-field-input-frame"><label id="'+this.compId+'_editor" class="jazz-form-text-label" style="display:none"></label></div><span id="'+this.compId+'_suffix" class="jazz-field-comp-suffix"></span></div><div id="'+this.compId+'_r" class="jazz-field-comp-r jazz-helper-hidden"></div></div>';el.append(comp);this.label=$("#"+this.compId+"_label");this.grandpa=$("#"+this.compId+"_out");this.parent=$("#"+this.compId+"_in");this.inputFrame=$("#"+this.compId+"_frame");this.inputview=$("#"+this.compId+"_editor");this.prefix=$("#"+this.compId+"_prefix");this.suffix=$("#"+this.compId+"_suffix");this.ruleImg=$("#"+this.compId+"_r");this.ruleAreaWidth=jazz.config.ruleImgWidth;this.arrowwidth=jazz.config.fieldIconWidth},_init:function(){this._super();this.options.isverify=true;this._formpanel();this._label();this._labelalign();this._labelwidth();this._prefix();this._suffix();this._tooltip();this._defaultvalue();this._valuetip();this._rule();this._editable();this._disabled();if(this.options.vtype=="hiddenfield"){this.element.hide()}this.isInputBox=this._filterVtype();this._width();this._height();this._readonly()},_defaultvalue:function(){var value=this.options.defaultvalue;if(value||value===0){this.setValue(value)}},_disabled:function(){if(this.options.vtype!="hiddenfield"){if(this.options.disabled==true||this.options.disabled=="disabled"){this.inputtext.attr("disabled","disabled");this.inputtext.addClass("jazz-field-disabled");this.options.isrule=false}else{if(this.inputtext.prop("disabled")){this.inputtext.removeAttr("disabled");this.inputtext.removeClass("jazz-field-disabled")}this.options.isrule=true}}},_editable:function(){if(this.options.editable==false){this.inputtext.attr("readonly","true")}else{this.inputtext.removeAttr("readonly")}},_formpanel:function(){var compParent=this.getParentComponent(),dataview=false,readonly=false;compParent=$(compParent);if(compParent.attr("vtype")==="formpanel"){var formpanel=compParent.data("formpanel");dataview=formpanel.options.dataview;readonly=formpanel.options.readonly}if(dataview=="true"||dataview==true||readonly=="true"||readonly==true){var b=this.element.attr("readonly")?false:true;if(b){this.options.readonly=true}}},_filterVtype:function(){var vtype=this.options.vtype;if(vtype!="radiofield"&&vtype!="checkboxfield"&vtype!="hiddenfield"&&vtype!="attachment"){return true}else{return false}},_height:function(){var height=this.options.height;this.options.height=height!=-1?height:jazz.config.fieldDefaultHeight;this._super();if(this.iscalculateheight){this._heightContent()}},_heightContent:function(){var bw=this.parent.css("border-bottom-width");if(bw){bw=bw.substring(0,1)}else{bw=0}if(this.isInputBox){this.inputtext.outerHeight(this.options.calculateinnerheight-parseInt(bw)*2)}else{this.parent.css("border","0px")}},_label:function(){var label=this.options.label||"";if(label){this.label.css({display:"block"});var newlabel=label+this.options.labelsplit;this.label.html(newlabel)}else{this.label.css({display:"none"})}},_labelalign:function(){if(this.options.label){var labelalign=this.options.labelalign;var align=["left","center","right"];if($.inArray(labelalign,align)>=0){this.label.css({"text-align":labelalign})}else{this.label.css({"text-align":"right"})}}},_labelwidth:function(){if(this.options.label){var labelwidth=this.options.labelwidth||jazz.config.fieldLabelWidth||80;this.label.outerWidth(labelwidth)}},_labelsplit:function(){this._label()},_prefix:function(){var prefix=this.options.prefix;if(!prefix){this.prefix.css({display:"none"})}else{this.prefix.css({display:"block"}).html(prefix)}},_readonly:function(){if(this.options.readonly==true){this.parent.removeClass("jazz-field-comp-in2");this.inputtext.css({display:"none"});this.inputview.css({display:"block"});var text=this.inputtext.val();if(text==this.options.valuetip){this.inputview.html("&nbsp;")}else{this.inputview.html(text||"&nbsp;")}}else{this.inputview.css({display:"none"});this.inputtext.css({display:"block"});this.parent.addClass("jazz-field-comp-in2")}},_rule:function(){var rule=this.options.rule,label=this.options.label;if(rule){this.options.isrule=true}else{this.options.isrule=false}if(label){var x=this.label.find("font").html()||"";var f=false;if(x=="*"){f=false}else{f=true}rule=(rule+"").indexOf("must");if(rule>=0&&f){this.label.prepend("<font color='red'>*</font>")}else{if(rule<0&&!f){this.label.find("font").remove()}}}},_setOption:function(key,value){switch(key){case"height":this.options.height=value;this._height();break;case"width":this.options.width=value;this._width();break;case"defaultvalue":this.options.defaultvalue=value;this._defaultvalue(value);break;case"editable":this.options.editable=value;this._editable();break;case"readonly":this.options.readonly=value;this._readonly();break;case"rule":this.options.rule=value;this._rule();if(value){this._validator()}else{this._validatoroff();this.verify()}break;case"ruletype":this.options.ruletype=value;this._widthInner();var b=this.verify();this._validateStyle(b);break;case"prefix":this.options.prefix=value;this._prefix();this._widthContent();break;case"suffix":this.options.suffix=value;this._suffix();this._widthContent();break;case"tooltip":this.options.tooltip=value;this._tooltip();break;case"disabled":this.options.disabled=value;this._disabled();break;case"valuetip":var oldtip=this.options.valuetip;this.options.valuetip=value;this._valuetip(true,oldtip);break;case"label":this.options.label=value;this._label();this._labelalign();this._labelwidth();this._width();break;case"labelalign":this.options.labelalign=value;this._labelalign();break;case"labelwidth":this.options.labelwidth=value;this._labelwidth();this._width();break;case"labelsplit":this.options.labelsplit=value;this._labelsplit();break}this._super(key,value)},_setInputview:function(value){var val=value;if(val===""||val==undefined){val=""}if(this.options.blanktext!=val&&this.options.valuetip!=val){this.inputview.html(val+"&nbsp;")}else{this.inputview.html("&nbsp;")}},_suffix:function(){var suffix=this.options.suffix;if(!suffix){this.suffix.css({display:"none"})}else{this.suffix.css({display:"block"}).html(suffix)}},_tooltip:function(){if(this.options.tooltip){var $this=this;this.element.tooltip({showevent:"mousedown",hideevent:"blur",content:$this.options.tooltip||"",position:$this.options.tooltipposition||0})}},_validatoroff:function(){var vtype=this.options.vtype;this.inputtext.off("keyup.rule blur.rule");if("datefield"===vtype){this.element.off("datefielditemselect.rule")}else{if("numberfield"===vtype){this.upArrows.off("click.ruleUp");this.downArrows.off("click.ruleDown")}}},_validateStyle:function(state){if(this.options.ruletype=="0"){if(state==false){this.parent.css("width",this.parentwidth-this.ruleAreaWidth);this.inputFrame.css("width",this.framewidth-this.ruleAreaWidth);if(this.isInputBox){this.inputtext.outerWidth(this.inputFrame.width())}}else{this.parent.css("width",this.parentwidth);this.inputFrame.css("width",this.framewidth);if(this.isInputBox){this.inputtext.outerWidth(this.framewidth)}}}},_validator:function(){var $this=this;var vtype=this.options.vtype;if(this.options.rule){if("textfield"===vtype||"textareafield"===vtype||"comboxfield"===vtype||"datefield"===vtype||"comboxtreefield"===vtype||"numberfield"===vtype||"passwordfield"===vtype||"autocompletecomboxfield"===vtype){var keyuptimeout,blurtimeout;this.inputtext.off("keyup.rule blur.rule").on("keyup.rule",function(){if(keyuptimeout){window.clearTimeout(keyuptimeout)}keyuptimeout=setTimeout(function(){var val=$this.getText();var state=jazz.doTooltip($this,val,$this.options.rule,$this.options.msg);$this._validateStyle(state)},500)}).on("blur.rule",function(){if(blurtimeout){window.clearTimeout(blurtimeout)}blurtimeout=setTimeout(function(){var val=$this.getText();var state=jazz.doTooltip($this,val,$this.options.rule,$this.options.msg);$this._validateStyle(state)},500)})}if("datefield"===vtype){var vtime;this.element.off("datefielditemselect.rule").on("datefielditemselect.rule",function(){if(vtime){window.clearTimeout(vtime)}vtime=setTimeout(function(){var val=$this.getText();var state=jazz.doTooltip($this,val,$this.options.rule,$this.options.msg);$this._validateStyle(state)},500)})}if("numberfield"===vtype){var uptimeout;this.upArrows.off("click.ruleUp").on("click.ruleUp",function(){if(uptimeout){window.clearTimeout(uptimeout)}uptimeout=setTimeout(function(){var val=$this.getText();var state=jazz.doTooltip($this,val,$this.options.rule,$this.options.msg);$this._validateStyle(state)},100)});this.downArrows.off("click.ruleDown").on("click.ruleDown",function(){if(uptimeout){window.clearTimeout(uptimeout)}uptimeout=setTimeout(function(){var val=$this.getText();var state=jazz.doTooltip($this,val,$this.options.rule,$this.options.msg);$this._validateStyle(state)},100)})}if("colorfield"===vtype){var colortimeout;this.inputtext.off("blur.rule").on("blur.rule",function(){if(colortimeout){window.clearTimeout(colortimeout)}colortimeout=setTimeout(function(){var val=$this.getText();var state=jazz.doTooltip($this,val,$this.options.rule,$this.options.msg);$this._validateStyle(state)},200)})}}},_valuetip:function(opt,oldtip){var valuetip=this.options.valuetip;if(opt){var value=this.inputtext.val();if(value==""||value==oldtip){this.inputtext.val(valuetip);this.inputtext.addClass("jazz-field-comp-input-tip")}}else{if(!this.options.defaultvalue&&valuetip){this.inputtext.val(valuetip);this.inputtext.addClass("jazz-field-comp-input-tip")}}},_width:function(){var width=this.options.width;this.options.width=width!=-1?width:jazz.config.fieldDefaultWidth;this._super();if(this.iscalculatewidth){this._widthInner()}},_widthInner:function(){var labelWidth=0;if(this.label.css("display")=="block"){labelWidth=this.label.outerWidth()+5}var ruletype=this.options.ruletype;var innerwidth=this.options.calculateinnerwidth;var iew=1;this.grandpa.outerWidth(innerwidth-labelWidth-iew);var iDivWidth=0;if(ruletype==1){iDivWidth=innerwidth-labelWidth-this.ruleAreaWidth}else{iDivWidth=innerwidth-labelWidth}this.parent.outerWidth(iDivWidth-iew);this._widthContent()},_widthContent:function(){var prefixWidth=0,suffixWidth=0;this.parentwidth=this.parent.width();if(this.options.prefix){prefixWidth=this.prefix.outerWidth()}if(this.options.suffix){suffixWidth=this.suffix.outerWidth()}var vtype=this.options.vtype;if(vtype=="datefield"||vtype=="comboxfield"||vtype=="numberfield"||vtype=="comboxtreefield"||vtype=="colorfield"){this.inputFrame.css({"padding-left":prefixWidth,"padding-right":suffixWidth});this.inputFrame.outerWidth(this.parentwidth-this.arrowwidth);if(this.options.suffix){this.suffix.css("right",this.arrowwidth+"px")}}else{this.inputFrame.css({"padding-left":prefixWidth,"padding-right":suffixWidth});this.inputFrame.outerWidth(this.parentwidth)}this.framewidth=this.inputFrame.width();if(this.isInputBox){this.inputtext.outerWidth(this.framewidth)}},getText:function(){var value=this.inputtext.val()||"";if(value==this.options.valuetip||value==this.options.blanktext){value=""}return value},getValue:function(){var value=this.input.val();if(value==this.options.valuetip){value=""}return value},reset:function(){this.input.val("");if(this.options.valuetip){this.inputtext.val(this.options.valuetip).addClass("jazz-field-comp-input-tip")}else{this.inputtext.val("")}this.inputview.text("")},setText:function(text){var val=text;if(val===""||val==undefined){val=""}var valuetip=this.options.valuetip;if(valuetip!=""&&valuetip==val){this.inputtext.val(val).addClass("jazz-field-comp-input-tip")}else{this.inputtext.val(val).removeClass("jazz-field-comp-input-tip")}this._setInputview(val)},setValue:function(value){var val=value;if(val===""||val==undefined){val=""}this.input.val(val).removeClass("jazz-field-comp-input-tip");this._setInputview(val)},verify:function(){var isverify=this.options.isverify?true:false;return isverify}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.Field"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.textfield",$.jazz.field,{options:{vtype:"textfield",maxlength:null,change:null,enter:null,keyup:null},_create:function(){this._super();this._createElements()},_createElements:function(){this.inputtext=this.input=$('<input id="'+this.compId+'_input" class="jazz-field-comp-input" type="text" name="'+this.options.name+'" autocomplete="off">').appendTo(this.inputFrame)},_init:function(){this._super();this._bindEvent();this._validator()},_bindEvent:function(){var $this=this;this.inputtext.off("focus.textfield blur.textfield keyup.textfield").on("focus.textfield",function(){if($(this).val()==$this.options.valuetip){$(this).val("");$(this).removeClass("jazz-field-comp-input-tip")}$this.inputValue=$this.inputtext.val();$this._event("enter",null,{newValue:$this.inputValue})}).on("blur.textfield",function(){var value=$(this).val();if(value==""&&$this.options.valuetip){$(this).val($this.options.valuetip);$(this).removeClass("jazz-field-comp-input-tip").addClass("jazz-field-comp-input-tip")}var ui={newValue:value||"",oldValue:$this.inputValue||""};$this._event("change",null,ui)}).on("keyup.textfield",function(e){setTimeout(function(){var text=$this.inputtext.val(),length=text.length;var maxlength=$this.options.maxlength;if(maxlength){if(length>maxlength){text=text.substr(0,maxlength);$this.inputtext.val(text)}}$this._event("keyup",null,{newValue:text})},500)})}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.TextField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.textareafield",$.jazz.textfield,{options:{vtype:"textareafield",prefixposition:0},_create:function(){this._super()},_createElements:function(){this.inputtext=this.input=$('<textarea id="'+this.compId+'_input" class="jazz-textarea-resize jazz-field-comp-input" type="text" name="'+this.options.name+'" autocomplete="off" ></textarea>').appendTo(this.inputFrame);var prefixposition=jazz.config.prefixPosition;if(prefixposition){this.options.prefixposition=prefixposition}},_init:function(){this._super()},_heightContent:function(){var bw=this.parent.css("border-bottom-width");if(bw){bw=bw.substring(0,1)}else{bw=0}var innerheight=this.options.calculateinnerheight;var preH=0,sufH=0;if(this.options.prefixposition=="1"){if(this.options.prefix){preH=this.prefix.outerHeight();this.inputFrame.css("padding-top",preH)}if(this.options.suffix){sufH=this.suffix.outerHeight();this.inputFrame.css("padding-bottom",sufH);this.suffix.removeClass("jazz-field-comp-suffix").addClass("jazz-field-comp-suffix2")}var _h=innerheight-parseInt(bw)*2-preH-sufH;this.inputtext.outerHeight(_h)}else{this.inputFrame.css({"padding-top":0,"padding-bottom":0});this.suffix.removeClass("jazz-field-comp-suffix2").addClass("jazz-field-comp-suffix");this.inputtext.outerHeight(innerheight-parseInt(bw)*2)}},_setOption:function(key,value){switch(key){case"prefixposition":this.options.prefixposition=value;this._widthContent();this._heightContent();break}this._super(key,value)},_widthContent:function(){var prefixWidth=0,suffixWidth=0,prefixposition=this.options.prefixposition;this.parentwidth=this.parent.width();if(this.options.prefix){if(prefixposition==1){prefixWidth=this.parentwidth}else{prefixWidth=this.prefix.outerWidth()}}if(this.options.suffix){if(prefixposition==1){suffixWidth=this.parentwidth}else{suffixWidth=this.suffix.outerWidth()}}if(prefixposition==1){this.inputFrame.css({"padding-left":0,"padding-right":0});this.inputFrame.outerWidth(this.parentwidth)}else{this.inputFrame.css({"padding-left":prefixWidth,"padding-right":suffixWidth});this.inputFrame.outerWidth(this.parentwidth)}this.framewidth=this.inputFrame.width();this.inputtext.outerWidth(this.framewidth)}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.Field"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.hiddenfield",$.jazz.field,{options:{vtype:"hiddenfield",delay:300,delaycount:30000},_create:function(){this._super();this.inputtext=this.input=$('<input type="hidden" id="'+this.compId+'_input" name="'+this.options.name+'" >').appendTo(this.inputFrame)},_init:function(){this._super()},_ajax:function(cacheflag,callbackfunction){var $this=this;var i=1,delay=$this.options.delay,delaycount=$this.options.delaycount;try{var timeout=setInterval(function(){var status=false;data=G.getPageDataSetCache($this.options.dataurl,$this.options.dataurlparams,cacheflag);if(data&&data.status==="success"){clearInterval(timeout);var d=data.data;if(jazz.config.platForm=="other"){$.each(d,function(i,sondata){d=sondata.data})}$this._callback(d);if($.isFunction(callbackfunction)){callbackfunction.call(this,d)}status=true}i++;if(status||delay*i>delaycount){clearInterval(timeout)}},delay)}catch(e){}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.HiddenField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.checkboxfield",$.jazz.hiddenfield,{options:{vtype:"checkboxfield",dataurl:[],itemwidth:100,itemselect:null},_create:function(){this._super();var vtype=this.options.vtype;if(vtype=="checkboxfield"){this.checkfield="checkbox"}else{this.checkfield="radio"}},_init:function(){this._dataItems();this._super();this._bindEvents()},_bindEvents:function(){var $this=this;if((this.options.disabled!=true&&this.options.disabled!="disabled")&&this.options.editable==true){this.parent.off("click.checkboxfield").on("click.checkboxfield",function(e){var target=e.target,$target=$(target);var boxid=$target.attr("id");boxid=boxid.substring(0,boxid.length-5);var boxObj=$("#"+boxid);if($target.is("span")){$this._toggle(boxObj,$target,e)}if($target.is("label")){span=$("#"+boxid+"_span");if(boxObj.prop("checked")){boxObj.prop("checked",false);$this._nocheckImg(span)}else{boxObj.prop("checked",true);$this._checkImg(span)}$this._event("itemselect",e,{checked:!$this._isChecked(boxObj),text:boxObj.attr("text"),value:boxObj.val()})}})}},_callback:function(data){if(data){this._commonDom(data,this.compId)}if(this.callbackFunc){this.callbackFunc.call(this,this.getValue())}},_checked:function(box,spanObj){box.prop("checked",true);this._checkImg(spanObj)},_checkImg:function(obj){obj.removeClass("jazz-"+this.checkfield+"-nochecked").addClass("jazz-"+this.checkfield+"-checked")},_commonDom:function(items,compId){this.parent.addClass("jazz-field-comp-in-check");this.compIdspan=compId;var name=this.options.name;var div='<div class="jazz-checkbox-frame">';if(items&&items.length>0){var $this=this;this.checkItems=[];var disabled="";if($this.options.disabled==true||$this.options.editable==false){disabled=' disabled="false" '}$.each(items,function(i,item){var id=compId+"_box_"+item.value;$this.checkItems.push(id);var chkedspan=" jazz-"+$this.checkfield+"-nochecked ",chkedtext="";if(item.checked=="true"||item.checked){chkedspan=" jazz-"+$this.checkfield+"-checked ";chkedtext=" checked='true' "}div=div+'<div index="'+i+'" class="jazz-field-comp2 jazz-checkbox-item" style="width: '+$this.options.itemwidth+'px;"><div class="jazz-checkbox-hidden"><input type="'+$this.checkfield+'" id="'+id+'" text="'+item.text+'" name="'+name+'" '+chkedtext+' value="'+item.value+'" '+disabled+'/></div><span id="'+id+'_span" class="jazz-checkbox '+chkedspan+'"></span><div style="padding-left: 25px"><label id="'+id+'label" class="jazz-checkbox-label">'+item.text+"</label></div></div>"})}div+='<div class="jazz-field-clear"></div></div>';this.inputFrame.append(div)},_dataItems:function(){this.inputFrame.children(".jazz-checkbox-frame").remove();if(typeof(this.options.dataurl)=="string"&&/^\s*[\[|{](.*)[\]|}]\s*$/.test(this.options.dataurl)){this.options.dataurl=jazz.stringToJson(this.options.dataurl)}if(typeof(this.options.dataurl)=="object"&&jazz.isArray(this.options.dataurl)){this._commonDom(this.options.dataurl,this.compId);if(this.callbackFunc){this.callbackFunc.call(this,this.getValue())}}else{this._ajax()}},_defaultvalue:function(){var value=this.options.defaultvalue;if(value||value===0){var $this=this;$.each(this.checkItems,function(i,data){$this.inputFrame.find("input[id='"+data+"']").removeAttr("checked");var span=$("#"+data+"_span");span.removeClass("jazz-"+$this.checkfield+"-checked").addClass("jazz-"+$this.checkfield+"-nochecked")});$.each((value+"").split(","),function(i,data){$this.inputFrame.find("input[value='"+data+"']").attr("checked","true");var span=$("#"+$this.compIdspan+"_box_"+data+"_span");span.removeClass("jazz-"+$this.checkfield+"-nochecked").addClass("jazz-"+$this.checkfield+"-checked")});this.inputview.text(this.getText())}},_disabled:function(){if(this.options.disabled==true||this.options.disabled=="disabled"){this.inputFrame.children(".jazz-checkbox-frame").addClass("jazz-field-disabled");this.parent.off("click.checkboxfield")}else{this.inputFrame.children(".jazz-checkbox-frame").removeClass("jazz-field-disabled");this._bindEvents()}},_editable:function(){if(this.options.editable==false||this.options.editable=="false"){this.parent.off("click.checkboxfield")}else{this._bindEvents()}},_height:function(){this.parent.css("border","0px")},_isChecked:function(box){return box.prop("checked")},_itemwidth:function(){var itemwidth=this.options.itemwidth;if(itemwidth){this.inputFrame.find(".jazz-checkbox-item").outerWidth(itemwidth)}},_nocheckImg:function(obj){obj.removeClass("jazz-"+this.checkfield+"-checked").addClass("jazz-"+this.checkfield+"-nochecked")},_readonly:function(){if(this.options.readonly==true){this.inputFrame.children(".jazz-checkbox-frame").css({display:"none"});this.inputview.css({display:"block"});this.inputview.html(this.getText()||"")}else{this.inputview.css({display:"none"});this.inputFrame.children(".jazz-checkbox-frame").css({display:"block"})}},_setOption:function(key,value){switch(key){case"itemwidth":this.options.itemwidth=value;this._itemwidth();break}this._super(key,value)},_toggle:function(box,spanObj,event){if(this._isChecked(box)){this._unchecked(box,spanObj)}else{this._checked(box,spanObj)}this._event("itemselect",event,{checked:this._isChecked(box),text:box.attr("text"),value:box.val()})},_unchecked:function(box,spanObj){box.prop("checked",false);this._nocheckImg(spanObj)},getText:function(){var name=this.options.name;var chkvalue=new Array();this.parent.find("input[name='"+name+"']:checked").each(function(){chkvalue.push($(this).attr("text"))});return chkvalue.join(",")},getValue:function(){var name=this.options.name;var chkvalue=new Array();this.parent.find("input[name='"+name+"']:checked").each(function(){chkvalue.push($(this).val())});return chkvalue.join(",")},reload:function(data,func){this.callbackFunc=func;this._dataItems()},reset:function(){for(var i=0,len=this.checkItems.length;i<len;i++){var obj=$("#"+this.checkItems[i]+"");var span=$("#"+this.checkItems[i]+"_span");span.removeClass("jazz-"+this.checkfield+"-checked").addClass("jazz-"+this.checkfield+"-nochecked");obj.attr("checked",false)}},setValue:function(value){var $this=this;$.each((value+"").split(","),function(i,data){$this.parent.find("input[value='"+data+"']").attr("checked","true");var span=$("#"+$this.compIdspan+"_box_"+data+"_span");span.removeClass("jazz-checkbox-nochecked").addClass("jazz-checkbox-checked")});this.inputview.text(this.getText()||"")}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.CheckboxField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.radiofield",$.jazz.checkboxfield,{options:{vtype:"radiofield"},_create:function(){this._super()},_init:function(){this._super()},_bindEvents:function(){var $this=this;if(this.options.disabled!=true&&this.options.editable==true){this.parent.off("click.checkboxfield").on("click.checkboxfield",function(e){var target=e.target,$target=$(target);if($target.is("span")){var boxid=$target.attr("id");boxid=boxid.substring(0,boxid.length-5);var box=$("#"+boxid);if(!$this._isChecked(box)){$this._nocheckAllImg()}$this._toggle(box,$target,e)}if($target.is("label")){var boxid=$target.attr("for");var box=$("#"+boxid),span=$("#"+boxid+"_span");if(!$this._isChecked(box)){$this._nocheckAllImg();$this._checked(box,span)}$this._event("itemselect",e,{checked:true,text:box.attr("text"),value:box.val()})}})}},_nocheckAllImg:function(){for(var i=0,len=this.checkItems.length;i<len;i++){var span=$("#"+this.checkItems[i]+"_span");span.removeClass("jazz-radio-checked").addClass("jazz-radio-nochecked")}},_toggle:function(box,spanObj,event){if(!this._isChecked(box)){this._checked(box,spanObj)}this._event("itemselect",event,{checked:true,text:box.attr("text"),value:box.val()})},getValue:function(){var name=this.options.name;return this.parent.find("input[name='"+name+"']:checked").val()||""},setValue:function(value,name){this.reset();var $this=this;$.each((value+"").split(","),function(i,data){$this.parent.find("input[value='"+data+"']").attr("checked","true");var span=$("#"+$this.compIdspan+"_box_"+data+"_span");span.removeClass("jazz-radio-nochecked").addClass("jazz-radio-checked")});this.inputview.text(this.getText()||"")}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.HiddenField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.passwordfield",$.jazz.hiddenfield,{options:{vtype:"passwordfield",goodlabel:"中",passwordtip:false,promptlabel:jazz.config.i18n.password,stronglabel:"强",weaklabel:"弱"},_create:function(){this._super();this.input=this.inputtext=$('<input id="'+this.compId+'_input" class="jazz-field-comp-input" type="password" name="'+this.options.name+'" autocomplete="off" >').appendTo(this.inputFrame);this._passwordtip()},_init:function(){this._super();this._bindEvents();this._validator()},_valuetip:function(){},_align:function(){this.panel.css({left:"",top:"","z-index":++jazz.zindex}).position({my:"left top",at:"right top",of:this.parent})},_bindEvents:function(){if(this.options.passwordtip==true){var $this=this;this.inputtext.off("focus.passwordfield blur.passwordfield keyup.passwordfield").on("focus.passwordfield",function(){if($this.options.passwordtip=="true"||$this.options.passwordtip==true){$this.infoText.text($this.options.promptlabel)}$this.showTip()}).on("blur.passwordfield",function(){$this.hideTip()}).on("keyup.passwordfield",function(){var value=$this.inputtext.val(),label=null,meterPos=null;if(value.length===0){label=$this.options.promptlabel;meterPos="0px 0px"}else{var score=$this._testStrength($this.inputtext.val());if(score<30){label=$this.options.weaklabel;meterPos="0px -10px"}else{if(score>=30&&score<80){label=$this.options.goodlabel;meterPos="0px -20px"}else{if(score>=80){label=$this.options.stronglabel;meterPos="0px -30px"}}}}$this.meter.css("background-position",meterPos);$this.infoText.text(label);$this._align()})}},_passwordtip:function(){if(!this.element.prop(":disabled")&&this.options.passwordtip==true){var panelMarkup='<div class="jazz-password-panel jazz-state-highlight jazz-helper-hidden">';panelMarkup+='<div class="jazz-password-meter" style="background-position:0px 0px"></div>';panelMarkup+='<div class="jazz-password-info">'+this.options.promptlabel+"</div>";panelMarkup+="</div>";this.panel=$(panelMarkup).insertAfter(this.element);this.meter=this.panel.children("div.jazz-password-meter");this.infoText=this.panel.children("div.jazz-password-info");if(this.options.inline){this.panel.addClass("jazz-password-panel-inline")}else{this.panel.addClass("jazz-password-panel-overlay").appendTo("body")}}},_normalize:function(x,y){var diff=x-y;if(diff<=0){return x/y}else{return 1+0.5*(x/(x+y/4))}},_setOption:function(key,value){switch(key){case"passwordtip":this.options.passwordtip=value;if(value==true){this._passwordtip();this._bindEvents()}else{if(this.panel){this.inputtext.off("focus.passwordfield blur.passwordfield keyup.passwordfield");this.panel.hide()}}break}this._super(key,value)},_testStrength:function(str){var grade=0,val=0,$this=this;val=str.match("[0-9]");grade+=$this._normalize(val?val.length:1/4,1)*25;val=str.match("[a-zA-Z]");grade+=$this._normalize(val?val.length:1/2,3)*10;val=str.match("[!@#$%^&*?_~.,;=]");grade+=$this._normalize(val?val.length:1/6,1)*35;val=str.match("[A-Z]");grade+=$this._normalize(val?val.length:1/6,1)*30;grade*=str.length/8;return grade>100?100:grade},hideTip:function(){if(this.options.inline){this.panel.slideUp()}else{this.panel.fadeOut()}},showTip:function(){if(!this.options.inline){this._align();this.panel.fadeIn()}else{this.panel.slideDown()}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.HiddenField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.iconfield",$.jazz.hiddenfield,{options:{vtype:"iconfield"},_create:function(){this._super();this.inputtext=$('<input id="'+this.compId+'_text" class="jazz-field-comp-input" type="text" autocomplete="off">').appendTo(this.inputFrame)},_init:function(){this._super()},_readonly:function(){if(this.options.readonly==true){this.parent.removeClass("jazz-field-comp-in2");this.inputtext.css({display:"none"});this.inputview.css({display:"block"});var text=this.inputtext.val();if(this.options.vtype=="colorfield"){text=this.inputview.attr("value")}if(text==this.options.valuetip){this.inputview.html("&nbsp;")}else{this.inputview.html(text||"&nbsp;")}this.parent.children(".jazz-field-icon").css({display:"none"});this.arrowwidth=0;this._widthContent()}else{this.inputview.css({display:"none"});this.inputtext.css({display:"block"});this.parent.addClass("jazz-field-comp-in2");this.parent.children(".jazz-field-icon").css({display:"block"});this.arrowwidth=jazz.config.fieldIconWidth;this._widthContent()}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.IconField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.numberfield",$.jazz.iconfield,{options:{vtype:"numberfield",max:null,min:null,step:1,change:null},_create:function(){this._super();this.parent.append('<a class="jazz-field-icon jazz-number-btn jazz-number-btn-up"><span id="'+this.compId+'_up" class="jazz-number-img jazz-number-upImg"></span></a><a class="jazz-field-icon jazz-number-btn jazz-number-btn-down"><span id="'+this.compId+'_down" class="jazz-number-img jazz-number-downImg"></span></a>');this.upArrows=$("#"+this.compId+"_up");this.downArrows=$("#"+this.compId+"_down");this.input=this.inputtext},_init:function(){this._super();this._initValue();var step=this.options.step;step=step||1;if(parseInt(step,10)===0){this.options.precision=step.toString().split(/[,]|[.]/)[1].length}this._bindEvents();this._validator()},_bindEvents:function(){var $this=this;this.parent.children(".jazz-number-btn").off("mouseout.number mouseup.number mousedown.number").on("mouseout.number",function(){if($this.timer){window.clearInterval($this.timer)}}).on("mouseup.number",function(){window.clearInterval($this.timer)}).on("mousedown.number",function(e){var element=$(this),dir=element.hasClass("jazz-number-btn-up")?1:-1;$this.inputtext.focus();$this._repeat(null,dir);e.preventDefault()});this.inputtext.off("keydown.number keyup.number blur.number focus.number").on("keydown.number",function(e){var keyCode=$.ui.keyCode;switch(e.which){case keyCode.UP:$this._spin($this.options.step);break;case keyCode.DOWN:$this._spin(-1*$this.options.step);break}}).on("keyup.number",function(){$this._updateValue()}).on("blur.number",function(){if($this.inputtext.val()===""){$this._valuetip()}else{$this._format()}$this._triggerChange()}).on("focus.number",function(){var value=$(this).val();if(value==$this.options.valuetip){$(this).val("");$(this).removeClass("jazz-field-comp-input-tip")}if(!isNaN(value)){$this._format();$this.oldvalue=$(this).val()}else{$this.oldvalue=""}})},_disabled:function(){this._super();if(this.options.disabled==true||this.options.disabled=="disabled"){this.parent.children(".jazz-number-btn").off("mouseout.number mouseup.number mousedown.number");this.inputtext.off("keydown.number keyup.number blur.number focus.number")}else{this._bindEvents()}},_format:function(){var value=this.value;var newvalue;if(this.options.precision){newvalue=parseFloat(this._toFixed(value,this.options.precision))}else{newvalue=parseInt(value,10)}if((this.options.min||this.options.min===0)&&newvalue<this.options.min){newvalue=this.options.min}if(this.options.max&&newvalue>this.options.max){newvalue=this.options.max}if(isNaN(newvalue)){this._valuetip()}else{this.value=newvalue;this.inputtext.val(newvalue)}},_initValue:function(){var value=this.inputtext.val();if(value===""||(!this.options.defaultvalue&&value==this.options.valuetip)){if(this.options.min||this.options.min===0){this.value=this.options.min}else{this.value=""}}else{if(this.options.step){this.value=parseFloat(value)}else{this.value=parseInt(value,10)}}},_repeat:function(interval,dir){var $this=this,i=interval||500;window.clearTimeout(this.timer);this.timer=window.setTimeout(function(){$this._repeat(40,dir)},i);this._spin(this.options.step*dir)},_setOption:function(key,value){switch(key){case"max":this.options.max=value;break;case"min":this.options.min=value;break;case"step":this.options.step=value;break}this._super(key,value)},_spin:function(step){var newvalue,currentValue=this.value?this.value:0;currentValue=parseInt(currentValue,10);if(this.options.precision){newvalue=parseFloat(this._toFixed(currentValue+step,this.options.precision))}else{newvalue=parseInt(currentValue+step,10)}if((!!this.options.min||this.options.min===0)&&newvalue<this.options.min){newvalue=this.options.min}if(!!this.options.max&&newvalue>this.options.max){newvalue=this.options.max}this.inputtext.val(newvalue);this.value=newvalue},_toFixed:function(value,precision){var power=Math.pow(10,precision||0);return String(Math.round(value*power)/power)},_triggerChange:function(){var newvalue=this.value;var oldvalue=this.oldvalue;var ui={newvalue:newvalue,oldvalue:oldvalue};this._event("change",null,ui)},_updateValue:function(){var value=this.inputtext.val();if(value===""){if(this.options.min||this.options.min===0){this.value=this.options.min}else{this.value=""}}else{if(this.options.step){value=parseFloat(value)}else{value=parseInt(value,10)}if(!isNaN(value)){this.value=value}}},setValue:function(value){this._super(value);if(value===""||value==undefined){value=this.options.min}if(value){this.oldvalue=Number(value);this.value=Number(value)}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.IconField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.dropdownfield",$.jazz.iconfield,{options:{vtype:"dropdownfield",appendTo:null,downheight:200,dataurl:null,dataurlparams:null,editable:true,islazydata:false,maxdownwidth:-1,mindownwidth:-1},_create:function(){this._super();this.trigger=$('<span id="'+this.compId+'_ar" class="jazz-field-icon jazz-field-comp-ar"></span>').appendTo(this.parent);this.datastatus=false;this._createDownpanel()},_init:function(){this._super()},_alignPanel:function(){var vtype=this.options.vtype;if(vtype!="datefield"&&vtype!="colorfield"){var parentwidth=this.parent.width();if(this.options.maxdownwidth>0&&this.options.maxdownwidth>parentwidth){parentwidth=this.options.maxdownwidth}if(this.options.mindownwidth>0&&this.options.mindownwidth<parentwidth){parentwidth=this.options.mindownwidth}this.panel.css("width",parentwidth)}this.panel.css({"z-index":++jazz.zindex}).position({my:"left top",at:"left bottom",of:this.parent,collision:"flipfit"})},_binddropdown:function(){var $this=this;var vtype=this.options.vtype;this.parent.off("mousedown.dropdown").on("mousedown.dropdown",function(e){$this._event("enter",e);var target=e.target,$target=$(target);if($target.is("span")||target==$this.inputtext.get(0)){if(vtype=="comboxfield"){$this._updateSelectItemStyle()}var b=true;if(jazz.isArray($this.dataset)){b=$this.dataset.length>0?true:false}$this._showDropdown(b)}if($.browser.msie){if($this.inputtext.get(0).createTextRange()){var range=$this.inputtext.get(0).createTextRange();range.collapse(false);range.select()}}})},_createDownpanel:function(){var name=this.options.name;var vtype=this.options.vtype;var zindex=++jazz.config.zindex+1000;this.panel=$('<div name="dropdownpanel_'+name+'" type="'+vtype+'"  class="jazz-dropdown-panel jazz-widget-content jazz-helper-hidden jazz-'+vtype+'-panel"/>').appendTo(this.options.appendTo||document.body);this.panel.css("z-index",zindex);this.itemsWrapper=$('<div class="jazz-dropdown-wrapper" />').appendTo(this.panel);if(vtype=="comboxtreefield"){this.resetcomboxtree=$("div[name='reset_comboxtree_"+name+"']");this.ulId="zTree_"+name;this.itemsContainer=$('<ul id="'+this.ulId+'" class="ztree" style="margin-top:0; width:auto;"></ul>').appendTo(this.panel)}else{if(vtype=="datefield"||vtype=="colorfield"){this.itemsContainer=this.itemsWrapper}else{this.itemsContainer=$('<ul class="jazz-dropdown-list jazz-helper-reset"></ul>').appendTo(this.itemsWrapper)}}this.panel.off("mousedown").on("mousedown",function(event){event.stopPropagation()})},_changeData:function(){var _change0=function(v){if(v===0){return v}else{return v||""}};var ui={oldValue:_change0(this._oldValue),oldText:_change0(this._oldText),newValue:_change0(this._newValue),newText:_change0(this._newText)};_change0=null;return ui},_disabled:function(){this._super();if(this.options.disabled==true||this.options.disabled=="disabled"){this.parent.off("mousedown.dropdown")}else{this._binddropdown()}},_dimensionList:function(){if(this.options.filterable){this.filterInput.width(this.filterContainer.width()-20)}},_hideDropdown:function(){this.panel.hide()},_itemScroll:function(){var scrollh=this.options.downheight||200;scrollh=parseInt(scrollh);if(this.panel.height()>scrollh){this.itemsWrapper.outerHeight(scrollh);this.panel.height(scrollh)}},_setValueCallback:function(callback_function){if($.isFunction(callback_function)){callback_function.call(this,null,this._changeData())}},_setValueData:function(value,callback_function){var $this=this;var i=1,delay=100,delaycount=$this.options.delaycount;var timeout=setInterval(function(){var status=$this.datastatus;if(status){if(value!=$this.getValue()){$this.setText("")}$this._setData(value,callback_function)}i++;if(status||delay*i>delaycount){clearInterval(timeout)}},delay)},_showDropdown:function(b){if(b){this.panel.css({position:"absolute",left:"0",top:"0"});this._itemScroll();this.panel.show();this._alignPanel();if(this.options.vtype=="comboxfield"){this._dimensionList()}}else{this.panel.hide()}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.DropdownField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.comboxfield",$.jazz.dropdownfield,{options:{vtype:"comboxfield",cacheflag:true,blanktext:jazz.config.fieldBlankText,casesensitive:false,datarender:null,editable:false,filterable:false,filtermatchmode:"contains",filterfunction:null,isshowblankitem:true,multiple:false,enter:null,change:null,itemselect:null},_create:function(){this._super()},_init:function(){this.blankitem=[],this.dataset=[],this.datakeyvalue={};this._filterable();this._setupFilterMatcher();this._isshowblankitem();this._loaddata();this._super();this._bindEvent();this._validator()},_bindEvent:function(){var $this=this;this.itemsContainer.off("mousedown.comboxfield").on("mousedown.comboxfield",function(e){var t=$(e.target);if(t.is(".jazz-dropdown-list-item a")){$this._selectedItem(e,t);e.stopPropagation()}});this._bindEventFilterInput();this._bindEventInputtext()},_bindEventFilterInput:function(){var $this=this;if(this.options.filterable){this.filterInput.off("keyup.comboxfield").on("keyup.comboxfield",function(){$this._filter($(this).val())})}},_bindEventInputtext:function(){var $this=this;this.inputtext.off("focus.comboxfield blur.comboxfield").on("focus.comboxfield",function(){if($(this).val()==$this.options.valuetip){$(this).val("");$(this).removeClass("jazz-field-comp-input-tip")}}).on("blur.comboxfield",function(){if($(this).val()==""&&!!$this.options.valuetip){$(this).val($this.options.valuetip);$(this).addClass("jazz-field-comp-input-tip")}})},_setData:function(value,callback_function){this._oldValue=this.getValue(),this._oldText=this.getText();var text="";if(this.options.multiple){var arr=value.split(",");for(var i=0,len=arr.length;i<len;i++){if(i==0){text=this._getDataText(arr[i])}else{text=text+","+this._getDataText(arr[i])}}}else{text=this._getDataText(value)}if(text){this._setTextValue(text,value);this._newText=text}this._newValue=value;this._setValueCallback(callback_function)},_selectedItem:function(e,t){var ui;t=t.parent();this._newText=t.data("text"),this._newValue=t.data("value");ui={text:this._newText,value:this._newValue};this.inputtext.removeClass("jazz-field-comp-input-tip");var multiple=this.options.multiple;if(multiple){if(t.hasClass("jazz-state-highlight")){t.removeClass("jazz-state-highlight")}else{t.addClass("jazz-state-highlight")}this._oldValue=this.getValue(),this._oldText=this.getText();var value=this._getSelectedData();this._setSelectedValue(value);this._event("itemselect",e,ui)}else{this._oldValue=this.getValue(),this._oldText=this.getText();this._setSelectedValue(t.data("value"));this._hideDropdown();this._event("itemselect",e,ui);this._event("change",e,this._changeData())}},_setValue:function(data,value,callback_function){if(jazz.isArray(data)){this.dataset=data;this._dataItems();this._setData(value,callback_function)}},_callback:function(data,callbackfunction){if(jazz.isArray(data)){this.dataset=data;this._dataItems(true)}if($.isFunction(callbackfunction)){callbackfunction.call(this)}},_containsFilter:function(value,filter){return value.indexOf(filter)!==-1},_dataItems:function(){var rule=this.options.rule;this.itemsContainer.empty();var liset=[];for(var i=0;i<this.dataset.length;i++){var option=this.dataset[i],value=option.value,text=option.text,content=text,datarender=this.options.datarender;this.datakeyvalue[value]=text+"";if(datarender){if(!$.isFunction(datarender)){if(/\(/.test(datarender)){datarender=datarender.split("(")[0]}datarender=eval(datarender+"")}content=datarender.call(this,option)}liset.push('<li data-value="'+value+'" data-text="'+text+'" class="jazz-dropdown-list-item" ><a href="javascript:;">'+content+"</a></li>")}if(this.blankitem.length>0&&(rule+"").indexOf("must")<0){this.itemsContainer.append(this.blankitemdom);this.dataset=this.blankitem.concat(this.dataset)}if(liset.length>0){this.itemsContainer.append(liset.join(""))}this.items=this.itemsContainer.children(".jazz-dropdown-list-item");this.datastatus=true},_endsWithFilter:function(value,filter){return value.indexOf(filter,value.length-filter.length)!==-1},_filter:function(value){var filterValue=this.options.casesensitive?$.trim(value):$.trim(value).toLowerCase();for(var i=0;i<this.dataset.length;i++){var option=this.dataset[i],itemLabel=this.options.casesensitive?option.text:option.text.toLowerCase(),item=this.items.eq(i);if(this.filterMatcher(itemLabel,filterValue)){item.show()}else{item.hide()}}},_filterable:function(){if(this.options.filterable){if(this.filterContainer){this.filterContainer.remove()}this.filterContainer=$('<div class="jazz-dropdown-filter"></div>').prependTo(this.panel);this.filterInput=$('<input type="text" autocomplete="off" class="jazz-field-comp-input">').appendTo(this.filterContainer);this.filterContainer.append('<span class="jazz-dropdown-search"></span>')}},_getActiveItem:function(){return this.items.filter(".jazz-state-highlight")},_getDataText:function(value){return this.datakeyvalue[value]||""},_getSelectedData:function(){var items=this.itemsContainer.children(".jazz-state-highlight");var value="";$.each(items,function(i,item){var obj=$(item);if(i==0){value=obj.data("value")}else{value=value+","+obj.data("value")}});return value},_isshowblankitem:function(){this.blankitem=[],blanktext=this.options.blanktext;if(this.options.isshowblankitem&&!this.options.multiple){this.blankitem=[{text:blanktext,value:""}];this.blankitemdom=$('<li data-value="" data-text="'+blanktext+'" class="jazz-dropdown-list-item" ><a href="javascrript:;">'+(blanktext||" ")+"</a></li>")}},_loaddata:function(){if(typeof(this.options.dataurl)=="string"&&/^\s*[\[|{](.*)[\]|}]\s*$/.test(this.options.dataurl)){this.options.dataurl=jazz.stringToJson(this.options.dataurl)}if(jazz.isArray(this.options.dataurl)){this.dataset=this.options.dataurl;this._dataItems()}else{this._ajax(!this.options.cacheflag)}},_setupFilterMatcher:function(){this.filterMatchers={startsWith:this._startsWithFilter,contains:this._containsFilter,endsWith:this._endsWithFilter,custom:this.options.filterfunction};this.filterMatcher=this.filterMatchers[this.options.filtermatchmode]},_startsWithFilter:function(value,filter){return value.indexOf(filter)===0},_setSelectedValue:function(value){var text="",val=(value+"").split(",");for(var i=0,len=val.length;i<len;i++){if(i==0){text=this._getDataText(val[i])}else{text=text+","+this._getDataText(val[i])}}this._setTextValue(text,value)},_setTextValue:function(text,value){this.input.val(value);if(value===""&&this.options.blanktext){text=this.options.blanktext}this.setText(text)},_updateSelectItemStyle:function(){var value=this.getValue();items=this.itemsContainer.children();items.removeClass("jazz-state-highlight");if(this.options.multiple){$.each(items,function(i,item){var obj=$(item);if(obj.data("value")!==""&&(value+"").indexOf(obj.data("value")+"")>-1){obj.addClass("jazz-state-highlight")}})}else{$.each(items,function(i,item){var obj=$(item);if(obj.data("value")+""==value){obj.addClass("jazz-state-highlight")}})}},addOption:function(text,value){var item=$('<li data-value="'+value+'" data-text="'+text+'" class="jazz-dropdown-list-item"><a href="javascript:;">'+text+"</a></li>");item.appendTo(this.itemsContainer);this.dataset.push({text:text,value:value});this.datakeyvalue[value]=text},getDataIndex:function(value){for(var i=0,len=this.dataset.length;i<len;i++){if(this.dataset[i]["value"]==value){return i}}},getValue:function(){var value="";if(this.options.editable==true){var text=this.inputtext.val();if(text!=this.options.valuetip&&text!=this.options.blanktext){for(var i=0;i<this.dataset.length;i++){var option=this.dataset[i],label=option.text;text=$.trim(text);if(label===text){text=option.value;break}}value=text}else{value=""}}else{value=this._super()}return value},hideOption:function(value){this.itemsContainer.children("[data-value='"+value+"']").hide()},reload:function(data,callbackfunction){this.reset();if(data&&jazz.isArray(data)){this._callback(data,callbackfunction)}else{var dataurl=this.options.dataurl;if(dataurl){if(jazz.isArray(dataurl)){this._callback(dataurl,callbackfunction)}else{var $this=this;this._ajax(!this.options.cacheflag,function(data){$this._callback(data,callbackfunction)})}}}},removeOption:function(value){for(var i=0,len=this.dataset.length;i<len;i++){if(this.dataset[i]["value"]==value){this.dataset.splice(i,1);break}}this.itemsContainer.children("[data-value='"+value+"']").remove()},showOption:function(value){this.itemsContainer.children("[data-value='"+value+"']").show()},setValue:function(value,callback_function){if(value||value===0){if(typeof(value)=="object"&&jazz.isArray(value)){this.dataset=value;this._isshowblankitem();this._dataItems();this.reset();this._setValueCallback(callback_function)}else{value=value+"";if(this.dataset.length>0){var text="";if(this.options.multiple){var arr=value.split(",");for(var i=0,len=arr.length;i<len;i++){if(i==0){text=this._getDataText(arr[i])}else{text=text+","+this._getDataText(arr[i])}}}else{text=this._getDataText(value)}if(text){this._setTextValue(text,value)}this._setValueCallback(callback_function)}else{if(this.options.islazydata||this.options.vtype=="autocompletecomboxfield"){if(this.options.dataurl){if(jazz.isArray(this.options.dataurl)){this._setValue(this.options.dataurl,value,callback_function)}else{var $this=this;this._ajax(!this.options.cacheflag,function(data){$this._setValue(data,value,callback_function)})}}}else{this._setValueData(value,callback_function)}}}}else{this.reset()}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.DropdownField","jazz.Date"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.datefield",$.jazz.dropdownfield,{options:{vtype:"datefield",isshowdatelist:true,change:null,enter:null,itemselect:null},_create:function(){this._super();this.trigger.removeClass("jazz-field-comp-ar").addClass("jazz-field-comp-date");this.input=this.inputtext},_init:function(){this._super();this._dropdate();var $this=this;this.inputtext.off("focus.datefield blur.datefield").on("focus.datefield",function(){if($(this).val()==$this.options.valuetip){$(this).val("");$(this).removeClass("jazz-field-comp-input-tip")}}).on("blur.datefield",function(){if($(this).val()==""&&$this.options.valuetip){$(this).val($this.options.valuetip);$(this).removeClass("jazz-field-comp-input-tip").addClass("jazz-field-comp-input-tip")}});this._validator()},_dropdate:function(){var dropdatej=this.itemsContainer.date({isshowdatelist:this.options.isshowdatelist});var $this=this;dropdatej.off("dateselect.datefield").on("dateselect.datefield",function(event,ui){$this._oldValue=$this._oldText=$this.getValue();$this.setValue(ui.date);$this._event("itemselect",event,{value:ui.date});$this.panel.hide();$this._newValue=$this._newText=ui.date;$this._event("change",event,$this._changeData())})},_itemScroll:function(){},_setOption:function(key,value){switch(key){case"isshowdatelist":this.options.isshowdatelist=value;this.itemsContainer.date("option","isshowdatelist",value);break}this._super(key,value)}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Tree","form/jazz.form.DropdownField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.comboxtreefield",$.jazz.dropdownfield,{options:{vtype:"comboxtreefield",setting:{data:{simpleData:{enable:true,idKey:"id",pIdKey:"pId",rootPId:0}},async:{enable:true,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",autoParam:["id","level"]},check:{enable:true,radioType:"all"},view:{dblClickExpand:true},callback:{}},showlabel:"name",downheight:200,editable:false,checkenable:true,multiple:false,enter:null,leave:null,itemselect:null},_create:function(){this._super()},_init:function(){this.dataset=[];this._treeSetting();this._loadtree();this._super();this._bindEventInputtext();this._validator()},_bindEventInputtext:function(){var $this=this;this.inputtext.off("focus.comboxfield blur.comboxfield").on("focus.comboxfield",function(){if($(this).val()==$this.options.valuetip){$(this).val("");$(this).removeClass("jazz-field-comp-input-tip")}}).on("blur.comboxfield",function(){if($(this).val()==""&&!!$this.options.valuetip){$(this).val($this.options.valuetip);$(this).addClass("jazz-field-comp-input-tip")}})},_callback:function(data){if(!!data){if(jazz.isIE(7)||jazz.isIE(6)){if(typeof(this.options.setting.async.autoParam)!="object"){this.options.setting.async.autoParam=jazz.stringToJson(this.options.setting.async.autoParam)}}this._initTreeEvent();this.dataset=data;this.zTreeObj=$.fn.zTree.init(this.itemsContainer,this.options.setting,data);this.datastatus=true}this._validator()},_itemScroll:function(){this.panel.height(this.options.downheight)},_initTreeEvent:function(){var $this=this;if(!!this.options.setting.check){this.options.setting.callback.onClick=function(event,treeId,treeNode){var z_tree_init_001=$this.zTreeObj;z_tree_init_001.checkNode(treeNode,true,true,true);if(!!$this.options.onclick){eval($this.options.onclick).call(this,event,treeId,treeNode)}};var tempClick={click:null};if(!!this.funOnClick){$.extend(true,tempClick,{click:this.funOnClick})}this.options.setting.callback.onCheck=function(e,treeId,treeNode){$this._oldText=$this.getText();$this._oldValue=$this.getValue();var z_tree_init_001=$this.zTreeObj,z_tree_init_nodes=z_tree_init_001.getCheckedNodes(true),node_label="",node_code="";if(!$this.options.multiple){z_tree_init_001.selectNode(treeNode);if(!treeNode.checked){z_tree_init_001.cancelSelectedNode()}}else{if(!treeNode.checked){z_tree_init_001.cancelSelectedNode()}else{z_tree_init_001.selectNode(treeNode)}}for(var i=0,l=z_tree_init_nodes.length;i<l;i++){if(i==0){node_label=z_tree_init_nodes[i].name;node_code=z_tree_init_nodes[i].id}else{node_label=node_label+","+z_tree_init_nodes[i].name;node_code=node_code+","+z_tree_init_nodes[i].id}}$this.node_label=$this._newText=node_label,$this._newValue=node_code;$this.setText(node_label);$this.input.val(node_code);$this._event("itemselect",e,{"{text":node_label,value:node_code});if(tempClick.click!=null&&$this.options.tempState!=0){var func=eval(tempClick.click);func(e,treeId,treeNode)}$this.inputtext.focus();if(!!$this.options.oncheck){eval($this.options.oncheck).call(this,e,treeId,treeNode)}}}else{var tempClick={click:null};if(!!this.funOnClick){$.extend(true,tempClick,{click:this.funOnClick})}this.options.setting.callback.onClick=function(e,treeId,treeNode){$this._oldText=$this.getText();$this._oldValue=$this.getValue();var z_tree_init_001=$this.zTreeObj,z_tree_init_nodes=z_tree_init_001.getSelectedNodes(),node_label="",node_code="";for(var i=0,l=z_tree_init_nodes.length;i<l;i++){if(i==0){node_label=z_tree_init_nodes[i].name;node_code=z_tree_init_nodes[i].id}else{node_label=node_label+","+z_tree_init_nodes[i].name;node_code=node_code+","+z_tree_init_nodes[i].id}}$this.node_label=$this._newText=node_label,$this._newValue=node_code;$this.setText(node_label);$this.input.val(node_code);if(tempClick.click!=null){var func=eval(tempClick.click);func(e,treeId,treeNode)}$this.inputtext.focus()}}this.options.setting.callback.onAsyncSuccess=function(e,treeId,treeNode){$this.datastatus=true;if(!!$this.options.onasyncsuccess){eval($this.options.onasyncsuccess).call(this,e,treeId,treeNode)}};if(!!this.options.onnodecreated){this.options.setting.callback.onNodeCreated=function(e,treeId,treeNode){eval($this.options.onnodecreated).call(this,e,treeId,treeNode)}}this.resetcomboxtree.off("click.comboxtreefield").on("click.comboxtreefield",function(){$this.reset();var treeObj=$this.zTreeObj;if(!!treeObj){var nodes=treeObj.getCheckedNodes(true);for(var i=0,l=nodes.length;i<l;i++){treeObj.checkNode(nodes[i],false,true)}}})},_loadData:function(data,func){this.itemsContainer.children().remove();this._loadtree(data,func)},_loadtree:function(data,func){if(data&&jazz.isArray(data)){this._callback(data)}else{if(!!this.options.dataurl){if(!!this.options.asyncurl){this.options.setting.async.url=this.options.asyncurl}else{this.options.setting.async.url=this.options.dataurl}if(typeof(this.options.dataurl)=="object"&&jazz.isArray(this.options.dataurl)){this._callback(this.options.dataurl)}else{this._ajax(true,func)}}}},_setNodeData:function(codes,aTree){var $this=this,m=1,delay=100,delaycount=this.options.delaycount,label="",code="";if(codes||codes===0){var codeArray=(codes+"").split(",");var codetimeout=new Object();for(var i=0;i<codeArray.length;i++){code=$.trim(codeArray[i]);var node=null;if(!!code){codetimeout["code_"+code]=setInterval(function(x){return function(){node=aTree.getNodeByParam("id",x,null);m++;if(!!node||delay*m>delaycount){clearInterval(codetimeout["code_"+x]);aTree.checkNode(node,false,true);aTree.checkNode(node,true,true);label=label+","+node[$this.options.showlabel];code=node.id+",";$this.setText(label.substring(1));$this.input.val(codes)}}}(code),delay)}}this._oldText=this.getText();this._oldValue=this.getValue();setTimeout(function(){$this.node_label=$this._newText=label,$this._newValue=codes},delaycount/2)}},_setData:function(value,callback_function){var aTree=this.zTreeObj;if(aTree){this._setNodeData(value,aTree)}this._setValueCallback(callback_function)},_treeSetting:function(){if(this.options.checkenable){this.options.setting.check.chkStyle="checkbox";if(!this.options.multiple){this.options.setting.check.chkStyle="radio"}else{this.resetcomboxtree.remove()}}else{this.options.setting.check.enable=false}if(!!this.options.asyncenable){this.options.setting.async.enable=this.options.asyncenable}if(!!this.options.autoparam){this.options.setting.async.autoParam=this.options.autoparam}if(!!this.options.autochecktrigger){this.options.setting.check.autoCheckTrigger=this.options.autochecktrigger}if(!!this.options.radiotype){this.options.setting.check.radioType=this.options.radiotype}if(!!this.options.chkboxtype){this.options.setting.check.chkboxType=this.options.chkboxtype}if(!!this.options.setting.check){this.funOnClick=this.options.setting.callback.onCheck}else{this.funOnClick=this.options.setting.callback.onClick}},getValue:function(){var value="";if(this.options.editable==true){var text=this.inputtext.val();if(text!=this.options.valuetip){label=$.trim(this.node_label);if(label===text){text=this._super()}value=text}else{value=""}}else{value=this._super()}return value},reload:function(data,func){this._loadData(data,func)},reset:function(){this._super();var aTree=this.zTreeObj;aTree.cancelSelectedNode();aTree.checkAllNodes(false);var nodes=aTree.getCheckedNodes(true);$.each(nodes,function(i,node){aTree.checkNode(node,false)})},setValue:function(value,callback_function){if(value||value===0){if(typeof(value)=="object"&&jazz.isArray(value)){this._initTreeEvent();this.zTreeObj=$.fn.zTree.init($this.itemsContainer,this.options.setting,value);this._setValueCallback(callback_function)}else{if(this.dataset.length>0){this._setData(value,callback_function)}else{if(this.options.islazydata){var $this=this;this._ajax(false,function(data){$this._callback(data);$this._setValueData(value,callback_function)})}else{this._setValueData(value,callback_function)}}}}else{}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.ComboxField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.autocompletecomboxfield",$.jazz.comboxfield,{options:{vtype:"autocompletecomboxfield",datatype:"text",minquerylength:1},_create:function(){this.options.editable=true;this.options.multiple=false;this.options.isshowblankitem=false;this._super();this.trigger.removeClass("jazz-field-comp-ar")},_filterable:function(){},_loaddata:function(){},_init:function(){this.query="";this._super()},_binddropdown:function(){},_bindEvent:function(){this._bindKeyEvents();var $this=this;this.itemsContainer.off("mousedown.comboxfield").on("mousedown.comboxfield",function(e){var t=$(e.target);if(t.is(".jazz-dropdown-list-item a")){$this._selectedItem(e,t);e.stopPropagation()}});this._bindEventInputtext()},_bindKeyEvents:function(){var $this=this;var dataurl=$this.options.dataurl;this.flag=true;this.inputtext.off("keyup.autocomplete, mousedown.autocomplete").on("keyup.autocomplete, mousedown.autocomplete",function(e){var keyCode=$.ui.keyCode,key=e.which,shouldSearch=true;if(key==keyCode.UP||key==keyCode.LEFT||key==keyCode.DOWN||key==keyCode.RIGHT||key==keyCode.TAB||key==keyCode.SHIFT||key==keyCode.ENTER||key==keyCode.NUMPAD_ENTER){shouldSearch=false}if(shouldSearch){if(!!$this.timeout){window.clearTimeout($this.timeout)}$this.timeout=window.setTimeout(function(){var value=$this.getValue();var text=$this.getText();if(dataurl&&!$.isArray(dataurl)){if($this.flag){if(dataurl.indexOf("?")!=-1){dataurl+="&text={text}"}else{dataurl+="?text={text}"}$this.flag=false}var url=encodeURI(dataurl.replace("{text}",text));if(!$this.options.cacheflag){url+=("&tty="+Math.random())}$this.options.dataurl=url}if($this.options.dataurlparams){$this.options.dataurlparams.text=text;$this.options.dataurlparams.value=value}if($this.options.minquerylength==0){$this._search(text)}else{if(text){$this._search(text)}}},$this.options.delay)}})},_dataItems:function(f){var data=[],emptyQuery=($.trim(this.query)==="");if(f){for(var i=0;i<this.dataset.length;i++){var option=this.dataset[i],optionLabel=option.text+"";if(!this.options.casesensitive){itemLabel=optionLabel.toLowerCase()}if(emptyQuery&&this.options.minquerylength==0){data.push(option)}else{if((this.filterMatcher(itemLabel,$.trim(this.query)))){data.push(option)}}}this.dataset=data}this._super();if(f){this._hideDropdown();var len=data.length;if(len>0){var $this=this;$.each(this.items,function(i,item){var obj=$(item);if($this.query){var text=obj.html(),re=new RegExp(jazz.escapeRegExp($this.query||""),"gi"),highlighedText=text.replace(re,'<span class="jazz-textfield-query">$&</span>');obj.html(highlighedText)}});if(!this.panel.is(":visible")&&this.datastatus){this._showDropdown(len)}}}},_editable:function(){this.options.editable=true;this._super()},_search:function(text){this.query=this.options.casesensitive?text:text.toLowerCase();if(this.options.dataurl){if($.isArray(this.options.dataurl)){this.dataset=this.options.dataurl;this._dataItems(true)}else{this._ajax(!this.options.cacheflag)}}},getValue:function(){var value="";if(this.options.datatype=="text"){value=this.getText()}else{var supervalue=this._super();if(supervalue||supervalue===0){value=supervalue}}return value},setValue:function(value,callback_function){if(this.options.datatype=="text"){this.setText(value);this._setValueCallback(callback_function)}else{this._super(value,callback_function)}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.DropdownField"],factory)}else{factory($)}})(jQuery,function($){var _idx=0,isIE=!$.support.cssFloat,_ie=isIE?"-ie":"",baseThemeColors=["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],subThemeColors=["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada","d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5","bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f","a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09","7f7f7f","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"],standardColors=["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"],int2Hex=function(i){var h=i.toString(16);if(h.length==1){h="0"+h}return h},st2Hex=function(s){return int2Hex(Number(s))},toHex3=function(c){if(c.length>10){var p1=1+c.indexOf("("),p2=c.indexOf(")"),cs=c.substring(p1,p2).split(",");return["#",st2Hex(cs[0]),st2Hex(cs[1]),st2Hex(cs[2])].join("")}else{return c}};$.widget("jazz.colorfield",$.jazz.dropdownfield,{options:{vtype:"colorfield",strings:"全部颜色,标准颜色",change:null},_create:function(){this.options.downheight=250;this._super()},_init:function(){this._super();this._paletteIdx=1;this._id="evo-cp"+_idx++;this._isPopup=true;this._palette=null;this._palette=this.itemsContainer.css({width:"205",height:"190"}).addClass("evo-pop jazz-widget").append(this._paletteHTML());if(jazz.util.isIE(7)){this._palette.css("width","203");this._palette.css("height","220")}else{if(jazz.util.isIE(8)){this._palette.css("width","224");this._palette.css("height","175")}}this._palette.parent().addClass("jazz-panel").css({"background-color":"#fff"});this._bindEvent();this._validator()},_editable:function(){this.options.editable=false;this._super()},_paletteHTML:function(){var h=[],pIdx=this._paletteIdx=Math.abs(this._paletteIdx),labels=this.options.strings.split(",");h.push("<span>",this["_paletteHTML"+pIdx](),"</span>");h.push('<div class="evo-more"><a href="javascript:void(0)">',labels[1+pIdx],"</a>");h.push("</div>");return h.join("")},_paletteHTML1:function(){var h=[],labels=this.options.strings.split(","),oTD='<td style="background-color:#',cTD=isIE?'"><div style="width:2px;"></div></td>':'"><span/></td>',oTRTH='<tr><th colspan="10" class="jazz-widget-content">';h.push('<table class="evo-palette',_ie,'">',oTRTH,labels[0],"</th></tr><tr>");for(var i=0;i<10;i++){h.push(oTD,baseThemeColors[i],cTD)}h.push("</tr>");if(!isIE){h.push('<tr><th colspan="10"></th></tr>')}h.push('<tr class="top">');for(i=0;i<10;i++){h.push(oTD,subThemeColors[i],cTD)}for(var r=1;r<4;r++){h.push('</tr><tr class="in">');for(i=0;i<10;i++){h.push(oTD,subThemeColors[r*10+i],cTD)}}h.push('</tr><tr class="bottom">');for(i=40;i<50;i++){h.push(oTD,subThemeColors[i],cTD)}h.push("</tr>",oTRTH,labels[1],"</th></tr><tr>");for(i=0;i<10;i++){h.push(oTD,standardColors[i],cTD)}h.push("</tr></table>");return h.join("")},_bindEvent:function(){var es=this._palette.find("div.evo-color"),sel="td";this._cTxt1=es.eq(0).children().eq(0);this._cTxt2=es.eq(1).children().eq(0);var $this=this;this._palette.off("mouseover.colorfield").on("mouseover.colorfield",sel,function(evt){var c=toHex3($(this).attr("style").substring(17));$this.inputtext.css("background-color",c)});this.itemsContainer.off("mouseout.colorfield").on("mouseout.colorfield",function(evt){if($this._newValue){$this.inputtext.css("background-color",$this._newValue)}else{$this.inputtext.css("background-color","#fff")}});this._palette.off("mousedown.colorfield").on("mousedown.colorfield",sel,function(e){$this._oldValue=$this._oldText=$this.getValue();var c=toHex3($(this).attr("style").substring(17));$this._newValue=$this._newText=c;$this.setValue(c);$this.inputtext.css("background-color",c);$this._hideDropdown();$this._event("change",e,$this._changeData())});this.inputtext.off("focus.colorfield blur.colorfield").on("focus.colorfield",function(){if($this.input.val()==""&&$this.options.valuetip){$(this).val("");$(this).removeClass("jazz-field-comp-input-tip")}}).on("blur.colorfield",function(){if($this.input.val()==""&&$this.options.valuetip&&!$this._newValue){$(this).val($this.options.valuetip);$(this).addClass("jazz-field-comp-input-tip")}})},getText:function(){return this.getValue()},getValue:function(){return this.input.val()||""},setText:function(v){this.setValue(v)},setValue:function(value){if(value==""||value==undefined){value=""}this.inputtext.css("background-color",value);this.inputtext.val("");this.inputview.html(value+"");this.input.val(value)}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.date",$.jazz.boxComponent,{options:{vtype:"date",width:200,height:200,year:new Date().getFullYear(),month:new Date().getMonth()+1,defaultvalue:null,isshowdatelist:false,select:null,finish:null,preyear:null,premonth:null,nextyear:null,nextmonth:null},_create:function(){this._super();if(this.options.defaultvalue){this.options.defaultvalue=new Date(this.options.defaultvalue.replace(/-/g,"/"))}this.element.addClass("jazz-date").css({width:this.options.width,height:this.options.height});this.calendarPreYear=$('<div class="jazz-date-preyear"></div>').appendTo(this.element);this.calendarPreMonth=$('<div class="jazz-date-premonth"></div>').appendTo(this.element);this.calendarNextYear=$('<div class="jazz-date-nextyear"></div>').appendTo(this.element);this.calendarNextMonth=$('<div class="jazz-date-nextmonth"></div>').appendTo(this.element);this.calendarText=$('<div class="jazz-date-text"><table align="center"><tr><td><div class="jazz-date-year-o">'+this.options.year+'</div></td><td> <div class="jazz-date-year-w">年</div> </td><td><div class="jazz-date-month-o">'+this.options.month+'</div></td><td> <div class="jazz-date-year-w">月</div> </td></tr></table></div>').appendTo(this.element);this.calendarYear=this.calendarText.find(".jazz-date-year-o");this.calendarMonth=this.calendarText.find(".jazz-date-month-o");if(this.options.isshowdatelist===true){this.calendarYear.addClass("jazz-cursor-pointer");this.calendarMonth.addClass("jazz-cursor-pointer")}this.calendarHeader=$('<table class="jazz-date-header" cellspacing="0" cellpadding="0" border="0" width="100%" height="22" align="center" vAlign="middle">  <thead>    <tr>      <td style="height:22px" class="jazz-date-week">一</td>      <td class="jazz-date-week">二</td>      <td class="jazz-date-week">三</td>      <td class="jazz-date-week">四</td>      <td class="jazz-date-week">五</td>      <td class="jazz-date-week">六</td>      <td class="jazz-date-week">日</td>    </tr>  </thead></table>').appendTo(this.element);this.items=$('<table class="jazz-date-body" cellspacing="0" cellpadding="0" border="0" width="100%" height="'+(this.options.height-this.calendarText.outerHeight(true)-this.calendarHeader.outerHeight(true))+'" align="center" vAlign="middle">  </tbody></table>').appendTo(this.element);this.yearnum=5},_init:function(){this._draw();this._bindEvent()},_bindEvent:function(){var $this=this;this.calendarPreYear.off("mousedown.date").on("mousedown.date",function(e){$this._listHide();$this.preYear();$this._event("preyear",e);e.stopPropagation()});this.calendarPreMonth.off("mousedown.date").on("mousedown.date",function(e){$this._listHide();$this.preMonth();$this._event("premonth",e);e.stopPropagation()});this.calendarNextMonth.off("mousedown.date").on("mousedown.date",function(e){$this._listHide();$this.nextMonth();$this._event("nextmonth",e);e.stopPropagation()});this.calendarNextYear.off("mousedown.date").on("mousedown.date",function(e){$this._listHide();$this.nextYear();$this._event("nextyear",e);e.stopPropagation()});this.items.off("mousedown.date, mouseover.date, mouseout.date").on("mousedown.date",function(event){var t=event.target,$t=$(t);if(t.tagName!="TD"||$t.hasClass("jazz-date-pmonth")||$t.hasClass("jazz-date-nmonth")){return}$this.items.find(".jazz-date-selected").removeClass("jazz-date-selected");$t.addClass("jazz-date-selected");var _day=t.innerHTML;if(_day&&_day.length==1){_day="0"+_day}var _month=$this.options.month;if(_month&&(_month+"").length==1){_month="0"+_month}$this._listHide();var num=$t.prop("id").length;var newdate=$t.prop("id").substring(5,num);$this._event("select",event,{date:newdate});event.stopPropagation()}).on("mouseover.date",function(event){var t=event.target,$t=$(t);if(t.tagName!="TD"||$t.hasClass("jazz-date-pmonth")||$t.hasClass("jazz-date-nmonth")){return}$t.addClass("jazz-date-hover");event.stopPropagation()}).on("mouseout.date",function(event){var t=event.target,$t=$(t);$t.removeClass("jazz-date-hover");event.stopPropagation()});$this.calendarYear.off("mousedown.date").on("mousedown.date",function(event){if($this.options.isshowdatelist===true){$this._listMonthHide();$this._yearlist($this.searchyear);if(!$this.listYear){$this._listyearShow()}$this.listYear.off("click.datelist").on("click.datelist",function(e){var target=$(e.target);if(target.hasClass("jazz-date-yearlist-td")){var year=$.trim(target.text());$this.calendarYear.text(year);$this._listYearHide();$this.options.year=parseInt(year||$this.options.year);$this._preDraw(new Date($this.options.year,$this.options.month-1,1))}else{if(target.hasClass("jazz-date-yearlist-td-p")){$this.searchyear=$this.yearAfter[0]-$this.yearnum;$this._yearlist($this.searchyear);$this._listyearShow()}else{if(target.hasClass("jazz-date-yearlist-td-c")){$this._listYearHide()}else{if(target.hasClass("jazz-date-yearlist-td-n")){$this.searchyear=$this.yearBefore[$this.yearnum-1]+$this.yearnum+1;$this._yearlist($this.searchyear);$this._listyearShow()}}}}});event.stopPropagation();$(document).off("mousedown.slistdate").on("mousedown.slistdate",function(){$this._listHide();$(this).off("mousedown.slistdate")})}});$this.calendarMonth.off("click.date").on("click.date",function(event){if($this.options.isshowdatelist===true){$this._listYearHide();if(!$this.listMonth){$this._monthlist()}$this.listMonth.off("click.datelist").on("click.datelist",function(e){var target=$(e.target);if(target.hasClass("jazz-date-monthlist-td")){var monthtext=$.trim(target.text());var month=$this._monthTextToNumber(monthtext)||$this.options.month;$this.calendarMonth.text(month);$this._listMonthHide();$this.options.month=month;$this._preDraw(new Date($this.options.year,month-1,1))}});event.stopPropagation();$(document).off("mousedown.slistMdate").on("mousedown.slistMdate",function(){$this._listHide();$(this).off("mousedown.slistMdate")})}})},_buildList:function(type){},_draw:function(){var arr=[];for(var i=0,firstday=new Date(this.options.year,this.options.month-1,1).getDay()-1;i<firstday;i++){arr.push(0)}for(var i=1,monthDay=new Date(this.options.year,this.options.month,0).getDate();i<=monthDay;i++){arr.push(i)}var frag=document.createDocumentFragment();while(arr.length){var row=document.createElement("tr");for(var i=1;i<=7;i++){var cell=document.createElement("td");cell.innerHTML="&nbsp;";if(arr.length){var d=arr.shift();if(d){cell.innerHTML=d;var on=new Date(this.options.year,this.options.month-1,d);if(this._isSame(on,new Date())){$(cell).addClass("jazz-date-today")}if(this.options.defaultvalue&&this._isSame(on,this.options.defaultvalue)){$(cell).addClass("jazz-date-selected")}}else{$(cell).addClass("jazz-date-pmonth")}var cellmonth=this.options.month<10?"0"+this.options.month:this.options.month;var cellday=d<10?"0"+d:d;$(cell).attr("id","date-"+this.options.year+"-"+cellmonth+"-"+cellday)}else{$(cell).addClass("jazz-date-nmonth")}row.appendChild(cell)}frag.appendChild(row)}this.items.children().remove();this.items.append(frag);this.calendarYear.text(this.options.year);this.calendarMonth.text(this.options.month);this._event("finish")},_isSame:function(d1,d2){return(d1.getFullYear()==d2.getFullYear()&&d1.getMonth()==d2.getMonth()&&d1.getDate()==d2.getDate())},_listHide:function(){this._listYearHide();this._listMonthHide()},_listYearHide:function(){if(this.listYear){this.listYear.remove();this.listYear=null}},_listMonthHide:function(){if(this.listMonth){this.listMonth.remove();this.listMonth=null}},_listyearShow:function(){var buf=[];buf.push('<div class="jazz-date-yearlist" style="display: block;">');buf.push('	<table cellspacing="0" cellpadding="3" border="0" align="center">');buf.push("		<tbody>");for(var i=0;i<this.yearnum;i++){buf.push('			<tr nowrap="nowrap">');buf.push('				<td class="jazz-date-yearlist-td" >');buf.push(this.yearAfter[i]);buf.push("				</td>");buf.push('				<td class="jazz-date-yearlist-td" >');buf.push(this.yearBefore[i]);buf.push("				</td>");buf.push("			</tr>")}buf.push("		</tbody>");buf.push("	</table>");buf.push('	<table cellspacing="0" cellpadding="3" border="0" align="center">');buf.push("		<tbody>");buf.push("			<tr>");buf.push('				<td class="jazz-date-yearlist-td-p"> ← </td>');buf.push('				<td class="jazz-date-yearlist-td-c"> × </td>');buf.push('				<td class="jazz-date-yearlist-td-n"> → </td>');buf.push("			</tr>");buf.push("		</tbody>");buf.push("	</table>");buf.push("</div>");var str=buf.join("");this.calendarYear.children(".jazz-date-yearlist").remove();this.listYear=$(str).appendTo(this.calendarYear);this.listYear.css({top:this.calendarYear.height()+1})},_monthlist:function(){var buf=[];buf.push('<div class="jazz-date-monthlist" style="display: block;">');buf.push('	<table cellspacing="0" cellpadding="3" border="0" align="center">');buf.push("		<tbody>");buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >一月</td><td class="jazz-date-monthlist-td" >七月</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >二月</td><td class="jazz-date-monthlist-td" >八月</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >三月</td><td class="jazz-date-monthlist-td" >九月</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >四月</td><td class="jazz-date-monthlist-td" >十月</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >五月</td><td class="jazz-date-monthlist-td" >十一</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >六月</td><td class="jazz-date-monthlist-td" >十二</td></tr>');buf.push("		</tbody>");buf.push("	</table>");buf.push("</div>");var str=buf.join("");this.listMonth=$(str).appendTo(this.calendarMonth);this.listMonth.css({top:this.calendarMonth.height()+1,right:"20px"})},_monthTextToNumber:function(text){var yue=jazz.config.i18n.months;for(var i=0;i<yue.length;i++){if(text==yue[i]){return(i+1)}}return""},_preDraw:function(date){this.options.year=date.getFullYear();this.options.month=date.getMonth()+1;this._draw()},_yearlist:function(year){var _year=year?parseInt(year):this.options.year;this.yearAfter=[],this.yearBefore=[];for(var i=this.yearnum;i>0;i--){this.yearAfter.push(_year-i);this.yearBefore.push(_year+(this.yearnum-i))}},currentMonth:function(){this._preDraw(new Date())},nextMonth:function(){this._preDraw(new Date(this.options.year,this.options.month,1))},nextYear:function(){this._preDraw(new Date(this.options.year+1,this.options.month-1,1))},preMonth:function(){this._preDraw(new Date(this.options.year,this.options.month-2,1))},preYear:function(){this._preDraw(new Date(this.options.year-1,this.options.month-1,1))}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.accordionpanel",$.jazz.boxComponent,{options:{vtype:"accordionpanel",iconurl:"",iconselect:"",showborder:true,activeindex:0,multiple:false,click:null},_create:function(){this._super();this._showborder();if(this.options.multiple){var index=this.options.activeindex;this.options.activeindex=[];this._addToSelection(index)}this.element.addClass("jazz-accordion jazz-helper-reset");var $this=this;this.childrens=this.element.children();$.each(this.childrens,function(i,child){$(child).addClass("jazz-accordion-content jazz-helper-reset jazz-widget-content");var childname=$(child).attr("name");var childid=$(child).attr("id");if(!childname){$(child).attr("name",$this.getCompId()+"_content"+i)}if(!childid){$(child).attr("id",$this.getCompId()+"_content"+i)}var headerClass=(i==$this.options.activeindex)?"jazz-accordion-headericon-active":"jazz-accordion-headericon-unactive";var headericon=$("<div class='"+headerClass+"'></div>");var headertext=$("<div class='jazz-accordion-headertext'></div>");var iconurl=$(child).attr("iconurl");if(iconurl){headertext.append('<span style="background:url('+iconurl+') 50% 50% no-repeat;" class="jazz-accordion-header-icon jazz-icon">p</span>')}else{headertext.css("padding-left","5px")}headertext.append("<span title='"+$(child).attr("title")+"' class='jazz-accordion-header-text'>"+$(child).attr("title")+"</span>");var header=$("<div class='jazz-accordion-header jazz-helper-reset jazz-state-default'></div>");if(!childname){header.attr("name",$this.getCompId()+"_header"+i)}else{header.attr("name",childname)}if(!childid){header.attr("id",$this.getCompId()+"_header"+i)}else{header.attr("id",childid)}if($this.options.activeindex==i){header.addClass("jazz-state-active");iconurl=$(child).attr("iconselect");if(iconurl){headertext.find(".jazz-accordion-header-icon").css("background-image","url("+iconurl+")")}}else{$(child).addClass("jazz-helper-hidden")}header.append(headertext).append(headericon);$(child).before(header)})},_init:function(){this._compSize();this.headers=this.element.children(".jazz-accordion-header");this.panels=this.element.children(".jazz-accordion-content");this._bindEvents();var $this=this;if(this.options.multiple){$.each(this.options.activeindex,function(i,index){var panel=$this.panels.eq(index);$this._calscroll(panel)})}else{var panel=this.panels.eq(this.options.activeindex);this._calscroll(panel)}},_compSize:function(){this._width();this._height()},_showborder:function(){if(this.options.showborder){this.element.addClass("jazz-panel-border")}else{this.element.removeClass("jazz-panel-border")}},_width:function(){this._super();var $this=this;if(this.iscalculatewidth&&!!this.headers){$.each(this.headers,function(i,header){$(header).outerWidth($this.options.calculateinnerwidth);$(header).next($this.options.calculateinnerwidth);var headertextobj=$(header).children(".jazz-accordion-headertext");var iconurl=headertextobj.children(".jazz-accordion-header-icon");var headerWidth=$this.options.calculateinnerwidth-headertextobj.next().outerWidth(true);headertextobj.width(headerWidth);var textWidth=$this.options.calculateinnerwidth-$(header).children(".jazz-accordion-headericon-active").outerWidth(true)-$(header).children(".jazz-accordion-headericon-unactive").outerWidth(true);if(iconurl){textWidth=headerWidth-headertextobj.children(".jazz-accordion-header-icon").outerWidth(true)}headertextobj.children(".jazz-accordion-header-text").outerWidth(textWidth)})}else{$.each(this.childrens,function(i,child){var childobj=$(child);childobj.outerWidth($this.options.calculateinnerwidth);childobj.prev($this.options.calculateinnerwidth);var headerobj=childobj.prev();var headertextobj=headerobj.children(".jazz-accordion-headertext");var iconurl=childobj.attr("iconurl");var headerWidth=$this.options.calculateinnerwidth-headertextobj.next().outerWidth(true);if(headertextobj.children(".jazz-accordion-header-icon")){headerWidth=headerWidth-5}headertextobj.width(headerWidth);var textWidth=$this.options.calculateinnerwidth-headerobj.children(".jazz-accordion-headericon-active").outerWidth(true)-headerobj.children(".jazz-accordion-headericon-unactive").outerWidth(true);if(iconurl){textWidth=headerWidth-headertextobj.children(".jazz-accordion-header-icon").outerWidth(true)}headertextobj.children(".jazz-accordion-header-text").outerWidth(textWidth);headertextobj.append("<div style='clear: both;'></div>")})}},_height:function(){this._super();if(this.iscalculateheight&&!!this.panels){var panel=this.panels.eq(this.options.activeindex);this._calscroll(panel)}},_bindEvents:function(){var $this=this;this.headers.off("click.accordion").on("click.accordion",function(e){var element=$(this);if(!element.hasClass("jazz-state-disabled")){var tabIndex=element.index()/2;$this.options.activeLastIndex=tabIndex;if(element.hasClass("jazz-state-active")){$this.unselect(tabIndex)}else{$this.select(tabIndex)}}e.preventDefault()});if(jazz.isIE(6)){this.headers.hover(function(){var element=$(this);if(!element.hasClass("jazz-state-disabled")){element.addClass("jazz-state-hover")}},function(){var element=$(this);if(!element.hasClass("jazz-state-disabled")){element.removeClass("jazz-state-hover")}})}},_show:function(panel){var iconurl;if(!this.options.multiple){var oldHeader=this.headers.filter(".jazz-state-active");oldHeader.removeClass("jazz-state-active").next().hide();oldHeader.children(".jazz-accordion-headericon-active").removeClass("jazz-accordion-headericon-active").addClass("jazz-accordion-headericon-unactive");oldHeader.each(function(i,header){iconurl=$(header).next().attr("iconurl");$(header).find(".jazz-accordion-header-icon").css("background-image","url("+iconurl+")")})}var newHeader=panel.prev();newHeader.addClass("jazz-state-active").children(".jazz-accordion-headericon-unactive").removeClass("jazz-accordion-headericon-unactive").addClass("jazz-accordion-headericon-active");iconurl=panel.attr("iconselect");if(iconurl){newHeader.find(".jazz-accordion-header-icon").css("background-image","url("+iconurl+")")}panel.show()},_addToSelection:function(nodeId){this.options.activeindex.push(nodeId)},_removeFromSelection:function(index){this.options.activeindex=$.grep(this.options.activeindex,function(r){return r!=index})},select:function(index){var panel=this.panels.eq(index);this._calscroll(panel);this._event("click",null,{state:1,index:index});if(this.options.multiple){this.options.activeindex=[];this._addToSelection(index)}else{this.options.activeindex=index}$.each(panel.parents("div[vtype]:first").getChildrenComponent(),function(){var element=$(this);var vtype=element.attr("vtype");element.data(vtype)._resizeHeight()});this._show(panel)},unselect:function(index){var panel=this.panels.eq(index),header=panel.prev();this._event("click",null,{state:0,index:index});header.removeClass("jazz-state-active").children(".jazz-accordion-headericon-active").removeClass("jazz-accordion-headericon-active").addClass("jazz-accordion-headericon-unactive");var iconurl=panel.attr("iconurl");header.find(".jazz-accordion-header-icon").css("background-image","url("+iconurl+")");panel.slideUp();this._removeFromSelection(index)},_calscroll:function(panel){var $this=this;var allheight=this.options.calculateinnerheight,otherheight=0;if(this.options.multiple){this.element.css({overflow:"auto"});var nScrollHight=this.element[0].scrollHeight;var nScrollTop=this.element[0].scrollTop;if(nScrollTop+allheight>=nScrollHight){$.each(this.headers,function(i,header){var headertextobj=$(header).children(".jazz-accordion-headertext");var iconurl=headertextobj.children(".jazz-accordion-header-icon");var headerWidth=$this.options.calculateinnerwidth-headertextobj.next().outerWidth(true)-jazz.config.scrollWidth;if(headertextobj.children(".jazz-accordion-header-icon")){headerWidth=headerWidth-5}headertextobj.width(headerWidth);var textWidth=$this.options.calculateinnerwidth-$(header).children(".jazz-accordion-headericon-active").outerWidth()-$(header).children(".jazz-accordion-headericon-unactive").outerWidth();if(iconurl){textWidth=headerWidth-headertextobj.children(".jazz-accordion-header-icon").outerWidth()}headertextobj.children(".jazz-accordion-header-text").outerWidth(textWidth)})}}else{if(allheight!=-1){$.each(this.headers,function(i,head){otherheight=otherheight+$(head).outerHeight(true)});var panelheight=allheight-otherheight;panel.outerHeight(panelheight).css({overflow:"auto"})}}},_destroy:function(){}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.button",$.jazz.boxComponent,{options:{vtype:"button",name:null,text:null,title:null,width:null,height:null,align:"left",iconalign:"left",issplitbutton:false,arrowalign:"right",defaultview:2,iconurl:null,toggleiconurl:null,disabled:false,group:null,checktype:null,delay:false,delaytime:150,showmenuevent:"hover",items:null,click:null,isfillet:true},_create:function(){this._super();this._getButtonDefaultUrl();this.originHtml=this.element[0].outerHTML;var title=this.options.title||"";this.element.addClass("button-main").wrap('<a class="jazz-button" href="javascript:;" title="'+title+'"></a>');var group=typeof this.options.group=="string"?this.options.group:"";this.element.attr("group",group);this.container=this.element.parents("a:first");tempTable=this._createButtonOutterDom();this.container.append(tempTable);this.element.appendTo(this.container.find(".button-main-td"));var main=this._createButtonInnerDom();this.element.append(main).attr("name",this.options.name||"");if(this.options.disabled==true||this.options.disabled=="true"){this.options.disabled=true;this.container.addClass("jazz-state-disabled")}else{this.options.disabled=false}},_init:function(){this._super();this._setButtonWidth();this._setButtonHeight();this._bindButtonEvents();if(this.options.items){var items=eval(this.options.items);if(!items){var createitems=this.options.createitems;if(createitems){items=this._customopration(this.options.createitems)}}this.options.items=items||[];this._createButtonMenuDom();this._bindButtonMenuEvent()}},_getButtonDefaultUrl:function(){try{var obj=$('<div id="div-img-src"  class="jazz-button-img-src"></div>').appendTo(document.body);var str=obj.css("background-image");var start=str.indexOf("(");var end=str.lastIndexOf("tool-sprites-dark.png");this.defaulturl=str.substring(start+1,end).replace('"',"");obj.remove()}catch(e){jazz.log(e)}},_createButtonOutterDom:function(){var arrowclass=this.options.arrowalign?"arrow-align-"+this.options.arrowalign:"arrow-align-right";var arrow='<div class="button-arrow" style="display:none;margin:0px;"><img alt="" src="" /></div>';if(this.options.issplitbutton){arrow='<div class="button-arrow '+arrowclass+'"><img alt="" src="'+this.defaulturl+'jazz-button-arrow-down.png"/></div>';if(this.options.showmenuevent=="hover"){arrow='<div class="button-arrow '+arrowclass+'" style="width:13px;height:8px;"><img alt="" src="'+this.defaulturl+'jazz-button-arrow-down.png" style="display:none;" /></div>';this.container.css("margin","0px")}}var table=[];table.push('<table cellspacing="0" cellpadding="0" border="0" style="border-collapse:collapse;"><thead>');var isFillet=this.options.isfillet?"-fillet":"";if(this.options.arrowalign=="top"){table.push('<tr><td class="button-top-left');table.push(isFillet);table.push('-corner button-corner"></td><td class="button-top button-border button-background"></td><td class="button-top-right');table.push(isFillet);table.push('-corner button-corner"></td></tr></thead><tbody><tr class="button-background"><td class="button-left button-border"></td><td class="button-arrow-td">');table.push(arrow);table.push('</td><td class="button-right button-border"></td></tr>');table.push('<tr class="button-background"><td class="button-left button-border"></td><td class="button-main-td"></td><td class="button-right button-border"></td></tr>');table.push('</tbody><tfoot><tr><td class="button-bottom-left');table.push(isFillet);table.push('-corner button-corner"></td><td class="button-bottom button-border button-background"></td><td class="button-bottom-right');table.push(isFillet);table.push('-corner button-corner"></td></tr>')}else{if(this.options.arrowalign=="bottom"){table.push('<tr><td class="button-top-left');table.push(isFillet);table.push('-corner button-corner"></td><td class="button-top button-background button-border"></td><td class="button-top-right');table.push(isFillet);table.push('-corner button-corner"></td></tr></thead><tbody>');table.push('<tr class="button-background"><td class="button-left button-border"></td><td class="button-main-td"></td><td class="button-right button-border"></td></tr>');table.push('<tr class="button-background"><td class="button-left button-border"></td><td class="button-arrow-td">');table.push(arrow);table.push('</td><td class="button-right button-border"></td></tr>');table.push('</tbody><tfoot><tr><td class="button-bottom-left');table.push(isFillet);table.push('-corner button-corner"></td><td class="button-bottom button-background button-border"></td><td class="button-bottom-right');table.push(isFillet);table.push('-corner button-corner"></td></tr>')}else{if(this.options.arrowalign=="left"){table.push('<tr><td class="button-top-left');table.push(isFillet);table.push('-corner button-corner"></td><td colspan="2" class="button-top button-background button-border"></td><td class="button-top-right');table.push(isFillet);table.push('-corner button-corner"></td></tr></thead><tbody>');table.push('<tr class="button-background"><td class="button-left button-border"></td><td class="button-arrow-td">');table.push(arrow);table.push('</td><td class="button-main-td"></td><td class="button-right button-border"></td></tr>');table.push('</tbody><tfoot><tr><td class="button-bottom-left');table.push(isFillet);table.push('-corner button-corner"></td><td colspan="2" class="button-bottom button-background button-border"></td><td class="button-bottom-right');table.push(isFillet);table.push('-corner button-corner"></td></tr>)')}else{table.push('<tr><td class="button-top-left');table.push(isFillet);table.push('-corner button-corner"></td><td colspan="2" class="button-top button-background button-border"></td><td class="button-top-right');table.push(isFillet);table.push('-corner button-corner"></td></tr></thead><tbody>');table.push('<tr class="button-background"><td class="button-left button-border"></td><td class="button-main-td"></td><td class="button-arrow-td">');table.push(arrow);table.push('</td><td class="button-right button-border"></td></tr>');table.push('</tbody><tfoot><tr><td class="button-bottom-left');table.push(isFillet);table.push('-corner button-corner"></td><td colspan="2" class="button-bottom button-background button-border"></td><td class="button-bottom-right');table.push(isFillet);table.push('-corner button-corner"></td></tr>')}}}table.push("</tfoot></table>");return table.join("")},_createButtonInnerDom:function(){var text=this.options.text||"";var src=this.options.iconurl||"";var defaultview=this.options.defaultview;var textviewclass="";if(defaultview==0||defaultview=="0"){text="";textviewclass="button-text-hide";src=src||this.defaulturl+"button-default-dark.png"}else{if(defaultview==1||defaultview=="1"){text=text||"jazz-button";textviewclass="button-text-only";src=""}else{text=text||"jazz-button";src=src||this.defaulturl+"button-default-dark.png"}}var textdiv='<div class="button-text '+textviewclass+'">'+text+"</div>";var hiddenImgClass=src?"":"button-image-hide";var img='<img alt="" src="'+src+'" />';var main="";if(this.options.iconalign=="top"){main='<div class="button-main-top '+hiddenImgClass+'">'+img+"</div>"+textdiv}else{if(this.options.iconalign=="bottom"){main=textdiv+'<div class="button-main-bottom '+hiddenImgClass+'">'+img+"</div>"}else{if(this.options.iconalign=="right"){textdiv='<div class="button-text text-align-left '+textviewclass+'">'+text+"</div>";main=textdiv+'<div class="button-main-right '+hiddenImgClass+'">'+img+"</div>"}else{textdiv='<div class="button-text text-align-right '+textviewclass+'">'+text+"</div>";main='<div class="button-main-left '+hiddenImgClass+'">'+img+"</div>"+textdiv}}}return main},_createButtonMenuDom:function(){if(this.options.items.length==0){return}var items=this.options.items;var vtype=items[0]["vtype"]||"menu";var name=items[0]["name"]||"jazz-menu-"+(++jazz.zindex);items[0]["target"]=this.container;this.menu=jazz.widget(items[0])},_bindButtonEvents:function(){var $this=this;var gridpanel=this.element.parents("[vtype=gridpanel]");this.mainButton=this.container.find(".button-main-td,.button-corner,.button-border");this.mainButton.on("mousedown.button",function(e){if(e.which===2||e.which===3){return false}var checktype=$this.options.checktype;if(!$this.options.disabled){if(checktype=="radio"||checktype=="check"){}else{$this._toggleSelectedStyle("selected")}}}).on("mouseup.button",function(e){if(e.which===2||e.which===3){return false}$this._handleMouseupEvent();if(!$this.options.disabled){if($this.options.click){var data=null;if(gridpanel.length){data=gridpanel.gridpanel("getSelection")}if($this.options.delay){$this._event("click",e,data);$this.disable();setTimeout(function(){$this.enable()},$this.options.delaytime)}else{$this._event("click",e,data)}}}});this.container.on("contextmenu.jazz-button-contextmenu",function(e){return false}).on("click.button",function(e){if($this.option.showmenuevent=="hover"){$(this).trigger("mouseenter.menuButton")}})},_handleMouseupEvent:function(){var $this=this;var disabled=$this.options.disabled;if(!disabled){var group=$this.options.group;var checktype=$this.options.checktype;var toggleiconurl=$this.options.toggleiconurl;var iconurl=$this.options.iconurl;var defaultview=this.options.defaultview;if(checktype=="radio"||checktype=="check"){if(checktype=="radio"){$this._toggleSelectedStyle("selected");if(group){$('[group="'+group+'"]').each(function(i,domEle){if($this.element[0]!=this){var obj=$(this).data("button");if(obj){dv=obj.options.defaultview;if(parseInt(dv)==2||parseInt(dv)==0){if(obj.options.toggleiconurl){obj.element.find("img").attr("src",obj.options.iconurl)}}obj.container.removeClass("jazz-button-pressed")}}})}else{}}else{if(checktype=="check"){if($this.container.hasClass("jazz-button-pressed")){$this._toggleSelectedStyle("unselected")}else{$this._toggleSelectedStyle("selected")}}}}else{$this._toggleSelectedStyle("unselected")}}},_toggleSelectedStyle:function(style){var $this=this;var toggleiconurl=$this.options.toggleiconurl;var iconurl=$this.options.iconurl;var defaultview=this.options.defaultview;if(style=="selected"){if(parseInt(defaultview)==2||parseInt(defaultview)==0){if(toggleiconurl){$this.element.find("img").attr("src",toggleiconurl)}}$this.container.addClass("jazz-button-pressed")}else{if(style=="unselected"){if(parseInt(defaultview)==2||parseInt(defaultview)==0){if(toggleiconurl){$this.element.find("img").attr("src",iconurl)}}$this.container.removeClass("jazz-button-pressed")}}},_bindButtonMenuEvent:function(){if(this.options.showmenuevent=="click"){this._bindButtonMenuClickEvent()}else{this._bindButtonMenuHoverEvent()}},_bindButtonMenuHoverEvent:function(){if(this.options.items.length==0){return}var that=this;var disabled=that.options.disabled;this.container.on("mouseenter.menuButton",function(e){disabled=that.options.disabled;if(!disabled){$(this).find(".button-arrow-td img").show();$(this).addClass("jazz-button-pressed");that._showMenu();var menuname=that.menu.attr("name");$(".jazz-menu-base:not([name='"+menuname+"'])").hide();if($(this).data("time2")){clearTimeout($(this).data("time2"));$(this).data("time2","")}}}).on("mouseleave.menuButton",function(e){if(!disabled){var current=$(this);if(current.data("time2")){return}var time2=setTimeout(function(){var offset=current.offset();if(e.pageX<=offset.left||Math.ceil(e.pageX)>=offset.left+current.width()||e.pageY<=offset.top){that._hideMenu();current.find(".button-arrow-td img").hide();current.removeClass("jazz-button-pressed")}current.data("time2","")},100);$(this).data("time2",time2)}})},_bindButtonMenuClickEvent:function(){if(this.options.items.length==0){return}var that=this;var issplitbutton=that.options.issplitbutton;if(issplitbutton){this.menuButton=this.container.find(".button-arrow-td")}else{this.menuButton=this.container.find(".button-main-td");that.menuButton.off("mousedown.button").off("mouseup.button")}this.menuButton.on("mousedown.menuButton",function(e){if(e.which===2||e.which===3){return false}var disabled=that.options.disabled;var checktype=that.options.checktype;if(!disabled){if(checktype=="radio"||checktype=="check"){}else{that._toggleSelectedStyle("selected")}if(that.menu.is(":hidden")){that._showMenu()}else{that._hideMenu()}var menuname=that.menu.attr("name");$(".jazz-menu-base:not([name='"+menuname+"'])").hide()}e.preventDefault();e.stopPropagation()}).on("mouseup.menuButton",function(e){if(e.which===2||e.which===3){return false}var disabled=that.options.disabled;if(!disabled){that._handleMouseupEvent()}})},_bindDocumentClickEvents:function(){var $this=this;$(document.body).bind("mousedown.buttonmenu",function(e){if($this.menu.is(":hidden")){return}var target=$(e.target);if(target.is($this.element)){$this.menu.hide();return}if(target.is($this.menuButton)||target.is($this.menu)||$this.menu.has(target).length>0){return}var offset=$this.container.offset();if(e.pageX<offset.left||e.pageX>offset.left+$this.container.width()||e.pageY<offset.top||e.pageY>offset.top+$this.container.height()){$this.menu.hide()}})},_width:function(){},_height:function(){},_setButtonWidth:function(){if(!this.options.width||/^\d+(\.\d+)?%$/.test(this.options.width)){return}var settingWidth=parseInt(this.options.width)||0;var realWidth=0,containerMargin=$(".button-corner",this.container).width(),arrowWidth=0,issplitbutton=this.options.issplitbutton,arrowalign=this.options.arrowalign;if(settingWidth>0){if(issplitbutton&&(arrowalign=="left"||arrowalign=="right")){arrowWidth=this.container.find("td.button-arrow-td").width()}var elmarginWidth=this.element.outerWidth(true)-this.element.outerWidth();realWidth=settingWidth-(containerMargin*2)-arrowWidth-elmarginWidth;if(realWidth>0){this.element.width(realWidth)}}},_setButtonHeight:function(){if(!this.options.height||/^\d+(\.\d+)?%$/.test(this.options.height)){return}var settingHeight=parseInt(this.options.height)||0;var realHeight=0,containerMargin=$(".button-corner",this.container).height(),arrowHeight=0,issplitbutton=this.options.issplitbutton,arrowalign=this.options.arrowalign,el=this.container.find("td.button-main-td");if(settingHeight>0){if(issplitbutton&&(arrowalign=="top"||arrowalign=="bottom")){arrowHeight=this.container.find("td.button-arrow-td").height()}var elmarginHeight=el.outerHeight(true)-el.outerHeight();realHeight=settingHeight-(containerMargin*2)-arrowHeight-elmarginHeight;if(realHeight>0){el.height(realHeight);if(issplitbutton&&(arrowalign=="left"||arrowalign=="right")){el.css({"line-height":realHeight+"px"})}}}},_setButtonFillet:function(value){value=(value=="true")?true:value;value=(value=="false")?false:value;if((typeof value!="boolean")||this.options.isfillet==value){return}this.options.isfillet=value;if(this.options.isfillet){this.container.find(".button-top-left-corner").removeClass("button-top-left-corner").addClass("button-top-left-fillet-corner");this.container.find(".button-top-right-corner").removeClass("button-top-right-corner").addClass("button-top-right-fillet-corner");this.container.find(".button-bottom-left-corner").removeClass("button-bottom-left-corner").addClass("button-bottom-left-fillet-corner");this.container.find(".button-bottom-right-corner").removeClass("button-bottom-right-corner").addClass("button-bottom-right-fillet-corner")}else{this.container.find(".button-top-left-fillet-corner").removeClass("button-top-left-fillet-corner").addClass("button-top-left-corner");this.container.find(".button-top-right-fillet-corner").removeClass("button-top-right-fillet-corner").addClass("button-top-right-corner");this.container.find(".button-bottom-left-fillet-corner").removeClass("button-bottom-left-fillet-corner").addClass("button-bottom-left-corner");this.container.find(".button-bottom-right-fillet-corner").removeClass("button-bottom-right-fillet-corner").addClass("button-bottom-right-corner")}},_hideMenu:function(){this.menu.fadeOut("slow")},_showMenu:function(){this.menu.fadeIn("slow");this.menu.css({left:"",top:"","z-index":++jazz.zindex}).position({my:"left top",at:"left bottom",of:this.container})},_setOption:function(key,value){switch(key){case"isfillet":this._setButtonFillet(value);break;case"width":this.options.width=value;this._setButtonWidth();break;case"height":this.options.height=value;this._setButtonHeight();break;case"disabled":if(value==true||value=="true"){this.options.disabled=true;this.container.addClass("jazz-state-disabled")}else{this.options.disabled=false;this.container.removeClass("jazz-state-disabled")}break;case"text":if(value){var textobj=this.element.find(".button-text");this.options.text=value;textobj.html(value)}break;case"iconurl":if(value==""){this.element.find("img").parent().addClass("button-image-hide")}else{this.element.find("img").parent().removeClass("button-image-hide")}this.element.find("img").attr("src",value)}this._super(key,value)},disable:function(){this._setOption("disabled",true)},enable:function(){this._setOption("disabled",false)},hide:function(){this.container.hide();if(this.menu&&this.menu.is(":visible")){this.menu.hide()}},show:function(){this.container.show()},highlight:function(){if(!this.options.disabled){if(this.options.toggleiconurl){this.element.find("img").attr("src",this.options.toggleiconurl)}this.container.addClass("jazz-button-pressed")}},unhighlight:function(){if(!this.options.disabled){if(this.options.toggleiconurl){this.element.find("img").attr("src",this.options.iconurl)}this.container.removeClass("jazz-button-pressed")}},triggerClick:function(){this.mainButton.trigger("mousedown.button");this.mainButton.trigger("mouseup.button")}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent","form/jazz.form.ComboxField"],factory)}else{factory($)}})(jQuery,function($){var ElementHandlers={"{ComboPageSize}":{markup:'<span class="jazz-paginator-pagesize"><select class="jazz-paginator-pagesize-select"><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option></select></span>',create:function(paginator){var element=$(this["markup"]);element.find("select.jazz-paginator-pagesize-select").attr("value",paginator.options.pagerows);element.find("select.jazz-paginator-pagesize-select").off("change.pagesize").on("change.pagesize",function(){paginator.gridtableObject.gridtable("clickGridTablePaginator",0,parseInt(this.value))});return element},align:"left",update:function(element,state){}},"{FirstPageLink}":{markup:'<span title="首页" class="jazz-paginator-first jazz-paginator-element jazz-state-default jazz-corner-all"><span class="jazz-icon jazz-icon-seek-first">p</span></span>',create:function(paginator){var element=$(this["markup"]);if(paginator.options.page==0){element.addClass("jazz-state-disabled");element.children().addClass("jazz-icon-disabled")}if(jazz.config.paginatorStyle==="text"){element.text("首页").addClass("jazz-paginator-text-btn")}element.on("click.paginator",function(){if(!$(this).hasClass("jazz-state-disabled")){paginator.option("page",0)}});return element},align:"left",update:function(element,state){if(state.page==0){element.addClass("jazz-state-disabled").removeClass("jazz-state-hover jazz-state-active");element.children().addClass("jazz-icon-disabled")}else{element.removeClass("jazz-state-disabled");element.children().removeClass("jazz-icon-disabled")}}},"{PreviousPageLink}":{markup:'<span title="上一页" class="jazz-paginator-prev jazz-paginator-element jazz-state-default jazz-corner-all"><span class="jazz-icon jazz-icon-seek-prev">p</span></span>',create:function(paginator){var element=$(this["markup"]);if(paginator.options.page==0){element.addClass("jazz-state-disabled");element.children().addClass("jazz-icon-disabled")}if(jazz.config.paginatorStyle==="text"){element.text("上页").addClass("jazz-paginator-text-btn")}element.on("click.paginator",function(){if(!$(this).hasClass("jazz-state-disabled")){paginator.option("page",paginator.options.page-1)}});return element},align:"left",update:function(element,state){if(state.page==0){element.addClass("jazz-state-disabled").removeClass("jazz-state-hover jazz-state-active");element.children().addClass("jazz-icon-disabled")}else{element.removeClass("jazz-state-disabled");element.children().removeClass("jazz-icon-disabled")}}},"{NextPageLink}":{markup:'<span title="下一页" class="jazz-paginator-next jazz-paginator-element jazz-state-default jazz-corner-all"><span class="jazz-icon jazz-icon-seek-next">p</span></span>',create:function(paginator){var element=$(this["markup"]);if(paginator.options.page==(paginator.getPageCount()-1)){element.addClass("jazz-state-disabled").removeClass("jazz-state-hover jazz-state-active");element.children().addClass("jazz-icon-disabled")}if(jazz.config.paginatorStyle==="text"){element.text("下页").addClass("jazz-paginator-text-btn")}element.on("click.paginator",function(){if(!$(this).hasClass("jazz-state-disabled")){paginator.option("page",paginator.options.page+1)}});return element},align:"left",update:function(element,state){if(state.page==(state.pagecount-1)){element.addClass("jazz-state-disabled").removeClass("jazz-state-hover jazz-state-active");element.children().addClass("jazz-icon-disabled")}else{element.removeClass("jazz-state-disabled");element.children().removeClass("jazz-icon-disabled")}}},"{LastPageLink}":{markup:'<span title="末页" class="jazz-paginator-last jazz-paginator-element jazz-state-default jazz-corner-all"><span class="jazz-icon jazz-icon-seek-end">p</span></span>',create:function(paginator){var element=$(this["markup"]);if(paginator.options.page==(paginator.getPageCount()-1)){element.addClass("jazz-state-disabled").removeClass("jazz-state-hover jazz-state-active");element.children().addClass("jazz-icon-disabled")}if(jazz.config.paginatorStyle==="text"){element.text("末页").addClass("jazz-paginator-text-btn")}element.on("click.paginator",function(){if(!$(this).hasClass("jazz-state-disabled")){paginator.option("page",paginator.getPageCount()-1)}});return element},align:"left",update:function(element,state){if(state.page==(state.pagecount-1)){element.addClass("jazz-state-disabled").removeClass("jazz-state-hover jazz-state-active");element.children().addClass("jazz-icon-disabled")}else{element.removeClass("jazz-state-disabled");element.children().removeClass("jazz-icon-disabled")}}},"{PageLinks}":{markup:'<span class="jazz-paginator-pages" style="line-height:20px;"></span>',create:function(paginator){var element=$(this.markup);element.append('<span class="jazz-state-default jazz-paginaotr-nowpage jazz-paginator-info">第</span><span class="jazz-state-default jazz-paginator-input">&nbsp;<input type="text" value="1" /></span><span class="jazz-state-default jazz-paginator-info">页，共'+paginator.getPageCount()+"页</span>");var inputw=element.find('input[type="text"]');inputw.focus(function(){$(this).parents(".jazz-paginator").find(".jazz-paginaotr-hidden-button").css({left:"105px"}).show().animate({left:"123px",opacity:"1"},"slow")});inputw.blur(function(){$(this).parents(".jazz-paginator").find(".jazz-paginaotr-hidden-button").animate({left:"100px",opacity:"0"},"slow",function(){$(this).hide()})});return element},align:"left",update:function(element,state){var input=element.find(".jazz-paginator-input input");input.val(parseInt(state.page)+1)}},"{PageInfo}":{markup:'<span class="jazz-paginator-element jazz-paginator-info jazz-paginator-text"></span>',create:function(paginator){var element=$(this.markup),nowP=(paginator.options.pagerows*(paginator.options.page+1)),html="当前显示"+(paginator.options.pagerows*paginator.options.page+1)+"-"+(nowP>paginator.options.totalrecords?paginator.options.totalrecords:nowP)+"，共"+paginator.options.totalrecords+"条";if(jazz.config.paginatorStyle==="text"){html="共<span class='jazz-paginator-totalrow'>"+paginator.options.totalrecords+"</span>条记录, 每页显示<div class='jazz-paginator-pagerows-input'></div>条, 共<span class='jazz-paginator-num'>"+paginator.getPageCount()+'</span>页. <span class="jazz-paginator-goto-info">跳转到 <input type="text" name="p_num" class="jazz-paginator-goto-input" /></span><span title=\'确定\' class=\'jazz-paginator-element jazz-state-default js-goto\'>确定</span>'}element.html(html);var that=paginator;element.find(".js-goto").on("click",function(){var p_num=parseInt($(this).prev().children("input").val());if(!p_num||!jazz.isNumber(p_num)||(p_num<1)||(p_num>that.getPageCount())){$(this).prev().children("input").val("");return}$(this).parents("[vtype=paginator]").paginator("setPage",(p_num-1))});return element},align:"right",update:function(element,state){var nowP=state.first+parseInt(state.pagerows),html;if(jazz.config.paginatorStyle==="text"){element.find(".jazz-paginator-goto-input").val("");element.find(".jazz-paginator-num").text(state.pagecount);element.find(".jazz-paginator-totalrow").text(state.totalrows);element.find(".jazz-paginator-pagerows-input").comboxfield("setValue",state.pagerows)}else{html="当前显示"+(state.first+1)+"-"+(nowP>state.totalrows?state.totalrows:nowP)+"，共"+state.totalrows+"条";element.text(html)}}},"{PageGoto}":{markup:'<span class="jazz-paginator-goto-info">跳转到 <input type="text" name="p_num" class="jazz-paginator-goto-input" /></span><span class="jazz-paginator-page jazz-paginator-element jazz-state-default jazz-paginator-goto"></span>',create:function(paginator){var element=$(this["markup"]);element.on("click.paginator",function(){var p_num=parseInt($(this).parent().find("input.jazz-paginator-goto-input").val());if(!p_num||!jazz.isNumber(p_num)||(p_num<1)||(p_num>paginator.getPageCount())){$(this).parent().find("input.jazz-paginator-goto-input").val("");return}paginator.setPage(p_num-1)});return element},update:function(element,state){element[0].value=""}},"{PageRefresh}":{markup:'<span title="刷新" class="jazz-paginator-refresh jazz-paginator-element jazz-state-default jazz-corner-all"><span class="jazz-icon">p</span></span>',align:"left",create:function(paginator){var element=$(this["markup"]);element.on("click.paginator",function(){paginator.setPage(0,"refresh")});return element},update:function(element,state){}}};$.widget("jazz.paginator",$.jazz.boxComponent,{options:{totalrecords:0,page:0,pagerows:10,template:"{FirstPageLink} {PreviousPageLink} {PageLinks} {LastPageLink} {NextPageLink} {PageInfo}",buttons:[],gopage:null},_create:function(){this._super();this.element.addClass("jazz-paginator");this.element.addClass("jazz-paginator-ext");this.element.append('<div class="jazz-paginator-content"><div class="jazz-paginator-left"></div><div class="jazz-paginator-right"></div><div style="clear:both;"></div></div>');this.id=this.element.attr("id");if(!this.id){this.id=this.element.uniqueId().attr("id")}this.options.totalrecords=parseInt(this.options.totalrecords,10)||0;this.paginatorElements=[];this._initTemplate();var elementKeys=this.options.template.split(/[ ]+/),paginaotrLeft=this.element.find(".jazz-paginator-left"),paginaotrRight=this.element.find(".jazz-paginator-right");for(var i=0,len=elementKeys.length;i<len;i++){var elementKey=elementKeys[i],handler=ElementHandlers[elementKey];if(handler){var paginatorElement=handler.create(this);this.paginatorElements[elementKey]=paginatorElement;if(handler.align=="left"){paginaotrLeft.append(paginatorElement)}else{paginaotrRight.append(paginatorElement)}}}this._setPageRowBox();this.addButton();if(jazz.config.paginatorStyle==="text"){}else{this.element.find(".js-goto").remove();this.element.find(".jazz-paginator-content").append("<a title='跳转' href='javascript:;' class='jazz-paginaotr-hidden-button'>确定</a>")}},_init:function(){this._super();var parent=this.getParentComponent();if(parent){if(parent.attr("vtype")=="gridpanel"){this.gridpanel=parent.data("gridpanel")}}this._bindEvents()},_bindEvents:function(){var $this=this,input;input=$this.element.find(".jazz-paginator-input input");input.on("keypress",function(e){var curKey=e.keyCode;if(curKey==13){var inputVal=$this.element.find('input[type="text"]').val();if($this._isPageLegal(inputVal)&&(inputVal-1)!=$this.options.page){$this.setPage(inputVal-1)}}});$this.element.find(".jazz-paginaotr-hidden-button").off("click.paginator").on("click.paginator",function(){var inputVal=$this.element.find('input[type="text"]').val();if($this._isPageLegal(inputVal)&&(inputVal-1)!=$this.options.page){$this.setPage(inputVal-1)}})},_initTemplate:function(){this.options.template="{FirstPageLink}  {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {PageRefresh} {PageInfo}";if(jazz.config.paginatorStyle==="text"){this.options.template="{FirstPageLink}  {PreviousPageLink} {NextPageLink} {LastPageLink} {PageInfo}"}},_isPageLegal:function(page){if(!/^\d+$/.test(page)){this.element.find('input[type="text"]').val((this.options.page+1));return false}if(page<0||page>Math.ceil(this.options.totalrecords/this.options.pagerows)){return false}return true},_setOption:function(key,value){if(key=="page"){this.setPage(value)}else{$.Widget.prototype._setOption.apply(this,arguments)}},_setPageRowBox:function(){var that=this;var tmp_paginator={ar:jazz.config.fieldIconWidth};jazz.config.fieldIconWidth=6;this.element.find(".jazz-paginator-pagerows-input").comboxfield({vtype:"comboxfield",name:"jazz-paginator-pagerows-input-"+(jazz.getRandom()),width:30,height:20,isshowblankitem:false,dataurl:[{text:"5",value:5},{text:"10",value:10},{text:"20",value:20},{text:"50",value:50}],itemselect:function(e,ui){that.options.pagerows=ui.value;that.setPage(0,"refresh")}});this.element.find(".jazz-paginator-pagerows-input").comboxfield("setValue",this.options.pagerows).css({margin:"3px 0 0",padding:0});jazz.config.fieldIconWidth=tmp_paginator.ar},_reflashChildWidth:function(){},_updateUI:function(state){for(var paginatorElementKey in this.paginatorElements){ElementHandlers[paginatorElementKey].update(this.paginatorElements[paginatorElementKey],state)}},addButton:function(){if(this.options.buttons===false){return}var $this=this,btns=$this.options.buttons;for(var i=0,len=btns.length;i<len;i++){var btn=btns[i],id=btn.id||this.element.uniqueId(),btnHtml="";if($.isFunction(btn.renderer)){btnHtml=btn.renderer.call(this)}else{btnHtml="<span>"+(btn.title?btn.title:"")+"</span>"}$(btnHtml).appendTo(this.element.find(".jazz-paginator-left"));$this.element.find("> .jazz-paginator-refresh").attr("id",this.id+"_"+id).addClass("jazz-paginator-element jazz-paginator-custom "+(btn.classname?btn.classname:""));$this.element.find(".jazz-paginator-refresh").on("click",function(){if($.isFunction(btn.callback)){btn.callback.call($this)}})}},getPageCount:function(){return Math.ceil(parseInt(this.options.totalrecords)/parseInt(this.options.pagerows))||1},getPageFirstRowNum:function(){return parseInt(this.options.pagerows)*this.options.page},setPage:function(p,silent){var $this=this,pc=$this.getPageCount();if(p>=0&&p<pc&&($this.options.page!=p||(silent==="refresh"&&p===0))){var newState={first:$this.options.pagerows*p,pagerows:$this.options.pagerows,page:p,pagecount:pc,totalrows:$this.options.totalrecords};this.options.page=p;if(!silent||silent==="refresh"){var gopage=$this.options.gopage;if($.isFunction(gopage)){$this._event("gopage",null,newState)}else{if($.isFunction(window[gopage])){window[gopage].call(this,newState)}else{if($this.gridpanel){$this.gridpanel.bindPaginatorClickEvent((p+1),$this.options.pagerows)}}}}this._updateUI(newState)}},updatePage:function(paginationInfo){this.options.page=paginationInfo.page>0?(paginationInfo.page-1):0;this.options.pagerows=paginationInfo.pagerows;this.options.totalrecords=paginationInfo.totalrecords;this.element.find(".jazz-paginator-left").children().remove();this.element.find(".jazz-paginator-right").children().remove();var elementKeys=this.options.template.split(/[ ]+/),paginaotrLeft=this.element.find(".jazz-paginator-left"),paginaotrRight=this.element.find(".jazz-paginator-right");for(var i=0,len=elementKeys.length;i<len;i++){var elementKey=elementKeys[i],handler=ElementHandlers[elementKey];if(handler){var paginatorElement=handler.create(this);this.paginatorElements[elementKey]=paginatorElement;if(handler.align=="left"){paginaotrLeft.append(paginatorElement)}else{paginaotrRight.append(paginatorElement)}}}this._setPageRowBox();this.addButton();this._bindEvents();var state={first:this.getPageFirstRowNum(),pagerows:this.options.pagerows,page:this.options.page,pagecount:this.getPageCount(),totalrows:this.options.totalrecords};this._updateUI(state)}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Paginator","jazz.Loading","jazz.DataFormat","jazz.Panel"],factory)}else{factory($)}})(jQuery,function($){(function($,undefined){jazz.namespace("grid");$.widget("jazz.gridpanel",$.jazz.panel,{options:{vtype:"gridpanel",name:null,dataurl:null,dataurlparams:null,iseditable:false,isshoweditcell:false,editortype:"cell",isshowselecthelper:true,isshowtoolbar:true,isshowpaginator:true,defaultview:"table",lineno:true,linenowidth:30,linetype:0,linestyle:1,rowselectable:true,selecttype:2,datarender:null,dataloadcomplete:null,queryparams:{},sortparams:{},items:null,isgroupsummary:false,ispagesummary:false,groupfield:null,grouptitlefield:null,isgroupexpand:true},_create:function(){this.originHtml=this.element[0].outerHTML;this._super();this.element.addClass("jazz-gridpanel");this.content.css("overflow","hidden")},_init:function(){this.isGridPanelAlreadyInit=false;this._super();if(!this.options.items||this.options.items.length==0){this._createContent(this.content)}this.gtoolbar=this.getChildrenComponentByVtype("toolbar");this.gcolumn=this.getChildrenComponentByVtype("gridcolumn");this.gtable=this.getChildrenComponentByVtype("gridtable");this.gcard=this.getChildrenComponentByVtype("gridcard");this.gpaginator=this.getChildrenComponentByVtype("paginator");this._extendGridpanelFunctions();this._settingGridpanelComponentView();this.paginationInfo={};this.rows=[];this._initLoadData()},_extendGridpanelFunctions:function(){if(this.gtable){var gtable=this.gtable.data("gridtable");if(gtable&&gtable._isGridtableEditable()){$.extend(this,jazz.grid.editorgridpanel)}}},_settingGridpanelComponentView:function(){if(this.options.isshowtoolbar==false||this.options.isshowtoolbar=="false"){if(this.gtoolbar){this.gtoolbar.hide()}}if(this.options.isshowpaginator==false||this.options.isshowpaginator=="false"){if(this.gpaginator){this.gpaginator.hide()}}this._settingPageareaHeight();if(this.options.defaultview=="card"){if(this.gcolumn){this.gcolumn.hide()}if(this.gtable){this.gtable.hide()}}else{if(this.gcard){this.gcard.hide()}}},_height:function(){this._super();if(this.isGridPanelAlreadyInit){this._settingPageareaHeight()}else{this.isGridPanelAlreadyInit=true}},_settingPageareaHeight:function(){if(parseInt(this.options.height)>0||this.options.layout=="fit"){var toolbarheight=0;if(this.gtoolbar&&this.gtoolbar.is(":visible")){toolbarheight=this.gtoolbar.outerHeight(true)||0}var gridcolumnheight=0;if(this.gcolumn&&this.gcolumn.is(":visible")){gridcolumnheight=this.gcolumn.outerHeight(true)||0}var paginatorheight=0;if(this.gpaginator&&this.gpaginator.is(":visible")){paginatorheight=this.gpaginator.outerHeight(true)||0}var pagearea=this.element.find(".jazz-pagearea");var h=0;if(pagearea[0]){if(this.options.defaultview=="card"){h=this.content.height()-toolbarheight-paginatorheight;pagearea.height(h)}else{h=this.content.height()-toolbarheight-gridcolumnheight-paginatorheight;pagearea.height(h)}}}else{}},_getGridOptions:function(){return this.options},getToolbar:function(){return this.gtoolbar},getGridColumn:function(){return this.gcolumn},getGridTable:function(){return this.gtable},getGridCard:function(){return this.gcard},getPaginator:function(){return this.gpaginator},recalculateGridpanelWidth:function(){this._width();this._reflashLayout();this._reflashChildWidth();this._height();this._reflashLayout();this._reflashChildHeight()},showColumn:function(columnname){this.gcolumn.gridcolumn("showColumn",columnname)},hideColumn:function(columnname){this.gcolumn.gridcolumn("hideColumn",columnname)},showView:function(viewname){var $this=this;var hideheader=$this.gcolumn.data("gridcolumn").options.hideheader;var gridcolumnheight=0;if(!hideheader||hideheader=="false"){gridcolumnheight=$this.gcolumn.outerHeight(true)||0}var display="";if(viewname=="card"){display=$this.gcard.css("display");if(display=="none"){if(parseInt($this.options.height)>0||$this.options.layout=="fit"){$this.gcard.parent().height($this.gcard.parent().height()+gridcolumnheight)}$this.gcard.parent().css({overflow:"auto"});if(!hideheader||hideheader=="false"){$this.gcolumn.hide()}$this.gtable.hide();$this.gcard.show()}}else{display=$this.gtable.css("display");if(display=="none"){if(parseInt($this.options.height)>0||$this.options.layout=="fit"){$this.gcard.parent().height($this.gcard.parent().height()-gridcolumnheight)}$this.gcard.parent().css({overflow:"hidden"});if(!hideheader||hideheader=="false"){$this.gcolumn.show()}$this.gtable.show();$this.gcard.hide()}}},destroyComp:function(){if(this.gtoolbar){var toolbar=this.gtoolbar.data("toolbar");toolbar.destroy()}if(this.gcolumn){var gridcolumn=this.gcolumn.data("gridcolumn");gridcolumn.destroy()}if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.destroy()}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.destroy()}if(this.gpaginator){var paginator=this.gpaginator.data("paginator");paginator.destroy()}this.element.replaceWith(this.originHtml);this.destroy()},setEditorCell:function(rowIndex,colIndex,editState){var rowIndex=parseInt(rowIndex);var colIndex=parseInt(colIndex);var editState=editState==true||editState=="true";if(rowIndex>0||colIndex>0){if(this.gtable){this.gtable.gridtable("setEditorCell",rowIndex,colIndex,editState)}}},addRow:function(data){if(data){this._setRowUUID(data);this.rows=this.rows.concat(data);data=$.extend(true,[],data);var $this=this;this._code2DataRenderGridpanel(data,function(rowdata){$this._processGridpanelData(rowdata);if($this.gtable){var gridtable=$this.gtable.data("gridtable");gridtable.addRow(rowdata)}if($this.gcard){var gridcard=$this.gcard.data("gridcard");gridcard.addCard(rowdata)}})}},updateRow:function(data){var rowuuid=data.rowuuid;if(!rowuuid){return null}this._updateTableAndCardById(data,rowuuid,"rowuuid")},updateRowById:function(data,id){if(!id){return null}var keyColumn=this._getGridcolumnKeyCode();if(!keyColumn){return null}this._updateTableAndCardById(data,id,keyColumn)},updateRowByIndex:function(data,rowIndex){var id=this._getRowUUIDByRowIndex(rowIndex);if(!id){return null}this._updateTableAndCardById(data,id,"rowuuid")},_updateTableAndCardById:function(data,id,keyColumn){var row=null;for(var i=0,len=this.rows.length;i<len;i++){if(this.rows[i][keyColumn]==id){for(var key in data){this.rows[i][key]=data[key]}row=$.extend(true,{},this.rows[i]);break}}if(!row){return null}var rowarr=[];rowarr.push(row);var $this=this;this._code2DataRenderGridpanel(rowarr,function(rowdata){$this._processGridpanelData(rowdata);if($this.gtable){var gridtable=$this.gtable.data("gridtable");gridtable.updateRowById(rowdata[0],rowdata[0]["rowuuid"])}if($this.gcard){var gridcard=$this.gcard.data("gridcard");gridcard.updateCardById(rowdata[0],rowdata[0]["rowuuid"])}})},_code2DataRenderGridpanel:function(rowsdata,fn){var $this=this;var cols=null,toCodeColumn=null;if($this.gcolumn){var gridcolumn=$this.gcolumn.data("gridcolumn");cols=gridcolumn.cols;toCodeColumn=gridcolumn.toCodeColumn;toCodeColumn=$this._combinedStaticAndUrlValueSet(toCodeColumn)}if(toCodeColumn&&toCodeColumn.length>0){$this._code2DataComplete(100,5000,rowsdata,toCodeColumn,function(data){fn(data)})}else{fn(rowsdata)}},getAllData:function(){return this.rows||[]},getRow:function(rowIndex){rowIndex=parseInt(rowIndex)+1;var data=this.getRowDataByIndex(rowIndex);return data},getRowLength:function(){return this.rows?this.rows.length:0},getRowDataById:function(id){if(!id){return null}var keyColumn=this._getGridcolumnKeyCode();if(!keyColumn){return null}var data=null;var ids=[];ids.push(id);data=this._getRowdataByKey(ids,keyColumn,"singleobject");return data},getRowDataByIndex:function(index){var id=this._getRowUUIDByRowIndex(index);if(!id){return null}var $this=this;var data=null;if(id){var ids=[];ids.push(id);data=$this._getRowdataByKey(ids,"rowuuid","singleobject")}return data},_getRowUUIDByRowIndex:function(index){var $this=this;var id=null;if($this.gtable){var tds=$this.gtable.find("td.jazz-grid-cell-no");for(var i=0,len=tds.length;i<len;i++){var lineno=$(tds[i]).html();if(parseInt(lineno)==parseInt(index)){id=$(tds[i]).parent().attr("id");break}}}return id},_getRowUUIDByKeyCode:function(dataId){var keyColumn=this._getGridcolumnKeyCode();if(!keyColumn){return null}var ids=[],rowuuid=null;ids.push(dataId);var data=this._getRowdataByKey(ids,keyColumn,"singleobject");if(data){rowuuid=data.rowuuid}return rowuuid},removeRow:function(data){var rowuuid=data.rowuuid;if(!rowuuid){return null}var data=this._removeTableAndCardById(rowuuid,"rowuuid");return data},removeRowById:function(id){if(!id){return null}var keyColumn=this._getGridcolumnKeyCode();if(!keyColumn){return null}var data=this._removeTableAndCardById(id,keyColumn);return data},removeRowByIndex:function(index){var id=this._getRowUUIDByRowIndex(index);if(!id){return null}var data=this._removeTableAndCardById(id,"rowuuid");return data},_removeTableAndCardById:function(id,keyColumn){if(!id){return null}var data=this._removeRowdataByKey(id,keyColumn);if(data&&data.rowuuid){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.removeRowById(data.rowuuid)}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.removeCardById(data.rowuuid)}}return data},getSelection:function(){var $this=this;var data=null;data=$this.getSelectedRowData();return data||[]},getSelectedRowData:function(){var $this=this;var data=null;var rowuuids=$this._getSelectedRowId();data=$this._getRowdataByKey(rowuuids,"rowuuid")||[];if(data){var trId="",no="";for(var i=0,len=data.length;i<len;i++){if($this.gtable){trId=data[i]["rowuuid"];no=$this.gtable.find("#"+trId+" td.jazz-grid-cell-no").html();data[i]["lineNo"]=no||""}else{data[i]["lineNo"]=""}}}return data},_getSelectedRowId:function(){var $this=this;var idArray=[],id=null;if($this.gtable){var trs=$this.gtable.find("tr[aria-selected=true]");for(var i=0,len=trs.length;i<len;i++){id=$(trs[i]).attr("id");if(id){idArray.push(id)}}}else{if($this.gcard){var cards=$this.gcard.find("div.jazz-grid-cardcell[aria-selected=true]");for(var i=0,len=cards.length;i<len;i++){id=$(cards[i]).attr("id");if(id){idArray.push(id)}}}}return idArray},_getRowdataByKey:function(ids,key,returnDataType){var $this=this,data=[];if(!ids||ids.length==0||!key){return null}var num=ids.length;for(var i=0,len=$this.rows.length;i<len;i++){if(num==0){break}for(var j=0;j<ids.length;j++){if($this.rows[i][key]==ids[j]){data.push($this.rows[i]);num=num-1;break}}}return returnDataType=="singleobject"&&data.length==1?data[0]:data},_removeRowdataByKey:function(id,key){var $this=this,data=null;if(!id||!key){return data}for(var i=0,len=$this.rows.length;i<len;i++){if($this.rows[i][key]==id){data=$this.rows[i];delete $this.rows[i];break}}for(var j=0,ln=$this.rows.length;j<ln;j++){if(!$this.rows[j]){$this.rows.splice(j,1)}}return data},getSelectedRowDataById:function(id){if(!id){return null}var data=null;var ids=[];ids.push(id);data=this._getRowdataByKey(ids,"rowuuid","singleobject");return data},selectRow:function(id){this.selectRowById(id)},unselectRow:function(id){this.unselectRowById(id)},selectRowById:function(id){if(!id){return}var rowuuid=this._getRowUUIDByKeyCode(id);if(rowuuid){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.selectRow(rowuuid)}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.selectRow(rowuuid)}}},selectRowByIndex:function(index){},unselectRowById:function(id){if(!id){return}var rowuuid=this._getRowUUIDByKeyCode(id);if(rowuuid){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.unselectRow(rowuuid)}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.unselectRow(rowuuid)}}},unselectRowByIndex:function(index){},selectAllRows:function(){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.selectAllRows()}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.selectAllRows()}},unselectAllRows:function(){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.unselectAllRows()}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.unselectAllRows()}},_initLoadData:function(){var $this=this;if($this.options.isshowpaginator||$this.options.isshowpaginator=="true"){if($this.gpaginator){var paginator=$this.gpaginator.data("paginator");var pagerows=0;if(paginator){pagerows=paginator.options.pagerows||0}else{pagerows=$this.gpaginator.attr("pagerows")||0}$this.paginationInfo.pagerows=parseInt(pagerows)}}if($this.options.dataurl){$this.element.find(".jazz-pagearea").loading();var params={url:$this.options.dataurl,params:$this.options.dataurlparams,pageparams:$this.paginationInfo,showloading:false,callback:function(responseText,$this){$this._successLoadData("init",responseText,null,null)}};$.DataAdapter.submit(params,$this)}},_successLoadData:function(loadDataType,responseText,requestdatacomplete,isRebindPaginator){var $this=this;if(responseText&&typeof(responseText)=="object"){var dataObj=responseText.data;if(dataObj){$this.paginationInfo.page=dataObj.page||1;$this.paginationInfo.pagerows=dataObj.pagerows||10;$this.paginationInfo.totalrows=dataObj.totalrows||0;$this.rows=dataObj.rows;if($this.rows){$this._setRowUUID($this.rows);var rowsdata=$.extend(true,[],$this.rows);var cols=null,toCodeColumn=null;if($this.gcolumn){var gridcolumn=$this.gcolumn.data("gridcolumn");cols=gridcolumn.cols;toCodeColumn=gridcolumn.toCodeColumn;toCodeColumn=$this._combinedStaticAndUrlValueSet(toCodeColumn)}if(toCodeColumn&&toCodeColumn.length>0){$this._code2DataComplete(100,5000,rowsdata,toCodeColumn,function(data){if(loadDataType=="init"){$this._renderGridpanelData(data)}else{$this._requestLoadData(data,requestdatacomplete,isRebindPaginator)}})}else{if(loadDataType=="init"){$this._renderGridpanelData(rowsdata)}else{$this._requestLoadData(rowsdata,requestdatacomplete,isRebindPaginator)}}}}}try{$this.element.find(".jazz-pagearea").loading("hide")}catch(e){jazz.log(e)}},_setRowUUID:function(data){var $this=this;if(data){for(var i=0,len=data.length;i<len;i++){data[i]["rowuuid"]=Math.uuid(32)}}},_getGridcolumnKeyCode:function(){var $this=this;var keyColumn=null;if($this.gcolumn){var gridcolumn=$this.gcolumn.data("gridcolumn");keyColumn=gridcolumn.keyCode}return keyColumn},_processGridpanelData:function(rowsdata){if(this.gcolumn){var gridcolumn=this.gcolumn.data("gridcolumn");cols=gridcolumn.cols;var data=null,columnname="",datatype="",dataformat="";for(var i=0,rowslen=rowsdata.length;i<rowslen;i++){data=rowsdata[i];for(var j=0,len=cols.length;j<len;j++){columnname=cols[j]["columnname"];datatype=cols[j]["datatype"];dataformat=cols[j]["dataformat"];if(datatype&&data[columnname]!=undefined){data[columnname]=jazz.util.parseDataByDataFormat({cellvalue:data[columnname],datatype:datatype,dataformat:dataformat})}}}}this._event("datarender",null,{data:rowsdata})},_renderGridpanelData:function(rowsdata){var $this=this;$this._processGridpanelData(rowsdata);var delay=100,timeout=5000;if($this.gtable){var gridtable=$this.gtable.data("gridtable");if(gridtable){gridtable.renderGridtableData(rowsdata,true)}else{loopReloadData($this.gtable,"gridtable",0)}}if($this.gcard){var gridcard=$this.gcard.data("gridcard");if(gridcard){gridcard.renderGridcardData(rowsdata,true)}else{loopReloadData($this.gcard,"gridcard",0)}}if($this.gpaginator){var paginator=$this.gpaginator.data("paginator");var a=$this.paginationInfo;if(paginator){paginator.updatePage({page:a.page,pagerows:a.pagerows,totalrecords:a.totalrows})}else{loopReloadData($this.gpaginator,"paginator",0)}}$this.recomputeGridTableWidth();$this._event("dataloadcomplete",null,{data:$this.rows,paginationInfo:$this.paginationInfo});function loopReloadData(obj,dataname,count){var compObject=obj.data(dataname);if(compObject){if(dataname=="gridtable"){compObject.renderGridtableData(rowsdata,true)}else{if(dataname=="gridcard"){compObject.renderGridcardData(rowsdata,true)}else{if(dataname=="paginator"){compObject.updatePage({page:$this.paginationInfo.page,pagerows:$this.paginationInfo.pagerows,totalrecords:$this.paginationInfo.totalrows})}}}}else{if(count*delay<=timeout){count++;setTimeout(function(){loopReloadData(obj,dataname,count)},delay)}}}},_combinedStaticAndUrlValueSet:function(codeColumn){if(!codeColumn||!codeColumn.length>0){return[]}var columnname=null;var valueset=null;var datatype=null;var tempArray=[];for(var i=0,len=codeColumn.length;i<len;i++){var temp=codeColumn[i];columnname=temp.columnname;valueset=temp.valueset;datatype=temp.datatype;if(valueset){if(valueset.indexOf("[")==0&&valueset.lastIndexOf("]")==valueset.length-1){valueset=eval("("+valueset+")");tempArray.push({columnname:columnname,valueset:"",resultset:valueset,datasettype:"static",datatype:datatype})}else{if(valueset.indexOf("{")!=-1||valueset.indexOf("{")!=-1){}else{tempArray.push({columnname:columnname,valueset:valueset,resultset:null,datasettype:"url",datatype:datatype})}}}}return tempArray},_code2data:function(valuesetColumn,rowsData){var row=null;var codeColumn=null;var columnName="";var resultset=null;var datatype=null;var oldText=null;for(var j=0,len=rowsData.length;j<len;j++){row=rowsData[j];for(var i=0;i<valuesetColumn.length;i++){codeColumn=valuesetColumn[i];resultset=codeColumn.resultset;if(resultset){columnName=codeColumn.columnname;oldText=row[columnName];datatype=codeColumn.datatype;if(datatype=="comboxfield"){for(var n=0;n<resultset.length;n++){if(oldText==resultset[n].value){row[columnName]=resultset[n].text}}}else{if(datatype=="comboxtreefield"){for(var n=0;n<resultset.length;n++){if(oldText==resultset[n].id){row[columnName]=resultset[n].name}}}else{for(var n=0;n<resultset.length;n++){if(oldText==resultset[n].value){row[columnName]=resultset[n].text}}}}}}}return rowsData},_code2DataComplete:function(delay,timeout,rowsData,toCodeColumn,callback){var count=0,$this=this,datatranslated;if(rowsData){codeToDataComplete(toCodeColumn,0)}function codeToDataComplete(valuesetColumn,index){if(!valuesetColumn||valuesetColumn.length==0){return}if(index==valuesetColumn.length){datatranslated=$this._code2data(valuesetColumn,rowsData);callback.call($this,datatranslated)}else{if(index<valuesetColumn.length){var datasettype=valuesetColumn[index]["datasettype"];var resultset=valuesetColumn[index]["resultset"];if(datasettype=="static"){count=0;index=index+1;codeToDataComplete(valuesetColumn,index)}else{if(datasettype=="url"&&resultset){count=0;index=index+1;codeToDataComplete(valuesetColumn,index)}else{if(datasettype=="url"&&!resultset){var url=valuesetColumn[index]["valueset"];var data=G.getPageDataSetCache(url);if(data&&data.status=="success"){data=data.data;if(data[0]["vtype"]||false){var d=data[0]["data"]||false;if(d){data=d}else{data=[]}}valuesetColumn[index]["resultset"]=data;count=0;index=index+1;codeToDataComplete(valuesetColumn,index)}else{if(count*delay>=timeout){count=0;index=index+1;codeToDataComplete(valuesetColumn,index)}else{count++;setTimeout(function(){codeToDataComplete(valuesetColumn,index)},delay)}}}}}}}}},getqueryparams:function(){return this.options.queryparams||{}},getPaginationInfo:function(){return this.paginationInfo||{}},query:function(comps,fn){if($.isArray(comps)){var a={};a.url=this.options.dataurl;a.components=comps;this.options.queryparams=$.DataAdapter.query(a);this._loadGirdpanelData("query",fn)}},reload:function(data,fn){this._loadGirdpanelData("reload",fn,data)},reloadCurrentPage:function(fn){this._loadGirdpanelData("reloadcurrentpage",fn)},goPage:function(n){if(!n){return false}this.paginationInfo.page=n;this._loadGirdpanelData()},_loadGirdpanelData:function(t,fn,data){this.rows=null;this._resetQueryDataParams(t);this.requestPageData(t,fn,data)},requestPageData:function(flag,fn,reloadJsonData){var $this=this;var url=$this.options.dataurl,urlparams=$this.options.dataurlparams,qparams=$this.options.queryparams,pginfo=$this.paginationInfo,sparams=$this.options.sortparams;if(flag=="reload"){url=reloadJsonData||$this.options.dataurl}if(url){$this.element.find(".jazz-pagearea").loading();if(typeof url=="object"){$this._successLoadData("",url,fn,true)}else{var data=$.extend({},pginfo,sparams);var params={url:url,params:urlparams,pageparams:data,queryparams:qparams,showloading:false,callback:function(resopnseData,that){var t=(flag!="paginator");that._successLoadData("",resopnseData,fn,t)}};$.DataAdapter.submit(params,$this)}}},_requestLoadData:function(data,fn,flag){var that=this;that._processGridpanelData(data);if(that.gtable){that.gtable.gridtable("renderGridtableData",data)}if(that.gcard){that.gcard.gridcard("renderGridcardData",data)}var a=that.paginationInfo;if(flag){if(that.options.isshowpaginator&&that.gpaginator){that.gpaginator.paginator("updatePage",{page:a.page,pagerows:a.pagerows,totalrecords:a.totalrows})}}if(fn&&$.isFunction(fn)){fn.call(that,that.rows,a)}},_resetQueryDataParams:function(flag){switch(flag){case"reload":this.options.sortparams.sortName="";this.options.sortparams.sortFlag="";this.options.queryparams={};this.paginationInfo.page=1;this.paginationInfo.totalrows=0;if(this.gcolumn){this.gcolumn.gridcolumn("clearColumnStatus")}break;case"reloadcurrentpage":this.paginationInfo.totalrows=0;break;case"query":this.options.sortparams.sortName="";this.options.sortparams.sortFlag="";this.paginationInfo.page=1;this.paginationInfo.totalrows=0;if(this.gcolumn){this.gcolumn.gridcolumn("clearColumnStatus")}break;case"paginator":this.options.sortparams.sortName="";this.options.sortparams.sortFlag="";if(this.gcolumn){this.gcolumn.gridcolumn("clearColumnStatus")}break}},bindPaginatorClickEvent:function(page,pagerows){this.paginationInfo.page=page;this.paginationInfo.pagerows=pagerows;this._resetQueryDataParams("paginator");this.requestPageData("paginator")},_setOption:function(key,value){switch(key){case"dataurl":this.paginationInfo.totalrows=0;break;case"dataurlparams":this.paginationInfo.totalrows=0;break;case"queryparams":this.paginationInfo.totalrows=0;break}this._super(key,value)},recomputeGridTableWidth:function(){var gridcolumn=this.gcolumn.data("gridcolumn");if(gridcolumn){gridcolumn._width()}var gridtable=this.gtable.data("gridtable");if(gridtable){gridtable._width()}}})})(jQuery);(function($){$.widget("jazz.gridcolumn",$.jazz.boxComponent,{options:{vtype:"gridcolumn",name:null,resizecolumn:true,wordbreak:false,hideheader:false,content:null,columnheader:null},_create:function(){this.options.columnheader=this.options.content||"";this.options.content=null;this._super();this.compId=this.getCompId();var el=this.element;el.attr("id",this.compId+"_gridcolumn").addClass("jazz-gridcolumn").css({width:"100%",overflow:"hidden"});if(el.children()&&el.children().length>0){this.tempcolumnheader=el.children();el.children().remove()}else{if(this.options.columnheader){this.tempcolumnheader=$(this.options.columnheader)}}var tableclass="jazz-grid-column-table";if(this.options.wordbreak||this.options.wordbreak=="true"){tableclass+=" jazz-grid-column-table-wordbreak"}var div='<div id="'+this.compId+'_columns" class="jazz-grid-columns" style="display: block;"><table id="'+this.compId+'_table" class="'+tableclass+'" cellspacing="0" cellpadding="0" border="0"><thead><tr><th style="width:0px;height:0px;"></th></tr></thead><tbody></tbody></table></div>';el.append(div);this.columns=$("#"+this.compId+"_columns");this.table=$("#"+this.compId+"_table");this.tbody=this.table.children("tbody");this.thead=this.table.children("thead")},_init:function(){this._super();this._createGridColumnOptions();this._createColumns();this._selectAllTableRows();if(this.options.resizecolumn){this._bindMoveColumnEvent()}this._bindColumnSortEvent();this._calculateColumnSplitterHeight();if(this.options.hideheader==true||this.options.hideheader=="true"){this.element.hide()}},_width:function(){this.calculateGridcolumnWidth();this.settingGridcolumnWidth()},_height:function(){},_createGridColumnOptions:function(){this.options.lineno=true;this.options.linenowidth=30;this.options.isshowselecthelper=true;this.options.selecttype=2;var vtypeparent=this.getParentComponent();if(vtypeparent&&vtypeparent.attr("vtype")=="gridpanel"){this.gridpanel=$(vtypeparent).data("gridpanel");var gridoptions=this.gridpanel.options;this.options.lineno=gridoptions.lineno;this.options.linenowidth=gridoptions.linenowidth;this.options.isshowselecthelper=gridoptions.isshowselecthelper;this.options.selecttype=gridoptions.selecttype}if(this.tempcolumnheader){var headers=[];$.each(this.tempcolumnheader,function(i,content){var t=[],str="";$.each($(content).children(),function(j,objs){var obj=$(objs);str={text:obj.attr("text"),textalign:obj.attr("textalign"),name:obj.attr("name"),visible:obj.attr("visible"),width:obj.attr("width"),datatype:obj.attr("datatype"),dataformat:obj.attr("dataformat"),textdisplaytype:obj.attr("textdisplaytype"),rowspan:obj.attr("rowspan"),valueset:obj.attr("dataurl"),key:obj.attr("key"),colspan:obj.attr("colspan"),sort:obj.attr("sort"),iseditable:obj.attr("iseditable"),issummary:obj.attr("issummary"),summarytype:obj.attr("summarytype"),summaryrender:obj.attr("summaryrender")};t.push(str)});headers.push(t)});this.options.header=headers}},_calculateColumnSplitterHeight:function(){var splitterObj=this.tbody.find(".jazz-grid-column-splitter");$.each(splitterObj,function(i,obj){var tdHeight=$(obj).parents(".jazz-grid-headerCell").height()||24;$(obj).height(tdHeight)})},_createColumns:function(){var lineno=this.options.lineno;var isshowselecthelper=this.options.isshowselecthelper;var selecttype=this.options.selecttype;var header2="",colIndex=0;this.columnWidth=[];this.cols=[];this.toCodeColumn=[];var headers=this.options.header,headrows=headers.length;var nums=0;if(this.options.lineno==true||this.options.lineno=="true"){nums+=1}if((this.options.isshowselecthelper==true||this.options.isshowselecthelper=="true")&&(this.options.selecttype!=0||this.options.selecttype!="0")){nums+=1}var cellColumnIndexArray=this._getCellColumnIndexArray();var headcell=null,cover=null,colindex=null,celltype=null,celldata=null;for(var i=0;i<cellColumnIndexArray.length;i++){header2+="<tr><th></th>";for(var j=0,len=cellColumnIndexArray[i].length;j<len;j++){headcell=cellColumnIndexArray[i][j];cover=headcell.cover;colindex=headcell.colindex;celltype=headcell.celltype;celldata=headcell.celldata;if(cover=="combined"){continue}if(celltype){if(celltype=="lineno"){header2+='<td index="'+colindex+'" class="jazz-grid-headerCell" rowspan="'+headrows+'"><div class="jazz-grid-headerCell-inner" style="text-align:center;">序号</div></td>'}if(celltype=="select"){if(selecttype==2||selecttype=="2"){header2+='<td index="'+colindex+'" class="jazz-grid-headerCell" rowspan="'+headrows+'"><div class="jazz-grid-headerCell-box"><input type="checkbox" name="'+this.compId+'_box" id="'+this.compId+'_box" /></div></td>'}else{header2+='<td class="jazz-grid-headerCell">&nbsp;</td>'}}}else{if(!celldata){continue}if(celldata.name){if(celldata.key==true||celldata.key=="true"){this.keyCode=celldata.name.replace(/^\s+(\w+)\s+$/g,"$1")}this.cols[colindex-nums]={columnname:celldata.name,sort:celldata.sort,index:colindex,datatype:celldata.datatype,dataformat:celldata.dataformat,textalign:celldata.textalign,iseditable:celldata.iseditable,issummary:celldata.issummary,summarytype:celldata.summarytype,summaryrender:celldata.summaryrender};this.toCodeColumn.push({columnname:celldata.name,valueset:celldata.valueset,datatype:celldata.datatype});var width=celldata.width,visible=celldata.visible;this.columnWidth[colindex-nums]={columnname:celldata.name,columnwidth:celldata.width,visible:visible}}var _colspan="",_rowspan="",_align="",_bottomclass="",_name="",_text="";if(celldata.rowspan){_rowspan=' rowspan="'+celldata.rowspan+'"'}if(celldata.colspan){_colspan=' colspan="'+celldata.colspan+'"'}if(celldata.textalign){_align=' style="text-align: '+celldata.textalign+'"'}if(celldata.text){_text=celldata.text}if(celldata.name){_bottomclass=" jazz-grid-bottomCell";_name=celldata.name}header2+='<td index="'+colindex+'" name="'+_name+'" class="jazz-grid-headerCell'+_bottomclass+'" '+_rowspan+_colspan+'><div class="jazz-grid-headerCell-outer"><div class="jazz-grid-headerCell-inner" '+_align+">"+_text+'</div><div class="jazz-grid-column-splitter"></div></td>'}}header2+="</tr>"}this.calculateGridcolumnWidth();this._createTheadDom();this.settingGridcolumnWidth();this.table.append(header2)},calculateGridcolumnWidth:function(){var width_table=this.columns.width();if((this.options.isshowselecthelper==true||this.options.isshowselecthelper=="true")&&(this.options.selecttype!=0||this.options.selecttype!="0")){width_table-=24}if(this.options.lineno==true||this.options.lineno=="true"){var linowidth=this.options.linenowidth?parseInt(this.options.linenowidth):30;width_table-=linowidth}var grid=this.getParentComponent();if(grid){var gridtable=$(grid)["gridpanel"]("getGridTable");if(gridtable){var contentDiv=gridtable.find(".jazz-grid-tables");if(contentDiv.size()>0){var gridTableClientWidth=contentDiv.get(0).clientWidth;var gridTableWidth=contentDiv.width();if(gridTableWidth>gridTableClientWidth){width_table-=17}}}}var re=/^[0-9]+.?[0-9]*$/;var fixedColumnWidth=0;var exceptFixedColumnWidth=0;var percentColumnWidth=0;var hasPercentWidth=false;var autoWidthNums=0;for(var i=0,m=this.columnWidth.length;i<m;i++){var temp=this.columnWidth[i];var colwidth=temp.columnwidth;var visible=temp.visible;if(visible==="false"||visible===false){continue}if(!colwidth||$.trim(colwidth)=="*"){autoWidthNums++}else{if(colwidth.indexOf("px")!=-1||(re.test(colwidth)&&colwidth.indexOf("%")==-1)){fixedColumnWidth+=parseFloat(colwidth);temp._columnwidth=parseFloat(colwidth)}if(!hasPercentWidth&&colwidth.indexOf("%")!=-1){hasPercentWidth=true}}}exceptFixedColumnWidth=width_table-fixedColumnWidth;if(hasPercentWidth){for(var i=0,m=this.columnWidth.length;i<m;i++){var temp=this.columnWidth[i];var colwidth=temp.columnwidth;var visible=temp.visible;if(visible==="false"||visible===false){continue}if(colwidth&&colwidth.indexOf("%")!=-1){var a=colwidth.substring(0,colwidth.indexOf("%"));var b=Math.floor((a/100)*exceptFixedColumnWidth);temp._columnwidth=b;percentColumnWidth+=b}}}if(autoWidthNums>0){var leftColumnWidth=exceptFixedColumnWidth-percentColumnWidth;for(var i=0,m=this.columnWidth.length;i<m;i++){var temp=this.columnWidth[i];var colwidth=temp.columnwidth;var visible=temp.visible;if(visible==="false"||visible===false){continue}if(!colwidth||$.trim(colwidth)=="*"){temp._columnwidth=Math.floor(leftColumnWidth/autoWidthNums)}}}},_createTheadDom:function(){var linowidth="";var thead_th="";if((this.options.isshowselecthelper==true||this.options.isshowselecthelper=="true")&&(this.options.selecttype!=0||this.options.selecttype!="0")){thead_th+='<th style="width:24px;height:0px;" name="selecthelper"></th>'}if(this.options.lineno==true||this.options.lineno=="true"){linowidth=this.options.linenowidth?parseInt(this.options.linenowidth)+"px":"30px";thead_th+='<th style="width:'+linowidth+';height:0px;" name="rowlineno"></th>'}for(var i=0,len=this.columnWidth.length;i<len;i++){var temp=this.columnWidth[i];var colname=temp.columnname;thead_th+='<th style="height:0px;" name="'+colname+'"></th>'}this.thead.find("tr").append(thead_th)},settingGridcolumnWidth:function(){for(var i=0,len=this.columnWidth.length;i<len;i++){var temp=this.columnWidth[i];var width=temp._columnwidth;var visible=temp.visible;var colname=temp.columnname;if(visible==false||visible=="false"){width=0}this.thead.find('th[name="'+colname+'"]').css("width",width+"px")}},_getCellColumnIndexArray:function(){var headers=this.options.header,headrows=headers.length;var columnnums=0;var haslineno=false,hasselectbox=false;if(this.options.lineno==true||this.options.lineno=="true"){columnnums+=1;haslineno=true}if((this.options.isshowselecthelper==true||this.options.isshowselecthelper=="true")&&(this.options.selecttype!=0||this.options.selecttype!="0")){columnnums+=1;hasselectbox=true}for(var m=0;m<headrows;m++){for(var n=0,len=headers[m].length;n<len;n++){if(headers[m][n]["name"]){columnnums=columnnums+1}}}var cellColumnIndexArray=[];for(var m=0;m<headrows;m++){cellColumnIndexArray[m]=[];for(var n=0;n<columnnums;n++){cellColumnIndexArray[m][n]={colindex:0,cover:false,celldata:null}}}if(hasselectbox){for(var j=0;j<headrows;j++){if(j==0){cellColumnIndexArray[j][0]["colindex"]=0;cellColumnIndexArray[j][0]["cover"]=true;cellColumnIndexArray[j][0]["celltype"]="select"}else{cellColumnIndexArray[j][0]["cover"]="combined"}}}if(haslineno&&hasselectbox){for(var j=0;j<headrows;j++){if(j==0){cellColumnIndexArray[j][1]["colindex"]=1;cellColumnIndexArray[j][1]["cover"]=true;cellColumnIndexArray[j][1]["celltype"]="lineno"}else{cellColumnIndexArray[j][1]["cover"]="combined"}}}else{if(!hasselectbox&&haslineno){for(var j=0;j<headrows;j++){if(j==0){cellColumnIndexArray[j][0]["colindex"]=0;cellColumnIndexArray[j][0]["cover"]=true;cellColumnIndexArray[j][0]["celltype"]="lineno"}else{cellColumnIndexArray[j][0]["cover"]="combined"}}}}for(var m=0;m<headrows;m++){for(var n=0,len=headers[m].length;n<len;n++){var obj=headers[m][n];var rowspan=parseInt(obj.rowspan)||1;var colspan=parseInt(obj.colspan)||1;var positionIndex=0;for(var k=0;k<cellColumnIndexArray[m].length;k++){if(cellColumnIndexArray[m][k]["cover"]==false){positionIndex=k;cellColumnIndexArray[m][k]["cover"]=true;cellColumnIndexArray[m][k]["colindex"]=k+colspan-1;cellColumnIndexArray[m][k]["celldata"]=obj;break}}if(rowspan>1){for(var j=m+1;j<m+rowspan;j++){cellColumnIndexArray[j][positionIndex]["cover"]="combined"}}if(colspan>1){for(var j=positionIndex+1;j<positionIndex+colspan;j++){cellColumnIndexArray[m][j]["cover"]="combined"}}}}return cellColumnIndexArray},_selectAllTableRows:function(){var $this=this;$("#"+this.compId+"_box").off("click.box").on("click.box",function(){if($this.gridpanel){if($(this).prop("checked")){$this.gridpanel.selectAllRows()}else{$this.gridpanel.unselectAllRows()}}})},_bindMoveColumnEvent:function(){var $this=this,$tbody=this.tbody.find("td");$tbody.off("mousedown.splitter").on("mousedown.splitter",function(e){var target=e.target,$target=$(target);if($target.is(".jazz-grid-column-splitter")){$this.spliderTd=$target.closest("td");$this.x1=e.pageX;var splitHeight=$this.columns.height()+$this._getTableObj().element.height();$this.grid_proxy=$('<div class="jazz-grid-proxy" style="display:none"></div>').appendTo(document.body);$this.grid_proxy.css({display:"block",top:$this.columns.offset().top,left:$this.x1,height:splitHeight});$(document).on("selectstart",function(){return false});$("body").css({"-moz-user-select":"none","-khtml-user-select":"none","user-select":" none"});$(document).off("mousemove.splitter").on("mousemove.splitter",function(e){if($this.grid_proxy){$this.x2=e.pageX;$this.grid_proxy.css({top:$this.columns.offset().top,left:$this.x2,height:splitHeight})}});$(document).off("mouseup.splitter").on("mouseup.splitter",function(e){if($this.grid_proxy){$this.grid_proxy.remove();var w=0;if($this.x2!=0){w=$this.x2-$this.x1}$this.x2=0;var index=$this.spliderTd.attr("index");var obj=$this.thead.find("th").eq((parseInt(index)+1));var tableWidth=$this.table.width();var colWidth=obj.width();var newColWidth=colWidth+w;var dfWidth=30;if(newColWidth<dfWidth){newColWidth=dfWidth;w=-(colWidth-newColWidth);$this.grid_proxy.css({top:$this.columns.offset().top,left:$this.x1+w,height:splitHeight})}obj.width(newColWidth);var newTableWidth=tableWidth+w;var tableObj=$this._getTableObj();var childrenObj=tableObj.thead.find("th").eq((parseInt(index)+1));childrenObj.width(newColWidth)}$(document).off("selectstart");$("body").css({"-moz-user-select":"","-khtml-user-select":"","user-select":""});$(document).off("mousemove.splitter mouseup.splitter");$this._calculateColumnSplitterHeight()})}})},_bindColumnSortEvent:function(){var $this=this;var el=this.tbody.find("td.jazz-grid-bottomCell");el.off("click.sortcell").on("click.sortcell",function(e){var colindex=$(this).attr("index");var colname=$(this).attr("name");var sortFlag="asc";var sortable=false;if(!colname){return}for(var i=0,len=$this.cols.length;i<len;i++){if(colname==$this.cols[i]["columnname"]){sortable=$this.cols[i]["sort"]==true||$this.cols[i]["sort"]=="true";break}}if(sortable){el.filter("[name!="+colname+"]").removeClass("jazz-grid-asc jazz-grid-desc").find("span.jazz-grid-sortIcon").remove();if($(this).find("span.jazz-grid-sortIcon").length==0){$(this).find("div.jazz-grid-headerCell-inner").append('<span class="jazz-grid-sortIcon"></span>')}if($(this).hasClass("jazz-grid-asc")){$(this).removeClass("jazz-grid-asc").addClass("jazz-grid-desc");sortFlag="desc"}else{if($(this).hasClass("jazz-grid-desc")){$(this).removeClass("jazz-grid-desc").addClass("jazz-grid-asc")}else{$(this).addClass("jazz-grid-asc")}}if(colname){$this.gridpanel.options.sortparams.sortName=colname;$this.gridpanel.options.sortparams.sortFlag=sortFlag;$this.gridpanel.requestPageData()}}})},_getTableObj:function(){if(!this.gridTableObj){var grid=this.getParentComponent();if(grid){if(!grid.gridTableObj){var t=$(grid)["gridpanel"]("getGridTable");grid.gridTableObj=t.data("gridtable")}}this.gridTableObj=grid.gridTableObj}return this.gridTableObj},hideColumn:function(columnname){if(!columnname){return}var el=this.thead.find('th[name="'+columnname+'"]');if(el.length>0){el.css("width","0px");var gridTableObj=this._getTableObj();if(gridTableObj){$(gridTableObj.thead).find('th[name="'+columnname+'"]').css("width","0px")}}},showColumn:function(columnname){if(!columnname){return}for(var i=0,len=this.columnWidth.length;i<len;i++){var temp=this.columnWidth[i];var width=temp._columnwidth;var colname=temp.columnname;if(colname==columnname){this.thead.find('th[name="'+colname+'"]').css("width",width+"px");var gridTableObj=this._getTableObj();if(gridTableObj){$(gridTableObj.thead).find('th[name="'+colname+'"]').css("width",width+"px")}}}},clearColumnStatus:function(){var $this=this;var el=this.tbody.find("td.jazz-grid-bottomCell");if(el.length>0){el.removeClass("jazz-grid-asc jazz-grid-desc").find("span.jazz-grid-sortIcon").remove()}var ckbox=this.tbody.find("input:checkbox");if(ckbox.length>0){ckbox.attr("checked",false)}}})})(jQuery);(function($){$.widget("jazz.gridtable",$.jazz.boxComponent,{options:{vtype:"gridtable",name:null,rowrender:null,isfixrow:false,addrowposition:"first",rowselect:null,rowunselect:null,rowdblclick:null},_create:function(){this._super();this.compId=this.getCompId();var el=this.element;el.attr("id",this.compId+"_gridtable").addClass("jazz-datatable");var div='<div id="'+this.compId+'_tables" class="jazz-grid-tables" style="display: block;"><table id="'+this.compId+'_table" class="jazz-grid-data-table" cellspacing="0" cellpadding="0" border="0"><thead><tr></tr></thead><tbody></tbody></table></div>';el.append(div);this.columns=$("#"+this.compId+"_tables");this.table=$("#"+this.compId+"_table");this.thead=this.table.children("thead");this.tbody=this.table.children("tbody")},_init:function(){this._super();this._createGridTableOptions();if(this.options.linetype&&(this.options.linetype!=0||this.options.linetype!="0")){this.table.addClass("jazz-grid-table-linetype"+this.options.linetype)}if(this.options.linestyle&&(this.options.linestyle!=1||this.options.linestyle!="1")){this.table.addClass("jazz-grid-table-linestyle"+this.options.linestyle)}this.calculateGridtableWidth();this._bindTableHorizonScrollEvent();this._bindGridTableEvent()},_width:function(){this.calculateGridtableWidth()},_height:function(){},_bindGridTableEvent:function(){if(this._isGridtableEditable()){$.extend(this,jazz.grid.editorgridtable)}if(this.options.groupfield){$.extend(this,jazz.grid.groupgridtable);this._bindGroupGridTableEvent();this._bindSummaryGridTableEvent()}else{if(this.options.isgroupsummary||this.options.ispagesummary){$.extend(this,jazz.grid.summarygridtable);this._bindSummaryGridTableEvent()}}this._bindGridTableSelectionEvent()},_isGridtableEditable:function(){var iseditable=false;if(this.options.iseditable){iseditable=true}else{for(var j=0,len=this.cols.length;j<len;j++){if(this.cols[j]["iseditable"]){iseditable=true;break}}}return iseditable},_createGridTableOptions:function(){this.options.lineno=true;this.options.isshowselecthelper=true;this.options.selecttype=2;this.options.linetype=0;this.options.linestyle=1;this.options.isshowpaginator=true;this.options.rowselectable=true;this.options.isshoweditcell=false;this.options.isshoweditcell=false;this.options.editortype="cell";this.options.iseditable=false;this.options.isgroupsummary=false;this.options.ispagesummary=false;this.options.groupfield=null;this.options.grouptitlefield=null;this.options.isgroupexpand=true;var parentobj=this.getParentComponent();if(parentobj&&parentobj.length>0){this.gridpanel=$(parentobj).data("gridpanel");var gridoptions=this.gridpanel.options;this.options.lineno=gridoptions.lineno;this.options.isshowselecthelper=gridoptions.isshowselecthelper;this.options.selecttype=gridoptions.selecttype;this.options.linetype=gridoptions.linetype;this.options.linestyle=gridoptions.linestyle;this.options.isshowpaginator=gridoptions.isshowpaginator;this.options.rowselectable=gridoptions.rowselectable;this.options.isshoweditcell=gridoptions.isshoweditcell;this.options.editortype=gridoptions.editortype;this.options.iseditable=gridoptions.iseditable;this.options.isgroupsummary=gridoptions.isgroupsummary;this.options.ispagesummary=gridoptions.ispagesummary;this.options.groupfield=gridoptions.groupfield;this.options.grouptitlefield=gridoptions.grouptitlefield;this.options.isgroupexpand=gridoptions.isgroupexpand;var el=this.element;var pagearea=parentobj.find(".jazz-pagearea");if(pagearea&&pagearea.length>0){el.appendTo(pagearea);if(parseInt(gridoptions.height)>0||gridoptions.layout=="fit"){}else{this.columns.css("height","auto")}}else{el.wrap('<div class="jazz-pagearea"></div>');pagearea=el.parent();if(parseInt(gridoptions.height)>0||gridoptions.layout=="fit"){pagearea.css({overflow:"hidden"})}else{this.columns.css("height","auto")}}this.gridcolumn=parentobj.find("div[vtype=gridcolumn]").data("gridcolumn");this.cols=this.gridcolumn.cols||[]}},calculateGridtableWidth:function(){if(this.gridcolumn){this.thead.children().remove();this.thead.append(this.gridcolumn.thead[0].innerHTML)}},_bindTableHorizonScrollEvent:function(){var that=this;var el=that.element;var gridtables=el.find("div.jazz-grid-tables");var gridcolumns=that.gridcolumn.columns;gridtables.off("scroll.gridtable").on("scroll.gridtable",function(){var scrollwidth=$(this).scrollLeft();gridcolumns.css("margin-left",-scrollwidth)})},_drawDataLine:function(){var $this=this,dataLength=this._trNumber(),rowLength=0,n=0;var pageNo=10;if(this.gridpanel&&this.gridpanel.paginationInfo){pageNo=this.gridpanel.paginationInfo.pagerows||10}if(dataLength<pageNo){rowLength=pageNo-dataLength}if(dataLength%2!=0){n=1}var trHtml="",showLine=this.options.lineno;for(var i=0,len=rowLength;i<len;i++){if((n+1+i)%2===0){cls="jazz-gridtable-even"}else{cls="jazz-gridtable-odd"}trHtml+='<tr index="'+(dataLength+i)+'" class="nodata '+cls+'">';trHtml+='<th style="height:20px;"></th>';if(this._isSelectHelper()&&this._isSelectType()){trHtml+="<td class='jazz-grid-cell'>&nbsp;</td>"}if(showLine){trHtml+="<td class='jazz-grid-cell'>&nbsp;</td>"}for(var j=0,l=this.cols.length;j<l;j++){trHtml+="<td class='jazz-grid-cell'>&nbsp;</td>"}trHtml+="</tr>"}if(rowLength>0){this.tbody.append(trHtml)}},_insertRowHtml:function(rowObj,index,lineIndex){var $this=this;var data=rowObj;var lineno=this.options.lineno;var page=1;var pagerows=0;if(this.gridpanel&&this.gridpanel.paginationInfo){page=this.gridpanel.paginationInfo.page||1;pagerows=this.gridpanel.paginationInfo.pagerows||0}lineIndex=index+lineIndex+1+((page-1)*pagerows);var cls="";if((lineIndex)%2==0){cls="jazz-gridtable-even"}else{cls="jazz-gridtable-odd"}var rowHtml='<tr index="'+(lineIndex-1)+'" class="jazz-grid-row '+cls+' " id="'+data.rowuuid+'">';rowHtml+='<th style="height:20px;"></th>';var b="";if(this._isSelectHelper()&&this._isSelectType()){if($this._isMultipleSelection()){b="checkbox"}else{if($this._isSingleSelection()){b="radio"}}rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box"><input type="'+b+'"/></td>'}if(lineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no">'+lineIndex+"</td>"}var columnname="",stm="",textalign="",title="";for(var j=0,len=this.cols.length;j<len;j++){columnname=this.cols[j]["columnname"];textalign=this.cols[j]["textalign"]||"";title="";stm="&nbsp;";if(columnname&&data[columnname]!=undefined){if(data[columnname].toString().indexOf("<")!=0){title=data[columnname]||""}stm=data[columnname]}if(textalign){textalign="text-align-"+textalign}rowHtml+='<td class="jazz-grid-cell '+textalign+'" title='+title+">"+stm+"</td>"}return rowHtml},_isSelectHelper:function(){var isshowselecthelper=this.options.isshowselecthelper;return(isshowselecthelper==true||isshowselecthelper=="true")},_isSelectType:function(){var selecttype=this.options.selecttype;return(selecttype!=0||selecttype!="0")},_isSingleSelection:function(){var selecttype=this.options.selecttype;return(selecttype==1||selecttype=="1")},_isMultipleSelection:function(){var selecttype=this.options.selecttype;return(selecttype==2||selecttype=="2")},_renderData:function(rows){if(!rows){return}var lineIndex=0;var rowHtml="";this._trObject().remove();lineIndex=this._trNumber();for(var i=0;i<rows.length;i++){rowHtml+=this._insertRowHtml(rows[i],i,lineIndex)}this.tbody.append(rowHtml);this._event("rowrender",null,{data:rows,rowEl:this.tbody.find("tr")})},renderGridtableData:function(rowsdata){if(rowsdata){this._renderData(rowsdata);this._updateIndex()}},_bindGridTableSelectionEvent:function(){var that=this;this.tbody.on("click.td","td.jazz-grid-cell",null,function(e){if($(this).parent().hasClass("nodata")){return}if($(e.target).is("a")){return}that._onRowClickEvent(e,$(this),false)}).on("dblclick.td","td.jazz-grid-cell",null,function(e){if($(this).parent().hasClass("nodata")){return}if($(e.target).is("a")){return}that._onRowClickEvent(e,$(this),true)})},_onRowClickEvent:function(e,tdEl,dbclick){var that=this;var targetrow=$(tdEl).parent();var rowselectable=that.options.rowselectable||that.options.rowselectable=="true";if(rowselectable){if(dbclick){that._onRowClick(e,targetrow,true)}else{setTimeout(function(){that._onRowClick(e,targetrow,false)},100)}}else{if($(e.target).is(".jazz-grid-cell-box :input")){that._onRowClick(e,targetrow,false)}}},_onRowClick:function(event,targetRow,flag){var row=$(targetRow);var isSelected=row.hasClass("jazz-row-selected");if(this._isMultipleSelection()){if(flag){this._selectRow(row,true,event,flag)}else{if(isSelected){this._unselectRow(row,true,event)}else{this._selectRow(row,true,event,flag)}}}else{if(flag){this._selectRow(row,true,event,flag)}else{if(isSelected){this._selectRow(row,true,event,flag)}else{this._unselectAllRows();this._selectRow(row,true,event,flag)}}}},_selectRow:function(row,isCallback,event,flag){var $this=this;var id=row.attr("id");row.addClass("jazz-row-selected").attr("aria-selected",true);if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",true)}if($this.tbody.find("input:checked").length==$this.tbody.find("input:checkbox").length){var thead=$this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",true)}}else{if(row.find("input:radio")){row.find("input:radio").attr("checked",true);row.siblings().find("input:radio").attr("checked",false)}}if($this.gridpanel.gcard){var card=$this.gridpanel.gcard.find("#"+id);card.removeClass("jazz-gridtable-hover").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",true)}}else{if(card.find("input.jazz-card-radio")){card.find("input.jazz-card-radio").attr("checked",true);card.siblings().find("input.jazz-card-radio").attr("checked",false)}}}if(isCallback){var data={};data=this.gridpanel.getSelectedRowDataById(id);if(flag==true){this._event("rowdblclick",event,data)}else{this._event("rowselect",event,data)}}},_unselectRow:function(row,isCallback,event){var $this=this;var id=row.attr("id");row.removeClass("jazz-row-selected").attr("aria-selected",false);var thead=$this.gridcolumn.tbody;if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",false)}if($this.tbody.find("input:checked").length!=$this.tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",false)}}if($this.gridpanel.gcard){var card=$this.gridpanel.gcard.find("#"+id);card.removeClass("jazz-gridtable-highlight").attr("aria-selected",false);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",false)}}else{if(card.find("input.jazz-card-radio")){card.find("input.jazz-card-radio").attr("checked",true);card.siblings().find("input.jazz-card-radio").attr("checked",false)}}}if(isCallback){var data={};data=this.gridpanel.getSelectedRowDataById(id);this._event("rowunselect",event,data)}},_selectAllRows:function(){this.tbody.find("tr.jazz-grid-row").addClass("jazz-row-selected").attr("aria-selected",true);if(this._isMultipleSelection()){this.tbody.find("input:checkbox").attr("checked",true);var thead=this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",true)}if(this.gridpanel.gcard){var gridcard=this.gridpanel.gcard.data("gridcard");var cardContent=gridcard.cardContent;cardContent.find("div.jazz-grid-cardcell").addClass("jazz-gridtable-highlight").attr("aria-selected",true);cardContent.find("input.jazz-card-checkbox").attr("checked",true)}},_unselectAllRows:function(){this.tbody.find("tr.jazz-grid-row").removeClass("jazz-row-selected").attr("aria-selected",false);if(this._isMultipleSelection()){this.tbody.find("input:checkbox").attr("checked",false);var thead=this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",false)}if(this.gridpanel.gcard){var gridcard=this.gridpanel.gcard.data("gridcard");var cardContent=gridcard.cardContent;cardContent.find("div.jazz-grid-cardcell").removeClass("jazz-gridtable-highlight").attr("aria-selected",false);cardContent.find("input.jazz-card-checkbox").attr("checked",false);cardContent.find("input.jazz-card-radio").attr("checked",false)}},_trObject:function(){var obj=this.tbody.children("tr");return obj},_trNumber:function(){var obj=this._trObject();if(obj){return obj.length}else{return 0}},_updateIndex:function(){if(this.options.lineno){var n=0;if(this.options.isshowpaginator){var p=1;var r=10;if(this.gridpanel&&this.gridpanel.paginationInfo){p=this.gridpanel.paginationInfo.page||1;r=this.gridpanel.paginationInfo.pagerows||10}n=(p-1)*r}var trObjs=this.tbody.children(".jazz-grid-row");$.each(trObjs,function(i,obj){$(this).children("td.jazz-grid-cell-no").text(i+1+n)})}if(this.options.isfixrow){this._drawDataLine()}},addRow:function(data){if(!data){return}var rowHtml="";var lineIndex=this._trNumber();for(var i=0;i<data.length;i++){rowHtml+=this._insertRowHtml(data[i],i,lineIndex)}var trobj=null;if(rowHtml){trobj=$(rowHtml).appendTo(this.tbody)}this._event("rowrender",null,{data:data,rowEl:trobj})},updateRowById:function(data,id){if(!data||!id){return}var trobj=this.tbody.find("#"+id);var isselected=trobj.hasClass("jazz-row-selected");var rowIndex=trobj.find(".jazz-grid-cell-no").html();var rowHtml=this._insertRowHtml(data,0,(parseInt(rowIndex)-1));trobj.replaceWith(rowHtml);var newtrobj=this.tbody.find("#"+id);if(isselected){newtrobj.addClass("jazz-row-selected").attr("aria-selected",true);newtrobj.find("input:checkbox").attr("checked",true);var thead=this.gridcolumn.tbody;if(this._isMultipleSelection()){if(this.tbody.find("input:checked").length==this.tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",true)}}}this._event("rowrender",null,{data:data,rowEl:newtrobj});if(this.options.isgroupsummary||this.options.ispagesummary){this.tbody.trigger("cellvaluechange.summaryrow",[id])}},removeRowById:function(id){this.tbody.find("#"+id).remove();if(this.tbody.children().length==0||this.tbody.find("tr[id]").length==0){if(this._isMultipleSelection()){var thead=this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",false)}}this._updateIndex();if(this.options.isgroupsummary||this.options.ispagesummary){this.tbody.trigger("cellvaluechange.summaryrow",[id])}},selectRow:function(id){var $this=this;var row=this.tbody.find("#"+id);row.addClass("jazz-row-selected").attr("aria-selected",true);var thead=$this.gridcolumn.tbody;if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",true)}if($this.tbody.find("input:checked").length==$this.tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",true)}}else{if(row.find("input:radio")){row.find("input:radio").attr("checked",true);row.siblings().find("input:radio").attr("checked",false)}}},unselectRow:function(id){var $this=this;var row=this.tbody.find("#"+id);row.removeClass("jazz-row-selected").attr("aria-selected",false);var thead=$this.gridcolumn.tbody;if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",false)}if($this.tbody.find("input:checked").length!=$this.tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",false)}}},selectAllRows:function(){var $this=this;$this.tbody.find("tr.jazz-grid-row").addClass("jazz-row-selected").attr("aria-selected",true);if($this._isMultipleSelection()){$this.tbody.find("input:checkbox").attr("checked",true)}var thead=$this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",true)},unselectAllRows:function(){var $this=this;$this.tbody.find("tr.jazz-grid-row").removeClass("jazz-row-selected").attr("aria-selected",false);if($this._isMultipleSelection()){$this.tbody.find("input:checkbox").attr("checked",false)}var thead=$this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",false)}})})(jQuery);(function($){$.widget("jazz.gridcard",$.jazz.boxComponent,{options:{vtype:"gridcard",name:null,width:null,height:null,margin:10,cardclass:"jazz-grid-qh-cardcell",html:function(data){var html='<div style="width:100%;height:100%"><div class="jazz-grid-cardcell-i"><div class="jazz-grid-bblb-img"></div></div><div class="jazz-grid-qh-c jazz-grid-bblb-c"><div class="jazz-grid-qh-c-h1">'+data.name+'</div><div class="jazz-grid-qh-c-date">'+data.org+'</div><div class="jazz-grid-cardcell-title" style="display:none;">'+data.name+"</div></div></div>";return html},isaddcard:true,addcardposition:"first",addcardrender:null,addcardclick:null,cardselect:null,cardunselect:null,carddblclick:null},_create:function(){this._super();this.compId=this.getCompId();var el=this.element;el.attr("id",this.compId+"_gridcard").addClass("jazz-gridcard");this.cardContent=$('<div id="'+this.compId+'_cardcontent" style="height:100%;"></div>').appendTo(el)},_init:function(){this._super();this._createGridCardOptions();this._bindGridcardSelectionEvent();this._calCardStyle();this._cardResize();if(this._isCardAddBtn()){this._addCardNewIcon()}},_width:function(){this.calculateGridcardWidth()},_height:function(){},_createGridCardOptions:function(){this.options.isshowselecthelper=true;this.options.selecttype=2;this.options.isshowpaginator=true;this.options.rowselectable=true;var parentobj=this.getParentComponent();if(parentobj&&parentobj.length>0){this.gridpanel=parentobj.data("gridpanel");var gridoptions=this.gridpanel.options;this.options.isshowselecthelper=gridoptions.isshowselecthelper;this.options.selecttype=gridoptions.selecttype;this.options.isshowpaginator=gridoptions.isshowpaginator;this.options.rowselectable=gridoptions.rowselectable;var el=this.element;var pagearea=parentobj.find(".jazz-pagearea");if(pagearea&&pagearea.length>0){el.appendTo(pagearea);if(parseInt(gridoptions.height)>0||gridoptions.layout=="fit"){}else{this.cardContent.css("height","auto")}}else{el.wrap('<div class="jazz-pagearea" ></div>');pagearea=el.parent();if(parseInt(gridoptions.height)>0||gridoptions.layout=="fit"){pagearea.css({overflow:"hidden"})}else{this.cardContent.css("height","auto")}}if(gridoptions.defaultview=="card"){pagearea.css({overflow:"auto"})}this.gridcolumn=parentobj.find("div[vtype=gridcolumn]").data("gridcolumn");this.gridtable=parentobj.find("div[vtype=gridtable]").data("gridtable");if(this.gridcolumn){this.cols=this.gridcolumn.cols}}},calculateGridcardWidth:function(){this._calCardStyle();this._cardResize()},_getcardSizeStyle:function(){var style="";var width=this.options.width,height=this.options.height,margin=this.options.margin||"10px";if(width&&height){style=" style='width:"+width+";height:"+height+";margin:"+margin+";'"}return style},renderGridcardData:function(rowsdata){if(rowsdata){this._renderData(rowsdata)}},_renderData:function(rowsData){var $this=this,rows=rowsData;$this.cardContent.children().remove();if($this._isCardAddBtn()&&!$this._hasCardAddBtn()){$this._addCardNewIcon()}if(rows){var functionHtml="";if($this.options.isshowselecthelper==true||$this.options.isshowselecthelper=="true"){if($this.options.selecttype=="1"){functionHtml='<div class="jazz-grid-cardcell-functionarea" ><div class="jazz-grid-cardcell-functionarea-radio"><input class="jazz-card-checkbox" type="radio" style="width:16px;height:16px;" /></div></div>'}else{if($this.options.selecttype=="2"){functionHtml='<div class="jazz-grid-cardcell-functionarea" ><div class="jazz-grid-cardcell-functionarea-checkbox"><input class="jazz-card-checkbox" type="checkbox" style="width:16px;height:16px;" /></div></div>'}}}var cardmodel=$this.options.html;var style=$this._getcardSizeStyle();var cardclass=$this.options.cardclass;var cardHtml="",cellcontent="";for(var i=0,len=rows.length;i<len;i++){cardHtml='<div class="jazz-grid-cardcell '+cardclass+'" '+style+' id="'+rows[i]["rowuuid"]+'">';cellcontent=$this._customopration(cardmodel,rows[i])||"";cardHtml=cardHtml+cellcontent;cardHtml=cardHtml+functionHtml;var stm=rows[i]["@toolsopration"];if(stm){stm="<div class='jazz-grid-cardcell-tools' >"+stm+"</div>"}else{stm=""}cardHtml=cardHtml+stm+"</div>";$(cardHtml).appendTo($this.cardContent)}}},_isCardAddBtn:function(){return((this.options.isaddcard==false)||(this.options.isaddcard=="false")?false:true)},_hasCardAddBtn:function(){return this.cardContent.find(".jazz-card-new").length==0?false:true},_addCardNewIcon:function(){var $this=this,$cardContent=$this.cardContent,addcardposition=$this.options.addcardposition,addcardrender=$this.options.addcardrender,addcardclick=$this.options.addcardclick;var cardHtml="";if(addcardrender){cardHtml=$this._customopration(addcardrender)}else{cardHtml=$this._createCardNewIcon()}if(addcardposition&&addcardposition==="first"&&($cardContent.find("div.jazz-grid-cardcell:first").length>0)){$cardContent.find("div.jazz-grid-cardcell:first").before(cardHtml)}else{$cardContent.append(cardHtml)}if(addcardclick){$cardContent.find("div.jazz-card-new").on("click",function(e){$this._event("addcardclick",e)})}},_createCardNewIcon:function(){var $this=this;if(!$this.cardCell){$this._calCardStyle()}var cardHeight=$this.cardCell.cardHeight;var style=$this._getcardSizeStyle();var cardclass=$this.options.cardclass;var addcard='<div class="jazz-grid-cardcell '+cardclass+'" '+style+'><div class="jazz-card-new" style="height:'+cardHeight+'px;"></div></div>';return addcard},_calCardStyle:function(){var $this=this,style=$this._getcardSizeStyle(),cardclass=$this.options.cardclass,card="<div class='jazz-grid-cardcell "+cardclass+"' "+style+"></div>",cardOuterwidth=$(card).outerWidth(true),cardWidth=$(card).width(),cardHeight=$(card).height(),cardMargin=$(card).outerWidth(true)-$(card).width();var cardContentWidth=this.element.parent().width();var total=Math.floor(cardContentWidth/(cardOuterwidth+2)),cardContainerWidth=total*(cardOuterwidth+2);$this.cardCell={total:total,cardWidth:cardWidth,cardHeight:cardHeight,cardMargin:cardMargin,cardContainerWidth:cardContainerWidth}},_cardResize:function(flag){if(!this.cardCell){return}var $this=this,cardCell=$this.cardCell,cardContainerWidth=cardCell.cardContainerWidth,total=cardCell.total;if(flag){total=Math.floor($this.element.parent().width()/(cardCell.cardWidth+22)),cardContainerWidth=total*(cardCell.cardWidth+22)}$this.cardContent.css({width:cardContainerWidth+"px",margin:"0 auto"})},_isSingleSelection:function(){var selecttype=this.options.selecttype;return(selecttype==1||selecttype=="1")},_isMultipleSelection:function(){var selecttype=this.options.selecttype;return(selecttype==2||selecttype=="2")},_bindGridcardSelectionEvent:function(){var $this=this;var selector="div.jazz-grid-cardcell";this.cardContent.on("mouseover.gridcard",selector,null,function(e){var element=$(this);if(!element.hasClass("jazz-gridtable-highlight")){element.addClass("jazz-gridtable-hover")}var tipObj=element.find("div.jazz-grid-qh-c-h1");if(tipObj.size()>0){var tip=element.find(".jazz-grid-cardcell-title").text();tipObj.tooltip({iconclass:"jazz-tooltip-default-icon",content:tip})}}).on("mouseout.gridcard",selector,null,function(){var element=$(this);if(!element.hasClass("jazz-gridtable-highlight")){element.removeClass("jazz-gridtable-hover")}}).on("click.gridcard",selector,null,function(e){if($(e.target).is(":input,div.jazz-grid-cardcell-functionarea-checkbox,div.jazz-grid-cardcell-functionarea-radio")){return}if($(e.target).is("a")||$(e.target).parent().is("div.jazz-grid-cardcell-tools")){return}if($(this).hasClass("jazz-card-new")){return}if($(this).children().hasClass("jazz-card-new")){return}var that=this;if($this.options.rowselectable||$this.options.rowselectable=="true"){setTimeout(function(){$this._onCardClick(e,that,false)},200)}}).on("dblclick.gridcard",selector,null,function(e){if($(e.target).is(":input, div.jazz-grid-cardcell-functionarea-checkbox,div.jazz-grid-cardcell-functionarea-radio")){return}if($(e.target).is("a")||$(e.target).parent().is("div.jazz-grid-cardcell-tools")){return}if($(this).hasClass("jazz-card-new")){return}if($(this).children().hasClass("jazz-card-new")){return}$this._onCardClick(e,this,true)}).on("click.cardcheckbox","input.jazz-card-checkbox",null,function(e){if($this._isMultipleSelection()){var row=e.target.parentNode.parentNode.parentNode;if($(this).attr("onclick")){}else{if(this.checked){$this._selectCard($(row),true,e)}else{$this._unselectCard($(row),true,e)}}}else{alert("组件选中类型非多选，无法触发复选框事件响应。")}})},_onCardClick:function(event,targetCard,flag){var card=$(targetCard);var isSelected=card.hasClass("jazz-gridtable-highlight");if(this._isMultipleSelection()){if(flag){this._selectCard(card,true,event,flag)}else{if(isSelected){this._unselectCard(card,true,event)}else{this._selectCard(card,true,event,flag)}}}else{if(flag){this._selectCard(card,true,event,flag)}else{if(isSelected){return}else{this._unselectAllCards();this._selectCard(card,true,event,flag)}}}},_getCardIndex:function(card){var index=-1;index=this.cardContent.find("div.jazz-grid-cardcell").index(card);if(this._isCardAddBtn()){if(this.options.addcardposition&&this.options.addcardposition==="first"){index-=1}}return index},_selectCard:function(row,isCallback,event,flag){var id=row.attr("id");row.removeClass("jazz-gridtable-hover").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if(row.find("input.jazz-card-checkbox")){row.find("input.jazz-card-checkbox").attr("checked",true)}if(row.find("input.jazz-card-radio")){row.find("input.jazz-card-radio").attr("checked",true)}if(this.gridtable){var tbody=this.gridtable.tbody;var thead=this.gridcolumn.tbody;var tablerow=tbody.find("#"+id);tablerow.addClass("jazz-row-selected").attr("aria-selected",true);if(tablerow.find("input:checkbox")){tablerow.find("input:checkbox").attr("checked",true)}if(tablerow.find("input:radio")){tablerow.find("input:radio").attr("checked",true);tablerow.siblings().find("input:radio").attr("checked",false)}if(tbody.find("input:checked").length==tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",true)}}if(isCallback){var data={};data=this.gridpanel.getSelectedRowDataById(id);if(flag==true){this._event("carddblclick",event,data)}else{this._event("cardselect",event,data)}}},_unselectCard:function(row,isCallback,event){var id=row.attr("id");row.removeClass("jazz-gridtable-highlight").attr("aria-selected","false");if(row.find("input.jazz-card-checkbox")){row.find("input.jazz-card-checkbox").attr("checked",false)}if(row.find("input.jazz-card-radio")){row.find("input.jazz-card-radio").attr("checked",false)}if(this.gridtable){var tbody=this.gridtable.tbody;var thead=this.gridcolumn.tbody;var tablerow=tbody.find("#"+id);tablerow.removeClass("jazz-row-selected").attr("aria-selected",false);if(tablerow.find("input:checkbox")){tablerow.find("input:checkbox").attr("checked",false)}if(tablerow.find("input:radio")){tablerow.find("input:radio").attr("checked",false)}if(tbody.find("input:checked").length!=tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",false)}}if(isCallback){var data={};data=this.gridpanel.getSelectedRowDataById(id);this._event("cardunselect",event,data)}},_selectAllCards:function(){this.cardContent.find("div.jazz-grid-cardcell").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if(this._isMultipleSelection()){this.cardContent.find("input.jazz-card-checkbox").attr("checked",true)}if(this.gridtable){var tbody=this.gridtable.tbody;var thead=this.gridcolumn.tbody;tbody.find("tr").addClass("jazz-row-selected").attr("aria-selected",true);if(this._isMultipleSelection()){tbody.find("input:checkbox").attr("checked",true);thead.find("input:checkbox").attr("checked",true)}}},_unselectAllCards:function(){this.cardContent.find("div.jazz-grid-cardcell").removeClass("jazz-gridtable-highlight").attr("aria-selected",false);this.cardContent.find("input.jazz-card-checkbox").attr("checked",false);this.cardContent.find("input.jazz-card-radio").attr("checked",false);if(this.gridtable){var tbody=this.gridtable.tbody;var thead=this.gridcolumn.tbody;tbody.find("tr").removeClass("jazz-row-selected").attr("aria-selected",false);if(this._isMultipleSelection()){tbody.find("input:checkbox").attr("checked",false);thead.find("input:checkbox").attr("checked",false)}}},addCard:function(data){if(!data){return}var cardHtml=this._creatCardHtml(data);if(cardHtml){if(this.options.addcardposition=="last"){this.cardContent.find("div.jazz-grid-cardcell:last").before(cardHtml)}else{this.cardContent.append(cardHtml)}}},_creatCardHtml:function(rows){var $this=this;if(rows){var functionHtml="";if($this.options.isshowselecthelper==true||$this.options.isshowselecthelper=="true"){if($this.options.selecttype=="1"){functionHtml='<div class="jazz-grid-cardcell-functionarea" ><div class="jazz-grid-cardcell-functionarea-radio"><input class="jazz-card-checkbox" type="radio" style="width:16px;height:16px;" /></div></div>'}else{if($this.options.selecttype=="2"){functionHtml='<div class="jazz-grid-cardcell-functionarea" ><div class="jazz-grid-cardcell-functionarea-checkbox"><input class="jazz-card-checkbox" type="checkbox" style="width:16px;height:16px;" /></div></div>'}}}var cardmodel=$this.options.html;var style=$this._getcardSizeStyle();var cardclass=$this.options.cardclass;var cardHtml="";for(var i=0,len=rows.length;i<len;i++){cardHtml+='<div class="jazz-grid-cardcell '+cardclass+'" '+style+' id="'+rows[i]["rowuuid"]+'">';cellcontent=$this._customopration(cardmodel,rows[i])||"";cardHtml=cardHtml+cellcontent;cardHtml=cardHtml+functionHtml;var stm=rows[i]["@toolsopration"];if(stm){stm="<div class='jazz-grid-cardcell-tools' >"+stm+"</div>"}else{stm=""}cardHtml=cardHtml+stm+"</div>"}return cardHtml}},updateCardById:function(data,id){if(!data||!id){return}var carddata=[];carddata.push(data);var cardobj=this.cardContent.find("#"+id);var cardHtml=this._creatCardHtml(carddata);if(cardHtml){cardobj.replaceWith(cardHtml)}},removeCardById:function(id){this.cardContent.find("#"+id).remove()},selectRow:function(id){if(!id){return false}var $this=this;var card=this.cardContent.find("#"+id);card.removeClass("jazz-gridtable-hover").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",true)}}else{if(card.find("input.jazz-card-radio")){card.find("input.jazz-card-radio").attr("checked",true);card.siblings().find("input.jazz-card-radio").attr("checked",false)}}},unselectRow:function(id){if(!id){return false}var $this=this;var card=this.cardContent.find("#"+id);card.removeClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",false)}}},unselectAllRows:function(){var $this=this;this.cardContent.find("div.jazz-grid-cardcell").removeClass("jazz-gridtable-highlight").attr("aria-selected",false);if($this._isMultipleSelection()){this.cardContent.find("input.jazz-card-checkbox").attr("checked",false)}},selectAllRows:function(){var $this=this;this.cardContent.find("div.jazz-grid-cardcell").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){this.cardContent.find("input.jazz-card-checkbox").attr("checked",true)}}})})(jQuery);(function($){jazz.grid.editorgridpanel={setEditorCell:function(rowIndex,colIndex,editState){var rowIndex=parseInt(rowIndex);var colIndex=parseInt(colIndex);var editState=editState==true||editState=="true";if(rowIndex>0||colIndex>0){if(this.gtable){this.gtable.gridtable("setEditorCell",rowIndex,colIndex,editState)}}},addEidtorRow:function(insertPosition){if(this.gtable){var data={};if(this.rows.length>0){var copyrow=this.rows[0];for(var key in copyrow){data[key]=null}}else{if(this.gcolumn){var gridcolumn=this.gcolumn.data("gridcolumn");cols=gridcolumn.cols;var columnname="";for(var j=0,len=cols.length;j<len;j++){columnname=cols[j]["columnname"];data[columnname]=null}}}data.eidtorstate="editing";data.rowuuid=Math.uuid(32);this.gtable.gridtable("addEidtorRow",data,insertPosition);this.rows.push(data)}},getUpdatedRowData:function(){var that=this;var rows=that.rows;var data=[],state="",temp=null;for(var i=0,len=rows.length;i<len;i++){state=rows[i]["eidtorstate"];if(state){temp={};$.extend(true,temp,rows[i]);data.push(temp)}}return data||[]},_renderGridpanelData:function(rowsdata){var $this=this;$this._processGridpanelData(rowsdata);var delay=100,timeout=5000;if($this.gtable){var gridtable=$this.gtable.data("gridtable");if(gridtable){gridtable.renderGridtableData(rowsdata,true)}else{loopReloadData($this.gtable,"gridtable",0)}}if($this.gcard){var gridcard=$this.gcard.data("gridcard");if(gridcard){gridcard.renderGridcardData(rowsdata,true)}else{loopReloadData($this.gcard,"gridcard",0)}}if($this.gpaginator){var paginator=$this.gpaginator.data("paginator");var a=$this.paginationInfo;if(paginator){paginator.updatePage({page:a.page,pagerows:a.pagerows,totalrecords:a.totalrows})}else{loopReloadData($this.gpaginator,"paginator",0)}}var isshoweditcell=$this.options.isshoweditcell;if(isshoweditcell){if($this.gtable){var gridtable=$this.gtable.data("gridtable");gridtable.createEditorCell()}}$this._event("dataloadcomplete",null,{data:$this.rows,paginationInfo:$this.paginationInfo});function loopReloadData(obj,dataname,count){var compObject=obj.data(dataname);if(compObject){if(dataname=="gridtable"){compObject.renderGridtableData(rowsdata,true)}else{if(dataname=="gridcard"){compObject.renderGridcardData(rowsdata,true)}else{if(dataname=="paginator"){compObject.updatePage({page:$this.paginationInfo.page,pagerows:$this.paginationInfo.pagerows,totalrecords:$this.paginationInfo.totalrows})}}}}else{if(count*delay<=timeout){count++;setTimeout(function(){loopReloadData(obj,dataname,count)},delay)}}}},_requestLoadData:function(data,fn,flag){var that=this;that._processGridpanelData(data);if(that.gtable){that.gtable.gridtable("renderGridtableData",data)}if(that.gcard){that.gcard.gridcard("renderGridcardData",data)}var isshoweditcell=that.options.isshoweditcell;if(isshoweditcell){if(that.gtable){var gridtable=that.gtable.data("gridtable");gridtable.createEditorCell()}}var a=that.paginationInfo;if(flag){if(that.options.isshowpaginator&&that.gpaginator){that.gpaginator.paginator("updatePage",{page:a.page,pagerows:a.pagerows,totalrecords:a.totalrows})}}if(fn&&$.isFunction(fn)){fn.call(that,that.rows,a)}}}})(jQuery);(function($){jazz.grid.editorgridtable={_insertRowHtml:function(rowObj,index,lineIndex){var $this=this;var data=rowObj;var lineno=this.options.lineno;var page=1;var pagerows=0;if(this.gridpanel&&this.gridpanel.paginationInfo){page=this.gridpanel.paginationInfo.page||1;pagerows=this.gridpanel.paginationInfo.pagerows||0}lineIndex=index+lineIndex+1+((page-1)*pagerows);var cls="";if((lineIndex)%2==0){cls="jazz-gridtable-even"}else{cls="jazz-gridtable-odd"}var rowHtml='<tr index="'+(lineIndex-1)+'" class="jazz-grid-row '+cls+' " id="'+data.rowuuid+'">';rowHtml+='<th style="height:20px;"></th>';var b="";if(this._isSelectHelper()&&this._isSelectType()){if($this._isMultipleSelection()){b="checkbox"}else{if($this._isSingleSelection()){b="radio"}}rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box"><input type="'+b+'"/></td>'}if(lineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no">'+lineIndex+"</td>"}var iseditable=false;if(this.gridpanel&&this.gridpanel.paginationInfo){iseditable=this.gridpanel.options.iseditable}var columnname="",stm="",textalign="",columneditor=null,title="";for(var j=0,len=this.cols.length;j<len;j++){columnname=this.cols[j]["columnname"];textalign=this.cols[j]["textalign"]||"";columneditor=this.cols[j]["iseditable"];title="";stm="&nbsp;";if(columnname&&data[columnname]!=undefined){if(data[columnname].toString().indexOf("<")!=0){title=data[columnname]||""}stm=data[columnname]}if(textalign){textalign="text-align-"+textalign}if(iseditable){columneditor=columneditor==false||columneditor=="false"?"":"celleditable"}else{columneditor=columneditor==true||columneditor=="true"?"celleditable":""}rowHtml+='<td class="jazz-grid-cell '+textalign+" "+columneditor+'" title='+title+">"+stm+"</td>"}return rowHtml},_bindGridTableSelectionEvent:function(){var that=this;this.tbody.on("click.td","td.jazz-grid-cell",null,function(e){if($(this).parent().hasClass("nodata")){return}if($(e.target).is("a")){return}that._onRowClickEvent(e,$(this),false)}).on("dblclick.td","td.jazz-grid-cell",null,function(e){if($(this).parent().hasClass("nodata")){return}if($(e.target).is("a")){return}that._onRowClickEvent(e,$(this),true)});$(document).on("mousedown.editorgrid",function(e){var target=$(e.target);if(!that.pretd||!that.pretd[0]){return}if(that.pretd[0]==target[0]||that.pretd.find(target)[0]){return}var isshoweditcell=that.options.isshoweditcell;if(isshoweditcell){that._showeditcellChange(e)}else{that._editorChange(e)}})},_onRowClickEvent:function(e,tdEl,dbclick){var $this=this;var targetrow=$(tdEl).parent();var editortype=$this.options.editortype;var rowselectable=$this.options.rowselectable||$this.options.rowselectable=="true";if(tdEl.hasClass("celleditable")){if(dbclick){if(rowselectable){$this._shiftToRowSelectedStyle(targetrow)}$this._editTdClick(e,targetrow,tdEl)}else{setTimeout(function(){if(rowselectable){$this._shiftToRowSelectedStyle(targetrow)}$this._editTdClick(e,targetrow,tdEl)},100)}}else{if(rowselectable){if(dbclick){$this._onRowClick(e,targetrow,true)}else{setTimeout(function(){$this._onRowClick(e,targetrow,false)},100)}}else{if($(e.target).is(".jazz-grid-cell-box :input")){$this._onRowClick(e,targetrow,false)}}if(editortype=="row"){$this._editTdClick(e,targetrow,tdEl)}}},_shiftToRowSelectedStyle:function(row){var $this=this;var id=row.attr("id");row.addClass("jazz-row-selected").attr("aria-selected",true);if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",true)}if($this.tbody.find("input:checked").length==$this.tbody.find("input:checkbox").length){var thead=$this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",true)}}else{if(row.find("input:radio")){row.find("input:radio").attr("checked",true);row.siblings().find("input:radio").attr("checked",false)}}if($this.gridpanel.gcard){var card=$this.gridpanel.gcard.find("#"+id);card.removeClass("jazz-gridtable-hover").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",true)}}else{if(card.find("input.jazz-card-radio")){card.find("input.jazz-card-radio").attr("checked",true);card.siblings().find("input.jazz-card-radio").attr("checked",false)}}}},_resetPretdComponent:function(){var that=this;that.pretd=null;that.pretdoption=null;that.prevtype=null;that.preheadname=null;that.preid=null;that.predata=null},_reValuePretdComponent:function(event,tr,td){var that=this;var comp=td.children();var vtype=comp.attr("vtype")||"";var index=td.index()||-1;var headname=that.thead.find("th").eq(index).attr("name");var id=tr.attr("id");var data=that.gridpanel.getSelectedRowDataById(id);var headerCells=that.gridcolumn.options.header;var tdoption=that._getDefinedColumn(headerCells,headname);that.pretd=td;that.pretdoption=tdoption;that.compobject=comp.data(vtype);that.prevtype=vtype;that.preheadname=headname;that.preid=id;that.predata=data},_editTdClick:function(event,tr,td){var that=this;var editortype=that.options.editortype;if(editortype=="row"){if(that.pretd&&that.pretd[0]==td[0]){return}else{if(tr.find("div[vtype]").length>0){if(td.hasClass("celleditable")){that._reValuePretdComponent(event,tr,td)}else{}}else{$(tr).find("td.celleditable").each(function(i){that._createCellEditorComponent(event,tr,$(this))});var defaultTD=$(tr).find("td.celleditable:first");that._reValuePretdComponent(event,tr,defaultTD)}}}else{if(editortype=="column"){if(that.pretd&&that.pretd[0]==td[0]){return}else{if(td.find("div[vtype]").length>0){if(td.hasClass("celleditable")){that._reValuePretdComponent(event,tr,td)}else{that._resetPretdComponent()}}else{var index=td.index();that.tbody.find("tr").each(function(i){var obj=$(this).children().eq(index);that._createCellEditorComponent(event,$(this),obj)});var defaultTR=that.tbody.find("tr:first");var defaultTD=defaultTR.children().eq(index);that._reValuePretdComponent(event,defaultTR,defaultTD)}}}else{if(that.pretd&&that.pretd[0]==td[0]){return}else{that._createCellEditorComponent(event,tr,td);that._reValuePretdComponent(event,tr,td);var inputObj=td.find("input[class='jazz-field-comp-input']");if(inputObj[0]){inputObj.focus()}}}}},_createCellEditorComponent:function(event,tr,td){var that=this;var editortype=that.options.editortype;var comp=td.children();var vtype=comp.attr("vtype")||"";if(!vtype){td.empty();var index=td.index()||-1;var headname=that.thead.find("th").eq(index).attr("name");td.addClass("jazz-grid-cell-editing");comp=$("<div style='margin:0px;padding:0px;'>").appendTo(td);var vtype="textfield",options={width:td.width(),height:td.height()};var headerCells=that.gridcolumn.options.header;if(headerCells){var tdoption=that._getDefinedColumn(headerCells,headname);if(tdoption){$.extend(true,options,tdoption);options.name="";vtype=tdoption.datatype||"textfield";if(vtype=="comboxtreefield"||vtype=="comboxfield"){var compdataurl=tdoption.valueset;if(compdataurl){if(compdataurl.trim().indexOf("[")===0){compdataurl=eval("("+compdataurl+")")}$.extend(options,{dataurl:compdataurl})}}}}comp[vtype](options);var compobject=comp.data(vtype);var id=tr.attr("id");var data=that.gridpanel.getSelectedRowDataById(id);var value=data&&data[headname]?data[headname]:"";compobject.setValue(value)}},_editorChange:function(e){var that=this;var headname=that.preheadname||"";var newText=that.compobject.getText()||"";var newValue=that.compobject.getValue()||"";var oldValue=that.predata[headname]||"";if((!oldValue&&!newValue)||newValue==oldValue){}else{that.predata[headname]=newValue||"";that.predata.eidtorstate="editing";that.pretd.addClass("jazz-editgrid-state");var predataid="";predataid=that.preid}var editortype=that.options.editortype;var target=$(e.target);if(editortype=="row"){var prerow=that.pretd.parent();if(prerow.has(target).length>0){}else{$(prerow).find("td.celleditable").each(function(i){var comp=$(this).find("div[vtype]");var v="";if(comp[0]){var vtype=comp.attr("vtype");var compobject=comp.data(vtype);v=compobject.getText()||""}$(this).empty();var index=$(this).index()||-1;var headname=that.thead.find("th").eq(index).attr("name");var headerCells=that.gridcolumn.options.header;var tdoption=that._getDefinedColumn(headerCells,headname);var datatype=tdoption.datatype;var dataformat=tdoption.dataformat;if(datatype&&v!=undefined){v=jazz.util.parseDataByDataFormat({cellvalue:v,datatype:datatype,dataformat:dataformat})}$(this).removeClass("jazz-grid-cell-editing").text(v).attr("title",v)});that._resetPretdComponent()}}else{if(editortype=="column"){var index=that.pretd.index();var td=target.closest("td");if(td[0]&&that.tbody.find(td).length>0&&td.index()==index){}else{that.tbody.find("tr").each(function(i){var tdobj=$(this).children().eq(index);var comp=tdobj.find("div[vtype]");var v="";if(comp[0]){var vtype=comp.attr("vtype");var compobject=comp.data(vtype);v=compobject.getText()||""}tdobj.empty();var headname=that.thead.find("th").eq(index).attr("name");var headerCells=that.gridcolumn.options.header;var tdoption=that._getDefinedColumn(headerCells,headname);var datatype=tdoption.datatype;var dataformat=tdoption.dataformat;if(datatype&&v!=undefined){v=jazz.util.parseDataByDataFormat({cellvalue:v,datatype:datatype,dataformat:dataformat})}tdobj.removeClass("jazz-grid-cell-editing").text(v).attr("title",v)});that._resetPretdComponent()}}else{var datatype=that.pretdoption.datatype;var dataformat=that.pretdoption.dataformat;if(datatype&&newText!=undefined){newText=jazz.util.parseDataByDataFormat({cellvalue:newText,datatype:datatype,dataformat:dataformat})}that.pretd.empty().removeClass("jazz-grid-cell-editing").text(newText).attr("title",newText);that.tbody.find(".jazz-grid-cell-edited").removeClass("jazz-grid-cell-edited");that.pretd.addClass("jazz-grid-cell-edited");that._resetPretdComponent()}}if(this.options.isgroupsummary||this.options.ispagesummary){if(predataid){that.tbody.trigger("cellvaluechange.summaryrow",[predataid])}}},_showeditcellChange:function(event){var that=this;var headname=that.preheadname||"";var newText=that.compobject.getText()||"";var newValue=that.compobject.getValue()||"";var oldValue=that.predata[headname]||"";if((!oldValue&&!newValue)||newValue==oldValue){}else{var datatype=that.pretdoption.datatype;var dataformat=that.pretdoption.dataformat;if(datatype&&newValue!=undefined){newValue=jazz.util.parseDataByDataFormat({cellvalue:newValue,datatype:datatype,dataformat:dataformat})}that.predata[headname]=newValue||"";that.predata.eidtorstate="editing"}that.pretd.attr("title",newText);that._resetPretdComponent()},_getDefinedColumn:function(cells,name){var $this=this;var opt=null;if($.isArray(cells)){for(var i=0,len=cells.length;i<len;i++){var cell=cells[i];if($.isArray(cell)){opt=$this._getDefinedColumn(cell,name)}else{if(name==cell.name){opt=cell;break}}}}return opt},setEditorCell:function(rowIndex,colIndex,editState){},createEditorCell:function(){var that=this;$.each(this._trObject(),function(i,obj){var tr=$(this);tr.find("td.celleditable").each(function(i){var td=$(this);that._createCellEditorComponent(null,tr,td)})})},addEidtorRow:function(data,insertPosition){var rowHtml="";var p=parseInt(insertPosition);var lineIndex=this._trNumber();if(p===0||insertPosition=="first"){rowHtml=this._insertRowHtml(data,0,0);$(rowHtml).insertBefore(this.tbody.children().first());this._updateIndex()}else{if(p>0&&p<lineIndex){rowHtml=this._insertRowHtml(data,0,0);$(rowHtml).insertBefore(this.tbody.children().eq(p));this._updateIndex()}else{rowHtml=this._insertRowHtml(data,0,lineIndex);$(rowHtml).appendTo(this.tbody)}}}}})(jQuery);(function($){jazz.grid.groupgridtable={_bindGroupGridTableEvent:function(){var that=this;this.tbody.on("click.tr","tr.jazz-grid-group-row",null,function(e){var isgroupsummary=that.options.isgroupsummary;var ispagesummary=that.options.ispagesummary;if($(this).hasClass("jazz-grid-group-expand")){$(this).removeClass("jazz-grid-group-expand").addClass("jazz-grid-group-collapse");if(isgroupsummary){$(this).nextUntil(".jazz-grid-groupsummary-row").show()}else{if(ispagesummary){if($(this)[0]==that.tbody.find("tr.jazz-grid-group-row").last()[0]){$(this).nextUntil(".jazz-grid-pagesummary-row").show()}else{$(this).nextUntil(".jazz-grid-group-row").show()}}else{$(this).nextUntil(".jazz-grid-group-row").show()}}}else{if($(this).hasClass("jazz-grid-group-collapse")){$(this).removeClass("jazz-grid-group-collapse").addClass("jazz-grid-group-expand");if(isgroupsummary){$(this).nextUntil(".jazz-grid-groupsummary-row").hide()}else{if(ispagesummary){if($(this)[0]==that.tbody.find("tr.jazz-grid-group-row").last()[0]){$(this).nextUntil(".jazz-grid-pagesummary-row").hide()}else{$(this).nextUntil(".jazz-grid-group-row").hide()}}else{$(this).nextUntil(".jazz-grid-group-row").hide()}}}}})},_bindSummaryGridTableEvent:function(){var that=this;this.tbody.on("cellvaluechange.summaryrow",function(event){that._computeGroupAndPageSummartResult()})},_renderData:function(rows){if(!rows){return}var groupfieldId=this.options.groupfield;var groupfieldTitle=this.options.grouptitlefield;var isgroupsummary=this.options.isgroupsummary;var ispagesummary=this.options.ispagesummary;rows.sort(function(a,b){return parseInt(a[groupfieldId])-parseInt(b[groupfieldId])});var lineIndex=0;var rowHtml=[];this._trObject().remove();lineIndex=this._trNumber();var groupId,grouptitle;for(var i=0;i<rows.length;i++){if(i==0){groupId=rows[i][groupfieldId];grouptitle=rows[i][groupfieldTitle]||"";rowHtml.push(this._getGroupRowHtml(groupId,grouptitle))}if(groupId==rows[i][groupfieldId]){}else{if(isgroupsummary){rowHtml.push(this._getSummaryRowHtml("groupsummary"))}groupId=rows[i][groupfieldId];grouptitle=rows[i][groupfieldTitle]||"";rowHtml.push(this._getGroupRowHtml(groupId,grouptitle))}rowHtml.push(this._insertRowHtml(rows[i],i,lineIndex))}if(isgroupsummary){rowHtml.push(this._getSummaryRowHtml("groupsummary"))}if(ispagesummary){rowHtml.push(this._getSummaryRowHtml("pagesummary"))}this.tbody.append(rowHtml.join(""));var isexpand=this.options.isgroupexpand;if(!isexpand){this.tbody.children("tr.jazz-grid-group-row").each(function(){if(isgroupsummary){$(this).nextUntil(".jazz-grid-groupsummary-row").hide()}else{if(ispagesummary){if($(this)[0]==that.tbody.find("tr.jazz-grid-group-row").last()[0]){$(this).nextUntil(".jazz-grid-pagesummary-row").hide()}else{$(this).nextUntil(".jazz-grid-group-row").hide()}}else{$(this).nextUntil(".jazz-grid-group-row").hide()}}})}this._computeGroupAndPageSummartResult(rows);var trObjs=this.tbody.children(".jazz-grid-row");this._event("rowrender",null,{data:rows,rowEl:trObjs})},_getGroupRowHtml:function(groupId,grouptitle){var groupId=groupId||"";var isexpand=this.options.isgroupexpand;var expandclass=isexpand?"jazz-grid-group-collapse":"jazz-grid-group-expand";var rowHtml='<tr class="jazz-grid-group-row '+expandclass+'" groupid="'+groupId+'" >';rowHtml+='<th style="height:20px;"></th>';var colspan_num=0;if(this._isSelectHelper()&&this._isSelectType()){colspan_num++}if(this.options.lineno){colspan_num++}colspan_num+=this.cols.length;rowHtml+='<td class="jazz-grid-cell" colspan="'+colspan_num+'"><div class="jazz-grid-group-title">'+grouptitle+"</div></td></tr>";return rowHtml},_computeGroupAndPageSummartResult:function(rows){var that=this;var isgroupsummary=this.options.isgroupsummary;var ispagesummary=this.options.ispagesummary;if(isgroupsummary){this.tbody.find("tr.jazz-grid-group-row").each(function(i){var siblings=$(this).nextUntil(".jazz-grid-group-row");var groupdata=[],data;$.each(siblings,function(j,obj){var id=$(obj).attr("id");if(id){data=that.gridpanel.getSelectedRowDataById(id);groupdata.push(data)}});var summaryrow=siblings.filter("tr.jazz-grid-groupsummary-row");that._computeSummaryResult(groupdata,summaryrow)})}if(ispagesummary){var summaryrow=this.tbody.find("tr.jazz-grid-pagesummary-row");if(!rows){rows=this.gridpanel.getAllData()}this._computeSummaryResult(rows,summaryrow)}},_computeSummaryResult:function(rows,summaryrow){var columnname="",issummary="",result=0,value;for(var j=0,len=this.cols.length;j<len;j++){issummary=this.cols[j]["issummary"];if(issummary){columnname=this.cols[j]["columnname"];summarytype=this.cols[j]["summarytype"];summaryrender=this.cols[j]["summaryrender"];var result=this._getSummaryTypeResult(columnname,rows,summarytype);result=this._getSummaryRenderResult(result,rows,summaryrender);var index=this.thead.find("th[name='"+columnname+"']").index();summaryrow.children().eq(index).text(result)}}},_getSummaryTypeResult:function(columnname,rows,type){if(type){var result;if(type.indexOf("(")!=-1){result=this._customopration(type,rows);return result}var temp=[],value;for(var i=0;i<rows.length;i++){value=rows[i][columnname];temp.push(value)}switch(type){case"count":return rows.length;case"min":var x=Math.min.apply(null,temp);return Math.min.apply(null,temp);case"max":return Math.max.apply(null,temp);case"sum":return eval(temp.join("+"));case"average":var count=temp.length;var sum=eval(temp.join("+"));if(count>0){return Math.round(sum/count)}else{return 0}default:return""}}else{return""}},_getSummaryRenderResult:function(result,rows,format){if(format){if(format.indexOf("(")!=-1){result=this._customopration(format,result,rows);return result}}else{return result}},_getSummaryRowHtml:function(summary){var rowHtml='<tr class="jazz-grid-'+summary+'-row">';rowHtml+='<th style="height:20px;"></th>';var isselect=this._isSelectHelper()&&this._isSelectType();var islineno=this.options.lineno;var hj=summary=="groupsummary"?"合计":"总合计";if(isselect&&islineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box" colspan="2">'+hj+"</td>";rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no" style="display:none;"></td>'}else{if(isselect){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box" colspan="2">'+hj+"</td>"}if(islineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no">'+hj+"</td>"}}var textalign;for(var j=0,len=this.cols.length;j<len;j++){textalign=this.cols[j]["textalign"]||"";if(textalign){textalign="text-align-"+textalign}rowHtml+='<td class="jazz-grid-cell '+textalign+'">&nbsp;</td>'}return rowHtml},addRow:function(data){if(!data){return}var rowHtml="";var lineIndex=this._trNumber();for(var i=0;i<data.length;i++){rowHtml+=this._insertRowHtml(data[i],i,lineIndex)}var trobj=null;if(rowHtml){trobj=$(rowHtml).prependTo(this.tbody)}this._event("rowrender",null,{data:data,rowEl:trobj});var isgroupsummary=this.options.isgroupsummary;var groupfieldId=this.options.groupfield;var groupfieldTitle=this.options.grouptitlefield;var id="",groupId="",trrow,targetgroup,grouprows,groupLastRow;for(var i=0;i<data.length;i++){id=data[i]["rowuuid"];groupId=data[i][groupfieldId];grouptitle=data[i][groupfieldTitle];trrow=this.tbody.find("#"+id);targetgroup=this.tbody.find("tr[groupid='"+groupId+"']");if(targetgroup[0]){grouprows=targetgroup.nextUntil("tr.jazz-grid-group-row");groupLastRow=grouprows.filter("tr.jazz-grid-row:last");groupLastRow.after(trrow)}else{var groupTrHtml="";groupTrHtml+=this._getGroupRowHtml(groupId,grouptitle);if(isgroupsummary){groupTrHtml+=this._getSummaryRowHtml("groupsummary")}var groupTrs=$(groupTrHtml).prependTo(this.tbody);groupTrs.filter("tr.jazz-grid-group-row").after(trrow)}}if(this.options.isgroupsummary||this.options.ispagesummary){this.tbody.trigger("cellvaluechange.summaryrow")}}}})(jQuery);(function($){jazz.grid.summarygridtable={_renderData:function(rows){if(!rows){return}var lineIndex=0;var rowHtml=[];this._trObject().remove();lineIndex=this._trNumber();for(var i=0;i<rows.length;i++){rowHtml.push(this._insertRowHtml(rows[i],i,lineIndex))}rowHtml.push(this._getSummaryRowHtml("pagesummary"));this.tbody.append(rowHtml.join(""));var summaryrow=this.tbody.find("tr.jazz-grid-pagesummary-row");this._computeSummaryResult(rows,summaryrow);var trObjs=this.tbody.children(".jazz-grid-row");this._event("rowrender",null,{data:rows,rowEl:trObjs})},_computeSummaryResult:function(rows,summaryrow){var columnname="",issummary="",result=0,value;for(var j=0,len=this.cols.length;j<len;j++){issummary=this.cols[j]["issummary"];if(issummary){columnname=this.cols[j]["columnname"];summarytype=this.cols[j]["summarytype"];summaryrender=this.cols[j]["summaryrender"];var result=this._getSummaryTypeResult(columnname,rows,summarytype);result=this._getSummaryRenderResult(result,rows,summaryrender);var index=this.thead.find("th[name='"+columnname+"']").index();summaryrow.children().eq(index).text(result)}}},_getSummaryTypeResult:function(columnname,rows,type){if(type){var result;if(type.indexOf("(")!=-1){result=this._customopration(type,rows);return result}var temp=[],value;for(var i=0;i<rows.length;i++){value=rows[i][columnname];temp.push(value)}switch(type){case"count":return rows.length;case"min":return Math.min.apply(null,temp);case"max":return Math.max.apply(null,temp);case"sum":return eval(temp.join("+"));case"average":var count=temp.length;var sum=eval(temp.join("+"));if(count>0){return Math.round(sum/count)}else{return 0}default:return""}}else{return""}},_getSummaryRenderResult:function(result,rows,format){if(format){if(format.indexOf("(")!=-1){result=this._customopration(format,result,rows);return result}}else{return result}},_getSummaryRowHtml:function(summary){var rowHtml='<tr class="jazz-grid-'+summary+'-row">';rowHtml+='<th style="height:20px;"></th>';var isselect=this._isSelectHelper()&&this._isSelectType();var islineno=this.options.lineno;var hj=summary=="groupsummary"?"合计":"总合计";if(isselect&&islineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box" colspan="2">'+hj+"</td>";rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no" style="display:none;"></td>'}else{if(isselect){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box" colspan="2">'+hj+"</td>"}if(islineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no">'+hj+"</td>"}}var textalign;for(var j=0,len=this.cols.length;j<len;j++){textalign=this.cols[j]["textalign"]||"";if(textalign){textalign="text-align-"+textalign}rowHtml+='<td class="jazz-grid-cell '+textalign+'">&nbsp;</td>'}return rowHtml},addRow:function(data){if(!data){return}var rowHtml="";var lineIndex=this._trNumber();for(var i=0;i<data.length;i++){rowHtml+=this._insertRowHtml(data[i],i,lineIndex)}var trobj=null;if(rowHtml){trobj=$(rowHtml).prependTo(this.tbody)}this._event("rowrender",null,{data:data,rowEl:trobj});var isgroupsummary=this.options.isgroupsummary;var groupfieldId=this.options.groupfield;var groupfieldTitle=this.options.grouptitlefield;var id="",groupId="",trrow,targetgroup,grouprows,groupLastRow;for(var i=0;i<data.length;i++){id=data[i]["rowuuid"];groupId=data[i][groupfieldId];grouptitle=data[i][groupfieldTitle];trrow=this.tbody.find("#"+id);targetgroup=this.tbody.find("tr[groupid='"+groupId+"']");if(targetgroup[0]){grouprows=targetgroup.nextUntil("tr.jazz-grid-group-row");groupLastRow=grouprows.filter("tr.jazz-grid-row:last");groupLastRow.after(trrow)}else{var groupTrHtml="";groupTrHtml+=this._getGroupRowHtml(groupId,grouptitle);if(isgroupsummary){groupTrHtml+=this._getSummaryRowHtml("groupsummary")}var groupTrs=$(groupTrHtml).prependTo(this.tbody);groupTrs.filter("tr.jazz-grid-group-row").after(trrow)}}if(this.options.isgroupsummary||this.options.ispagesummary){this.tbody.trigger("cellvaluechange.summaryrow")}}}})(jQuery)});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.loading",$.jazz.boxComponent,{options:{blank:false,imgsrc:true,text:"正在加载..."},_create:function(){this.ele=$("<div class='jazz-loading-wrap'><div class='jazz-loading-overlay'></div><div class='jazz-loading-img'><div class='jazz-loading-text'>"+this.options.text+"</div></div></div>").appendTo(this.element);if(!this.options.imgsrc){this.ele.children(".jazz-loading-img").css("background","none")}if(this.options.imgsrc!==true&&this.options.imgsrc){this.ele.children(".jazz-loading-img").css({"background-image":"url("+this.options.imgsrc+")"})}},_init:function(){this.changePosition=false;this.oldPosition="";if(this.options.blank===true){this.ele.find(".jazz-loading-img").hide()}else{this.ele.find(".jazz-loading-img").show()}this.show()},_checkPosition:function(){var parent=this.element.parent(),position=parent.css("position");this.oldPosition=this.element.css("position");if(this.element[0].tagName=="BODY"){this.ele.css({position:"fixed"});if(jazz.isIE(6)){this.ele.css({height:$(window).height(),width:$(window).width()})}this.ele.addClass("jazz-ie6-position-fixed")}else{if(position=="inherit"||position=="static"||position==""){if(!this.element.hasClass("jazz-window-modal")){this.element.css({position:"relative"})}this.ele.children(".jazz-loading-overlay").css("height","100%");this.changePosition=true}}},_reverPostion:function(){if(this.changePosition){this.element.css("position",this.oldPosition);this.changePosition=false}},hide:function(){this._reverPostion();this.ele.hide()},show:function(){this._checkPosition();this.ele.show()},destroy:function(){this.element.children().remove();this.element.remove()}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Toolbar","jazz.Loading"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.imageviewer",$.jazz.container,{options:{imagesrc:null,width:400,height:300,buttons:null,min_width:120,min_height:90,iscandrag:true,isrotate:false,isshowtoolbar:true,isshowcontextmenu:false,isshowwatermark:true,maxzoom:1,watermarkurl:null},_create:function(){this._super();this.options.width=parseInt(this.options.width);this.options.height=parseInt(this.options.height);this.toolbarWrap=$("<div class='jazz-imageview-toolbar'><div name='jazz-imageview-toolbar-"+(jazz.getRandom())+"'></div></div>").appendTo(this.element);if(!this.element.attr("id")){this.element.uniqueId()}if(!this.element.attr("name")){this.element.attr("name","jazz-imageviewer-"+jazz.getRandom())}this._setupContainer();this._initToolbar();this._initWatermark();this.loadImage(this.options.imagesrc);this._setupCSS();this._initContextMenu()},_init:function(){this._bindEvent()},_initToolbar:function(){var $this=this,btns;if(!$this.options.isshowtoolbar){return}btns=[{vtype:"button",align:"right",iconclass:"jazz-btn-zoomin",name:"jazz-imageview-button-zoomin",defaultview:0,click:function(){$this.zoom("in")}},{vtype:"button",align:"right",iconclass:"jazz-btn-zoomout",name:"jazz-imageview-button-zoomout",defaultview:0,click:function(){$this.zoom("out")}}];if($this.options.isrotate){btns=btns.concat([{vtype:"button",align:"right",text:"左转",iconclass:"jazz-imageviewer-rotate-left",defaultview:1,click:function(){$this._rotate(90)}},{vtype:"button",align:"right",text:"右转",iconclass:"jazz-imageviewer-rotate-right",defaultview:1,click:function(){$this._rotate(270)}}])}if(jazz.isArray(this.options.buttons)){btns=btns.concat(this.options.buttons)}$this.toolbarWrap.find(">div").toolbar({items:btns})},getToolbar:function(){if(this.options.isshowtoolbar){return this.toolbarWrap.find(">div")}},_initWatermark:function(){if(this.options.isshowwatermark){this.watermark=$("<div class='jazz-imageview-watermark'></div>").appendTo(this.element);this.addWatermark()}},_rotate:function(degree){var transform,styles=document.createElement("div").style,img=this.imgWrap[0],cosa,sina,matrix;$.each(["transform","MozTransform","webkitTransform","OTransform","msTransform"],function(i,t){if(t in styles){transform=t;return false}});this.imgWrap.data("degree")&&(degree+=this.imgWrap.data("degree"));degree=degree%360;this.imgWrap.data("degree",degree);cosa=Math.cos(degree*Math.PI/180);sina=Math.sin(degree*Math.PI/180);(degree==90||degree==270)&&(cosa=0);(degree==180)&&(sina=0);matrix={M11:cosa,M12:(-1*sina),M21:sina,M22:cosa};if(!transform){img.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+matrix.M11+",M12="+(-1*matrix.M12)+",M21="+(-1*matrix.M21)+",M22="+matrix.M22+",SizingMethod='auto expand')"}else{img.style[transform]="matrix("+matrix.M11+", "+matrix.M12+", "+matrix.M21+", "+matrix.M22+", 0, 0)"}if(degree/90%2==1){this.trans=true}else{this.trans=false}this._checkRectCross()},_computeCenterPoint:function(){var img_width=this.imgWrap.width();var img_height=this.imgWrap.height();var ox=this.imgWrap.offset().left;var oy=this.imgWrap.offset().top;this.centerpoint_x=ox+img_width/2;this.centerpoint_y=oy+img_height/2},_checkRectCross:function(){var w=this.imgWrap.width();var h=this.imgWrap.height();var x=this.imgWrap.offset().left;var y=this.imgWrap.offset().top;var canvas_width=this.element.width();var canvas_height=this.element.height();var rect1={minx1:0,miny1:0,maxx1:canvas_width,maxy1:canvas_height};var rect2={minx2:x,miny2:y,maxx2:x+w,maxy2:y+h};var minx=Math.max(rect1.minx1,rect2.minx2);var miny=Math.max(rect1.miny1,rect2.miny2);var maxx=Math.min(rect1.maxx1,rect2.maxx2);var maxy=Math.min(rect1.maxy1,rect2.maxy2);if((minx===0)||((minx>maxx)||(miny>maxy))){var w2=canvas_width/2;var h2=canvas_width/2;this.imgWrap.css({left:w2-w/2,top:h2-h/2})}},_setupContainer:function(){this.element.addClass("jazz-imageview-wrap");this.element.css({width:(this.options.width+"px"),height:(this.options.height+"px")});this.toolbarWrap.css({width:(this.options.width+"px")})},loadImage:function(imgSrc){var loading=this.element.loading({text:"正在加载图片..."});if(this.imgWrap){this.imgWrap.removeClass();this.imgWrap.addClass("jazz-imageview-image jazz-imageview-minsize");this.imgWrap.find("img").attr("src",imgSrc)}else{this.imgWrap=$("<image src='"+imgSrc+"' alt='' class='jazz-imageview-image jazz-imageview-minsize' />").appendTo(this.element).wrap("<a class='jazz-helper-link' href='javascript:;'></a>")}this.imgWrap.load(function(){var width=$(this).width(),height=$(this).height(),$wrap=$(this).parents(".jazz-imageview-wrap"),wrapWidth=$wrap.width(),wrapHeight=$wrap.height(),minWidth=wrapWidth,minHeight=wrapHeight;$(this).data("size",{width:width,height:height});if(width>=height){minHeight=Math.floor(wrapWidth*height/width)}else{minWidth=Math.floor(wrapHeight*width/height)}if(width<=wrapWidth&&height<=wrapHeight){minWidth=width;minHeight=height;$wrap.data("maxZoom",(wrapWidth/width).toFixed(1))}$(this).data("minSize",{width:minWidth,height:minHeight});$(this).css({width:minWidth,height:minHeight});$wrap.data("minZoom",(minWidth/width).toFixed(1));if(minWidth<wrapWidth){$(this).css({left:(wrapWidth-minWidth)/2+"px"})}if(minHeight<wrapHeight){$(this).css({top:(wrapHeight-minHeight)/2+"px"})}$wrap.data("minPos",{left:(wrapWidth-minWidth)/2+"px",top:(wrapHeight-minHeight)/2+"px"});$wrap.loading("hide")})},_setupCSS:function(){this.imgWrap.css({position:"absolute",top:0,left:0});if(this.options.iscandrag){this.imgWrap.css({cursor:"move"})}},_bindEvent:function(){var $this=this,recoupLeft=0,recoupTop=0;if(this.options.iscandrag){this.imgWrap.draggable({start:function(e,ui){var left=parseInt($(this).css("left"),10),top=parseInt($(this).css("top"),10);left=isNaN(left)?0:left;top=isNaN(top)?0:top;recoupLeft=left-ui.position.left;recoupTop=top-ui.position.top;$this._hideContextMenu();$this.imgWrap.data("beforeOffset",$this.imgWrap.offset()).addClass("jazz-helper-draging")},drag:function(e,ui){ui.position.left+=recoupLeft;ui.position.top+=recoupTop},stop:function(){$this._checkPosition();$this.imgWrap.removeClass("jazz-helper-draging").addClass("jazz-helper-draged")}});if(this.options.isshowwatermark){}}this.element.off("dblclick.viewer").on("dblclick.viewer",function(e){var zoomSize=$this._calZoomSize();if($this.imgWrap.hasClass("jazz-helper-draging")){return}if($this._isInRange(e.pageX,e.pageY,"toolbar")){return}if($this.imgWrap.hasClass("jazz-imageview-minsize")){$this._setImgSize(zoomSize.max,$this.imgWrap.data("trans"));$this.imgWrap.removeClass("jazz-imageview-minsize")}else{$this._setImgSize(zoomSize.min,$this.imgWrap.data("trans"));$this.imgWrap.addClass("jazz-imageview-minsize");$this.imgWrap.offset($this.element.data("minPos"))}$this._checkPosition();$this._adjustImgPos();$this._hideContextMenu()});this.imgWrap.off("mousewheel.viewer DOMMouseScroll.viewer").on("mousewheel.viewer DOMMouseScroll.viewer",function(e){$this._onMouseWheel(e)});this._bindContextMenuEvent();if(!$this.options.isshowtoolbar){return}this.element.find(".jazz-helper-link").hover(function(){$this.toolbarWrap.show()},function(){});this.element.hover(function(){$this.toolbarWrap.show()});this.toolbarWrap.hover(function(){$this.toolbarWrap.show()})},_checkPosition:function(){var transform,styles=document.createElement("div").style;$.each(["transform","MozTransform","webkitTransform","OTransform","msTransform"],function(i,t){if(t in styles){transform=t;return false}});var wrapOffset=this.wrapPos||(this.wrapPos=this.element.offset()),imgOffset=this.imgWrap.offset(),imgSize=this._getImgSize(),wrapWidth=this.options.width,wrapHeight=this.options.height,vwidth=this.trans?"height":"width",vheight=this.trans?"width":"height";if(wrapWidth>=imgSize[vwidth]){if(wrapOffset.left>imgOffset.left){this.imgWrap.offset({left:this.imgWrap.data("beforeOffset")["left"]})}}else{if(!transform){vwidth="width",vheight="height"}if(imgSize[vwidth]+imgOffset.left<wrapOffset.left+wrapWidth){this.imgWrap.offset({left:(wrapWidth-imgSize[vwidth]+wrapOffset.left)})}}if(wrapWidth>=imgSize[vwidth]){if(imgOffset.left+imgSize[vwidth]>wrapOffset.left+wrapWidth){this.imgWrap.offset({left:this.imgWrap.data("beforeOffset")["left"]})}}else{if(imgOffset.left>wrapOffset.left){this.imgWrap.offset({left:wrapOffset.left})}}if(wrapHeight>=imgSize[vheight]){if(wrapOffset.top>imgOffset.top){this.imgWrap.offset({top:this.imgWrap.data("beforeOffset")["top"]})}}else{if(!transform){vwidth="width",vheight="height"}if(imgSize[vheight]+imgOffset.top<wrapHeight+wrapOffset.top){this.imgWrap.offset({top:(wrapHeight+wrapOffset.top-imgSize[vheight])})}}if(wrapHeight>=imgSize[vheight]){if(imgOffset.top+imgSize[vheight]>wrapOffset.top+wrapHeight){this.imgWrap.offset({top:this.imgWrap.data("beforeOffset")["top"]})}}else{if(imgOffset.top>wrapOffset.top){this.imgWrap.offset({top:wrapOffset.top})}}},_updatePosition:function(x,y){return;var wrapOffset,imgOffset,imgSize,oldImgSize,wrapWidth=this.options.width,wrapHeight=this.options.height,offsetX,offsetY,wrapCenter;if(this.imgWrap.hasClass("jazz-imageview-minsize")){this.imgWrap.css(this.element.data("minPos"));return}imgOffset=this.imgWrap.offset();wrapOffset=this.element.offset();imgSize=this._getImgSize(),oldImgSize=this.element.data("oldImgSize");wrapCenter=this.wrapCenter||(this.wrapCenter={x:(wrapOffset.left+wrapWidth/2),y:(wrapOffset.top+wrapHeight/2)});var rX=Math.floor((x-imgOffset.left)/oldImgSize.width*imgSize.width+imgOffset.left),rY=Math.floor((y-imgOffset.top)/oldImgSize.height*imgSize.height+imgOffset.top);offsetX=imgOffset.left+wrapCenter.x-rX;offsetY=imgOffset.top+wrapCenter.y-rX;this.imgWrap.offset({top:offsetX,left:offsetY})},zoom:function(type){type=type||"in";var zoomStep=1,zoom_step=this.zoom_step?this.zoom_step:(this.zoom_step=jazz.config.zoomStep),oldImgSize;if(!this._isZoom(type)){return false}this.imgWrap.data("beforeOffset",this.imgWrap.offset());type=="in"?(zoomStep+=zoom_step):(zoomStep-=zoom_step);oldImgSize=this._getImgSize();this.element.data("oldImgSize",oldImgSize);var imgSize={width:Math.ceil(oldImgSize.width*zoomStep),height:Math.ceil(oldImgSize.height*zoomStep)};this._setImgSize(imgSize);this._checkPosition();this._adjustImgPos()},_calZoomSize:function(){var imgSize,maxZoom=this.element.data("maxZoom")||jazz.config.maxZoom||1,minSize=this.imgWrap.data("minSize");if(this.zoomSize){return this.zoomSize}imgSize=this.originalSize||(this.originalSize=this.imgWrap.data("size"));this.zoomSize={max:{width:Math.ceil(imgSize.width*maxZoom),height:Math.ceil(imgSize.height*maxZoom)},min:{width:minSize.width,height:minSize.height}};return this.zoomSize},_isZoom:function(vtype){var zoomSize,imgSize,vwidth="width",vheight="height",trans=this.trans;zoomSize=this._calZoomSize();imgSize=this._getImgSize();if(trans){vwidth="height";vheight="width"}if(vtype==="in"&&(imgSize[vwidth]>=zoomSize.max["width"]||imgSize[vheight]>=zoomSize.max["height"])){return false}if(vtype==="out"&&(imgSize[vwidth]<=zoomSize.min["width"]||imgSize[vheight]<=zoomSize.min["height"])){this.imgWrap.addClass("jazz-imageview-minsize");this.imgWrap.css(this.element.data("minPos"));return false}this.imgWrap.removeClass("jazz-imageview-minsize");return true},_isInRange:function(x,y,who){var $el,startPoint,endPointX,endPointY;try{$el=this["get"+who.replace(/^\w/,function(m){return m.toUpperCase()})]()}catch(e){jazz.log(e);return false}startPoint=this[who+"Offset"]||(this[who+"Offset"]=$el.offset());endPointX=startPoint.left+$el.width();endPointY=startPoint.top+$el.height();if(x>=startPoint.left&&y>=startPoint.top&&x<=endPointX&&y<=endPointY){return true}return false},getImage:function(){return this.imgWrap},_getImgSize:function(){return{width:this.imgWrap.outerWidth(),height:this.imgWrap.outerHeight()}},_setImgSize:function(imgSize,trans){var minSize=this.imgWrap.data("minSize");imgSize=imgSize||this.originalSize||(this.originalSize=this.imgWrap.data("size"));this.imgWrap.height(imgSize.height).width(imgSize.width)},_adjustImgPos:function(){var imgSize=this._getImgSize(),wrapWidth=this.options.width,wrapHeight=this.options.height,trans=this.trans,vheight=trans?"width":"height",vwidth=trans?"height":"width";if(imgSize[vwidth]<=wrapWidth){this.imgWrap.css({left:(wrapWidth-imgSize[vwidth])/2+"px"})}if(imgSize[vheight]<=wrapHeight){this.imgWrap.css({top:(wrapHeight-imgSize[vheight])/2+"px"})}},_onMouseWheel:function(e){var $this=this,imgOffset=$this.imgWrap.offset(),delta,zoomFlag;e=e||window.event;e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}if(e.preventDefault){e.preventDefault()}if(e.originalEvent){delta=e.originalEvent.detail||e.originalEvent["wheelDelta"];if(delta>0){zoomFlag=$this.zoom("in")}else{zoomFlag=$this.zoom("out")}$this._hideContextMenu()}},_initContextMenu:function(){var $menu,items=[];if(!this.options.isshowcontextmenu){return}if($("div.jazz-imageview-contextmenu").length>0){this.contextMenu=$("div.jazz-imageview-contextmenu");return}$menu=$("<div class='jazz-imageview-contextmenu jazz-helper-hidden'><ul></ul></div>").appendTo($("body")).children("ul");items.push("<li><a href='javascript:;' class='jazz-imageview-zoomin'>放大</a></li>");items.push("<li><a href='javascript:;' class='jazz-imageview-zoomout'>缩小</a></li>");if(this.options.isrotate){items.push("<li><a href='javascript:;' class='jazz-imageview-rotateleft'>左转</a></li>");items.push("<li><a href='javascript:;' class='jazz-imageview-rotateright'>右转</a></li>")}items.push("<li><a href='javascript:;' class='jazz-imageview-cancelMenu'>取消</a></li>");$menu.append(items.join(""));this.contextMenu=$menu.parent()},_showContextMenu:function(x,y){this.contextMenu.offset({left:x,top:y}).show()},_hideContextMenu:function(){$("div.jazz-imageview-dblclicked").removeClass("jazz-imageview-dblclicked");this.options.isshowcontextmenu&&this.contextMenu.offset({left:0,top:0}).hide()},_bindContextMenuEvent:function(){var $this=this;if(!this.options.isshowcontextmenu){return}this.imgWrap[0].oncontextmenu=function(e){e=e||window.event;e.cancelBubble=true;e.stopPropagation&&e.stopPropagation();event.preventDefault?event.preventDefault():event.returnValue=false;$(".jazz-imageview-dblclicked").removeClass("jazz-imageview-dblclicked");$this.element.addClass("jazz-imageview-dblclicked");$(".jazz-imageview-wrap").not(".jazz-imageview-dblclicked").find(".jazz-imageview-toolbar").hide();$this._showContextMenu(e.clientX,e.clientY)};if($._data(this.contextMenu[0],"events")){return}$("a.jazz-imageview-cancelMenu").off("click.viewer").on("click.viewer",function(){$this._hideContextMenu()});$("a.jazz-imageview-zoomin").off("click.viewer").on("click.viewer",function(){$(".jazz-imageview-dblclicked:first").imageviewer("zoom","in")});$("a.jazz-imageview-zoomout").off("click.viewer").on("click.viewer",function(){$(".jazz-imageview-dblclicked:first").imageviewer("zoom","out")})},reset:function(imgSrc){var imgSize,left=0,top=0;this._setImgSize();imgSize=this._getImgSize();if(imgSize.width<this.element.width()){left=(this.element.width()-imgSize.width)/2+"px"}if(imgSize.height<this.element.height()){top=(this.element.height()-imgSize.height)/2+"px"}this.imgWrap.css({top:top,left:left})},addButton:function(button){var btns=[];if(!jazz.isArray(button)){btns=[button]}else{btns=btns.concat(button)}this.toolbarWrap.find("> div").toolbar("addElement",btns)},addWatermark:function(src){src=src||this.options.watermarkurl||jazz.config.watermarkurl;if(!src){return}this.watermark.css({background:"url("+src+") right bottom no-repeat transparent"})},_setOption:function(key,value){switch(key){case"width":this.options.width=parseInt((value+"").replace(/px/ig,""));this._setupContainer();break;case"height":this.options.height=parseInt((value+"").replace(/px/ig,""));this._setupContainer();break;case"watermarkurl":this.options.watermarkurl=value;this.addWatermark(value);break;case"imagesrc":this.options.imagesrc=value;this.loadImage(value)}this._super(key,value)},destroy:function(){this.element.children().remove();this.element.remove();if($("div.jazz-imageview-wrap").length<=1){this.contextMenu.children().remove();this.contextMenu.remove()}this._super()}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Button"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.toolbar",$.jazz.boxComponent,{options:{vtype:"toolbar",items:null,overflowtype:"scroll",orientation:"horizontal"},_create:function(){this._super();var toolbardoms="<div class='jazz-toolbar-scroll-first'></div><div class='jazz-toolbar-content'><div class='jazz-toolbar-content-wrap'><div class='jazz-toolbar-contentarea-second'></div><div class='jazz-toolbar-contentarea-first'></div></div></div><div class='jazz-toolbar-scroll-second'></div>";var toolbarclass="jazz-toolbar jazz-toolbar-orientation-horizontal";if(this.options.orientation=="vertical"){toolbarclass="jazz-toolbar jazz-toolbar-orientation-vertical"}this.element.addClass(toolbarclass).append(toolbardoms);this.scollFirst=this.element.find(".jazz-toolbar-scroll-first");this.toolbarContent=this.element.find(".jazz-toolbar-content");this.toolbarContentWrap=this.element.find(".jazz-toolbar-content-wrap");this.toolbarFirst=this.element.find(".jazz-toolbar-contentarea-first");this.toolbarSecond=this.element.find(".jazz-toolbar-contentarea-second");this.scollSecond=this.element.find(".jazz-toolbar-scroll-second");if(this.options.orientation=="vertical"){if(this.options.height==-1){this.toolbarContent.addClass("toolbar-content-default-height")}if(this.options.width==-1){this.toolbarContent.addClass("toolbar-content-default-width");this.element.addClass("toolbar-default-width")}}},_init:function(){this._super();this._setToolbarWith();this._setToolbarHeight();if(this.options.items==null){this._vtypeCreateElements()}else{this._widgetCreateElements()}if(this.options.overflowtype=="wrap"){if(this.options.orientation=="horizontal"){this.toolbarContentWrap.css("width","100%");this.toolbarFirst.addClass("white-space-normal");this.toolbarSecond.addClass("white-space-normal")}}else{this._bindScrollEvent();if($.isArray(this.options.items)&&this.options.items.length>0){var that=this;setTimeout(function(){that._computeToolbarWidth()},150)}}},finish:function(){var that=this;if(this.options.overflowtype!="wrap"){setTimeout(function(){that._computeToolbarWidth()},150)}},_vtypeCreateElements:function(){var orientation=this.options.orientation;var childrens=this.element.children();var child=null,wrapHtml="<div class='jazz-toolbar-element'></div>";if(orientation=="vertical"){for(var i=0,m=childrens.length;i<m-3;i++){child=$(childrens[i]);child.wrap(wrapHtml);this.toolbarFirst.append(child.parent())}this.toolbarSecond.hide()}else{if(this.element.children("[align=center]").length==(childrens.length-3)){this.toolbarContent.css("text-align","center")}for(var i=0,m=childrens.length;i<m-3;i++){child=$(childrens[i]);child.wrap(wrapHtml);if(child.attr("align")=="right"){this.toolbarSecond.append(child.parent())}else{this.toolbarFirst.append(child.parent())}}}},_widgetCreateElements:function(){var items=this.options.items;if(!$.isArray(items)){return}var orientation=this.options.orientation;var child=null,wrapHtml="<div class='jazz-toolbar-element'></div>";if(orientation=="vertical"){for(var i=0,len=items.length;i<len;i++){if(items[i]["class"]=="separator"){child=$("<div class='separator'></div>")}else{child=jazz.widget(items[i],this.toolbarFirst)}if(items[i]["vtype"]=="button"){child=child.data("button")["container"]}child.wrap(wrapHtml);this.toolbarFirst.append(child.parent())}this.toolbarSecond.hide()}else{var isAllAlignCenter=true;for(var i=0,len=items.length;i<len;i++){if(items[i]["align"]!="center"){isAllAlignCenter=false}}if(isAllAlignCenter){this.toolbarContent.css("text-align","center")}for(var i=0,len=items.length;i<len;i++){if(items[i]["align"]=="right"){if(items[i]["class"]=="separator"){child=$("<div class='separator'></div>")}else{child=jazz.widget(items[i],this.toolbarSecond)}if(items[i]["vtype"]=="button"){child=child.data("button")["container"]}child.wrap(wrapHtml);this.toolbarSecond.append(child.parent())}else{if(items[i]["class"]=="separator"){child=$("<div class='separator'></div>")}else{child=jazz.widget(items[i],this.toolbarFirst)}if(items[i]["vtype"]=="button"){child=child.data("button")["container"]}child.wrap(wrapHtml);this.toolbarFirst.append(child.parent())}}}},_bindScrollEvent:function(){var that=this;this.element.on("contextmenu.jazz-toolbar-contextmenu",function(e){return false});var orientation=this.options.orientation;var scrollwidth=50;that.scollSecond.off("click").on("click",function(){if(orientation=="horizontal"){var scrollleft=that.toolbarContent.scrollLeft()+scrollwidth;var scrollTotalWidth=that.toolbarContentWrap.width()-that.toolbarContent.width();if(scrollleft>scrollTotalWidth){scrollleft=scrollTotalWidth}that.toolbarContent.scrollLeft(scrollleft)}else{if(orientation=="vertical"){var scrollheight=that.toolbarContent.scrollTop()+scrollwidth;var scrollTotalHeight=that.toolbarContentWrap.height()-that.toolbarContent.height();if(scrollheight>scrollTotalHeight){scrollheight=scrollTotalHeight}that.toolbarContent.scrollTop(scrollheight)}}});that.scollFirst.off("click").on("click",function(){if(orientation=="horizontal"){var scrollleft=that.toolbarContent.scrollLeft()-scrollwidth;that.toolbarContent.scrollLeft(scrollleft)}else{if(orientation=="vertical"){var scrollheight=that.toolbarContent.scrollTop()-scrollwidth;that.toolbarContent.scrollTop(scrollheight)}}})},_computeToolbarWidth:function(){var that=this;var orientation=this.options.orientation;if(orientation=="horizontal"){var tbw1=0;$.each(that.toolbarFirst.children(),function(index,obj){if($(obj).is(":visible")){tbw1+=$(obj).width()}});var tbw2=0;$.each(that.toolbarSecond.children(),function(index,obj){if($(obj).is(":visible")){tbw2+=$(obj).width()}});if(tbw1>0){tbw1+=1;that.toolbarFirst.width(tbw1)}else{}if(tbw2>0){tbw2+=1;that.toolbarSecond.width(tbw2)}else{}var wrapWidth=0;var contentWidth=that.toolbarContent.width();var toolbarWidth=that.element.width();if(toolbarWidth<(tbw1+tbw2)){that.toolbarContent.width(that.element.width()-36);that.toolbarContent.css({position:"relative",left:"18px"});wrapWidth=tbw1+tbw2+3;that.toolbarContentWrap.width(wrapWidth);that.scollFirst.show();that.scollSecond.show()}else{that.toolbarContent.css({width:"100%",position:"static",left:"0px"});that.toolbarContentWrap.css({width:"100%"});that.scollFirst.hide();that.scollSecond.hide()}}else{if(orientation=="vertical"){var toolbarHeight=that.element.height();var contentHeight=that.toolbarContent.height();var contentWrapHeight=that.toolbarContentWrap.height();if(jazz.isNormalSize(that.options.height)){if(toolbarHeight<contentWrapHeight){that.toolbarContent.height(toolbarHeight-36);that.toolbarContent.css({position:"relative",top:"18px"});that.scollFirst.show();that.scollSecond.show()}else{that.toolbarContent.css({height:"100%",position:"static",top:"0px"});that.scollFirst.hide();that.scollSecond.hide()}}}}},_width:function(){var orientation=this.options.orientation;var width=this.options.width;if(orientation=="vertical"&&width==-1){return false}this._super();if(this.iscalculatewidth){if(this.options.overflowtype=="wrap"){if(this.options.orientation=="horizontal"){var tbw1=this.toolbarFirst.width();var tbw2=this.toolbarSecond.width();var toolbarWidth=this.element.width();var leftchildsize=this.toolbarFirst.children().size();var rightchildsize=this.toolbarSecond.children().size();if(leftchildsize>0&&leftchildsize>0){if(toolbarWidth<(tbw1+tbw2)){this.toolbarFirst.css("width","70%");this.toolbarSecond.css("width","auto")}}else{if(leftchildsize===0){this.toolbarSecond.css("width","100%")}if(rightchildsize===0){this.toolbarFirst.css("width","100%")}}}}else{this._computeToolbarWidth()}}},_height:function(){this._super();if(this.iscalculatewidth){if(this.options.overflowtype=="wrap"){}else{this._computeToolbarWidth()}}},_setToolbarWith:function(){var orientation=this.options.orientation;var width=this.options.width;if(orientation=="vertical"&&width==-1){return false}if(this.options.width==-1){width="100%"}if(jazz.isNormalSize(width)){if(jazz.isNumber(width)){this.element.outerWidth(width)}else{if(/^\d+(\.\d+)?%$/.test(width)){var n=this._getCalculatePercentWidth(width);this.element.outerWidth(n)}}}},_setToolbarHeight:function(){var height=this.options.height;if(jazz.isNormalSize(height)){if(jazz.isNumber(height)&&parseFloat(height)>=0){this.element.outerHeight(height)}else{if(/^\d+(\.\d+)?%$/.test(height)){var n=this._getCalculatePercentHeight(height);this.element.outerHeight(n)}}}},addElement:function(items){this._insertSubElement(items);if(this.options.overflowtype!="wrap"){this._computeToolbarWidth()}},appendElement:function(items,name){this._insertSubElement(items,name,"after");if(this.options.overflowtype!="wrap"){this._computeToolbarWidth()}},prependElement:function(items,name){this._insertSubElement(items,name,"before");if(this.options.overflowtype!="wrap"){this._computeToolbarWidth()}},_insertSubElement:function(items,name,position){if(!$.isArray(items)){return}var orientation=this.options.orientation;var child=null,wrapHtml="<div class='jazz-toolbar-element'></div>";if(orientation=="vertical"){for(var i=0,len=items.length;i<len;i++){if(items[i]["class"]=="separator"){child=$("<div class='separator'></div>")}else{child=jazz.widget(items[i],this.toolbarFirst)}if(items[i]["vtype"]=="button"){child=child.data("button")["container"]}child.wrap(wrapHtml);this._insertSubElementByCondition(name,position,child.parent(),this.toolbarFirst)}}else{var isAllAlignCenter=false;var textAlign=this.toolbarContent.css("text-align");if(textAlign=="center"){isAllAlignCenter=true}else{var temp=true;for(var i=0,len=items.length;i<len;i++){if(items[i]["align"]!="center"){temp=false}}var leftnums=this.toolbarFirst.children().length;var rightnums=this.toolbarSecond.children().length;if(leftnums==0&&rightnums==0&&temp){isAllAlignCenter=true}if(isAllAlignCenter){this.toolbarContent.css("text-align","center")}}for(var i=0,len=items.length;i<len;i++){if(items[i]["align"]=="right"){if(items[i]["class"]=="separator"){child=$("<div class='separator'></div>")}else{child=jazz.widget(items[i],this.toolbarSecond)}if(items[i]["vtype"]=="button"){child=child.data("button")["container"]}child.wrap(wrapHtml);this._insertSubElementByCondition(name,position,child.parent(),this.toolbarSecond)}else{if(items[i]["class"]=="separator"){child=$("<div class='separator'></div>")}else{child=jazz.widget(items[i],this.toolbarFirst)}if(items[i]["vtype"]=="button"){child=child.data("button")["container"]}child.wrap(wrapHtml);this._insertSubElementByCondition(name,position,child.parent(),this.toolbarFirst)}}}},_insertSubElementByCondition:function(name,position,newEl,tbar){if(name){var target=this.element.find('div[name="'+name+'"]');if(target.length>0){if(position=="before"){$(target).parent().before(newEl)}else{$(target).parent().after(newEl)}}else{if(position=="before"){tbar.prepend(newEl)}else{tbar.append(newEl)}}}else{if(position=="before"){tbar.prepend(newEl)}else{tbar.append(newEl)}}},removeElement:function(name){if(!name){return}var $this=this;$this.element.find('div[name="'+name+'"]').each(function(i){$(this).parents(".jazz-toolbar-element").remove()});if(this.options.overflowtype!="wrap"){this._computeToolbarWidth()}},hideElement:function(name){if(!name){return}var $this=this;$this.element.find('div[name="'+name+'"]').each(function(i){$(this).parents(".jazz-toolbar-element").hide()});if(this.options.overflowtype!="wrap"){this._computeToolbarWidth()}},showElement:function(name){if(!name){return}var $this=this;$this.element.find('div[name="'+name+'"]').each(function(i){$(this).parents(".jazz-toolbar-element").show()});if(this.options.overflowtype!="wrap"){this._computeToolbarWidth()}},removeButton:function(name){this.removeElement(name)},hideButton:function(name){this.hideElement(name)},showButton:function(name){this.showElement(name)},disableButton:function(name){if(!name){return}var $this=this;$this.element.find('div[name="'+name+'"]').each(function(i){$(this).button("disable")})},enableButton:function(name){if(!name){return}var $this=this;$this.element.find('div[name="'+name+'"]').each(function(i){$(this).button("enable")})},highlightButton:function(name){if(!name){return}this.element.find('div[name="'+name+'"]').button("highlight")},unhighlightButton:function(name){if(!name){return}this.element.find('div[name="'+name+'"]').button("unhighlight")},hide:function(){var $this=this;$this.element.hide()},show:function(){var $this=this;$this.element.show()}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.tooltip",$.jazz.boxComponent,{options:{content:"",hideevent:"mouseout",iconclass:null,isbindevent:true,position:null,showevent:"mouseover"},_create:function(){this.container=$('<div class="jazz-tooltip" />').appendTo(document.body);var styleClass="",_iconclass=this.options.iconclass;if(_iconclass){styleClass='<span class="jazz-tooltip-img '+_iconclass+'"></span>'}else{this.arrow=$('<div class="jazz-tooltip-arrow"></div>').appendTo(this.container);this.container.css({"padding-left":"10px"})}var content='<div class="jazz-tooltip-div"> '+styleClass+'<span class="jazz-tooltip-label"></span></div>';this.container.append(content);this.contentobj=this.container.children(".jazz-tooltip-div")},_init:function(){if(this.options.isbindevent){this._bindEvent()}if(this.options.width!=-1){this.contentobj.outerWidth(this.options.width)}else{this.contentobj.outerWidth(200)}if(this.options.content){var obj=this.contentobj.children(".jazz-tooltip-label");obj.html(this.options.content)}},_setOption:function(key,value){switch(key){case"content":this.options.content=value;var obj=this.contentobj.children(".jazz-tooltip-label");obj.html(value);break;case"position":this._align();break}this._super(key,value)},_align:function(){var $this=this;var pos={my:"left top",at:"right top",collision:"flipfit none",of:$this.element,using:function(pos){var lp=0;if(!$this.options.iconclass){var tipHeight=$this.container.outerHeight();var eleHeight=$this.element.height();if(eleHeight>50){if(tipHeight<=50){lp=0;$this.arrow.css({top:"7px"})}else{if(eleHeight-tipHeight>20){lp=20;$this.arrow.css({top:"35px"})}else{lp=0;$this.arrow.css({top:"25px"})}}}else{if(tipHeight<=50){lp=0;$this.arrow.css({top:"7px"})}else{lp=18;$this.arrow.css({top:"25px"})}}}var n=0;if($this.options.position==1){n=$this.element.height()}var l=pos.left<0?0:pos.left+5,t=pos.top<0?0:pos.top-lp+n;$(this).css({left:l,top:t})}};this.container.css({left:"",top:"","z-index":++jazz.zindex}).position(pos)},_bindEvent:function(){var $this=this;var hideevent=this.options.hideevent,showevent=this.options.showevent;if(hideevent=="mouseout"){this.globalSelector=null}else{this.globalSelector="a,:input,:button,img"}var _sevent="",_hevent="";if(hideevent){var _h=hideevent.split(";");for(var i=0,len=_h.length;i<len;i++){if(_h[i]){_hevent=_h[i]+".tooltip "+_hevent}}}if(showevent){var _s=showevent.split(";");for(var i=0,len=_s.length;i<len;i++){if(_s[i]){_sevent=_s[i]+".tooltip "+_sevent}}}this.element.off(_sevent+" "+_hevent).on(_sevent,this.globalSelector,function(){$this.show()}).on(_hevent,this.globalSelector,function(){$this.hide()});this.element.removeAttr("title")},hide:function(){this.container.hide();this.container.css("z-index","")},show:function(){this._align();this.container.show()}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Window"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.message",$.jazz.window,{options:{detail:"",width:340,height:-1,showtype:0,sure:null,cancel:null},_create:function(){this._super();this.element.addClass("jazz-message")},_init:function(){this.options.modal=true;this.options.visible=true;this._super();this.content.empty();var div='<div class="jazz-message-content"><div class="jazz-message-img"></div><div class="jazz-message-text">&nbsp;</div><div class="jazz-message-button"></div></div>';this.content.append(div);jazz.config.errorMessageNumber++;var img=this.element.find(".jazz-message-img");var btn=this.element.find(".jazz-message-button");var $this=this;var qd=$('<div class="jazz-message-button-style jazz-message-img-queding"></div>').appendTo(btn);qd.off("click.message").on("click.message",function(){$this.close(true);jazz.config.errorMessageNumber=0;var a=$this.options.sure;if($.isFunction(a)){a.call($this)}});var type=this.options.showtype;if(type==0){img.addClass("jazz-message-img-info")}else{if(type==1){img.addClass("jazz-message-img-error")}else{if(type==2){img.addClass("jazz-message-img-warn")}else{if(type==3){img.addClass("jazz-message-img-confirm");var qx=$('<div class="jazz-message-button-style jazz-message-img-cancel"></div>').appendTo(btn);qx.off("click.message").on("click.message",function(){$this.close(true);jazz.config.errorMessageNumber=0;var a=$this.options.cancel;if($.isFunction(a)){a.call($this)}})}}}}if(this.options.detail){var text=this.element.find(".jazz-message-text");text.html(this.options.detail)}}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery"],factory)}else{factory($)}})(jQuery,function($){jazz_validator={reg:{number:/^[-]?\d+(\.\d+)?([Ee][-+]?[1-9]+)?$/i,numberInt:/^[-]?\d+$/i,numberFloat:/^[-]?\d+\.\d+$/i,numberPlusInt:/^\d+$/i,character:/^[\u4e00-\u9fa5A-Za-z]+$/i,chinese:/^[\u4e00-\u9fa5]+$/i,twoBytes:/^[^\x00-\xff]+$/i,english:/^[A-Za-z]+$/i,number$character:/^[\u4e00-\u9fa5A-Za-z0-9]+$/i,number$english:/^[\w]+$/i,qq:/^[1-9]\d{5,11}$/i,telephone:/^((\(0\d{2,3}\))|(0\d{2,3}-))?[1-9]\d{6,7}(-\d{1,4})?$/i,cellphone:/^0?1\d{10}$/i,postal:/^\d{6}$/i,currency:/^\$[-+]?\d+(\.\d+)?([Ee][-+]?[1-9]+)?$/i,email:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i,url:/^(http|https|ftp):\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/i},msg:{t:"",number:jazz.config.i18n.num,numberInt:jazz.config.i18n.numInt,numberFloat:jazz.config.i18n.numFloat,numberPlusInt:jazz.config.i18n.numberPlusInt,numberScience:jazz.config.i18n.numScience,character:jazz.config.i18n.character,chinese:jazz.config.i18n.chinese,twoBytes:jazz.config.i18n.twoBytes,english:jazz.config.i18n.english,date:jazz.config.i18n.date,"number$character":jazz.config.i18n.numChar,"number$english":jazz.config.i18n.numEnglish,qq:jazz.config.i18n.qq,telephone:jazz.config.i18n.telephone,cellphone:jazz.config.i18n.cellphone,idcard:jazz.config.i18n.idcard,postal:jazz.config.i18n.postal,currency:jazz.config.i18n.currency,email:jazz.config.i18n.email,url:jazz.config.i18n.url,and:jazz.config.i18n.and1,or:jazz.config.i18n.or,solo:"",must:jazz.config.i18n.must,contrast:jazz.config.i18n.contrast,range:jazz.config.i18n.range,customCheckStyle:jazz.config.i18n.customCheckStyle,length:jazz.config.i18n.length1,customFunction:jazz.config.i18n.customFunction},checkIdcard:function(idcard){var area={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};var idcard,Y,JYM;var S,M;var idcard_array=new Array();idcard_array=idcard.split("");if(area[parseInt(idcard.substr(0,2))]==null){return false}switch(idcard.length){case 18:if(parseInt(idcard.substr(6,4))%4==0||(parseInt(idcard.substr(6,4))%100==0&&parseInt(idcard.substr(6,4))%4==0)){ereg=/^[1-9][0-9]{5}19[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/}else{ereg=/^[1-9][0-9]{5}19[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/}if(ereg.test(idcard)){S=(parseInt(idcard_array[0])+parseInt(idcard_array[10]))*7+(parseInt(idcard_array[1])+parseInt(idcard_array[11]))*9+(parseInt(idcard_array[2])+parseInt(idcard_array[12]))*10+(parseInt(idcard_array[3])+parseInt(idcard_array[13]))*5+(parseInt(idcard_array[4])+parseInt(idcard_array[14]))*8+(parseInt(idcard_array[5])+parseInt(idcard_array[15]))*4+(parseInt(idcard_array[6])+parseInt(idcard_array[16]))*2+parseInt(idcard_array[7])*1+parseInt(idcard_array[8])*6+parseInt(idcard_array[9])*3;Y=S%11;M="F";JYM="10X98765432";M=JYM.substr(Y,1);if(M==idcard_array[17]){return true}else{return false}}else{return false}break;default:return false;break}},idcard:function(val){var value=val;if(value==""){return true}return this.checkIdcard(value)},numberDefine:function(val,zl,xl){var value=val;if(value==""){return true}if(!this.reg.number.test(value)){return false}var valueStrArray=value.split(".");var zlength=zl;if(valueStrArray.length==2){return valueStrArray[0].length<=zlength&&valueStrArray[1].length<=xl}else{return valueStrArray[0].length<=zlength}},customCheckStyle:function(val,value){var text=val;var reList=value;for(var i=0;i<text.length;i++){var c=text.charAt(i);if(reList.indexOf(c)>=0){return false}}return true},getFunc:function(str){if(!str){str=""}var res=[];res.push(eval(str));return res},contrast:function(val,v1,v2){var value=val;if(value==""){return true}if(this.reg.number.test(value)){var flag=eval(value+v1);if(v2!=""){flag=flag?eval(value+v2):false}return flag}else{return false}},length:function(item,val,begin,end){var value=val;if(value==""){return true}var len=this.getLen(value);if(item.indexOf(",")>=0){return(len>=begin&&len<=end)}else{if(end!=""){return(len>begin&&len<end)}else{return len==begin}}},getLen:function(str){var len=0;for(var i=0;i<str.length;i++){var strCode=str.charCodeAt(i);var strChar=str.charAt(i);if((strCode>65248)||(strCode==12288)||this.reg.chinese.test(strChar)){len=len+2}else{len=len+1}}return len},testRegexp:function(val,rule){if(typeof(rule)!="regexp"){if(this.testRegex("\\/\\^",rule)){rule=rule.substring(1,rule.length)}if(this.testRegex("\\/\\i",rule)){rule=rule.substring(0,rule.length-2)}rule=new RegExp(rule)}var value=val;if(value==""){return true}return rule.test(value)},testRegex:function(regex,rule){return((typeof regex=="string")?new RegExp(regex):regex).test(rule)},doValidator:function(val,rule,regMsg,compThis){var msg=[];var customFunctionReturnObj=null;var ruleArray=[],type="solo";if(!!rule){if(rule.indexOf("_")>=0){ruleArray=rule.split("_");type="and"}else{if(rule.indexOf("||")>=0){ruleArray=rule.split("||");type="or"}else{ruleArray[0]=rule}}var flag=(type!="or")?true:false;var state=flag,stateArray=[];$.each(ruleArray,function(index,item){var tempMSG="";if(item.indexOf("must")>=0){if($.trim(val)==""){state=false}else{state=true}if(typeof(regMsg)=="undefined"||$.trim(regMsg)==""){tempMSG=jazz_validator.msg.t+jazz_validator.msg.must}else{tempMSG=regMsg+""}}else{if(/^(\w+_)?date;.+/.test(item)){var items=item.split(";");var d=items[1]||"yyyy-MM-dd";var c=jazz.dateformat.isDate($.trim(val),d);if(c==false){if(typeof(regMsg)=="undefined"||$.trim(regMsg)==""){tempMSG=jazz_validator.msg.t+"时间格式输入有误，请输入（"+d+"）格式！"}else{tempMSG=regMsg+""}state=false}else{state=true}}else{if(item.indexOf("number")>=0&&item.indexOf(",")>=0){var defineArray=item.substring(item.indexOf("(")+1,item.indexOf(")")).split(",");var zl=defineArray[0]-defineArray[1];var xl=defineArray[1];state=jazz_validator.numberDefine(val,zl,xl);if(typeof(regMsg)=="undefined"||$.trim(regMsg)==""){tempMSG=jazz_validator.msg.t+"数字,且整数部分最多"+zl+"位,且小数部分最多"+xl+"位"}else{tempMSG=regMsg+""}item="numberDefine"}else{if(jazz_validator.reg[item]){state=(state==flag)?jazz_validator.testRegexp(val,jazz_validator.reg[item]+""):state;if(typeof(regMsg)=="undefined"||$.trim(regMsg)==""){tempMSG=jazz_validator.msg.t+(jazz_validator.msg[item]||"")}else{tempMSG=regMsg+""}}else{if(item.indexOf("regexp")>=0){state=(state==flag)?jazz_validator.testRegexp(val,item.split(";")[1]):state;tempMSG=jazz_validator.msg.t+((!!regMsg)?regMsg:"");item="regexp"}else{if(item.indexOf("customCheckStyle")>=0){state=jazz_validator.customCheckStyle(val,item.split(";")[1]);if(typeof(regMsg)=="undefined"||$.trim(regMsg)==""){tempMSG=jazz_validator.msg.t+jazz_validator.msg.customCheckStyle+item.split(";")[1]}else{tempMSG=regMsg+""}}else{if(item.indexOf("customFunction")>=0){var items=item.split(";");customFunctionReturnObj=jazz_validator.getFunc(items[1]);state=customFunctionReturnObj[0].state;tempMSG=jazz_validator.msg.t+customFunctionReturnObj[0].msg;item="customFunction";if(state==undefined||state=="undefined"||state==true){state=true;tempMSG=""}}else{if(item.indexOf("contrast")>=0){var contrastValue1=item.split(";")[1],contrastValue2="";if(item.split(";").length==3){contrastValue2=item.split(";")[2]}state=jazz_validator.contrast(val,contrastValue1,contrastValue2);if(typeof(regMsg)=="undefined"||$.trim(regMsg)==""){tempMSG=jazz_validator.msg.t+jazz_validator.msg.contrast+contrastValue1+",  "+contrastValue2}else{tempMSG=regMsg+""}item="contrast"}else{if(item.indexOf("length")>=0){var tempItemArray=item.split(";"),begin="",end="";if(tempItemArray.length==3){begin=item.split(";")[1];end=item.split(";")[2]}else{if(tempItemArray[1].indexOf(",")>=0){begin=tempItemArray[1].split(",")[0];end=tempItemArray[1].split(",")[1]}else{begin=tempItemArray[1]}}state=jazz_validator.length(tempItemArray[1],val,begin,end);if(typeof(regMsg)=="undefined"||$.trim(regMsg)==""){tempMSG=jazz_validator.msg.t+jazz_validator.msg.length+begin+(!!end?("和"+end+"之间"):"")}else{tempMSG=regMsg+""}item="length"}else{if(item.indexOf("idcard")>=0){state=jazz_validator.idcard(val);if(typeof(regMsg)=="undefined"||$.trim(regMsg)==""){tempMSG=jazz_validator.msg.t+jazz_validator.msg.idcard}else{tempMSG=regMsg+""}item="idcard"}}}}}}}}}}if(!state&&tempMSG){msg.push(tempMSG)}stateArray[index]=state});var rs=true;if(type=="and"){rs=this._rAndState(stateArray,type)}else{if(type=="or"){rs=this._rOrState(stateArray,type)}else{rs=state}}if(!!compThis){compThis.options.isverify=rs}return{state:rs,msg:msg.join(";")}}else{if(!!compThis){compThis.options.isverify=true}return{state:true,msg:msg.join()}}},_rAndState:function(stateArray,type){var r=true;$.each(stateArray,function(i,state){if(state==false){r=false}});return r},_rOrState:function(stateArray,type){var r=false;$.each(stateArray,function(i,state){if(state==true){r=true}});return r}}});(function($){$.widget("jazz.icon",$.jazz.panel,{options:{vtype:"icon",scrolltime:500,activeindex:0,iscontroller:true,isshowpaginator:true,theme:0,dataurl:null,dataurlparams:null,paramicons:{width:140,height:145},rows:2,cols:-1,iconrender:null,click:null},_create:function(){this._super();this.innerPanel=$('<div style="width: 100%; height: 100%"></div>').appendTo(this.content);this.paginator=$("<div></div>")},_init:function(){this._super();this.content.css("overflow","hidden");this.paramIconData=[];this.contentWidth=this.content.width();this.contentHeight=this.content.height();this._build(this.innerPanel);this._bindDrag(this.innerPanel);if(this.options.iscontroller&&this.options.isshowpaginator){this._bindPaginator(this.innerPanel)}},_ajax:function(){var params={url:this.options.dataurl,params:this.options.dataurlparams,callback:this._callback};$.DataAdapter.submit(params,this)},_callback:function(data,sourceThis){var jsonData=null;var $this=null;if(data=="1"){jsonData=this.options.data;$this=this}else{jsonData=data;$this=sourceThis}var icondata=jsonData.data;if(jsonData!=null&&icondata){var theme=$this.options.theme;var k=0;if(theme=="2"){var gHeight=0,rows=$this.options.rows;var innerHeight=$this.innerPanel.height();var all=$this.options.paramicons.width*icondata.length;if(all>$this.innerPanel.width()&&innerHeight>190&&rows==1){$this.options.rows=2;rows=2}gHeight=parseInt(innerHeight/parseInt($this.options.rows))-1;var paramicons=$this.options.paramicons;var iconLiObject=paramicons.iconLiObject=[];$.each(icondata,function(i,obj){var li=$('<li class="jazz-iconLi2" index="'+k+'"></li>');li.css({height:gHeight});var imgClass="";if(obj.count=="0"||obj.count==undefined){imgClass="";obj.count=""}else{imgClass="s-icon-img"}li.append('<span id="img_'+obj.id+'" class="'+imgClass+'">'+obj.count+"</span>");li.append('<div><span class="icon2" style="background: url('+obj.imageurl+')"></span><div class="text">'+obj.label+"</div></div>");var c=li.children("div");c.css("top",parseInt((li.height()-100)/2)+5);li.hover(function(){c.children("span").css("background",'url("'+obj.imageurl3+'")');c.children("div").addClass("jazz-icon-text2")},function(){c.children("span").css("background",'url("'+obj.imageurl+'")');c.children("div").removeClass("jazz-icon-text2")});if(i===0){paramicons.height=li.height()}iconLiObject.push(li);$this.paramIconData[i]=obj;k+=1})}else{var gHeight=0,gWidth=0;var rows=$this.options.rows,cols=$this.options.cols;var innerHeight=$this.innerPanel.height();gHeight=parseInt(innerHeight/parseInt(rows))-2;if(cols!=-1){var innerWidth=$this.innerPanel.width();gWidth=parseInt(innerWidth/parseInt(cols))-0}var paramicons=$this.options.paramicons;var iconLiObject=paramicons.iconLiObject=[];$.each(icondata,function(i,obj){var li=$('<li class="jazz-iconLi2" index="'+k+'"></li>');li.css({height:gHeight});if(cols!=-1){li.css({width:gWidth})}var imgClass="";if(obj.count=="0"||obj.count==undefined){imgClass="";obj.count=""}else{imgClass="s-icon-img"}li.append('<span id="img_'+obj.id+'" class="'+imgClass+'">'+obj.count+"</span>");var iconrender=$this.options.iconrender;var flag=true;if($.isFunction(iconrender)){var str=iconrender.call(this,li,obj);li.append(str);flag=false}else{li.append('<div><span class="icon2" style="background: url('+obj.imageurl+')"></span><div class="text">'+obj.label+"</div></div>")}if(flag){var c=li.children("div");c.css("top",parseInt((li.height()-100)/2)+5);li.hover(function(){c.children("span").css("background",'url("'+obj.imageurl3+'")');c.children("div").addClass("jazz-icon-text2")},function(){c.children("span").css("background",'url("'+obj.imageurl+'")');c.children("div").removeClass("jazz-icon-text2")})}if(i===0){paramicons.width=li.width();paramicons.height=li.height()}iconLiObject.push(li);$this.paramIconData[i]=obj;k+=1})}$this.iconallnumber=k;var innerPanel=$this.innerPanel;$this._buildPage(innerPanel,$this.iconallnumber);$this.ul=innerPanel.children("ul");$this._bindIconEvent($this.ul);if($this.options.iscontroller){$this._buildButton(innerPanel,$this.ul.size())}$this._updatePosition(innerPanel)}},_build:function(innerPanel){this.iconallnumber=0;if(this.options.data){this._callback("1")}else{if(this.options.dataurl){this._ajax()}}},_buildPage:function(innerPanel,k){var navBarHeight=0;var gH=this.options.paramicons.height;var gW=this.options.paramicons.width;var rows=Math.floor((this.contentHeight-navBarHeight)/gH);var cols=Math.floor(this.contentWidth/gW);rows=this.options.rows;gH=parseInt(innerPanel.height()/parseInt(rows))-1;var perIconNum=rows*cols;if(perIconNum==0){perIconNum=1}var pageNumber=Math.ceil(k/perIconNum);$.extend(this.options.paramicons,{rows:rows,cols:rows,pageNumber:pageNumber});for(var n=0;n<pageNumber;n++){var ul=$('<ul class="jazz-iconUl currDesktop"></ul>').appendTo(innerPanel);for(var j=n*perIconNum;j<(n+1)*perIconNum;j++){ul.append(this.options.paramicons.iconLiObject[j])}}if(this.options.iscontroller&&this.options.isshowpaginator){this._paginator(k,perIconNum)}},_paginator:function(total,rows){var width=this.contentWidth;var pagenum=Math.ceil(total/rows);var p=$('<div style="height: 20px;"></div>').appendTo(this.paginator);for(var i=0,len=pagenum;i<len;i++){p.append('<span class="jazz-icon-item" index="'+i+'"></span>')}var w=(width-pagenum*20)/2-5;p.css({"padding-left":w});p.outerWidth(width)},_updatePosition:function(innerPanel){var w=this.contentWidth,h=this.content.height(),$this=this,ulNumber=this.ul.size();this.moveWidth=w;innerPanel.css({width:((w)*ulNumber),height:h});innerPanel.children("ul").css({width:w,height:h,"margin-right":0});if(this.options.isshowpaginator){this.paginator.appendTo(this.content).css({position:"absolute",left:"0",bottom:"0",padding:"0"})}this.ul.each(function(){$this._iconsArrange($(this))});$this._panelMove(innerPanel,$this.ul,w,$this.options.activeindex)},_bindDrag:function(innerPanel){var $this=this;var dxStart,dxEnd;innerPanel.draggable({axis:"x",start:function(event,ui){$(this).css("cursor","move");beginTime=new Date().getTime();dxStart=event.pageX},stop:function(event,ui){var $ul=$this.ul;$(this).css("cursor","inherit");dxEnd=event.pageX;var dxCha=dxEnd-dxStart,currDesktop=$(this).find("ul.currDesktop"),deskIndex=$ul.index(currDesktop);var moveWidth=$this.contentWidth;if(dxCha<-150&&deskIndex<($ul.size()-1)){$this._panelMove($(this),$ul,moveWidth,deskIndex+1)}else{if(dxCha>150&&deskIndex>0){$this._panelMove($(this),$ul,moveWidth,deskIndex-1)}else{$(this).animate({left:-(deskIndex)*moveWidth},$this.options.scrolltime)}}}})},_bindIconEvent:function(ul){var $this=this;this.ul.children("li").on("click",function(e,i){$this._trigger("click",e,$this.paramIconData[$(this).attr("index")])})},_bindPaginator:function(innerPanel){var $this=this;$.each($this.paginator.find(".jazz-icon-item"),function(i){$(this).off("click.paicon").on("click.paicon",function(){$this._panelMove(innerPanel,$this.ul,$this.contentWidth,i)})})},_panelMove:function(innerPanel,ul,moveWidth,nextIndex){var $this=this;innerPanel.stop().animate({left:-(nextIndex)*moveWidth},$this.options.scrolltime,function(){ul.removeClass("currDesktop").eq(nextIndex).addClass("currDesktop");if($this.options.isshowpaginator){$.each($this.paginator.find(".jazz-icon-item"),function(i){if(nextIndex==i){$(this).addClass("jazz-icon-item-current")}else{$(this).removeClass("jazz-icon-item-current")}})}if($this.options.iscontroller){if(nextIndex>0){$this.leftButton.addClass("jazz-iconpanel-leftbtn")}else{$this.leftButton.removeClass("jazz-iconpanel-leftbtn")}if(nextIndex<ul.size()-1){$this.rightButton.addClass("jazz-iconpanel-rightbtn")}else{$this.rightButton.removeClass("jazz-iconpanel-rightbtn")}}});this.options.activeindex=nextIndex},_iconsArrange:function(ul){var $ul=ul;var navBarHeight=0,iconNum=$ul.find("li").size();$ul.data("iconNum",iconNum);var gH=this.options.paramicons.height;var gW=this.options.paramicons.width;gH=parseInt(this.innerPanel.height()/parseInt(this.options.rows))-1;var rows=Math.floor((this.contentHeight-navBarHeight)/gH);var cols=Math.floor(this.contentWidth/gW);var curcol=0,currow=0;var mW=0;mH=0;if(this.options.theme===1){mW=30;mH=20}$ul.find("li").css({position:"absolute",margin:0,left:function(index,value){var v=(index-cols*currow)*gW+mW;if((index+1)%cols==0){currow=currow+1}return v},top:function(index,value){var v=curcol*gH+mH;if((index+1)%cols==0){curcol=curcol+1}return v}})},_buildButton:function(innerPanel,number){var $this=this;this.leftButton=$('<a href="javascript:void(0);" target="_self"></a>').appendTo(innerPanel.parent());this.rightButton=$('<a href="javascript:void(0);" target="_self"></a>').appendTo(innerPanel.parent());this.leftButton.on("click.icon",function(){if($this.options.activeindex>0){$this._panelMove(innerPanel,$this.ul,$this.contentWidth,$this.options.activeindex-1)}});this.rightButton.on("click.icon",function(){if($this.options.activeindex<$this.ul.size()-1){$this._panelMove(innerPanel,$this.ul,$this.contentWidth,$this.options.activeindex+1)}else{$this._panelMove(innerPanel,$this.ul,$this.contentWidth,0)}});innerPanel.parent().hover(function(){if($this.options.activeindex>0){$this.leftButton.addClass("jazz-iconpanel-leftbtn")}$this.rightButton.addClass("jazz-iconpanel-rightbtn")},function(){$this.leftButton.removeClass("jazz-iconpanel-leftbtn");$this.rightButton.removeClass("jazz-iconpanel-rightbtn")})},loadData:function(url,params,flag){if(!url){if(this.options.dataurl!=null){if(!!params){this.options.params=params}this.innerPanel.children().remove();if(this.options.isshowpaginator){this.paginator.remove();this.paginator=$("<div></div>")}this._build(this.innerPanel);this._bindDrag(this.innerPanel);if(this.options.isshowpaginator){this._bindPaginator(this.innerPanel)}}}else{this.innerPanel.children().remove();if(this.options.isshowpaginator){this.paginator.remove();this.paginator=$("<div></div>")}if(flag=="static"){this.options.data=url}else{if(!!url){this.options.dataurl=url;this.options.data=null}if(!!params){this.options.params=params}}this._build(this.innerPanel);this._bindDrag(this.innerPanel);if(this.options.isshowpaginator){this._bindPaginator(this.innerPanel)}}},getCount:function(id){var img=$("#img_"+id);img.addClass("s-icon-img");if($.trim(img.html())){return img.html()}else{return 0}},updateCount:function(url,params){var param={url:url,params:params,async:false,callback:this._callbackCount};$.DataAdapter.submit(param,this)},_callbackCount:function(data,sourceThis){var jsonData=data;if(!!jsonData&&!!jsonData.data){for(var i=0;i<jsonData.data.length;i++){var obj=jsonData.data[i];if(obj.count=="0"){$("#img_"+obj.id).hide()}else{$("#img_"+obj.id).show();$("#img_"+obj.id).html(obj.count)}}}},leftside:function(){var innerPanel=this.innerPanel;if(this.options.activeindex>0){this._panelMove(innerPanel,this.ul,this.contentWidth,this.options.activeindex-1)}if(this.options.activeindex==0){return false}else{return true}},rightside:function(){var innerPanel=this.innerPanel,num=this.ul.size();if(this.options.activeindex<this.ul.size()-1){this._panelMove(innerPanel,this.ul,this.contentWidth,this.options.activeindex+1)}if(this.options.activeindex==this.ul.size()-1){return false}else{return true}}})})(jQuery);(function($,factory){if(jazz.config.isUseRequireJS===true){define("jazz.Tree",["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){(function($){var settings={},roots={},caches={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:true,showTitle:true,txtSelectedEnable:false},data:{key:{children:"children",name:"name",title:"",url:"url"},simpleData:{enable:false,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:false,leaf:false}},async:{enable:false,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(setting){var r=data.getRoot(setting);if(!r){r={};data.setRoot(setting,r)}r[setting.data.key.children]=[];r.expandTriggerFlag=false;r.curSelectedList=[];r.noSelection=true;r.createdNodes=[];r.zId=0;r._ver=(new Date()).getTime()},_initCache=function(setting){var c=data.getCache(setting);if(!c){c={};data.setCache(setting,c)}c.nodes=[];c.doms=[]},_bindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.NODECREATED,function(event,treeId,node){tools.apply(setting.callback.onNodeCreated,[event,treeId,node])});o.bind(c.CLICK,function(event,srcEvent,treeId,node,clickFlag){tools.apply(setting.callback.onClick,[srcEvent,treeId,node,clickFlag])});o.bind(c.EXPAND,function(event,treeId,node){tools.apply(setting.callback.onExpand,[event,treeId,node])});o.bind(c.COLLAPSE,function(event,treeId,node){tools.apply(setting.callback.onCollapse,[event,treeId,node])});o.bind(c.ASYNC_SUCCESS,function(event,treeId,node,msg){tools.apply(setting.callback.onAsyncSuccess,[event,treeId,node,msg])});o.bind(c.ASYNC_ERROR,function(event,treeId,node,XMLHttpRequest,textStatus,errorThrown){tools.apply(setting.callback.onAsyncError,[event,treeId,node,XMLHttpRequest,textStatus,errorThrown])})},_unbindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.NODECREATED).unbind(c.CLICK).unbind(c.EXPAND).unbind(c.COLLAPSE).unbind(c.ASYNC_SUCCESS).unbind(c.ASYNC_ERROR)},_eventProxy=function(event){var target=event.target,setting=data.getSetting(event.data.treeId),tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null,tmp=null;if(tools.eqs(event.type,"mousedown")){treeEventType="mousedown"}else{if(tools.eqs(event.type,"mouseup")){treeEventType="mouseup"}else{if(tools.eqs(event.type,"contextmenu")){treeEventType="contextmenu"}else{if(tools.eqs(event.type,"click")){if(tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.SWITCH)!==null){tId=tools.getNodeMainDom(target).id;nodeEventType="switchNode"}else{tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="clickNode"}}}else{if(tools.eqs(event.type,"dblclick")){treeEventType="dblclick";tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="switchNode"}}}}}}if(treeEventType.length>0&&tId.length==0){tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id}}if(tId.length>0){node=data.getNodeCache(setting,tId);switch(nodeEventType){case"switchNode":if(!node.isparent){nodeEventType=""}else{if(tools.eqs(event.type,"click")||(tools.eqs(event.type,"dblclick")&&tools.apply(setting.view.dblClickExpand,[setting.treeId,node],setting.view.dblClickExpand))){nodeEventCallback=handler.onSwitchNode}else{nodeEventType=""}}break;case"clickNode":nodeEventCallback=handler.onClickNode;break}}switch(treeEventType){case"mousedown":treeEventCallback=handler.onZTreeMousedown;break;case"mouseup":treeEventCallback=handler.onZTreeMouseup;break;case"dblclick":treeEventCallback=handler.onZTreeDblclick;break;case"contextmenu":treeEventCallback=handler.onZTreeContextmenu;break}var proxyResult={stop:false,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback};return proxyResult},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(!n){return}var r=data.getRoot(setting),childKey=setting.data.key.children;n.level=level;n.tId=setting.treeId+"_"+(++r.zId);n.parentTId=parentNode?parentNode.tId:null;n.open=(typeof n.open=="string")?tools.eqs(n.open,"true"):!!n.open;if(n[childKey]&&n[childKey].length>0){n.isparent=true;n.zAsync=true}else{n.isparent=(typeof n.isparent=="string")?tools.eqs(n.isparent,"true"):!!n.isparent;n.open=(n.isparent&&!setting.async.enable)?n.open:false;n.zAsync=!n.isparent}n.isFirstNode=isFirstNode;n.isLastNode=isLastNode;n.getParentNode=function(){return data.getNodeCache(setting,n.parentTId)};n.getPreNode=function(){return data.getPreNode(setting,n)};n.getNextNode=function(){return data.getNextNode(setting,n)};n.isAjaxing=false;data.fixPIdKeyValue(setting,n)},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(setting,node){data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=node},getNodeCacheId:function(tId){return tId.substring(tId.lastIndexOf("_")+1)},addAfterA:function(afterA){_init.afterA.push(afterA)},addBeforeA:function(beforeA){_init.beforeA.push(beforeA)},addInnerAfterA:function(innerAfterA){_init.innerAfterA.push(innerAfterA)},addInnerBeforeA:function(innerBeforeA){_init.innerBeforeA.push(innerBeforeA)},addInitBind:function(bindEvent){_init.bind.push(bindEvent)},addInitUnBind:function(unbindEvent){_init.unbind.push(unbindEvent)},addInitCache:function(initCache){_init.caches.push(initCache)},addInitNode:function(initNode){_init.nodes.push(initNode)},addInitProxy:function(initProxy,isFirst){if(!!isFirst){_init.proxys.splice(0,0,initProxy)}else{_init.proxys.push(initProxy)}},addInitRoot:function(initRoot){_init.roots.push(initRoot)},addNodesData:function(setting,parentNode,nodes){var childKey=setting.data.key.children;if(!parentNode[childKey]){parentNode[childKey]=[]}if(parentNode[childKey].length>0){parentNode[childKey][parentNode[childKey].length-1].isLastNode=false;view.setNodeLineIcos(setting,parentNode[childKey][parentNode[childKey].length-1])}parentNode.isparent=true;parentNode[childKey]=parentNode[childKey].concat(nodes)},addSelectedNode:function(setting,node){var root=data.getRoot(setting);if(!data.isSelectedNode(setting,node)){root.curSelectedList.push(node)}},addCreatedNode:function(setting,node){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);root.createdNodes.push(node)}},addZTreeTools:function(zTreeTools){_init.zTreeTools.push(zTreeTools)},exSetting:function(s){$.extend(true,_setting,s)},fixPIdKeyValue:function(setting,node){if(setting.data.simpleData.enable){node[setting.data.simpleData.pIdKey]=node.parentTId?node.getParentNode()[setting.data.simpleData.idKey]:setting.data.simpleData.rootPId}},getAfterA:function(setting,node,array){for(var i=0,j=_init.afterA.length;i<j;i++){_init.afterA[i].apply(this,arguments)}},getBeforeA:function(setting,node,array){for(var i=0,j=_init.beforeA.length;i<j;i++){_init.beforeA[i].apply(this,arguments)}},getInnerAfterA:function(setting,node,array){for(var i=0,j=_init.innerAfterA.length;i<j;i++){_init.innerAfterA[i].apply(this,arguments)}},getInnerBeforeA:function(setting,node,array){for(var i=0,j=_init.innerBeforeA.length;i<j;i++){_init.innerBeforeA[i].apply(this,arguments)}},getCache:function(setting){return caches[setting.treeId]},getNextNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);for(var i=0,l=p[childKey].length-1;i<=l;i++){if(p[childKey][i]===node){return(i==l?null:p[childKey][i+1])}}return null},getNodeByParam:function(setting,nodes,key,value){if(!nodes||!key){return null}var childKey=setting.data.key.children;for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){return nodes[i]}var tmp=data.getNodeByParam(setting,nodes[i][childKey],key,value);if(tmp){return tmp}}return null},getNodeCache:function(setting,tId){if(!tId){return null}var n=caches[setting.treeId].nodes[data.getNodeCacheId(tId)];return n?n:null},getNodeName:function(setting,node){var nameKey=setting.data.key.name;return""+node[nameKey]},getNodeTitle:function(setting,node){var t=setting.data.key.title===""?setting.data.key.name:setting.data.key.title;return""+node[t]},getNodes:function(setting){return data.getRoot(setting)[setting.data.key.children]},getNodesByParam:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){result.push(nodes[i])}result=result.concat(data.getNodesByParam(setting,nodes[i][childKey],key,value))}return result},getNodesByParamFuzzy:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];value=value.toLowerCase();for(var i=0,l=nodes.length;i<l;i++){if(typeof nodes[i][key]=="string"&&nodes[i][key].toLowerCase().indexOf(value)>-1){result.push(nodes[i])}result=result.concat(data.getNodesByParamFuzzy(setting,nodes[i][childKey],key,value))}return result},getNodesByFilter:function(setting,nodes,filter,isSingle,invokeParam){if(!nodes){return(isSingle?null:[])}var childKey=setting.data.key.children,result=isSingle?null:[];for(var i=0,l=nodes.length;i<l;i++){if(tools.apply(filter,[nodes[i],invokeParam],false)){if(isSingle){return nodes[i]}result.push(nodes[i])}var tmpResult=data.getNodesByFilter(setting,nodes[i][childKey],filter,isSingle,invokeParam);if(isSingle&&!!tmpResult){return tmpResult}result=isSingle?tmpResult:result.concat(tmpResult)}return result},getPreNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);for(var i=0,l=p[childKey].length;i<l;i++){if(p[childKey][i]===node){return(i==0?null:p[childKey][i-1])}}return null},getRoot:function(setting){return setting?roots[setting.treeId]:null},getRoots:function(){return roots},getSetting:function(treeId){return settings[treeId]},getSettings:function(){return settings},getZTreeTools:function(treeId){var r=this.getRoot(this.getSetting(treeId));return r?r.treeTools:null},initCache:function(setting){for(var i=0,j=_init.caches.length;i<j;i++){_init.caches[i].apply(this,arguments)}},initNode:function(setting,level,node,parentNode,preNode,nextNode){for(var i=0,j=_init.nodes.length;i<j;i++){_init.nodes[i].apply(this,arguments)}},initRoot:function(setting){for(var i=0,j=_init.roots.length;i<j;i++){_init.roots[i].apply(this,arguments)}},isSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]){return true}}return false},removeNodeCache:function(setting,node){var childKey=setting.data.key.children;if(node[childKey]){for(var i=0,l=node[childKey].length;i<l;i++){arguments.callee(setting,node[childKey][i])}}data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=null},removeSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]||!data.getNodeCache(setting,root.curSelectedList[i].tId)){root.curSelectedList.splice(i,1);i--;j--}}},setCache:function(setting,cache){caches[setting.treeId]=cache},setRoot:function(setting,root){roots[setting.treeId]=root},setZTreeTools:function(setting,zTreeTools){for(var i=0,j=_init.zTreeTools.length;i<j;i++){_init.zTreeTools[i].apply(this,arguments)}},transformToArrayFormat:function(setting,nodes){if(!nodes){return[]}var childKey=setting.data.key.children,r=[];if(tools.isArray(nodes)){for(var i=0,l=nodes.length;i<l;i++){r.push(nodes[i]);if(nodes[i][childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[i][childKey]))}}}else{r.push(nodes);if(nodes[childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[childKey]))}}return r},transformTozTreeFormat:function(setting,sNodes){var i,l,key=setting.data.simpleData.idKey,parentKey=setting.data.simpleData.pIdKey,childKey=setting.data.key.children;if(!key||key==""||!sNodes){return[]}if(tools.isArray(sNodes)){var r=[];var tmpMap=[];for(i=0,l=sNodes.length;i<l;i++){tmpMap[sNodes[i][key]]=sNodes[i]}for(i=0,l=sNodes.length;i<l;i++){if(tmpMap[sNodes[i][parentKey]]&&sNodes[i][key]!=sNodes[i][parentKey]){if(!tmpMap[sNodes[i][parentKey]][childKey]){tmpMap[sNodes[i][parentKey]][childKey]=[]}tmpMap[sNodes[i][parentKey]][childKey].push(sNodes[i])}else{r.push(sNodes[i])}}return r}else{return[sNodes]}}},event={bindEvent:function(setting){for(var i=0,j=_init.bind.length;i<j;i++){_init.bind[i].apply(this,arguments)}},unbindEvent:function(setting){for(var i=0,j=_init.unbind.length;i<j;i++){_init.unbind[i].apply(this,arguments)}},bindTree:function(setting){var eventParam={treeId:setting.treeId},o=setting.treeObj;if(!setting.view.txtSelectedEnable){o.bind("selectstart",function(e){var node;var n=e.originalEvent.srcElement.nodeName.toLowerCase();return(n==="input"||n==="textarea")}).css({"-moz-user-select":"-moz-none"})}o.bind("click",eventParam,event.proxy);o.bind("dblclick",eventParam,event.proxy);o.bind("mouseover",eventParam,event.proxy);o.bind("mouseout",eventParam,event.proxy);o.bind("mousedown",eventParam,event.proxy);o.bind("mouseup",eventParam,event.proxy);o.bind("contextmenu",eventParam,event.proxy)},unbindTree:function(setting){var o=setting.treeObj;o.unbind("click",event.proxy).unbind("dblclick",event.proxy).unbind("mouseover",event.proxy).unbind("mouseout",event.proxy).unbind("mousedown",event.proxy).unbind("mouseup",event.proxy).unbind("contextmenu",event.proxy)},doProxy:function(e){var results=[];for(var i=0,j=_init.proxys.length;i<j;i++){var proxyResult=_init.proxys[i].apply(this,arguments);results.push(proxyResult);if(proxyResult.stop){break}}return results},proxy:function(e){var setting=data.getSetting(e.data.treeId);if(!tools.uCanDo(setting,e)){return true}var results=event.doProxy(e),r=true,x=false;for(var i=0,l=results.length;i<l;i++){var proxyResult=results[i];if(proxyResult.nodeEventCallback){x=true;r=proxyResult.nodeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}if(proxyResult.treeEventCallback){x=true;r=proxyResult.treeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}}return r}},handler={onSwitchNode:function(event,node){var setting=data.getSetting(event.data.treeId);if(node.open){if(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}else{if(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}return true},onClickNode:function(event,node){var setting=data.getSetting(event.data.treeId),clickFlag=((setting.view.autoCancelSelected&&event.ctrlKey)&&data.isSelectedNode(setting,node))?0:(setting.view.autoCancelSelected&&event.ctrlKey&&setting.view.selectedMulti)?2:1;if(tools.apply(setting.callback.beforeClick,[setting.treeId,node,clickFlag],true)==false){return true}if(clickFlag===0){view.cancelPreSelectedNode(setting,node)}else{view.selectNode(setting,node,clickFlag===2)}setting.treeObj.trigger(consts.event.CLICK,[event,setting.treeId,node,clickFlag]);event.stopPropagation();return true},onZTreeMousedown:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseDown,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseDown,[event,setting.treeId,node]);event.stopPropagation()}return true},onZTreeMouseup:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseUp,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseUp,[event,setting.treeId,node])}return true},onZTreeDblclick:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeDblClick,[setting.treeId,node],true)){tools.apply(setting.callback.onDblClick,[event,setting.treeId,node]);event.stopPropagation()}return true},onZTreeContextmenu:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeRightClick,[setting.treeId,node],true)){tools.apply(setting.callback.onRightClick,[event,setting.treeId,node]);event.stopPropagation()}return(typeof setting.callback.onRightClick)!="function"}},tools={apply:function(fun,param,defaultValue){if((typeof fun)=="function"){return fun.apply(zt,param?param:[])}return defaultValue},canAsync:function(setting,node){var childKey=setting.data.key.children;return(setting.async.enable&&node&&node.isparent&&!(node.zAsync||(node[childKey]&&node[childKey].length>0)))},clone:function(obj){if(obj===null){return null}var o=tools.isArray(obj)?[]:{};for(var i in obj){o[i]=(obj[i] instanceof Date)?new Date(obj[i].getTime()):(typeof obj[i]==="object"?arguments.callee(obj[i]):obj[i])}return o},eqs:function(str1,str2){return str1.toLowerCase()===str2.toLowerCase()},isArray:function(arr){return Object.prototype.toString.apply(arr)==="[object Array]"},$:function(node,exp,setting){if(!!exp&&typeof exp!="string"){setting=exp;exp=""}if(typeof node=="string"){return $(node,setting?setting.treeObj.get(0).ownerDocument:null)}else{return $("#"+node.tId+exp,setting?setting.treeObj:null)}},getMDom:function(setting,curDom,targetExpr){if(!curDom){return null}while(curDom&&curDom.id!==setting.treeId){for(var i=0,l=targetExpr.length;curDom.tagName&&i<l;i++){if(tools.eqs(curDom.tagName,targetExpr[i].tagName)&&curDom.getAttribute(targetExpr[i].attrName)!==null){return curDom}}curDom=curDom.parentNode}return null},getNodeMainDom:function(target){return($(target).parent("li").get(0)||$(target).parentsUntil("li").parent().get(0))},isChildOrSelf:function(dom,parentId){return($(dom).closest("#"+parentId).length>0)},uCanDo:function(setting,e){return true}},view={addNodes:function(setting,parentNode,newNodes,isSilent){if(setting.data.keep.leaf&&parentNode&&!parentNode.isparent){return}if(!tools.isArray(newNodes)){newNodes=[newNodes]}if(setting.data.simpleData.enable){newNodes=data.transformTozTreeFormat(setting,newNodes)}if(parentNode){var target_switchObj=$$(parentNode,consts.id.SWITCH,setting),target_icoObj=$$(parentNode,consts.id.ICON,setting),target_ulObj=$$(parentNode,consts.id.UL,setting);if(!parentNode.open){view.replaceSwitchClass(parentNode,target_switchObj,consts.folder.CLOSE);view.replaceIcoClass(parentNode,target_icoObj,consts.folder.CLOSE);parentNode.open=false;target_ulObj.css({display:"none"})}data.addNodesData(setting,parentNode,newNodes);view.createNodes(setting,parentNode.level+1,newNodes,parentNode);if(!isSilent){view.expandCollapseParentNode(setting,parentNode,true)}}else{data.addNodesData(setting,data.getRoot(setting),newNodes);view.createNodes(setting,0,newNodes,null)}},appendNodes:function(setting,level,nodes,parentNode,initFlag,openFlag){if(!nodes){return[]}var html=[],childKey=setting.data.key.children;for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];node.id=$.trim(node.id);if(initFlag){var tmpPNode=(parentNode)?parentNode:data.getRoot(setting),tmpPChild=tmpPNode[childKey],isFirstNode=((tmpPChild.length==nodes.length)&&(i==0)),isLastNode=(i==(nodes.length-1));data.initNode(setting,level,node,parentNode,isFirstNode,isLastNode,openFlag);data.addNodeCache(setting,node)}var childHtml=[];if(node[childKey]&&node[childKey].length>0){childHtml=view.appendNodes(setting,level+1,node[childKey],node,initFlag,openFlag&&node.open)}if(openFlag){view.makeDOMNodeMainBefore(html,setting,node);view.makeDOMNodeLine(html,setting,node);data.getBeforeA(setting,node,html);view.makeDOMNodeNameBefore(html,setting,node);data.getInnerBeforeA(setting,node,html);view.makeDOMNodeIcon(html,setting,node);data.getInnerAfterA(setting,node,html);view.makeDOMNodeNameAfter(html,setting,node);data.getAfterA(setting,node,html);if(node.isparent&&node.open){view.makeUlHtml(setting,node,html,childHtml.join(""))}view.makeDOMNodeMainAfter(html,setting,node);data.addCreatedNode(setting,node)}}return html},appendParentULDom:function(setting,node){var html=[],nObj=$$(node,setting);if(!nObj.get(0)&&!!node.parentTId){view.appendParentULDom(setting,node.getParentNode());nObj=$$(node,setting)}var ulObj=$$(node,consts.id.UL,setting);if(ulObj.get(0)){ulObj.remove()}var childKey=setting.data.key.children,childHtml=view.appendNodes(setting,node.level+1,node[childKey],node,false,true);view.makeUlHtml(setting,node,html,childHtml.join(""));nObj.append(html.join(""))},asyncNode:function(setting,node,isSilent,callback){var i,l;if(node&&!node.isparent){tools.apply(callback);return false}else{if(node&&node.isAjaxing){return false}else{if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==false){tools.apply(callback);return false}}}if(node){node.isAjaxing=true;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"","class":consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={};for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0]}tmpParam[spKey]=node[pKey]}if(tools.isArray(setting.async.otherParam)){for(i=0,l=setting.async.otherParam.length;i<l;i+=2){tmpParam[setting.async.otherParam[i]]=setting.async.otherParam[i+1]}}else{for(var p in setting.async.otherParam){tmpParam[p]=setting.async.otherParam[p]}}var _tmpV=data.getRoot(setting)._ver;var postData=new Object();var dataArray=new Array();var obj=new Object();if(jazz.config.platForm=="sword"){if(!!tmpParam){$.each(tmpParam,function(k,v){var str={name:k,value:v+"",sword:"attr"};dataArray.push(eval(str))});postData.data=dataArray}var treeurl=tools.apply(setting.async.url,[setting.treeId,node],setting.async.url);if(!!treeurl){postData.tid=treeurl}obj.postData=JSON.stringify(postData)}else{if(!!tmpParam){$.each(tmpParam,function(k,v){var str={name:k,data:v+"",vtype:"attr"};dataArray.push(eval(str))});postData.data=dataArray}obj.postData=JSON.stringify(postData)}tmpParam=obj;$.ajax({contentType:setting.async.contentType,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:tmpParam,dataType:setting.async.dataType,success:function(msg){if(msg.data.length>0){msg=msg.data[0].data}if(_tmpV!=data.getRoot(setting)._ver){return}var newNodes=[];try{if(!msg||msg.length==0){newNodes=[]}else{if(typeof msg=="string"){newNodes=eval("("+msg+")")}else{newNodes=msg}}}catch(err){newNodes=msg}if(node){node.isAjaxing=null;node.zAsync=true}view.setNodeLineIcos(setting,node);if(newNodes&&newNodes!==""){newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes);view.addNodes(setting,node,!!newNodes?tools.clone(newNodes):[],!!isSilent)}else{view.addNodes(setting,node,[],!!isSilent)}setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]);tools.apply(callback)},error:function(XMLHttpRequest,textStatus,errorThrown){if(_tmpV!=data.getRoot(setting)._ver){return}if(node){node.isAjaxing=null}view.setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,XMLHttpRequest,textStatus,errorThrown])}});return true},cancelPreSelectedNode:function(setting,node){var list=data.getRoot(setting).curSelectedList;for(var i=0,j=list.length-1;j>=i;j--){if(!node||node===list[j]){$$(list[j],consts.id.A,setting).removeClass(consts.node.CURSELECTED);if(node){data.removeSelectedNode(setting,node);break}}}if(!node){data.getRoot(setting).curSelectedList=[]}},createNodeCallback:function(setting){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);while(root.createdNodes.length>0){var node=root.createdNodes.shift();tools.apply(setting.view.addDiyDom,[setting.treeId,node]);if(!!setting.callback.onNodeCreated){setting.treeObj.trigger(consts.event.NODECREATED,[setting.treeId,node])}}}},createNodes:function(setting,level,nodes,parentNode){if(!nodes||nodes.length==0){return}var root=data.getRoot(setting),childKey=setting.data.key.children,openFlag=!parentNode||parentNode.open||!!$$(parentNode[childKey][0],setting).get(0);root.createdNodes=[];var zTreeHtml=view.appendNodes(setting,level,nodes,parentNode,true,openFlag);if(!parentNode){setting.treeObj.append(zTreeHtml.join(""))}else{var ulObj=$$(parentNode,consts.id.UL,setting);if(ulObj.get(0)){ulObj.append(zTreeHtml.join(""))}}view.createNodeCallback(setting)},destroy:function(setting){if(!setting){return}data.initCache(setting);data.initRoot(setting);event.unbindTree(setting);event.unbindEvent(setting);setting.treeObj.empty()},expandCollapseNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children;if(!node){tools.apply(callback,[]);return}if(root.expandTriggerFlag){var _callback=callback;callback=function(){if(_callback){_callback()}if(node.open){setting.treeObj.trigger(consts.event.EXPAND,[setting.treeId,node])}else{setting.treeObj.trigger(consts.event.COLLAPSE,[setting.treeId,node])}};root.expandTriggerFlag=false}if(!node.open&&node.isparent&&((!$$(node,consts.id.UL,setting).get(0))||(node[childKey]&&node[childKey].length>0&&!$$(node[childKey][0],setting).get(0)))){view.appendParentULDom(setting,node);view.createNodeCallback(setting)}if(node.open==expandFlag){tools.apply(callback,[]);return}var ulObj=$$(node,consts.id.UL,setting),switchObj=$$(node,consts.id.SWITCH,setting),icoObj=$$(node,consts.id.ICON,setting);if(node.isparent){node.open=!node.open;if(node.iconOpen&&node.iconClose){icoObj.attr("style",view.makeNodeIcoStyle(setting,node))}if(node.open){view.replaceSwitchClass(node,switchObj,consts.folder.OPEN);view.replaceIcoClass(node,icoObj,consts.folder.OPEN);if(animateFlag==false||setting.view.expandSpeed==""){ulObj.show();tools.apply(callback,[])}else{if(node[childKey]&&node[childKey].length>0){ulObj.slideDown(setting.view.expandSpeed,callback)}else{ulObj.show();tools.apply(callback,[])}}}else{view.replaceSwitchClass(node,switchObj,consts.folder.CLOSE);view.replaceIcoClass(node,icoObj,consts.folder.CLOSE);if(animateFlag==false||setting.view.expandSpeed==""||!(node[childKey]&&node[childKey].length>0)){ulObj.hide();tools.apply(callback,[])}else{ulObj.slideUp(setting.view.expandSpeed,callback)}}}else{tools.apply(callback,[])}},expandCollapseParentNode:function(setting,node,expandFlag,animateFlag,callback){if(!node){return}if(!node.parentTId){view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback);return}else{view.expandCollapseNode(setting,node,expandFlag,animateFlag)}if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,animateFlag,callback)}},expandCollapseSonNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children,treeNodes=(node)?node[childKey]:root[childKey],selfAnimateSign=(node)?false:animateFlag,expandTriggerFlag=data.getRoot(setting).expandTriggerFlag;data.getRoot(setting).expandTriggerFlag=false;if(treeNodes){for(var i=0,l=treeNodes.length;i<l;i++){if(treeNodes[i]){view.expandCollapseSonNode(setting,treeNodes[i],expandFlag,selfAnimateSign)}}}data.getRoot(setting).expandTriggerFlag=expandTriggerFlag;view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback)},makeDOMNodeIcon:function(html,setting,node){var nameStr=data.getNodeName(setting,node),name=setting.view.nameIsHTML?nameStr:nameStr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");html.push("<span id='",node.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(setting,node),"' style='",view.makeNodeIcoStyle(setting,node),"'></span><span id='",node.tId,consts.id.SPAN,"'>",name,"</span>")},makeDOMNodeLine:function(html,setting,node){html.push("<span id='",node.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(setting,node),"' treeNode",consts.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(html,setting,node){html.push("</li>")},makeDOMNodeMainBefore:function(html,setting,node){html.push("<li id='",node.tId,"' class='",consts.className.LEVEL,node.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(html,setting,node){html.push("</a>")},makeDOMNodeNameBefore:function(html,setting,node){var title=data.getNodeTitle(setting,node),url=view.makeNodeUrl(setting,node),fontcss=view.makeNodeFontCss(setting,node),fontStyle=[];for(var f in fontcss){fontStyle.push(f,":",fontcss[f],";")}html.push("<a id='",node.tId,consts.id.A,"' class='",consts.className.LEVEL,node.level,"' treeNode",consts.id.A,' onclick="',(node.click||""),'" ',((url!=null&&url.length>0)?"href='"+url+"'":"")," target='",view.makeNodeTarget(node),"' style='",fontStyle.join(""),"'");if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&title){html.push("title='",title.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'")}html.push(">")},makeNodeFontCss:function(setting,node){var fontCss=tools.apply(setting.view.fontCss,[setting.treeId,node],setting.view.fontCss);return(fontCss&&((typeof fontCss)!="function"))?fontCss:{}},makeNodeIcoClass:function(setting,node){var icoCss=["ico"];if(!node.isAjaxing){icoCss[0]=(node.iconskin?node.iconskin+"_":"")+icoCss[0];if(node.isparent){icoCss.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{icoCss.push(consts.folder.DOCU)}}return consts.className.BUTTON+" "+icoCss.join("_")},makeNodeIcoStyle:function(setting,node){var icoStyle=[];if(!node.isAjaxing){var icon=(node.isparent&&node.iconOpen&&node.iconClose)?(node.open?node.iconOpen:node.iconClose):node.icon;if(icon){icoStyle.push("background:url(",icon,") 0 0 no-repeat;")}if(setting.view.showIcon==false||!tools.apply(setting.view.showIcon,[setting.treeId,node],true)){icoStyle.push("width:0px;height:0px;")}}return icoStyle.join("")},makeNodeLineClass:function(setting,node){var lineClass=[];if(setting.view.showLine){if(node.level==0&&node.isFirstNode&&node.isLastNode){lineClass.push(consts.line.ROOT)}else{if(node.level==0&&node.isFirstNode){lineClass.push(consts.line.ROOTS)}else{if(node.isLastNode){lineClass.push(consts.line.BOTTOM)}else{lineClass.push(consts.line.CENTER)}}}}else{lineClass.push(consts.line.NOLINE)}if(node.isparent){lineClass.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{lineClass.push(consts.folder.DOCU)}return view.makeNodeLineClassEx(node)+lineClass.join("_")},makeNodeLineClassEx:function(node){return consts.className.BUTTON+" "+consts.className.LEVEL+node.level+" "+consts.className.SWITCH+" "},makeNodeTarget:function(node){return(node.target||"_blank")},makeNodeUrl:function(setting,node){var urlKey=setting.data.key.url;return node[urlKey]?node[urlKey]:null},makeUlHtml:function(setting,node,html,content){html.push("<ul id='",node.tId,consts.id.UL,"' class='",consts.className.LEVEL,node.level," ",view.makeUlLineClass(setting,node),"' style='display:",(node.open?"block":"none"),"'>");html.push(content);html.push("</ul>")},makeUlLineClass:function(setting,node){return((setting.view.showLine&&!node.isLastNode)?consts.line.LINE:"")},removeChildNodes:function(setting,node){if(!node){return}var childKey=setting.data.key.children,nodes=node[childKey];if(!nodes){return}for(var i=0,l=nodes.length;i<l;i++){data.removeNodeCache(setting,nodes[i])}data.removeSelectedNode(setting);delete node[childKey];if(!setting.data.keep.parent){node.isparent=false;node.open=false;var tmp_switchObj=$$(node,consts.id.SWITCH,setting),tmp_icoObj=$$(node,consts.id.ICON,setting);view.replaceSwitchClass(node,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(node,tmp_icoObj,consts.folder.DOCU);$$(node,consts.id.UL,setting).remove()}else{$$(node,consts.id.UL,setting).empty()}},setFirstNode:function(setting,parentNode){var childKey=setting.data.key.children,childLength=parentNode[childKey].length;if(childLength>0){parentNode[childKey][0].isFirstNode=true}},setLastNode:function(setting,parentNode){var childKey=setting.data.key.children,childLength=parentNode[childKey].length;if(childLength>0){parentNode[childKey][childLength-1].isLastNode=true}},removeNode:function(setting,node){var root=data.getRoot(setting),childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():root;node.isFirstNode=false;node.isLastNode=false;node.getPreNode=function(){return null};node.getNextNode=function(){return null};if(!data.getNodeCache(setting,node.tId)){return}$$(node,setting).remove();data.removeNodeCache(setting,node);data.removeSelectedNode(setting,node);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i].tId==node.tId){parentNode[childKey].splice(i,1);break}}view.setFirstNode(setting,parentNode);view.setLastNode(setting,parentNode);var tmp_ulObj,tmp_switchObj,tmp_icoObj,childLength=parentNode[childKey].length;if(!setting.data.keep.parent&&childLength==0){parentNode.isparent=false;parentNode.open=false;tmp_ulObj=$$(parentNode,consts.id.UL,setting);tmp_switchObj=$$(parentNode,consts.id.SWITCH,setting);tmp_icoObj=$$(parentNode,consts.id.ICON,setting);view.replaceSwitchClass(parentNode,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(parentNode,tmp_icoObj,consts.folder.DOCU);tmp_ulObj.css("display","none")}else{if(setting.view.showLine&&childLength>0){var newLast=parentNode[childKey][childLength-1];tmp_ulObj=$$(newLast,consts.id.UL,setting);tmp_switchObj=$$(newLast,consts.id.SWITCH,setting);tmp_icoObj=$$(newLast,consts.id.ICON,setting);if(parentNode==root){if(parentNode[childKey].length==1){view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.ROOT)}else{var tmp_first_switchObj=$$(parentNode[childKey][0],consts.id.SWITCH,setting);view.replaceSwitchClass(parentNode[childKey][0],tmp_first_switchObj,consts.line.ROOTS);view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}}else{view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}tmp_ulObj.removeClass(consts.line.LINE)}}},replaceIcoClass:function(node,obj,newName){if(!obj||node.isAjaxing){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[tmpList.length-1]=newName;break}obj.attr("class",tmpList.join("_"))},replaceSwitchClass:function(node,obj,newName){if(!obj){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:tmpList[0]=view.makeNodeLineClassEx(node)+newName;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[1]=newName;break}obj.attr("class",tmpList.join("_"));if(newName!==consts.folder.DOCU){obj.removeAttr("disabled")}else{obj.attr("disabled","disabled")}},selectNode:function(setting,node,addFlag){if(!addFlag){view.cancelPreSelectedNode(setting)}$$(node,consts.id.A,setting).addClass(consts.node.CURSELECTED);data.addSelectedNode(setting,node)},setNodeFontCss:function(setting,treeNode){var aObj=$$(treeNode,consts.id.A,setting),fontCss=view.makeNodeFontCss(setting,treeNode);if(fontCss){aObj.css(fontCss)}},setNodeLineIcos:function(setting,node){if(!node){return}var switchObj=$$(node,consts.id.SWITCH,setting),ulObj=$$(node,consts.id.UL,setting),icoObj=$$(node,consts.id.ICON,setting),ulLine=view.makeUlLineClass(setting,node);if(ulLine.length==0){ulObj.removeClass(consts.line.LINE)}else{ulObj.addClass(ulLine)}switchObj.attr("class",view.makeNodeLineClass(setting,node));if(node.isparent){switchObj.removeAttr("disabled")}else{switchObj.attr("disabled","disabled")}icoObj.removeAttr("style");icoObj.attr("style",view.makeNodeIcoStyle(setting,node));icoObj.attr("class",view.makeNodeIcoClass(setting,node))},setNodeName:function(setting,node){var title=data.getNodeTitle(setting,node),nObj=$$(node,consts.id.SPAN,setting);nObj.empty();if(setting.view.nameIsHTML){nObj.html(data.getNodeName(setting,node))}else{nObj.text(data.getNodeName(setting,node))}if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)){var aObj=$$(node,consts.id.A,setting);aObj.attr("title",!title?"":title)}},setNodeTarget:function(setting,node){var aObj=$$(node,consts.id.A,setting);aObj.attr("target",view.makeNodeTarget(node))},setNodeUrl:function(setting,node){var aObj=$$(node,consts.id.A,setting),url=view.makeNodeUrl(setting,node);if(url==null||url.length==0){aObj.removeAttr("href")}else{aObj.attr("href",url)}},switchNode:function(setting,node){if(node.open||!tools.canAsync(setting,node)){view.expandCollapseNode(setting,node,!node.open)}else{if(setting.async.enable){if(!view.asyncNode(setting,node)){view.expandCollapseNode(setting,node,!node.open);return}}else{if(node){view.expandCollapseNode(setting,node,!node.open)}}}}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(treeId){var o=data.getZTreeTools(treeId);return o?o:null},destroy:function(treeId){if(!!treeId&&treeId.length>0){view.destroy(data.getSetting(treeId))}else{for(var s in settings){view.destroy(settings[s])}}},init:function(obj,zSetting,zNodes){var setting=tools.clone(_setting);$.extend(true,setting,zSetting);setting.treeId=obj.attr("id");setting.treeObj=obj;setting.treeObj.empty();settings[setting.treeId]=setting;if(typeof document.body.style.maxHeight==="undefined"){setting.view.expandSpeed=""}data.initRoot(setting);var root=data.getRoot(setting),childKey=setting.data.key.children;zNodes=zNodes?tools.clone(tools.isArray(zNodes)?zNodes:[zNodes]):[];if(setting.data.simpleData.enable){root[childKey]=data.transformTozTreeFormat(setting,zNodes)}else{root[childKey]=zNodes}data.initCache(setting);event.unbindTree(setting);event.bindTree(setting);event.unbindEvent(setting);event.bindEvent(setting);var zTreeTools={setting:setting,addNodes:function(parentNode,newNodes,isSilent){if(!newNodes){return null}if(!parentNode){parentNode=null}if(parentNode&&!parentNode.isparent&&setting.data.keep.leaf){return null}var xNewNodes=tools.clone(tools.isArray(newNodes)?newNodes:[newNodes]);function addCallback(){view.addNodes(setting,parentNode,xNewNodes,(isSilent==true))}if(tools.canAsync(setting,parentNode)){view.asyncNode(setting,parentNode,isSilent,addCallback)}else{addCallback()}return xNewNodes},cancelSelectedNode:function(node){view.cancelPreSelectedNode(setting,node)},destroy:function(){view.destroy(setting)},expandAll:function(expandFlag){expandFlag=!!expandFlag;view.expandCollapseSonNode(setting,null,expandFlag,true);return expandFlag},expandNode:function(node,expandFlag,sonSign,focus,callbackFlag){if(!node||!node.isparent){return null}if(expandFlag!==true&&expandFlag!==false){expandFlag=!node.open}callbackFlag=!!callbackFlag;if(callbackFlag&&expandFlag&&(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false)){return null}else{if(callbackFlag&&!expandFlag&&(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false)){return null}}if(expandFlag&&node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,false)}if(expandFlag===node.open&&!sonSign){return null}data.getRoot(setting).expandTriggerFlag=callbackFlag;if(!tools.canAsync(setting,node)&&sonSign){view.expandCollapseSonNode(setting,node,expandFlag,true,function(){if(focus!==false){try{$$(node,setting).focus().blur()}catch(e){}}})}else{node.open=!expandFlag;view.switchNode(this.setting,node);if(focus!==false){try{$$(node,setting).focus().blur()}catch(e){}}}return expandFlag},getNodes:function(){return data.getNodes(setting)},getNodeByParam:function(key,value,parentNode){if(!key){return null}return data.getNodeByParam(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value)},getNodeByTId:function(tId){return data.getNodeCache(setting,tId)},getNodesByParam:function(key,value,parentNode){if(!key){return null}return data.getNodesByParam(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value)},getNodesByParamFuzzy:function(key,value,parentNode){if(!key){return null}return data.getNodesByParamFuzzy(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value)},getNodesByFilter:function(filter,isSingle,parentNode,invokeParam){isSingle=!!isSingle;if(!filter||(typeof filter!="function")){return(isSingle?null:[])}return data.getNodesByFilter(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),filter,isSingle,invokeParam)},getNodeIndex:function(node){if(!node){return null}var childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():data.getRoot(setting);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i]==node){return i}}return -1},getSelectedNodes:function(){var r=[],list=data.getRoot(setting).curSelectedList;for(var i=0,l=list.length;i<l;i++){r.push(list[i])}return r},isSelectedNode:function(node){return data.isSelectedNode(setting,node)},reAsyncChildNodes:function(parentNode,reloadType,isSilent){if(!this.setting.async.enable){return}var isRoot=!parentNode;if(isRoot){parentNode=data.getRoot(setting)}if(reloadType=="refresh"){var childKey=this.setting.data.key.children;for(var i=0,l=parentNode[childKey]?parentNode[childKey].length:0;i<l;i++){data.removeNodeCache(setting,parentNode[childKey][i])}data.removeSelectedNode(setting);parentNode[childKey]=[];if(isRoot){this.setting.treeObj.empty()}else{var ulObj=$$(parentNode,consts.id.UL,setting);ulObj.empty()}}view.asyncNode(this.setting,isRoot?null:parentNode,!!isSilent)},refresh:function(){this.setting.treeObj.empty();var root=data.getRoot(setting),nodes=root[setting.data.key.children];data.initRoot(setting);root[setting.data.key.children]=nodes;data.initCache(setting);view.createNodes(setting,0,root[setting.data.key.children])},removeChildNodes:function(node){if(!node){return null}var childKey=setting.data.key.children,nodes=node[childKey];view.removeChildNodes(setting,node);return nodes?nodes:null},removeNode:function(node,callbackFlag){if(!node){return}callbackFlag=!!callbackFlag;if(callbackFlag&&tools.apply(setting.callback.beforeRemove,[setting.treeId,node],true)==false){return}view.removeNode(setting,node);if(callbackFlag){this.setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node])}},selectNode:function(node,addFlag){if(!node){return}if(tools.uCanDo(setting)){addFlag=setting.view.selectedMulti&&addFlag;if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),true,false,function(){try{$$(node,setting).focus().blur()}catch(e){}})}else{try{$$(node,setting).focus().blur()}catch(e){}}view.selectNode(setting,node,addFlag)}},transformTozTreeNodes:function(simpleNodes){return data.transformTozTreeFormat(setting,simpleNodes)},transformToArray:function(nodes){return data.transformToArrayFormat(setting,nodes)},updateNode:function(node,checkTypeFlag){if(!node){return}var nObj=$$(node,setting);if(nObj.get(0)&&tools.uCanDo(setting)){view.setNodeName(setting,node);view.setNodeTarget(setting,node);view.setNodeUrl(setting,node);view.setNodeLineIcos(setting,node);view.setNodeFontCss(setting,node)}}};root.treeTools=zTreeTools;data.setZTreeTools(setting,zTreeTools);if(root[childKey]&&root[childKey].length>0){view.createNodes(setting,0,root[childKey])}else{if(setting.async.enable&&setting.async.url&&setting.async.url!==""){view.asyncNode(setting)}}return zTreeTools}};var zt=$.fn.zTree,$$=tools.$,consts=zt.consts})(jQuery);(function($){var _consts={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},_setting={check:{enable:false,autoCheckTrigger:false,chkStyle:_consts.checkbox.STYLE,nocheckInherit:false,chkDisabledInherit:false,radioType:_consts.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},_initRoot=function(setting){var r=data.getRoot(setting);r.radioCheckedList=[]},_initCache=function(treeId){},_bindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.CHECK,function(event,srcEvent,treeId,node){tools.apply(setting.callback.onCheck,[!!srcEvent?srcEvent:event,treeId,node])})},_unbindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.CHECK)},_eventProxy=function(e){var target=e.target,setting=data.getSetting(e.data.treeId),tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null;if(tools.eqs(e.type,"mouseover")){if(setting.check.enable&&tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.CHECK)!==null){tId=tools.getNodeMainDom(target).id;nodeEventType="mouseoverCheck"}}else{if(tools.eqs(e.type,"mouseout")){if(setting.check.enable&&tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.CHECK)!==null){tId=tools.getNodeMainDom(target).id;nodeEventType="mouseoutCheck"}}else{if(tools.eqs(e.type,"click")){if(setting.check.enable&&tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.CHECK)!==null){tId=tools.getNodeMainDom(target).id;nodeEventType="checkNode"}}}}if(tId.length>0){node=data.getNodeCache(setting,tId);switch(nodeEventType){case"checkNode":nodeEventCallback=_handler.onCheckNode;break;case"mouseoverCheck":nodeEventCallback=_handler.onMouseoverCheck;break;case"mouseoutCheck":nodeEventCallback=_handler.onMouseoutCheck;break}}var proxyResult={stop:nodeEventType==="checkNode",node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback};return proxyResult},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(!n){return}var checkedKey=setting.data.key.checked;if(typeof n[checkedKey]=="string"){n[checkedKey]=tools.eqs(n[checkedKey],"true")}n[checkedKey]=!!n[checkedKey];n.checkedOld=n[checkedKey];if(typeof n.nocheck=="string"){n.nocheck=tools.eqs(n.nocheck,"true")}n.nocheck=!!n.nocheck||(setting.check.nocheckInherit&&parentNode&&!!parentNode.nocheck);if(typeof n.chkDisabled=="string"){n.chkDisabled=tools.eqs(n.chkDisabled,"true")}n.chkDisabled=!!n.chkDisabled||(setting.check.chkDisabledInherit&&parentNode&&!!parentNode.chkDisabled);if(typeof n.halfCheck=="string"){n.halfCheck=tools.eqs(n.halfCheck,"true")}n.halfCheck=!!n.halfCheck;n.check_Child_State=-1;n.check_Focus=false;n.getCheckStatus=function(){return data.getCheckStatus(setting,n)};if(setting.check.chkStyle==consts.radio.STYLE&&setting.check.radioType==consts.radio.TYPE_ALL&&n[checkedKey]){var r=data.getRoot(setting);r.radioCheckedList.push(n)}},_beforeA=function(setting,node,html){var checkedKey=setting.data.key.checked;if(setting.check.enable){data.makeChkFlag(setting,node);html.push("<span ID='",node.tId,consts.id.CHECK,"' class='",view.makeChkClass(setting,node),"' treeNode",consts.id.CHECK,(node.nocheck===true?" style='display:none;'":""),"></span>")}},_zTreeTools=function(setting,zTreeTools){zTreeTools.checkNode=function(node,checked,checkTypeFlag,callbackFlag){var checkedKey=setting.data.key.checked;if(!node){return}if(node.chkDisabled===true){return}if(checked!==true&&checked!==false){checked=!node[checkedKey]}callbackFlag=!!callbackFlag;if(node[checkedKey]===checked&&!checkTypeFlag){return}else{if(callbackFlag&&tools.apply(this.setting.callback.beforeCheck,[setting.treeId,node],true)==false){return}}if(tools.uCanDo(this.setting)&&setting.check.enable&&node.nocheck!==true){node[checkedKey]=checked;var checkObj=$$(node,consts.id.CHECK,setting);if(checkTypeFlag||setting.check.chkStyle===consts.radio.STYLE){view.checkNodeRelation(setting,node)}view.setChkClass(setting,checkObj,node);view.repairParentChkClassWithSelf(setting,node);if(callbackFlag){setting.treeObj.trigger(consts.event.CHECK,[null,setting.treeId,node])}}};zTreeTools.checkAllNodes=function(checked){view.repairAllChk(setting,!!checked)};zTreeTools.getCheckedNodes=function(checked){var childKey=setting.data.key.children;checked=(checked!==false);return data.getTreeCheckedNodes(setting,data.getRoot(setting)[childKey],checked)};zTreeTools.getChangeCheckedNodes=function(){var childKey=setting.data.key.children;return data.getTreeChangeCheckedNodes(setting,data.getRoot(setting)[childKey])};zTreeTools.setChkDisabled=function(node,disabled,inheritParent,inheritChildren){disabled=!!disabled;inheritParent=!!inheritParent;inheritChildren=!!inheritChildren;view.repairSonChkDisabled(setting,node,disabled,inheritChildren);view.repairParentChkDisabled(setting,node.getParentNode(),disabled,inheritParent)};var _updateNode=zTreeTools.updateNode;zTreeTools.updateNode=function(node,checkTypeFlag){if(_updateNode){_updateNode.apply(zTreeTools,arguments)}if(!node||!setting.check.enable){return}var nObj=$$(node,setting);if(nObj.get(0)&&tools.uCanDo(setting)){var checkObj=$$(node,consts.id.CHECK,setting);if(checkTypeFlag==true||setting.check.chkStyle===consts.radio.STYLE){view.checkNodeRelation(setting,node)}view.setChkClass(setting,checkObj,node);view.repairParentChkClassWithSelf(setting,node)}}},_data={getRadioCheckedList:function(setting){var checkedList=data.getRoot(setting).radioCheckedList;for(var i=0,j=checkedList.length;i<j;i++){if(!data.getNodeCache(setting,checkedList[i].tId)){checkedList.splice(i,1);i--;j--}}return checkedList},getCheckStatus:function(setting,node){if(!setting.check.enable||node.nocheck||node.chkDisabled){return null}var checkedKey=setting.data.key.checked,r={checked:node[checkedKey],half:node.halfCheck?node.halfCheck:(setting.check.chkStyle==consts.radio.STYLE?(node.check_Child_State===2):(node[checkedKey]?(node.check_Child_State>-1&&node.check_Child_State<2):(node.check_Child_State>0)))};return r},getTreeCheckedNodes:function(setting,nodes,checked,results){if(!nodes){return[]}var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,onlyOne=(checked&&setting.check.chkStyle==consts.radio.STYLE&&setting.check.radioType==consts.radio.TYPE_ALL);results=!results?[]:results;for(var i=0,l=nodes.length;i<l;i++){if(nodes[i].nocheck!==true&&nodes[i].chkDisabled!==true&&nodes[i][checkedKey]==checked){results.push(nodes[i]);if(onlyOne){break}}data.getTreeCheckedNodes(setting,nodes[i][childKey],checked,results);if(onlyOne&&results.length>0){break}}return results},getTreeChangeCheckedNodes:function(setting,nodes,results){if(!nodes){return[]}var childKey=setting.data.key.children,checkedKey=setting.data.key.checked;results=!results?[]:results;for(var i=0,l=nodes.length;i<l;i++){if(nodes[i].nocheck!==true&&nodes[i].chkDisabled!==true&&nodes[i][checkedKey]!=nodes[i].checkedOld){results.push(nodes[i])}data.getTreeChangeCheckedNodes(setting,nodes[i][childKey],results)}return results},makeChkFlag:function(setting,node){if(!node){return}var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,chkFlag=-1;if(node[childKey]){for(var i=0,l=node[childKey].length;i<l;i++){var cNode=node[childKey][i];var tmp=-1;if(setting.check.chkStyle==consts.radio.STYLE){if(cNode.nocheck===true||cNode.chkDisabled===true){tmp=cNode.check_Child_State}else{if(cNode.halfCheck===true){tmp=2}else{if(cNode[checkedKey]){tmp=2}else{tmp=cNode.check_Child_State>0?2:0}}}if(tmp==2){chkFlag=2;break}else{if(tmp==0){chkFlag=0}}}else{if(setting.check.chkStyle==consts.checkbox.STYLE){if(cNode.nocheck===true||cNode.chkDisabled===true){tmp=cNode.check_Child_State}else{if(cNode.halfCheck===true){tmp=1}else{if(cNode[checkedKey]){tmp=(cNode.check_Child_State===-1||cNode.check_Child_State===2)?2:1}else{tmp=(cNode.check_Child_State>0)?1:0}}}if(tmp===1){chkFlag=1;break}else{if(tmp===2&&chkFlag>-1&&i>0&&tmp!==chkFlag){chkFlag=1;break}else{if(chkFlag===2&&tmp>-1&&tmp<2){chkFlag=1;break}else{if(tmp>-1){chkFlag=tmp}}}}}}}}node.check_Child_State=chkFlag}},_event={},_handler={onCheckNode:function(event,node){if(node.chkDisabled===true){return false}var setting=data.getSetting(event.data.treeId),checkedKey=setting.data.key.checked;if(tools.apply(setting.callback.beforeCheck,[setting.treeId,node],true)==false){return true}node[checkedKey]=!node[checkedKey];view.checkNodeRelation(setting,node);var checkObj=$$(node,consts.id.CHECK,setting);view.setChkClass(setting,checkObj,node);view.repairParentChkClassWithSelf(setting,node);setting.treeObj.trigger(consts.event.CHECK,[event,setting.treeId,node]);return true},onMouseoverCheck:function(event,node){if(node.chkDisabled===true){return false}var setting=data.getSetting(event.data.treeId),checkObj=$$(node,consts.id.CHECK,setting);node.check_Focus=true;view.setChkClass(setting,checkObj,node);return true},onMouseoutCheck:function(event,node){if(node.chkDisabled===true){return false}var setting=data.getSetting(event.data.treeId),checkObj=$$(node,consts.id.CHECK,setting);node.check_Focus=false;view.setChkClass(setting,checkObj,node);return true}},_tools={},_view={checkNodeRelation:function(setting,node){var pNode,i,l,childKey=setting.data.key.children,checkedKey=setting.data.key.checked,r=consts.radio;if(setting.check.chkStyle==r.STYLE){var checkedList=data.getRadioCheckedList(setting);if(node[checkedKey]){if(setting.check.radioType==r.TYPE_ALL){for(i=checkedList.length-1;i>=0;i--){pNode=checkedList[i];pNode[checkedKey]=false;checkedList.splice(i,1);view.setChkClass(setting,$$(pNode,consts.id.CHECK,setting),pNode);if(pNode.parentTId!=node.parentTId){view.repairParentChkClassWithSelf(setting,pNode)}}checkedList.push(node)}else{var parentNode=(node.parentTId)?node.getParentNode():data.getRoot(setting);for(i=0,l=parentNode[childKey].length;i<l;i++){pNode=parentNode[childKey][i];if(pNode[checkedKey]&&pNode!=node){pNode[checkedKey]=false;view.setChkClass(setting,$$(pNode,consts.id.CHECK,setting),pNode)}}}}else{if(setting.check.radioType==r.TYPE_ALL){for(i=0,l=checkedList.length;i<l;i++){if(node==checkedList[i]){checkedList.splice(i,1);break}}}}}else{if(node[checkedKey]&&(!node[childKey]||node[childKey].length==0||setting.check.chkboxType.Y.indexOf("s")>-1)){view.setSonNodeCheckBox(setting,node,true)}if(!node[checkedKey]&&(!node[childKey]||node[childKey].length==0||setting.check.chkboxType.N.indexOf("s")>-1)){view.setSonNodeCheckBox(setting,node,false)}if(node[checkedKey]&&setting.check.chkboxType.Y.indexOf("p")>-1){view.setParentNodeCheckBox(setting,node,true)}if(!node[checkedKey]&&setting.check.chkboxType.N.indexOf("p")>-1){view.setParentNodeCheckBox(setting,node,false)}}},makeChkClass:function(setting,node){var checkedKey=setting.data.key.checked,c=consts.checkbox,r=consts.radio,fullStyle="";if(node.chkDisabled===true){fullStyle=c.DISABLED}else{if(node.halfCheck){fullStyle=c.PART}else{if(setting.check.chkStyle==r.STYLE){fullStyle=(node.check_Child_State<1)?c.FULL:c.PART}else{fullStyle=node[checkedKey]?((node.check_Child_State===2||node.check_Child_State===-1)?c.FULL:c.PART):((node.check_Child_State<1)?c.FULL:c.PART)}}}var chkName=setting.check.chkStyle+"_"+(node[checkedKey]?c.TRUE:c.FALSE)+"_"+fullStyle;chkName=(node.check_Focus&&node.chkDisabled!==true)?chkName+"_"+c.FOCUS:chkName;return consts.className.BUTTON+" "+c.DEFAULT+" "+chkName},repairAllChk:function(setting,checked){if(setting.check.enable&&setting.check.chkStyle===consts.checkbox.STYLE){var checkedKey=setting.data.key.checked,childKey=setting.data.key.children,root=data.getRoot(setting);for(var i=0,l=root[childKey].length;i<l;i++){var node=root[childKey][i];if(node.nocheck!==true&&node.chkDisabled!==true){node[checkedKey]=checked}view.setSonNodeCheckBox(setting,node,checked)}}},repairChkClass:function(setting,node){if(!node){return}data.makeChkFlag(setting,node);if(node.nocheck!==true){var checkObj=$$(node,consts.id.CHECK,setting);view.setChkClass(setting,checkObj,node)}},repairParentChkClass:function(setting,node){if(!node||!node.parentTId){return}var pNode=node.getParentNode();view.repairChkClass(setting,pNode);view.repairParentChkClass(setting,pNode)},repairParentChkClassWithSelf:function(setting,node){if(!node){return}var childKey=setting.data.key.children;if(node[childKey]&&node[childKey].length>0){view.repairParentChkClass(setting,node[childKey][0])}else{view.repairParentChkClass(setting,node)}},repairSonChkDisabled:function(setting,node,chkDisabled,inherit){if(!node){return}var childKey=setting.data.key.children;if(node.chkDisabled!=chkDisabled){node.chkDisabled=chkDisabled}view.repairChkClass(setting,node);if(node[childKey]&&inherit){for(var i=0,l=node[childKey].length;i<l;i++){var sNode=node[childKey][i];view.repairSonChkDisabled(setting,sNode,chkDisabled,inherit)}}},repairParentChkDisabled:function(setting,node,chkDisabled,inherit){if(!node){return}if(node.chkDisabled!=chkDisabled&&inherit){node.chkDisabled=chkDisabled}view.repairChkClass(setting,node);view.repairParentChkDisabled(setting,node.getParentNode(),chkDisabled,inherit)},setChkClass:function(setting,obj,node){if(!obj){return}if(node.nocheck===true){obj.hide()}else{obj.show()}obj.removeClass();obj.addClass(view.makeChkClass(setting,node))},setParentNodeCheckBox:function(setting,node,value,srcNode){var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,checkObj=$$(node,consts.id.CHECK,setting);if(!srcNode){srcNode=node}data.makeChkFlag(setting,node);if(node.nocheck!==true&&node.chkDisabled!==true){node[checkedKey]=value;view.setChkClass(setting,checkObj,node);if(setting.check.autoCheckTrigger&&node!=srcNode){setting.treeObj.trigger(consts.event.CHECK,[null,setting.treeId,node])}}if(node.parentTId){var pSign=true;if(!value){var pNodes=node.getParentNode()[childKey];for(var i=0,l=pNodes.length;i<l;i++){if((pNodes[i].nocheck!==true&&pNodes[i].chkDisabled!==true&&pNodes[i][checkedKey])||((pNodes[i].nocheck===true||pNodes[i].chkDisabled===true)&&pNodes[i].check_Child_State>0)){pSign=false;break}}}if(pSign){view.setParentNodeCheckBox(setting,node.getParentNode(),value,srcNode)}}},setSonNodeCheckBox:function(setting,node,value,srcNode){if(!node){return}var childKey=setting.data.key.children,checkedKey=setting.data.key.checked,checkObj=$$(node,consts.id.CHECK,setting);if(!srcNode){srcNode=node}var hasDisable=false;if(node[childKey]){for(var i=0,l=node[childKey].length;i<l&&node.chkDisabled!==true;i++){var sNode=node[childKey][i];view.setSonNodeCheckBox(setting,sNode,value,srcNode);if(sNode.chkDisabled===true){hasDisable=true}}}if(node!=data.getRoot(setting)&&node.chkDisabled!==true){if(hasDisable&&node.nocheck!==true){data.makeChkFlag(setting,node)}if(node.nocheck!==true&&node.chkDisabled!==true){node[checkedKey]=value;if(!hasDisable){node.check_Child_State=(node[childKey]&&node[childKey].length>0)?(value?2:0):-1}}else{node.check_Child_State=-1}view.setChkClass(setting,checkObj,node);if(setting.check.autoCheckTrigger&&node!=srcNode&&node.nocheck!==true&&node.chkDisabled!==true){setting.treeObj.trigger(consts.event.CHECK,[null,setting.treeId,node])}}}},_z={tools:_tools,view:_view,event:_event,data:_data};$.extend(true,$.fn.zTree.consts,_consts);$.extend(true,$.fn.zTree._z,_z);var zt=$.fn.zTree,tools=zt._z.tools,consts=zt.consts,view=zt._z.view,data=zt._z.data,event=zt._z.event,$$=tools.$;data.exSetting(_setting);data.addInitBind(_bindEvent);data.addInitUnBind(_unbindEvent);data.addInitCache(_initCache);data.addInitNode(_initNode);data.addInitProxy(_eventProxy,true);data.addInitRoot(_initRoot);data.addBeforeA(_beforeA);data.addZTreeTools(_zTreeTools);var _createNodes=view.createNodes;view.createNodes=function(setting,level,nodes,parentNode){if(_createNodes){_createNodes.apply(view,arguments)}if(!nodes){return}view.repairParentChkClassWithSelf(setting,parentNode)};var _removeNode=view.removeNode;view.removeNode=function(setting,node){var parentNode=node.getParentNode();if(_removeNode){_removeNode.apply(view,arguments)}if(!node||!parentNode){return}view.repairChkClass(setting,parentNode);view.repairParentChkClass(setting,parentNode)};var _appendNodes=view.appendNodes;view.appendNodes=function(setting,level,nodes,parentNode,initFlag,openFlag){var html="";if(_appendNodes){html=_appendNodes.apply(view,arguments)}if(parentNode){data.makeChkFlag(setting,parentNode)}return html}})(jQuery);(function($){var _consts={event:{DRAG:"ztree_drag",DROP:"ztree_drop",REMOVE:"ztree_remove",RENAME:"ztree_rename"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},_setting={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDrop:null,onRename:null}},_initRoot=function(setting){var r=data.getRoot(setting),rs=data.getRoots();r.curEditNode=null;r.curEditInput=null;r.curHoverNode=null;r.dragFlag=0;r.dragNodeShowBefore=[];r.dragMaskList=new Array();rs.showHoverDom=true},_initCache=function(treeId){},_bindEvent=function(setting){var o=setting.treeObj;var c=consts.event;o.bind(c.RENAME,function(event,treeId,treeNode,isCancel){tools.apply(setting.callback.onRename,[event,treeId,treeNode,isCancel])});o.bind(c.REMOVE,function(event,treeId,treeNode){tools.apply(setting.callback.onRemove,[event,treeId,treeNode])});o.bind(c.DRAG,function(event,srcEvent,treeId,treeNodes){tools.apply(setting.callback.onDrag,[srcEvent,treeId,treeNodes])});o.bind(c.DROP,function(event,srcEvent,treeId,treeNodes,targetNode,moveType,isCopy){tools.apply(setting.callback.onDrop,[srcEvent,treeId,treeNodes,targetNode,moveType,isCopy])})},_unbindEvent=function(setting){var o=setting.treeObj;var c=consts.event;o.unbind(c.RENAME);o.unbind(c.REMOVE);o.unbind(c.DRAG);o.unbind(c.DROP)},_eventProxy=function(e){var target=e.target,setting=data.getSetting(e.data.treeId),relatedTarget=e.relatedTarget,tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null,tmp=null;if(tools.eqs(e.type,"mouseover")){tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="hoverOverNode"}}else{if(tools.eqs(e.type,"mouseout")){tmp=tools.getMDom(setting,relatedTarget,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(!tmp){tId="remove";nodeEventType="hoverOutNode"}}else{if(tools.eqs(e.type,"mousedown")){tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="mousedownNode"}}}}if(tId.length>0){node=data.getNodeCache(setting,tId);switch(nodeEventType){case"mousedownNode":nodeEventCallback=_handler.onMousedownNode;break;case"hoverOverNode":nodeEventCallback=_handler.onHoverOverNode;break;case"hoverOutNode":nodeEventCallback=_handler.onHoverOutNode;break}}var proxyResult={stop:false,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback};return proxyResult},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(!n){return}n.isHover=false;n.editNameFlag=false},_zTreeTools=function(setting,zTreeTools){zTreeTools.cancelEditName=function(newName){var root=data.getRoot(setting);if(!root.curEditNode){return}view.cancelCurEditNode(setting,newName?newName:null,true)};zTreeTools.copyNode=function(targetNode,node,moveType,isSilent){if(!node){return null}if(targetNode&&!targetNode.isparent&&setting.data.keep.leaf&&moveType===consts.move.TYPE_INNER){return null}var newNode=tools.clone(node);if(!targetNode){targetNode=null;moveType=consts.move.TYPE_INNER}if(moveType==consts.move.TYPE_INNER){function copyCallback(){view.addNodes(setting,targetNode,[newNode],isSilent)}if(tools.canAsync(setting,targetNode)){view.asyncNode(setting,targetNode,isSilent,copyCallback)}else{copyCallback()}}else{view.addNodes(setting,targetNode.parentNode,[newNode],isSilent);view.moveNode(setting,targetNode,newNode,moveType,false,isSilent)}return newNode};zTreeTools.editName=function(node){if(!node||!node.tId||node!==data.getNodeCache(setting,node.tId)){return}if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),true)}view.editNode(setting,node)};zTreeTools.moveNode=function(targetNode,node,moveType,isSilent){if(!node){return node}if(targetNode&&!targetNode.isparent&&setting.data.keep.leaf&&moveType===consts.move.TYPE_INNER){return null}else{if(targetNode&&((node.parentTId==targetNode.tId&&moveType==consts.move.TYPE_INNER)||$$(node,setting).find("#"+targetNode.tId).length>0)){return null}else{if(!targetNode){targetNode=null}}}function moveCallback(){view.moveNode(setting,targetNode,node,moveType,false,isSilent)}if(tools.canAsync(setting,targetNode)&&moveType===consts.move.TYPE_INNER){view.asyncNode(setting,targetNode,isSilent,moveCallback)}else{moveCallback()}return node};zTreeTools.setEditable=function(editable){setting.edit.enable=editable;return this.refresh()}},_data={setSonNodeLevel:function(setting,parentNode,node){if(!node){return}var childKey=setting.data.key.children;node.level=(parentNode)?parentNode.level+1:0;if(!node[childKey]){return}for(var i=0,l=node[childKey].length;i<l;i++){if(node[childKey][i]){data.setSonNodeLevel(setting,node,node[childKey][i])}}}},_event={},_handler={onHoverOverNode:function(event,node){var setting=data.getSetting(event.data.treeId),root=data.getRoot(setting);if(root.curHoverNode!=node){_handler.onHoverOutNode(event)}root.curHoverNode=node;view.addHoverDom(setting,node)},onHoverOutNode:function(event,node){var setting=data.getSetting(event.data.treeId),root=data.getRoot(setting);if(root.curHoverNode&&!data.isSelectedNode(setting,root.curHoverNode)){view.removeTreeDom(setting,root.curHoverNode);root.curHoverNode=null}},onMousedownNode:function(eventMouseDown,_node){var i,l,setting=data.getSetting(eventMouseDown.data.treeId),root=data.getRoot(setting),roots=data.getRoots();if(eventMouseDown.button==2||!setting.edit.enable||(!setting.edit.drag.isCopy&&!setting.edit.drag.isMove)){return true}var target=eventMouseDown.target,_nodes=data.getRoot(setting).curSelectedList,nodes=[];if(!data.isSelectedNode(setting,_node)){nodes=[_node]}else{for(i=0,l=_nodes.length;i<l;i++){if(_nodes[i].editNameFlag&&tools.eqs(target.tagName,"input")&&target.getAttribute("treeNode"+consts.id.INPUT)!==null){return true}nodes.push(_nodes[i]);if(nodes[0].parentTId!==_nodes[i].parentTId){nodes=[_node];break}}}view.editNodeBlur=true;view.cancelCurEditNode(setting);var doc=$(setting.treeObj.get(0).ownerDocument),body=$(setting.treeObj.get(0).ownerDocument.body),curNode,tmpArrow,tmpTarget,isOtherTree=false,targetSetting=setting,sourceSetting=setting,preNode,nextNode,preTmpTargetNodeId=null,preTmpMoveType=null,tmpTargetNodeId=null,moveType=consts.move.TYPE_INNER,mouseDownX=eventMouseDown.clientX,mouseDownY=eventMouseDown.clientY,startTime=(new Date()).getTime();if(tools.uCanDo(setting)){doc.bind("mousemove",_docMouseMove)}function _docMouseMove(event){if(root.dragFlag==0&&Math.abs(mouseDownX-event.clientX)<setting.edit.drag.minMoveSize&&Math.abs(mouseDownY-event.clientY)<setting.edit.drag.minMoveSize){return true}var i,l,tmpNode,tmpDom,tmpNodes,childKey=setting.data.key.children;body.css("cursor","pointer");if(root.dragFlag==0){if(tools.apply(setting.callback.beforeDrag,[setting.treeId,nodes],true)==false){_docMouseUp(event);return true}for(i=0,l=nodes.length;i<l;i++){if(i==0){root.dragNodeShowBefore=[]}tmpNode=nodes[i];if(tmpNode.isparent&&tmpNode.open){view.expandCollapseNode(setting,tmpNode,!tmpNode.open);root.dragNodeShowBefore[tmpNode.tId]=true}else{root.dragNodeShowBefore[tmpNode.tId]=false}}root.dragFlag=1;roots.showHoverDom=false;tools.showIfameMask(setting,true);var isOrder=true,lastIndex=-1;if(nodes.length>1){var pNodes=nodes[0].parentTId?nodes[0].getParentNode()[childKey]:data.getNodes(setting);tmpNodes=[];for(i=0,l=pNodes.length;i<l;i++){if(root.dragNodeShowBefore[pNodes[i].tId]!==undefined){if(isOrder&&lastIndex>-1&&(lastIndex+1)!==i){isOrder=false}tmpNodes.push(pNodes[i]);lastIndex=i}if(nodes.length===tmpNodes.length){nodes=tmpNodes;break}}}if(isOrder){preNode=nodes[0].getPreNode();nextNode=nodes[nodes.length-1].getNextNode()}curNode=$$("<ul class='zTreeDragUL'></ul>",setting);for(i=0,l=nodes.length;i<l;i++){tmpNode=nodes[i];tmpNode.editNameFlag=false;view.selectNode(setting,tmpNode,i>0);view.removeTreeDom(setting,tmpNode);tmpDom=$$("<li id='"+tmpNode.tId+"_tmp'></li>",setting);tmpDom.append($$(tmpNode,consts.id.A,setting).clone());tmpDom.css("padding","0");tmpDom.children("#"+tmpNode.tId+consts.id.A).removeClass(consts.node.CURSELECTED);curNode.append(tmpDom);if(i==setting.edit.drag.maxShowNodeNum-1){tmpDom=$$("<li id='"+tmpNode.tId+"_moretmp'><a>  ...  </a></li>",setting);curNode.append(tmpDom);break}}curNode.attr("id",nodes[0].tId+consts.id.UL+"_tmp");curNode.addClass(setting.treeObj.attr("class"));curNode.appendTo(body);tmpArrow=$$("<span class='tmpzTreeMove_arrow'></span>",setting);tmpArrow.attr("id","zTreeMove_arrow_tmp");tmpArrow.appendTo(body);setting.treeObj.trigger(consts.event.DRAG,[event,setting.treeId,nodes])}if(root.dragFlag==1){if(tmpTarget&&tmpArrow.attr("id")==event.target.id&&tmpTargetNodeId&&(event.clientX+doc.scrollLeft()+2)>($("#"+tmpTargetNodeId+consts.id.A,tmpTarget).offset().left)){var xT=$("#"+tmpTargetNodeId+consts.id.A,tmpTarget);event.target=(xT.length>0)?xT.get(0):event.target}else{if(tmpTarget){tmpTarget.removeClass(consts.node.TMPTARGET_TREE);if(tmpTargetNodeId){$("#"+tmpTargetNodeId+consts.id.A,tmpTarget).removeClass(consts.node.TMPTARGET_NODE+"_"+consts.move.TYPE_PREV).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_INNER)}}}tmpTarget=null;tmpTargetNodeId=null;isOtherTree=false;targetSetting=setting;var settings=data.getSettings();for(var s in settings){if(settings[s].treeId&&settings[s].edit.enable&&settings[s].treeId!=setting.treeId&&(event.target.id==settings[s].treeId||$(event.target).parents("#"+settings[s].treeId).length>0)){isOtherTree=true;targetSetting=settings[s]}}var docScrollTop=doc.scrollTop(),docScrollLeft=doc.scrollLeft(),treeOffset=targetSetting.treeObj.offset(),scrollHeight=targetSetting.treeObj.get(0).scrollHeight,scrollWidth=targetSetting.treeObj.get(0).scrollWidth,dTop=(event.clientY+docScrollTop-treeOffset.top),dBottom=(targetSetting.treeObj.height()+treeOffset.top-event.clientY-docScrollTop),dLeft=(event.clientX+docScrollLeft-treeOffset.left),dRight=(targetSetting.treeObj.width()+treeOffset.left-event.clientX-docScrollLeft),isTop=(dTop<setting.edit.drag.borderMax&&dTop>setting.edit.drag.borderMin),isBottom=(dBottom<setting.edit.drag.borderMax&&dBottom>setting.edit.drag.borderMin),isLeft=(dLeft<setting.edit.drag.borderMax&&dLeft>setting.edit.drag.borderMin),isRight=(dRight<setting.edit.drag.borderMax&&dRight>setting.edit.drag.borderMin),isTreeInner=dTop>setting.edit.drag.borderMin&&dBottom>setting.edit.drag.borderMin&&dLeft>setting.edit.drag.borderMin&&dRight>setting.edit.drag.borderMin,isTreeTop=(isTop&&targetSetting.treeObj.scrollTop()<=0),isTreeBottom=(isBottom&&(targetSetting.treeObj.scrollTop()+targetSetting.treeObj.height()+10)>=scrollHeight),isTreeLeft=(isLeft&&targetSetting.treeObj.scrollLeft()<=0),isTreeRight=(isRight&&(targetSetting.treeObj.scrollLeft()+targetSetting.treeObj.width()+10)>=scrollWidth);if(event.target&&tools.isChildOrSelf(event.target,targetSetting.treeId)){var targetObj=event.target;while(targetObj&&targetObj.tagName&&!tools.eqs(targetObj.tagName,"li")&&targetObj.id!=targetSetting.treeId){targetObj=targetObj.parentNode}var canMove=true;for(i=0,l=nodes.length;i<l;i++){tmpNode=nodes[i];if(targetObj.id===tmpNode.tId){canMove=false;break}else{if($$(tmpNode,setting).find("#"+targetObj.id).length>0){canMove=false;break}}}if(canMove&&event.target&&tools.isChildOrSelf(event.target,targetObj.id+consts.id.A)){tmpTarget=$(targetObj);tmpTargetNodeId=targetObj.id}}tmpNode=nodes[0];if(isTreeInner&&tools.isChildOrSelf(event.target,targetSetting.treeId)){if(!tmpTarget&&(event.target.id==targetSetting.treeId||isTreeTop||isTreeBottom||isTreeLeft||isTreeRight)&&(isOtherTree||(!isOtherTree&&tmpNode.parentTId))){tmpTarget=targetSetting.treeObj}if(isTop){targetSetting.treeObj.scrollTop(targetSetting.treeObj.scrollTop()-10)}else{if(isBottom){targetSetting.treeObj.scrollTop(targetSetting.treeObj.scrollTop()+10)}}if(isLeft){targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()-10)}else{if(isRight){targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()+10)}}if(tmpTarget&&tmpTarget!=targetSetting.treeObj&&tmpTarget.offset().left<targetSetting.treeObj.offset().left){targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()+tmpTarget.offset().left-targetSetting.treeObj.offset().left)}}curNode.css({top:(event.clientY+docScrollTop+3)+"px",left:(event.clientX+docScrollLeft+3)+"px"});var dX=0;var dY=0;if(tmpTarget&&tmpTarget.attr("id")!=targetSetting.treeId){var tmpTargetNode=tmpTargetNodeId==null?null:data.getNodeCache(targetSetting,tmpTargetNodeId),isCopy=(event.ctrlKey&&setting.edit.drag.isMove&&setting.edit.drag.isCopy)||(!setting.edit.drag.isMove&&setting.edit.drag.isCopy),isPrev=!!(preNode&&tmpTargetNodeId===preNode.tId),isNext=!!(nextNode&&tmpTargetNodeId===nextNode.tId),isInner=(tmpNode.parentTId&&tmpNode.parentTId==tmpTargetNodeId),canPrev=(isCopy||!isNext)&&tools.apply(targetSetting.edit.drag.prev,[targetSetting.treeId,nodes,tmpTargetNode],!!targetSetting.edit.drag.prev),canNext=(isCopy||!isPrev)&&tools.apply(targetSetting.edit.drag.next,[targetSetting.treeId,nodes,tmpTargetNode],!!targetSetting.edit.drag.next),canInner=(isCopy||!isInner)&&!(targetSetting.data.keep.leaf&&!tmpTargetNode.isparent)&&tools.apply(targetSetting.edit.drag.inner,[targetSetting.treeId,nodes,tmpTargetNode],!!targetSetting.edit.drag.inner);if(!canPrev&&!canNext&&!canInner){tmpTarget=null;tmpTargetNodeId="";moveType=consts.move.TYPE_INNER;tmpArrow.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}else{var tmpTargetA=$("#"+tmpTargetNodeId+consts.id.A,tmpTarget),tmpNextA=tmpTargetNode.isLastNode?null:$("#"+tmpTargetNode.getNextNode().tId+consts.id.A,tmpTarget.next()),tmpTop=tmpTargetA.offset().top,tmpLeft=tmpTargetA.offset().left,prevPercent=canPrev?(canInner?0.25:(canNext?0.5:1)):-1,nextPercent=canNext?(canInner?0.75:(canPrev?0.5:0)):-1,dY_percent=(event.clientY+docScrollTop-tmpTop)/tmpTargetA.height();if((prevPercent==1||dY_percent<=prevPercent&&dY_percent>=-0.2)&&canPrev){dX=1-tmpArrow.width();dY=tmpTop-tmpArrow.height()/2;moveType=consts.move.TYPE_PREV}else{if((nextPercent==0||dY_percent>=nextPercent&&dY_percent<=1.2)&&canNext){dX=1-tmpArrow.width();dY=(tmpNextA==null||(tmpTargetNode.isparent&&tmpTargetNode.open))?(tmpTop+tmpTargetA.height()-tmpArrow.height()/2):(tmpNextA.offset().top-tmpArrow.height()/2);moveType=consts.move.TYPE_NEXT}else{dX=5-tmpArrow.width();dY=tmpTop;moveType=consts.move.TYPE_INNER}}tmpArrow.css({display:"block",top:dY+"px",left:(tmpLeft+dX)+"px"});tmpTargetA.addClass(consts.node.TMPTARGET_NODE+"_"+moveType);if(preTmpTargetNodeId!=tmpTargetNodeId||preTmpMoveType!=moveType){startTime=(new Date()).getTime()}if(tmpTargetNode&&tmpTargetNode.isparent&&moveType==consts.move.TYPE_INNER){var startTimer=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==tmpTargetNode.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else{if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===tmpTargetNode.tId){startTimer=false}}if(startTimer){window.zTreeMoveTimer=setTimeout(function(){if(moveType!=consts.move.TYPE_INNER){return}if(tmpTargetNode&&tmpTargetNode.isparent&&!tmpTargetNode.open&&(new Date()).getTime()-startTime>targetSetting.edit.drag.autoOpenTime&&tools.apply(targetSetting.callback.beforeDragOpen,[targetSetting.treeId,tmpTargetNode],true)){view.switchNode(targetSetting,tmpTargetNode);if(targetSetting.edit.drag.autoExpandTrigger){targetSetting.treeObj.trigger(consts.event.EXPAND,[targetSetting.treeId,tmpTargetNode])}}},targetSetting.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=tmpTargetNode.tId}}}}else{moveType=consts.move.TYPE_INNER;if(tmpTarget&&tools.apply(targetSetting.edit.drag.inner,[targetSetting.treeId,nodes,null],!!targetSetting.edit.drag.inner)){tmpTarget.addClass(consts.node.TMPTARGET_TREE)}else{tmpTarget=null}tmpArrow.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}preTmpTargetNodeId=tmpTargetNodeId;preTmpMoveType=moveType}return false}doc.bind("mouseup",_docMouseUp);function _docMouseUp(event){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}preTmpTargetNodeId=null;preTmpMoveType=null;doc.unbind("mousemove",_docMouseMove);doc.unbind("mouseup",_docMouseUp);doc.unbind("selectstart",_docSelect);body.css("cursor","auto");if(tmpTarget){tmpTarget.removeClass(consts.node.TMPTARGET_TREE);if(tmpTargetNodeId){$("#"+tmpTargetNodeId+consts.id.A,tmpTarget).removeClass(consts.node.TMPTARGET_NODE+"_"+consts.move.TYPE_PREV).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE+"_"+_consts.move.TYPE_INNER)}}tools.showIfameMask(setting,false);roots.showHoverDom=true;if(root.dragFlag==0){return}root.dragFlag=0;var i,l,tmpNode;for(i=0,l=nodes.length;i<l;i++){tmpNode=nodes[i];if(tmpNode.isparent&&root.dragNodeShowBefore[tmpNode.tId]&&!tmpNode.open){view.expandCollapseNode(setting,tmpNode,!tmpNode.open);delete root.dragNodeShowBefore[tmpNode.tId]}}if(curNode){curNode.remove()}if(tmpArrow){tmpArrow.remove()}var isCopy=(event.ctrlKey&&setting.edit.drag.isMove&&setting.edit.drag.isCopy)||(!setting.edit.drag.isMove&&setting.edit.drag.isCopy);if(!isCopy&&tmpTarget&&tmpTargetNodeId&&nodes[0].parentTId&&tmpTargetNodeId==nodes[0].parentTId&&moveType==consts.move.TYPE_INNER){tmpTarget=null}if(tmpTarget){var dragTargetNode=tmpTargetNodeId==null?null:data.getNodeCache(targetSetting,tmpTargetNodeId);if(tools.apply(setting.callback.beforeDrop,[targetSetting.treeId,nodes,dragTargetNode,moveType,isCopy],true)==false){view.selectNodes(sourceSetting,nodes);return}var newNodes=isCopy?tools.clone(nodes):nodes;function dropCallback(){if(isOtherTree){if(!isCopy){for(var i=0,l=nodes.length;i<l;i++){view.removeNode(setting,nodes[i])}}if(moveType==consts.move.TYPE_INNER){view.addNodes(targetSetting,dragTargetNode,newNodes)}else{view.addNodes(targetSetting,dragTargetNode.getParentNode(),newNodes);if(moveType==consts.move.TYPE_PREV){for(i=0,l=newNodes.length;i<l;i++){view.moveNode(targetSetting,dragTargetNode,newNodes[i],moveType,false)}}else{for(i=-1,l=newNodes.length-1;i<l;l--){view.moveNode(targetSetting,dragTargetNode,newNodes[l],moveType,false)}}}}else{if(isCopy&&moveType==consts.move.TYPE_INNER){view.addNodes(targetSetting,dragTargetNode,newNodes)}else{if(isCopy){view.addNodes(targetSetting,dragTargetNode.getParentNode(),newNodes)}if(moveType!=consts.move.TYPE_NEXT){for(i=0,l=newNodes.length;i<l;i++){view.moveNode(targetSetting,dragTargetNode,newNodes[i],moveType,false)}}else{for(i=-1,l=newNodes.length-1;i<l;l--){view.moveNode(targetSetting,dragTargetNode,newNodes[l],moveType,false)}}}}view.selectNodes(targetSetting,newNodes);$$(newNodes[0],setting).focus().blur();setting.treeObj.trigger(consts.event.DROP,[event,targetSetting.treeId,newNodes,dragTargetNode,moveType,isCopy])}if(moveType==consts.move.TYPE_INNER&&tools.canAsync(targetSetting,dragTargetNode)){view.asyncNode(targetSetting,dragTargetNode,false,dropCallback)}else{dropCallback()}}else{view.selectNodes(sourceSetting,nodes);setting.treeObj.trigger(consts.event.DROP,[event,setting.treeId,nodes,null,null,null])}}doc.bind("selectstart",_docSelect);function _docSelect(){return false}if(eventMouseDown.preventDefault){eventMouseDown.preventDefault()}return true}},_tools={getAbs:function(obj){var oRect=obj.getBoundingClientRect(),scrollTop=document.body.scrollTop+document.documentElement.scrollTop,scrollLeft=document.body.scrollLeft+document.documentElement.scrollLeft;return[oRect.left+scrollLeft,oRect.top+scrollTop]},inputFocus:function(inputObj){if(inputObj.get(0)){inputObj.focus();tools.setCursorPosition(inputObj.get(0),inputObj.val().length)}},inputSelect:function(inputObj){if(inputObj.get(0)){inputObj.focus();inputObj.select()}},setCursorPosition:function(obj,pos){if(obj.setSelectionRange){obj.focus();obj.setSelectionRange(pos,pos)}else{if(obj.createTextRange){var range=obj.createTextRange();range.collapse(true);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}}},showIfameMask:function(setting,showSign){var root=data.getRoot(setting);while(root.dragMaskList.length>0){root.dragMaskList[0].remove();root.dragMaskList.shift()}if(showSign){var iframeList=$$("iframe",setting);for(var i=0,l=iframeList.length;i<l;i++){var obj=iframeList.get(i),r=tools.getAbs(obj),dragMask=$$("<div id='zTreeMask_"+i+"' class='zTreeMask' style='top:"+r[1]+"px; left:"+r[0]+"px; width:"+obj.offsetWidth+"px; height:"+obj.offsetHeight+"px;'></div>",setting);dragMask.appendTo($$("body",setting));root.dragMaskList.push(dragMask)}}}},_view={addEditBtn:function(setting,node){if(node.editNameFlag||$$(node,consts.id.EDIT,setting).length>0){return}if(!tools.apply(setting.edit.showRenameBtn,[setting.treeId,node],setting.edit.showRenameBtn)){return}var aObj=$$(node,consts.id.A,setting),editStr="<span class='"+consts.className.BUTTON+" edit' id='"+node.tId+consts.id.EDIT+"' title='"+tools.apply(setting.edit.renameTitle,[setting.treeId,node],setting.edit.renameTitle)+"' treeNode"+consts.id.EDIT+" style='display:none;'></span>";aObj.append(editStr);$$(node,consts.id.EDIT,setting).bind("click",function(){if(!tools.uCanDo(setting)||tools.apply(setting.callback.beforeEditName,[setting.treeId,node],true)==false){return false}view.editNode(setting,node);return false}).show()},addRemoveBtn:function(setting,node){if(node.editNameFlag||$$(node,consts.id.REMOVE,setting).length>0){return}if(!tools.apply(setting.edit.showRemoveBtn,[setting.treeId,node],setting.edit.showRemoveBtn)){return}var aObj=$$(node,consts.id.A,setting),removeStr="<span class='"+consts.className.BUTTON+" remove' id='"+node.tId+consts.id.REMOVE+"' title='"+tools.apply(setting.edit.removeTitle,[setting.treeId,node],setting.edit.removeTitle)+"' treeNode"+consts.id.REMOVE+" style='display:none;'></span>";aObj.append(removeStr);$$(node,consts.id.REMOVE,setting).bind("click",function(){if(!tools.uCanDo(setting)||tools.apply(setting.callback.beforeRemove,[setting.treeId,node],true)==false){return false}view.removeNode(setting,node);setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node]);return false}).bind("mousedown",function(eventMouseDown){return true}).show()},addHoverDom:function(setting,node){if(data.getRoots().showHoverDom){node.isHover=true;if(setting.edit.enable){view.addEditBtn(setting,node);view.addRemoveBtn(setting,node)}tools.apply(setting.view.addHoverDom,[setting.treeId,node])}},cancelCurEditNode:function(setting,forceName,isCancel){var root=data.getRoot(setting),nameKey=setting.data.key.name,node=root.curEditNode;if(node){var inputObj=root.curEditInput,newName=forceName?forceName:(isCancel?node[nameKey]:inputObj.val());if(tools.apply(setting.callback.beforeRename,[setting.treeId,node,newName,isCancel],true)===false){return false}else{node[nameKey]=newName;setting.treeObj.trigger(consts.event.RENAME,[setting.treeId,node,isCancel])}var aObj=$$(node,consts.id.A,setting);aObj.removeClass(consts.node.CURSELECTED_EDIT);inputObj.unbind();view.setNodeName(setting,node);node.editNameFlag=false;root.curEditNode=null;root.curEditInput=null;view.selectNode(setting,node,false)}root.noSelection=true;return true},editNode:function(setting,node){var root=data.getRoot(setting);view.editNodeBlur=false;if(data.isSelectedNode(setting,node)&&root.curEditNode==node&&node.editNameFlag){setTimeout(function(){tools.inputFocus(root.curEditInput)},0);return}var nameKey=setting.data.key.name;node.editNameFlag=true;view.removeTreeDom(setting,node);view.cancelCurEditNode(setting);view.selectNode(setting,node,false);$$(node,consts.id.SPAN,setting).html("<input type=text class='rename' id='"+node.tId+consts.id.INPUT+"' treeNode"+consts.id.INPUT+" >");var inputObj=$$(node,consts.id.INPUT,setting);inputObj.attr("value",node[nameKey]);if(setting.edit.editNameSelectAll){tools.inputSelect(inputObj)}else{tools.inputFocus(inputObj)}inputObj.bind("blur",function(event){if(!view.editNodeBlur){view.cancelCurEditNode(setting)}}).bind("keydown",function(event){if(event.keyCode=="13"){view.editNodeBlur=true;view.cancelCurEditNode(setting)}else{if(event.keyCode=="27"){view.cancelCurEditNode(setting,null,true)}}}).bind("click",function(event){return false}).bind("dblclick",function(event){return false});$$(node,consts.id.A,setting).addClass(consts.node.CURSELECTED_EDIT);root.curEditInput=inputObj;root.noSelection=false;root.curEditNode=node},moveNode:function(setting,targetNode,node,moveType,animateFlag,isSilent){var root=data.getRoot(setting),childKey=setting.data.key.children;if(targetNode==node){return}if(setting.data.keep.leaf&&targetNode&&!targetNode.isparent&&moveType==consts.move.TYPE_INNER){return}var oldParentNode=(node.parentTId?node.getParentNode():root),targetNodeIsRoot=(targetNode===null||targetNode==root);if(targetNodeIsRoot&&targetNode===null){targetNode=root}if(targetNodeIsRoot){moveType=consts.move.TYPE_INNER}var targetParentNode=(targetNode.parentTId?targetNode.getParentNode():root);if(moveType!=consts.move.TYPE_PREV&&moveType!=consts.move.TYPE_NEXT){moveType=consts.move.TYPE_INNER}if(moveType==consts.move.TYPE_INNER){if(targetNodeIsRoot){node.parentTId=null}else{if(!targetNode.isparent){targetNode.isparent=true;targetNode.open=!!targetNode.open;view.setNodeLineIcos(setting,targetNode)}node.parentTId=targetNode.tId}}var targetObj,target_ulObj;if(targetNodeIsRoot){targetObj=setting.treeObj;target_ulObj=targetObj}else{if(!isSilent&&moveType==consts.move.TYPE_INNER){view.expandCollapseNode(setting,targetNode,true,false)}else{if(!isSilent){view.expandCollapseNode(setting,targetNode.getParentNode(),true,false)}}targetObj=$$(targetNode,setting);target_ulObj=$$(targetNode,consts.id.UL,setting);if(!!targetObj.get(0)&&!target_ulObj.get(0)){var ulstr=[];view.makeUlHtml(setting,targetNode,ulstr,"");targetObj.append(ulstr.join(""))}target_ulObj=$$(targetNode,consts.id.UL,setting)}var nodeDom=$$(node,setting);if(!nodeDom.get(0)){nodeDom=view.appendNodes(setting,node.level,[node],null,false,true).join("")}else{if(!targetObj.get(0)){nodeDom.remove()}}if(target_ulObj.get(0)&&moveType==consts.move.TYPE_INNER){target_ulObj.append(nodeDom)}else{if(targetObj.get(0)&&moveType==consts.move.TYPE_PREV){targetObj.before(nodeDom)}else{if(targetObj.get(0)&&moveType==consts.move.TYPE_NEXT){targetObj.after(nodeDom)}}}var i,l,tmpSrcIndex=-1,tmpTargetIndex=0,oldNeighbor=null,newNeighbor=null,oldLevel=node.level;if(node.isFirstNode){tmpSrcIndex=0;if(oldParentNode[childKey].length>1){oldNeighbor=oldParentNode[childKey][1];oldNeighbor.isFirstNode=true}}else{if(node.isLastNode){tmpSrcIndex=oldParentNode[childKey].length-1;oldNeighbor=oldParentNode[childKey][tmpSrcIndex-1];oldNeighbor.isLastNode=true}else{for(i=0,l=oldParentNode[childKey].length;i<l;i++){if(oldParentNode[childKey][i].tId==node.tId){tmpSrcIndex=i;break}}}}if(tmpSrcIndex>=0){oldParentNode[childKey].splice(tmpSrcIndex,1)}if(moveType!=consts.move.TYPE_INNER){for(i=0,l=targetParentNode[childKey].length;i<l;i++){if(targetParentNode[childKey][i].tId==targetNode.tId){tmpTargetIndex=i}}}if(moveType==consts.move.TYPE_INNER){if(!targetNode[childKey]){targetNode[childKey]=new Array()}if(targetNode[childKey].length>0){newNeighbor=targetNode[childKey][targetNode[childKey].length-1];newNeighbor.isLastNode=false}targetNode[childKey].splice(targetNode[childKey].length,0,node);node.isLastNode=true;node.isFirstNode=(targetNode[childKey].length==1)}else{if(targetNode.isFirstNode&&moveType==consts.move.TYPE_PREV){targetParentNode[childKey].splice(tmpTargetIndex,0,node);newNeighbor=targetNode;newNeighbor.isFirstNode=false;node.parentTId=targetNode.parentTId;node.isFirstNode=true;node.isLastNode=false}else{if(targetNode.isLastNode&&moveType==consts.move.TYPE_NEXT){targetParentNode[childKey].splice(tmpTargetIndex+1,0,node);newNeighbor=targetNode;newNeighbor.isLastNode=false;node.parentTId=targetNode.parentTId;node.isFirstNode=false;node.isLastNode=true}else{if(moveType==consts.move.TYPE_PREV){targetParentNode[childKey].splice(tmpTargetIndex,0,node)}else{targetParentNode[childKey].splice(tmpTargetIndex+1,0,node)}node.parentTId=targetNode.parentTId;node.isFirstNode=false;node.isLastNode=false}}}data.fixPIdKeyValue(setting,node);data.setSonNodeLevel(setting,node.getParentNode(),node);view.setNodeLineIcos(setting,node);view.repairNodeLevelClass(setting,node,oldLevel);if(!setting.data.keep.parent&&oldParentNode[childKey].length<1){oldParentNode.isparent=false;oldParentNode.open=false;var tmp_ulObj=$$(oldParentNode,consts.id.UL,setting),tmp_switchObj=$$(oldParentNode,consts.id.SWITCH,setting),tmp_icoObj=$$(oldParentNode,consts.id.ICON,setting);view.replaceSwitchClass(oldParentNode,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(oldParentNode,tmp_icoObj,consts.folder.DOCU);tmp_ulObj.css("display","none")}else{if(oldNeighbor){view.setNodeLineIcos(setting,oldNeighbor)}}if(newNeighbor){view.setNodeLineIcos(setting,newNeighbor)}if(!!setting.check&&setting.check.enable&&view.repairChkClass){view.repairChkClass(setting,oldParentNode);view.repairParentChkClassWithSelf(setting,oldParentNode);if(oldParentNode!=node.parent){view.repairParentChkClassWithSelf(setting,node)}}if(!isSilent){view.expandCollapseParentNode(setting,node.getParentNode(),true,animateFlag)}},removeEditBtn:function(setting,node){$$(node,consts.id.EDIT,setting).unbind().remove()},removeRemoveBtn:function(setting,node){$$(node,consts.id.REMOVE,setting).unbind().remove()},removeTreeDom:function(setting,node){node.isHover=false;view.removeEditBtn(setting,node);view.removeRemoveBtn(setting,node);tools.apply(setting.view.removeHoverDom,[setting.treeId,node])},repairNodeLevelClass:function(setting,node,oldLevel){if(oldLevel===node.level){return}var liObj=$$(node,setting),aObj=$$(node,consts.id.A,setting),ulObj=$$(node,consts.id.UL,setting),oldClass=consts.className.LEVEL+oldLevel,newClass=consts.className.LEVEL+node.level;liObj.removeClass(oldClass);liObj.addClass(newClass);aObj.removeClass(oldClass);aObj.addClass(newClass);ulObj.removeClass(oldClass);ulObj.addClass(newClass)},selectNodes:function(setting,nodes){for(var i=0,l=nodes.length;i<l;i++){view.selectNode(setting,nodes[i],i>0)}}},_z={tools:_tools,view:_view,event:_event,data:_data};$.extend(true,$.fn.zTree.consts,_consts);$.extend(true,$.fn.zTree._z,_z);var zt=$.fn.zTree,tools=zt._z.tools,consts=zt.consts,view=zt._z.view,data=zt._z.data,event=zt._z.event,$$=tools.$;data.exSetting(_setting);data.addInitBind(_bindEvent);data.addInitUnBind(_unbindEvent);data.addInitCache(_initCache);data.addInitNode(_initNode);data.addInitProxy(_eventProxy);data.addInitRoot(_initRoot);data.addZTreeTools(_zTreeTools);var _cancelPreSelectedNode=view.cancelPreSelectedNode;view.cancelPreSelectedNode=function(setting,node){var list=data.getRoot(setting).curSelectedList;for(var i=0,j=list.length;i<j;i++){if(!node||node===list[i]){view.removeTreeDom(setting,list[i]);if(node){break}}}if(_cancelPreSelectedNode){_cancelPreSelectedNode.apply(view,arguments)}};var _createNodes=view.createNodes;view.createNodes=function(setting,level,nodes,parentNode){if(_createNodes){_createNodes.apply(view,arguments)}if(!nodes){return}if(view.repairParentChkClassWithSelf){view.repairParentChkClassWithSelf(setting,parentNode)}};var _makeNodeUrl=view.makeNodeUrl;view.makeNodeUrl=function(setting,node){return setting.edit.enable?null:(_makeNodeUrl.apply(view,arguments))};var _removeNode=view.removeNode;view.removeNode=function(setting,node){var root=data.getRoot(setting);if(root.curEditNode===node){root.curEditNode=null}if(_removeNode){_removeNode.apply(view,arguments)}};var _selectNode=view.selectNode;view.selectNode=function(setting,node,addFlag){var root=data.getRoot(setting);if(data.isSelectedNode(setting,node)&&root.curEditNode==node&&node.editNameFlag){return false}if(_selectNode){_selectNode.apply(view,arguments)}view.addHoverDom(setting,node);return true};var _uCanDo=tools.uCanDo;tools.uCanDo=function(setting,e){var root=data.getRoot(setting);if(e&&(tools.eqs(e.type,"mouseover")||tools.eqs(e.type,"mouseout")||tools.eqs(e.type,"mousedown")||tools.eqs(e.type,"mouseup"))){return true}if(root.curEditNode){view.editNodeBlur=false;root.curEditInput.focus()}return(!root.curEditNode)&&(_uCanDo?_uCanDo.apply(view,arguments):true)};$.widget("jazz.tree",$.jazz.boxComponent,{options:{url:null,params:null,data:null,setting:null,height:300},_create:function(){this._super();this.element.addClass("jazz-panel-content jazz-widget-content").attr("vtype","tree");var name=this.options.name;if(!name){name=this.options.id}this.element.attr("name","jazz_"+name);this.element.css({overflow:"hidden"});var height=this.element.height();if(height<30){this.element.css({height:this.options.height})}this.ulId="tree_"+name;this.itemsContainer=$('<ul id="'+this.ulId+'" class="ztree" style="margin-top:0; width:auto; padding-top: 0px; padding-bottom: 0px; height:100%; overflow:auto;"></ul>').appendTo(this.element);if(!!this.options.data){this._callback("1")}else{if(!!this.options.url){this._ajax()}else{this._initTreeEvent();$.fn.zTree.init(this.itemsContainer,this.options.setting)}}},_init:function(){this._super();this._compSize()},_compSize:function(){this._width();this._height()},_width:function(){this._super()},_height:function(){this._super()},_ajax:function(){var param={url:this.options.url,params:this.options.params,async:true,callback:this._callback};$.DataAdapter.submit(param,this)},_callback:function(data,sourceThis){var jsonData=null;var $this=null;if(data=="1"){jsonData=this.options.data;$this=this}else{var newdata=data.data;jsonData=newdata;$this=sourceThis}if(!!jsonData){$.fn.zTree.init($this.itemsContainer,$this.options.setting,jsonData)}},_initTreeEvent:function(){},loadData:function(url,params,flag){if(!url){if(this.options.url!=null){if(!!params){this.options.params=params}this.itemsContainer.children().remove();this._ajax()}}else{this.itemsContainer.children().remove();if(flag=="static"){this.options.data=url;this._callback(1)}else{if(!!url){this.options.url=url}if(!!params){this.options.params=params}this._ajax()}}}})})(jQuery)});var SWFUpload;var swfobject;if(SWFUpload==undefined){SWFUpload=function(settings){this.initSWFUpload(settings)}}SWFUpload.prototype.initSWFUpload=function(userSettings){try{this.customSettings={};this.settings={};this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings(userSettings);this.loadSupport();if(this.swfuploadPreload()){this.loadFlash()}this.displayDebugInfo()}catch(ex){delete SWFUpload.instances[this.movieName];throw ex}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.5.0 2010-01-15 Beta 2";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290,RESIZE:-300,USER_DEFINED:-500};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.UPLOAD_TYPE={NORMAL:-1,RESIZED:-2};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120,JAVASCRIPT:-130,NONE:-130};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.RESIZE_ENCODING={JPEG:-1,PNG:-2};SWFUpload.completeURL=function(url){try{var path="",indexSlash=-1;if(typeof(url)!=="string"||url.match(/^https?:\/\//i)||url.match(/^\//)||url===""){return url}indexSlash=window.location.pathname.lastIndexOf("/");if(indexSlash<=0){path="/"}else{path=window.location.pathname.substr(0,indexSlash)+"/"}return path+url}catch(ex){return url}};SWFUpload.onload=function(){};SWFUpload.prototype.initSettings=function(userSettings){this.ensureDefault=function(settingName,defaultValue){var setting=userSettings[settingName];if(setting!=undefined){this.settings[settingName]=setting}else{this.settings[settingName]=defaultValue}};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("flash9_url","swfupload_fp9.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000;font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_preload_handler",null);this.ensureDefault("swfupload_load_failed_handler",null);this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_resize_start_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("mouse_click_handler",null);this.ensureDefault("mouse_out_handler",null);this.ensureDefault("mouse_over_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(!!this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+new Date().getTime();this.settings.flash9_url=this.settings.flash9_url+(this.settings.flash9_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+new Date().getTime()}if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)}delete this.ensureDefault};SWFUpload.prototype.loadSupport=function(){this.support={loading:swfobject.hasFlashPlayerVersion("9.0.28"),imageResize:swfobject.hasFlashPlayerVersion("10.0.0")}};SWFUpload.prototype.loadFlash=function(){var targetElement,tempParent,wrapperType,flashHTML,els;if(!this.support.loading){this.queueEvent("swfupload_load_failed_handler",["Flash Player doesn't support SWFUpload"]);return}if(document.getElementById(this.movieName)!==null){this.support.loading=false;this.queueEvent("swfupload_load_failed_handler",["Element ID already in use"]);return}targetElement=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(targetElement==undefined){this.support.loading=false;this.queueEvent("swfupload_load_failed_handler",["button place holder not found"]);return}wrapperType=(targetElement.currentStyle&&targetElement.currentStyle.display||window.getComputedStyle)!=="block"?"span":"div";tempParent=document.createElement(wrapperType);flashHTML=this.getFlashHTML();try{tempParent.innerHTML=flashHTML}catch(ex){this.support.loading=false;this.queueEvent("swfupload_load_failed_handler",["Exception loading Flash HTML into placeholder"]);return}els=tempParent.getElementsByTagName("object");if(!els||els.length>1||els.length===0){this.support.loading=false;this.queueEvent("swfupload_load_failed_handler",["Unable to find movie after adding to DOM"]);return}else{if(els.length===1){this.movieElement=els[0]}}targetElement.parentNode.replaceChild(tempParent.firstChild,targetElement);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement()}};SWFUpload.prototype.getFlashHTML=function(flashVersion){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',(this.support.imageResize?this.settings.flash_url:this.settings.flash9_url),'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',(this.support.imageResize?this.settings.flash_url:this.settings.flash9_url),'" />','<param name="quality" value="high" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var httpSuccessString,paramString;paramString=this.buildParamString();httpSuccessString=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(httpSuccessString),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(paramString),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var postParams,paramStringPairs=[];postParams=this.settings.post_params;if(typeof(postParams)==="object"){for(var name in postParams){if(postParams.hasOwnProperty(name)){paramStringPairs.push(encodeURIComponent(name.toString())+"="+encodeURIComponent(postParams[name].toString()))}}}return paramStringPairs.join("&amp;")};SWFUpload.prototype.destroy=function(){var movieElement;try{this.cancelUpload(null,false);movieElement=this.cleanUp();if(movieElement){try{movieElement.parentNode.removeChild(movieElement)}catch(ex){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true}catch(ex2){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","flash9_url:                ",this.settings.flash9_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_placeholder:       ",(this.settings.button_placeholder?"Set":"Not Set"),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_cursor:            ",this.settings.button_cursor.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_preload_handler assigned:  ",(typeof this.settings.swfupload_preload_handler==="function").toString(),"\n","\t","swfupload_load_failed_handler assigned:  ",(typeof this.settings.swfupload_load_failed_handler==="function").toString(),"\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","mouse_click_handler assigned:       ",(typeof this.settings.mouse_click_handler==="function").toString(),"\n","\t","mouse_over_handler assigned:        ",(typeof this.settings.mouse_over_handler==="function").toString(),"\n","\t","mouse_out_handler assigned:         ",(typeof this.settings.mouse_out_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_resize_start_handler assigned:      ",(typeof this.settings.upload_resize_start_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n","Support:\n","\t","Load:                     ",(this.support.loading?"Yes":"No"),"\n","\t","Image Resize:             ",(this.support.imageResize?"Yes":"No"),"\n"].join(""))};SWFUpload.prototype.addSetting=function(name,value,default_value){if(value==undefined){return(this.settings[name]=default_value)}else{return(this.settings[name]=value)}};SWFUpload.prototype.getSetting=function(name){if(this.settings[name]!=undefined){return this.settings[name]}return""};SWFUpload.prototype.callFlash=function(functionName,argumentArray){var movieElement,returnValue,returnString;argumentArray=argumentArray||[];movieElement=this.getMovieElement();try{if(movieElement!=undefined){returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>");returnValue=eval(returnString)}else{this.debug("Can't call flash because the movie wasn't found.")}}catch(ex){this.debug("Exception calling flash function '"+functionName+"': "+ex.message)}if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue)}return returnValue};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(fileID){this.callFlash("StartUpload",[fileID])};SWFUpload.prototype.startResizedUpload=function(fileID,width,height,encoding,quality,allowEnlarging){this.callFlash("StartUpload",[fileID,{width:width,height:height,encoding:encoding,quality:quality,allowEnlarging:allowEnlarging}])};SWFUpload.prototype.cancelUpload=function(fileID,triggerErrorEvent){if(triggerErrorEvent!==false){triggerErrorEvent=true}this.callFlash("CancelUpload",[fileID,triggerErrorEvent])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.requeueUpload=function(indexOrFileID){return this.callFlash("RequeueUpload",[indexOrFileID])};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(statsObject){this.callFlash("SetStats",[statsObject])};SWFUpload.prototype.getFile=function(fileID){if(typeof(fileID)==="number"){return this.callFlash("GetFileByIndex",[fileID])}else{return this.callFlash("GetFile",[fileID])}};SWFUpload.prototype.getQueueFile=function(fileID){if(typeof(fileID)==="number"){return this.callFlash("GetFileByQueueIndex",[fileID])}else{return this.callFlash("GetFile",[fileID])}};SWFUpload.prototype.addFileParam=function(fileID,name,value){return this.callFlash("AddFileParam",[fileID,name,value])};SWFUpload.prototype.removeFileParam=function(fileID,name){this.callFlash("RemoveFileParam",[fileID,name])};SWFUpload.prototype.setUploadURL=function(url){this.settings.upload_url=url.toString();this.callFlash("SetUploadURL",[url])};SWFUpload.prototype.setPostParams=function(paramsObject){this.settings.post_params=paramsObject;this.callFlash("SetPostParams",[paramsObject])};SWFUpload.prototype.addPostParam=function(name,value){this.settings.post_params[name]=value;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(name){delete this.settings.post_params[name];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(types,description){this.settings.file_types=types;this.settings.file_types_description=description;this.callFlash("SetFileTypes",[types,description])};SWFUpload.prototype.setFileSizeLimit=function(filesizelimit){this.settings.file_size_limit=filesizelimit;this.callFlash("SetFileSizeLimit",[filesizelimit])};SWFUpload.prototype.setFileUploadLimit=function(fileuploadlimit){this.settings.file_upload_limit=fileuploadlimit;this.callFlash("SetFileUploadLimit",[fileuploadlimit])};SWFUpload.prototype.setFileQueueLimit=function(fileQueueLimit){this.settings.file_queue_limit=fileQueueLimit;this.callFlash("SetFileQueueLimit",[fileQueueLimit])};SWFUpload.prototype.setFilePostName=function(filePostName){this.settings.file_post_name=filePostName;this.callFlash("SetFilePostName",[filePostName])};SWFUpload.prototype.setUseQueryString=function(useQueryString){this.settings.use_query_string=useQueryString;this.callFlash("SetUseQueryString",[useQueryString])};SWFUpload.prototype.setRequeueOnError=function(requeueOnError){this.settings.requeue_on_error=requeueOnError;this.callFlash("SetRequeueOnError",[requeueOnError])};SWFUpload.prototype.setHTTPSuccess=function(http_status_codes){if(typeof http_status_codes==="string"){http_status_codes=http_status_codes.replace(" ","").split(",")}this.settings.http_success=http_status_codes;this.callFlash("SetHTTPSuccess",[http_status_codes])};SWFUpload.prototype.setAssumeSuccessTimeout=function(timeout_seconds){this.settings.assume_success_timeout=timeout_seconds;this.callFlash("SetAssumeSuccessTimeout",[timeout_seconds])};SWFUpload.prototype.setDebugEnabled=function(debugEnabled){this.settings.debug_enabled=debugEnabled;this.callFlash("SetDebugEnabled",[debugEnabled])};SWFUpload.prototype.setButtonImageURL=function(buttonImageURL){if(buttonImageURL==undefined){buttonImageURL=""}this.settings.button_image_url=buttonImageURL;this.callFlash("SetButtonImageURL",[buttonImageURL])};SWFUpload.prototype.setButtonDimensions=function(width,height){this.settings.button_width=width;this.settings.button_height=height;var movie=this.getMovieElement();if(movie!=undefined){movie.style.width=width+"px";movie.style.height=height+"px"}this.callFlash("SetButtonDimensions",[width,height])};SWFUpload.prototype.setButtonText=function(html){this.settings.button_text=html;this.callFlash("SetButtonText",[html])};SWFUpload.prototype.setButtonTextPadding=function(left,top){this.settings.button_text_top_padding=top;this.settings.button_text_left_padding=left;this.callFlash("SetButtonTextPadding",[left,top])};SWFUpload.prototype.setButtonTextStyle=function(css){this.settings.button_text_style=css;this.callFlash("SetButtonTextStyle",[css])};SWFUpload.prototype.setButtonDisabled=function(isDisabled){this.settings.button_disabled=isDisabled;this.callFlash("SetButtonDisabled",[isDisabled])};SWFUpload.prototype.setButtonAction=function(buttonAction){this.settings.button_action=buttonAction;this.callFlash("SetButtonAction",[buttonAction])};SWFUpload.prototype.setButtonCursor=function(cursor){this.settings.button_cursor=cursor;this.callFlash("SetButtonCursor",[cursor])};SWFUpload.prototype.queueEvent=function(handlerName,argumentArray){var self=this;if(argumentArray==undefined){argumentArray=[]}else{if(!(argumentArray instanceof Array)){argumentArray=[argumentArray]}}if(typeof this.settings[handlerName]==="function"){this.eventQueue.push(function(){this.settings[handlerName].apply(this,argumentArray)});setTimeout(function(){self.executeNextEvent()},0)}else{if(this.settings[handlerName]!==null){throw"Event handler "+handlerName+" is unknown or is not a function"}}};SWFUpload.prototype.executeNextEvent=function(){var f=this.eventQueue?this.eventQueue.shift():null;if(typeof(f)==="function"){f.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(file){var reg=/[$]([0-9a-f]{4})/i,unescapedPost={},uk,match;if(file!=undefined){for(var k in file.post){if(file.post.hasOwnProperty(k)){uk=k;while((match=reg.exec(uk))!==null){uk=uk.replace(match[0],String.fromCharCode(parseInt("0x"+match[1],16)))}unescapedPost[uk]=file.post[k]}}file.post=unescapedPost}return file};SWFUpload.prototype.swfuploadPreload=function(){var returnValue;if(typeof this.settings.swfupload_preload_handler==="function"){returnValue=this.settings.swfupload_preload_handler.call(this)}else{if(this.settings.swfupload_preload_handler!=undefined){throw"upload_start_handler must be a function"}}if(returnValue===undefined){returnValue=true}return !!returnValue};SWFUpload.prototype.flashReady=function(){var movieElement=this.cleanUp();if(!movieElement){this.debug("Flash called back ready but the flash movie can't be found.");return}this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.cleanUp=function(){var movieElement=this.getMovieElement();try{if(movieElement&&typeof(movieElement.CallFunction)==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var key in movieElement){try{if(typeof(movieElement[key])==="function"){movieElement[key]=null}}catch(ex){}}}}catch(ex1){}window.__flash__removeCallback=function(instance,name){try{if(instance){instance[name]=null}}catch(flashEx){}};return movieElement};SWFUpload.prototype.mouseClick=function(){this.queueEvent("mouse_click_handler")};SWFUpload.prototype.mouseOver=function(){this.queueEvent("mouse_over_handler")};SWFUpload.prototype.mouseOut=function(){this.queueEvent("mouse_out_handler")};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("file_queued_handler",file)};SWFUpload.prototype.fileQueueError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("file_queue_error_handler",[file,errorCode,message])};SWFUpload.prototype.fileDialogComplete=function(numFilesSelected,numFilesQueued,numFilesInQueue){this.queueEvent("file_dialog_complete_handler",[numFilesSelected,numFilesQueued,numFilesInQueue])};SWFUpload.prototype.uploadResizeStart=function(file,resizeSettings){file=this.unescapeFilePostParams(file);this.queueEvent("upload_resize_start_handler",[file,resizeSettings.width,resizeSettings.height,resizeSettings.encoding,resizeSettings.quality])};SWFUpload.prototype.uploadStart=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("return_upload_start_handler",file)};SWFUpload.prototype.returnUploadStart=function(file){var returnValue;if(typeof this.settings.upload_start_handler==="function"){file=this.unescapeFilePostParams(file);returnValue=this.settings.upload_start_handler.call(this,file)}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}}if(returnValue===undefined){returnValue=true}returnValue=!!returnValue;this.callFlash("ReturnUploadStart",[returnValue])};SWFUpload.prototype.uploadProgress=function(file,bytesComplete,bytesTotal){file=this.unescapeFilePostParams(file);this.queueEvent("upload_progress_handler",[file,bytesComplete,bytesTotal])};SWFUpload.prototype.uploadError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("upload_error_handler",[file,errorCode,message])};SWFUpload.prototype.uploadSuccess=function(file,serverData,responseReceived){file=this.unescapeFilePostParams(file);this.queueEvent("upload_success_handler",[file,serverData,responseReceived])};SWFUpload.prototype.uploadComplete=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("upload_complete_handler",file)};SWFUpload.prototype.debug=function(message){this.queueEvent("debug_handler",message)};SWFUpload.prototype.debugMessage=function(message){var exceptionMessage,exceptionValues;if(this.settings.debug){exceptionValues=[];if(typeof message==="object"&&typeof message.name==="string"&&typeof message.message==="string"){for(var key in message){if(message.hasOwnProperty(key)){exceptionValues.push(key+": "+message[key])}}exceptionMessage=exceptionValues.join("\n")||"";exceptionValues=exceptionMessage.split("\n");exceptionMessage="EXCEPTION: "+exceptionValues.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(exceptionMessage)}else{SWFUpload.Console.writeLine(message)}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(message){var console,documentForm;try{console=document.getElementById("SWFUpload_Console");if(!console){documentForm=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(documentForm);console=document.createElement("textarea");console.id="SWFUpload_Console";console.style.fontFamily="monospace";console.setAttribute("wrap","off");console.wrap="off";console.style.overflow="auto";console.style.width="700px";console.style.height="350px";console.style.margin="5px";documentForm.appendChild(console)}console.value+=message+"\n";console.scrollTop=console.scrollHeight-console.clientHeight}catch(ex){alert("Exception: "+ex.name+" Message: "+ex.message)}};swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();swfobject.addDomLoadEvent(function(){if(typeof(SWFUpload.onload)==="function"){SWFUpload.onload.call(window)}});var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.queue={};SWFUpload.prototype.initSettings=(function(oldInitSettings){return function(userSettings){if(typeof(oldInitSettings)==="function"){oldInitSettings.call(this,userSettings)}this.queueSettings={};this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler;this.settings.upload_complete_handler=SWFUpload.queue.uploadCompleteHandler;this.settings.upload_start_handler=SWFUpload.queue.uploadStartHandler;this.settings.queue_complete_handler=userSettings.queue_complete_handler||null}})(SWFUpload.prototype.initSettings);SWFUpload.prototype.startUpload=function(fileID){this.queueSettings.queue_cancelled_flag=false;this.callFlash("StartUpload",[fileID])};SWFUpload.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=true;this.stopUpload();var stats=this.getStats();while(stats.files_queued>0){this.cancelUpload();stats=this.getStats()}};SWFUpload.queue.uploadStartHandler=function(file){var returnValue;if(typeof(this.queueSettings.user_upload_start_handler)==="function"){returnValue=this.queueSettings.user_upload_start_handler.call(this,file)}returnValue=(returnValue===false)?false:true;this.queueSettings.queue_cancelled_flag=!returnValue;return returnValue};SWFUpload.queue.uploadCompleteHandler=function(file){var user_upload_complete_handler=this.queueSettings.user_upload_complete_handler;var continueUpload;if(file.filestatus===SWFUpload.FILE_STATUS.COMPLETE){this.queueSettings.queue_upload_count++}if(typeof(user_upload_complete_handler)==="function"){continueUpload=(user_upload_complete_handler.call(this,file)===false)?false:true}else{if(file.filestatus===SWFUpload.FILE_STATUS.QUEUED){continueUpload=false}else{continueUpload=true}}if(continueUpload){var stats=this.getStats();if(stats.files_queued>0&&this.queueSettings.queue_cancelled_flag===false){this.startUpload()}else{if(this.queueSettings.queue_cancelled_flag===false){this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]);this.queueSettings.queue_upload_count=0}else{this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0}}}}}(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","form/jazz.form.Field"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.attachment",$.jazz.field,{options:{vtype:"attachment",allowfiletypes:"*.*",allowfiletypesdesc:"所有文件",description:"",downloadurl:"",filesizelimit:"50 MB",fileuploadlimit:20,filesizeminlimit:0,isrepeatupload:false,previewurl:"",title:"上传附件",single:false,theme:0,uploadurl:"",click:null,close:null,enter:null,leave:null,uploadsuccess:null},_height:function(){},_disabled:function(){},_editable:function(){},_create:function(){this._super();this.id=this.options.name;if(!this.id){return false}var str='<div class="jazz-att-panel" id="'+this.id+'Panel"><div class="jazz-att-add"><span class="iconTrans14 jazz-att-icon"></span><a href="#" tabindex="-1">'+this.options.title+"</a></div>";str+='<div class="jazz-att-theme" id="'+this.id+'ProgressContainer"></div>';if(this.options.description){str+='<div class="jazz-att-shuoming">'+this.options.description+"</div>"}str+='<div class="swfContainer" style="width:80px; height: 20px;left: 5px; top: 5px; position: absolute;"><input type="hidden" name="uploadSession" value="'+jazz.getRandom()+jazz.getRandom()+'" /><input type="hidden" name="filesizelimit" value="'+this.options.filesizelimit+'" /><input type="hidden" name="filesizeminlimit" value="'+this.options.filesizeminlimit+'" /><input type="hidden" name="fileuploadlimit" value="'+this.options.fileuploadlimit+'" /><input type="hidden" name="allowfiletypes" value="'+this.options.allowfiletypes+'" /><input type="hidden" name="allowfiletypesdesc" value="'+this.options.allowfiletypesdesc+'" /><input type="hidden" name="uploadedfilescount" value="0"/><input type="hidden" name="disableButtonId" value="btnSave" /><span id="'+this.id+'SwfHolder"></span></div></div>';this.parent.addClass("jazz-att-no-border");this.inputFrame.addClass("jazz-att-panel");this.inputFrame.append(str);this._loadSwfupload()},_init:function(){this._super();this.datadisplay=[]},_getConfig:function(){var id=this.id;if(null==id||""==id){throw"加载文件上传控件错误！控件id参数不能为空！"}var config={id:id};var elements=this.inputFrame.find("input[type=hidden]");$.each(elements,function(i,item){config[item.name]=item.value});config.masterId=config.masterId||"";config.filesizelimit=config.filesizelimit||"50 MB";config.filesizeminlimit=config.filesizeminlimit||0;config.fileuploadlimit=parseInt(config.fileuploadlimit||20);config.allowfiletypes=config.allowfiletypes||"*.*;";config.allowfiletypesdesc=config.allowfiletypesdesc||"所有文件;";config.uploadedfilescount=parseInt(config.uploadedfilescount||0);return config},_loadSwfupload:function(){SWFUpload.onload=this._swf_upload()},_readonly:function(){if(this.options.readonly==true){this.inputFrame.find(".jazz-att-add").css({display:"none"});this.inputFrame.find(".swfContainer").css({display:"none"});if(this.options.theme==1){this.inputFrame.find(".jazz-att-theme1-close").css({display:"none"})}}else{this.inputFrame.find(".jazz-att-add").css({display:"block"});this.inputFrame.find(".swfContainer").css({display:"block"});if(this.options.theme==1){this.inputFrame.find(".jazz-att-theme1-close").css({display:"block"})}}},_swf_upload:function(){var config=this._getConfig();this._swfInit(config)},_swfInit:function(config){var $this=this;var DEFAULT_UPLOAD_URL=jazz.config.contextpath+($this.options.uploadurl||jazz.config.default_upload_url),DEFAULT_FLASH_URL=jazz.config.contextpath+jazz.config.default_flash_url,DEFAULT_FLASH9_URL=jazz.config.contextpath+jazz.config.default_flash9_url;var single=this.options.single,uploadSuccessHandler=uploadSuccess;var isrepeatupload=this.options.isrepeatupload;this.swfInstance=new SWFUpload({upload_url:$.trim(DEFAULT_UPLOAD_URL),post_params:{type:"upload",uploadSession:config.uploadSession},file_size_limit:config.filesizelimit,file_types:config.allowfiletypes,file_types_description:config.allowfiletypesdesc,file_upload_limit:config.fileuploadlimit,button_action:single?SWFUpload.BUTTON_ACTION.SELECT_FILE:SWFUpload.BUTTON_ACTION.SELECT_FILES,swfupload_loaded_handler:loaded,swfupload_preload_handler:preLoad,swfupload_load_failed_handler:loadFailed,file_queued_handler:fileQueued,file_queue_error_handler:fileQueueError,file_dialog_complete_handler:fileDialogComplete,upload_start_handler:uploadStart,upload_progress_handler:uploadProgress,upload_error_handler:uploadError,upload_success_handler:uploadSuccessHandler,upload_complete_handler:uploadComplete,button_placeholder_id:$this.id+"SwfHolder",button_width:70,button_height:20,button_text_top_padding:0,button_text_left_padding:0,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,flash_url:DEFAULT_FLASH_URL,flash9_url:DEFAULT_FLASH9_URL,custom_settings:{progressTarget:$this.id+"ProgressContainer",uploadedfilescount:config.uploadedfilescount,disableButtonId:config.disableButtonId,type:config.type,isrepeatupload:isrepeatupload,alreadyupload:[],customuploadstate:false},debug:false});this._onLoad(this.swfInstance);function preLoad(){if(!this.support.loading){jazz.info("加载附件上传控件失败,请安装FLASH9 或以上系统环境！");return false}}function loaded(){var fileUploadLimt=this.settings.file_upload_limit;var uploadedfilescount=this.customSettings.uploadedfilescount;if(fileUploadLimt>0){var stats=this.getStats();stats.successful_uploads=uploadedfilescount;this.setStats(stats)}}function loadFailed(){jazz.info("加载附件上传控件失败,请安装FLASH9 或以上系统环境！")}function fileQueued(file){try{var f=true;var size=file.size;var n=parseFloat(size/1024,0.1);if(!isNaN(n)){n=Math.round(n*100)/100}var filesize=$this.options.filesizeminlimit;filesize=filesize+"";if(filesize!==0&&filesize.length>2){filesize=$this.countFileSize(filesize)}var filesize=$this.countFileDisplaySize(filesize||0);if(filesize[1]!==0){if(parseFloat(filesize[1])>=n){f=false}}if((this.customSettings.isrepeatupload||$.inArray(file.name,this.customSettings.alreadyupload)<0)&&f){this.customuploadstate=true;this.customSettings.alreadyupload.push(file.name);var progress=new FileProgress(file,this.customSettings.progressTarget,this.customSettings,"fileQueued");progress.toggleCancel(true,this)}else{this.customuploadstate=false;if(!f){jazz.info("您所选择的文件未超过"+filesize[0]+"，请重新选择上传的文件。")}else{jazz.info("上传数据已经存在！")}}}catch(ex){this.debug(ex)}}function fileQueueError(file,errorCode,message){try{if(errorCode===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){jazz.info("您最多可以添加"+this.settings.file_upload_limit+"个附件！");return}switch(errorCode){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:jazz.info("您所选择的文件超过了"+this.settings.file_size_limit+"，请重新选择上传的文件。");break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:jazz.info("您所选择的文件类型非法，请重新选择上传的文件。");break;default:if(file!==null){jazz.info("您所选择的文件有误，请尝试重新选择上传的文件。")}break}}catch(ex){this.debug(ex)}}function fileDialogComplete(numFilesSelected,numFilesQueued){if(this.customuploadstate){try{if(numFilesSelected==0){return false}this.startUpload()}catch(ex){this.debug(ex)}}}function uploadStart(file){if(this.customuploadstate){try{var progress=new FileProgress(file,this.customSettings.progressTarget,this.customSettings,"uploadStart");progress.toggleCancel(true,this)}catch(ex){this.debug(ex)}return true}}function uploadProgress(file,bytesLoaded,bytesTotal){if(this.customuploadstate){try{var percent=Math.ceil((bytesLoaded/bytesTotal)*100);var progress=new FileProgress(file,this.customSettings.progressTarget,this.customSettings,"uploadProgress");progress.setProgress(percent)}catch(ex){this.debug(ex)}}}function uploadSuccess(file,serverData){if(this.customuploadstate){try{var progress=new FileProgress(file,this.customSettings.progressTarget,this.customSettings,"uploadSuccess");var jsonData=jazz.stringToJson(serverData);if(jsonData.success===true){progress.setComplete(jsonData);progress.toggleCancel(false,this);$this._showListEvent(file,serverData,this.customSettings);$this._event("uploadsuccess",null,serverData)}else{this.uploadError(file,SWFUpload.UPLOAD_ERROR.USER_DEFINED,jsonData.msg)}}catch(ex){this.debug(ex)}}}function uploadError(file,errorCode,message){if(this.customuploadstate){try{var progress=new FileProgress(file,this.customSettings.progressTarget,this.customSettings);progress.setError();progress.toggleCancel(false,this);switch(errorCode){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:progress.setStatus("上传失败: "+message);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:progress.setStatus("上传失败.");break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:progress.setStatus("服务器发生错误，上传失败.");break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:progress.setStatus("上传失败.");break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:progress.setStatus("上传超过限制.");break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:progress.setStatus("上传失败.");break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:progress.setStatus("被取消.");progress.setCancelled(this);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:progress.setStatus("被停止.");break;case SWFUpload.UPLOAD_ERROR.USER_DEFINED:progress.setStatus(message);break;default:progress.setStatus("上传文件失败: "+errorCode);break}}catch(ex){this.debug(ex)}}}function uploadComplete(file){if(this.customuploadstate){if(this.getStats().files_queued===0){var progress=new FileProgress(file,this.customSettings.progressTarget,this.customSettings,"uploadComplete");progress.toggleCancel(false,this)}}}function FileProgress(file,contentTargetId,customSettings,methodname){var cache=FileProgress.instances[file.id];if(cache){return cache}this.file=file;var contentTargetEl=$("#"+contentTargetId);if(contentTargetEl&&methodname=="fileQueued"){$this._showList(contentTargetEl,file)}FileProgress.instances[file.id]=this}FileProgress.instances={};FileProgress.prototype.setProgress=function(percentage){var fileEl=$("#"+this.file.id);if(fileEl){fileEl.find("#att_prog_"+this.file.id).width(percentage+"%")}};FileProgress.prototype.setComplete=function(result){var el=$("#"+this.file.id);if(el){setTimeout(function(){el.find(".jazz-att-progress").hide()},800);el.find("input[id=hiddenFileId]").val(result.id);el.attr("fileid",result.id)}};FileProgress.prototype.setError=function(){var el=$("#"+this.file.id);if(el){el.find(".jazz-att-progress-i").css({background:"red",width:"100%"})}};FileProgress.prototype.setCancelled=function(swfuploadInstance){};FileProgress.prototype.setStatus=function(status){var el=$("#"+this.file.id);if(el){el.find(".status").get(0).innerHTML=status}};FileProgress.prototype.toggleCancel=function(show,swfuploadInstance){var buttonId=swfuploadInstance.customSettings.disableButtonId;var fileEl=$("#"+this.file.id);if(fileEl){if(!buttonId){var btnEl=$("#"+buttonId).get(0);if(!btnEl){btnEl.disabled=show}}}else{if(!buttonId){var btnEl=$("#"+buttonId).get(0);if(btnEl){btnEl.disabled=false}}}}},_onLoad:function(swfInstance){var $this=this;if(swfInstance){$this._swfEvent();return}throw"加载flash控件出错！"},_swfEvent:function(){var $this=this;this.inputFrame.on("mousedown.attachment",function(event){var target=event.target,$target=$(target);if($target.is("a")){var action=$target.attr("_act");var fileObj=$target.parent().parent();if("att_remove_swf"===action){var file=$this.getFile(fileObj);$this.deleteFile(file);return}else{if("download_file"===action){var file=$this.getFile(fileObj);if(!!file){var _url=jazz.config.contextpath+($this.options.downloadurl||jazz.config.default_download_url)+"?name="+encodeURI(file.fileName)+"&fileId="+file.hiddenFileId;var form=$("<form>");form.attr("style","display:none");form.attr("target","");form.attr("method","post");form.attr("action",_url);$("body").append(form);form.submit()}return}}}})},destroy:function(){var swf=this.swfInstance;swf.destroy()},deleteFile:function(file){var $this=this;setTimeout(function(){var _id=file.deleteId||file.id;$("#"+_id).remove()},200);var swf=this.swfInstance,fileIndex=file.index,fileId=file.hiddenFileId||file.id;if(!swf){return}if(!!fileIndex){var cacheFile=swf.getFile(parseInt(fileIndex));if(cacheFile){if(SWFUpload.FILE_STATUS.QUEUED===cacheFile.filestatus||SWFUpload.FILE_STATUS.IN_PROGRESS===cacheFile.filestatus){swf.cancelUpload(cacheFile.id,false);var progress=new FileProgress(cacheFile,swf.customSettings.progressTarget);progress.toggleCancel(false,swf);return}else{if(SWFUpload.FILE_STATUS.ERROR===cacheFile.filestatus||SWFUpload.FILE_STATUS.CANCELLED===cacheFile.filestatus){}}}}var up=swf.customSettings.alreadyupload;for(var i=0,len=up.length;i<len;i++){if(up[i]==file.fileName){swf.customSettings.alreadyupload[i]="XXX_XXX"}}if(this.options.theme==0){this._event("close",null,file)}var stats=swf.getStats();stats.successful_uploads--;swf.setStats(stats)},countFileDisplaySize:function(size){if(typeof size=="string"){return size}var n=0;var displaySize=[];var ONE_KB=1024,ONE_MB=ONE_KB*ONE_KB,ONE_GB=ONE_KB*ONE_MB;if(Math.floor(size/ONE_GB)>0){n=this.format(Math.floor(size*100/ONE_GB)/100,2);displaySize.push(n+"GB")}else{if(Math.floor(size/ONE_MB)>0){n=this.format(Math.floor(size*100/ONE_MB)/100,2);displaySize.push(n+"MB")}else{if(Math.floor(size/ONE_KB)>0){n=this.format(Math.floor(size*100/ONE_KB)/100,2);displaySize.push(n+"KB")}else{n=size;displaySize.push(n+"Bytes")}}}displaySize.push(n);return displaySize},countFileSize:function(size){var n=0;if(typeof size!="string"){return n}var ONE_KB=1024,ONE_MB=ONE_KB*ONE_KB,ONE_GB=ONE_KB*ONE_MB;n=parseFloat(size.substring(0,size.length-2));size=size.substring(size.length-2,size.length);if(size=="KB"){n=parseFloat(n)*ONE_KB}else{if(size=="MB"){n=parseFloat(n)*ONE_MB}else{if(size=="GB"){n=parseFloat(n)*ONE_GB}}}return n},format:function(value,decimalLength){value=Math.round(value*Math.pow(10,decimalLength));value=value/Math.pow(10,decimalLength);var v=value.toString().split(".");if(v[0]==""){v[0]="0"}if(v.length>1){var len=v[1].length;if(len>decimalLength){v[1]=v[1].substring(0,decimalLength)}return v[0]+"."+v[1]}return v[0]},getControl:function(){return $('div[name="'+this.id+'"]')},getFile:function(fileEl){var hiddenFileId=fileEl.find('input[id="hiddenFileId"]').val();var fileName=fileEl.find('a[_act="download_file"]').text();return{id:fileEl.attr("id"),index:fileEl.attr("_fileIndex"),hiddenFileId:hiddenFileId,fileName:fileName}},getFiles:function(){var $this=this;var fileContainer=this.getControl(),files=[],fileEls=fileContainer.find("div.jazz-att-list-p");$.each(fileEls,function(index,item){var file=$this.getFile($(item)),fileId=file.hiddenFileId;if(!!fileId){files.push(file)}});return files},getFileIds:function(){var $this=this;var fileContainer=this.getControl(),fileIds=[],fileEls=fileContainer.find("div.jazz-att-list-p");$.each(fileEls,function(index,item){var file=$this.getFile($(item)),fileId=file.hiddenFileId;if(!!fileId){fileIds.push(fileId)}});return fileIds.join("##")},getValue:function(){var files=this.getFiles();var attach=[];if(files){for(var i=0,len=files.length;i<len;i++){var obj={},f=files[i];if($.inArray(f.hiddenFileId,this.datadisplay)==-1){obj.name=f.fileName;var _fileid=f.hiddenFileId;if(_fileid=="undefined"){_fileid=f.id}obj.fileId=_fileid;attach.push(obj)}}}return jazz.jsonToString(attach)},getText:function(){var files=this.getFiles();var attach=[];if(files){for(var i=0,len=files.length;i<len;i++){var obj={},f=files[i];attach.push(f.fileName)}}return attach.join(",")},reset:function(){},setValue:function(data){if(!data){return false}var $this=this,swf=this.swfInstance;if(!swf){return}var contentTargetEl=$("#"+this.id+"ProgressContainer");if(typeof(data)!="object"){data=jazz.stringToJson(data)}for(var i=0,len=data.length;i<len;i++){swf.settings.custom_settings.alreadyupload.push(data[i]["name"]);this._showList(contentTargetEl,data[i],true,i,data)}swf.setPostParams({uploadSession:$this.uploadSession})},_showList:function(contentTargetEl,file,flag,index,dataDisplay){var _none="",_theme=this.options.theme;if(_theme==1){_none='style="display: none;"'}var fieldId=file.id||file.fileId;var hiddenFileId=file.hiddenFileId;var size=file.size;var index=file.index||index;if(flag==true){hiddenFileId=file.id;this.datadisplay.push(hiddenFileId)}size=this.countFileDisplaySize(size);var str='<div class="jazz-att-list-p" id="'+fieldId+'" _fileindex="'+index+'"><span class="jazz-att-normal" '+_none+'><cite><a tabindex="-1"  href="#" _act="download_file">'+file.name+'</a><em style="margin-left:5px;">('+size[0]+')</em></cite><input type="hidden" id="hiddenFileId" value="'+hiddenFileId+'"/>';if(_theme!=1){if(!flag){str+='<b class="jazz-att-progress"><i id="att_prog_'+fieldId+'"></i></b>'}}str+='<a tabindex="-1" href="#" _act="att_remove_swf">删除</a><em class="status" style="color: red; margin-left: 6px;display: none;">上传失败.</em></span>';if(_theme==1){str+='<div id="'+fieldId+'_img" class="jazz-att-theme1-imgbg jazz-att-theme1-size">';if(!flag){str+='<b class="jazz-att-progress jazz-att-progress-t1"><i id="att_prog_'+fieldId+'" class="jazz-att-progress-i"></i></b>'}str+="</div>"}str+="</div>";contentTargetEl.append(str);if(flag==true){this._showListEvent(file,dataDisplay,this.swfInstance.settings.custom_settings)}},_showListEvent:function(file,data,custom_settings){if(this.options.theme==1){data=jazz.stringToJson(data);var _fileId=file.id||file.fileId;var _attachId=data.id||_fileId;if(_attachId){var _url=(this.options.previewurl||jazz.config.default_preview_url)+"?fileId="+_attachId;var obj=$("#"+this.id+"ProgressContainer").find("#"+_fileId+"_img");obj.children().remove();var imgType=file.type||file.name;if(imgType==".doc"||imgType==".docx"||/.*(\.doc|\.docx)$/i.test(imgType)){obj.addClass("jazz-att-theme1-size").addClass("jazz-att-word")}else{if(imgType==".pdf"||/.*(\.pdf)$/i.test(imgType)){obj.addClass("jazz-att-theme1-size").addClass("jazz-att-pdf")}else{obj.append('<img src="'+_url+'" class="jazz-att-theme1-size" />')}}var $close=$('<div class="jazz-att-theme1-close"></div>').appendTo(obj);var data=$.extend(file,data,{previewurl:_url},{deleteId:_fileId});var $this=this;$close.css("display","block");obj.on("mouseenter",function(e){$this._event("enter",e,data)}).on("mouseleave",function(e){$this._event("leave",e,data)}).on("mousedown",function(e){var target=e.target,$target=$(target);if($target.is(".jazz-att-theme1-close")){if(!$this.options.isrepeatupload){var arr=[];var alreadyupload=custom_settings.alreadyupload;for(var i=0,len=alreadyupload.length;i<len;i++){if(alreadyupload[i]==file.name){}else{arr.push(alreadyupload[i])}}$this.swfInstance.settings.custom_settings.alreadyupload=arr}$this._event("close",e,data)}else{$this._event("click",e,data)}})}}},toggleLabel:function(){}})});jazz.namespace("widget");jazz.widget=function(options,parent){if(typeof(options)=="object"){var vtype=options.vtype||"";if(!vtype){alert(" vtype 未定义！");return false}else{var obj=null;if(!!parent){obj=$("<div>").appendTo(parent)}else{obj=$("<div>").appendTo("body")}obj[vtype](options);obj[vtype]("finish");return obj}}};(function($){$.widget("jazz.boxlist",$.jazz.boxComponent,{options:{vtype:"boxlist",width:150,height:180,dataurl:null,params:null,multiple:false,datarender:null,click:null,change:null,unclick:null,dblclick:null},_create:function(){this._super();this.element.addClass("jazz-boxlist-ul jazz-boxlist-content");this._width();this._height();this.listContainer=$('<ul class="jazz-listbox-list"></ul>').appendTo(this.element)},_init:function(){if(typeof(this.options.dataurl)=="object"){this._callback("1",this)}else{if(!!this.options.dataurl){this._ajax()}else{this._callback({},this)}}},_ajax:function(){param={url:this.options.dataurl,params:this.options.params,callback:this._callback};$.DataAdapter.submit(param,this)},_callback:function(data,sourceThis){var jsonData=null;var $this=null;if(data=="1"){jsonData=this.options.dataurl;$this=sourceThis}else{jsonData=data;$this=sourceThis}$this.arrayOption=[];if(!!jsonData&&!!jsonData.data){$this.arrayOption=jsonData.data}var optHtml="";var render="";for(var i=0;i<$this.arrayOption.length;i++){var choice=$this.arrayOption[i];var _text=$.trim(choice.text);if(!choice.text){_text=""}if(!!$this.options.datarender){render=eval($this.options.datarender).call(this,choice);optHtml+='<li class="jazz-boxlist-item jazz-boxlist-li">'+render+"</li>"}else{optHtml+='<li class="jazz-boxlist-item jazz-boxlist-li">'+_text+"</li>"}}$this.listContainer.append(optHtml);$this.items=$this.listContainer.find(".jazz-boxlist-item");$this._bindEvents()},_bindEvents:function(){var time=null;var $this=this;this.element.off().on("dblclick.boxlist",function(event){var target=event.target;var $target=$(target);if($target.is("li")){clearTimeout(time);var item=$target;if($this.options.multiple){item=$this._clickMultiple(event,item);$this._trigger("dblclick",null,item)}else{item=$this._clickSingle(event,item);$this._trigger("dblclick",null,item)}}}).on("click.boxlist",function(event){var target=event.target;var $target=$(target);if($target.is("li")){clearTimeout(time);var item=$target;time=setTimeout(function(){if($this.options.multiple){item=$this._clickMultiple(event,item);$this._trigger("click",null,item)}else{item=$this._clickSingle(event,item);$this._trigger("click",null,item)}},200)}})},_clickSingle:function(event,item){var selectedItem=this.items.filter(".jazz-boxlist-highlight");var itemIndex=item.index();var selectedIndex=selectedItem.index();if(itemIndex!==selectedIndex){if(selectedItem.length){this._unselectItem(selectedItem)}this._selectItem(item);if(selectedItem.length){this._changeTrigger(selectedItem,item)}else{this._changeTrigger(null,item)}}return this.arrayOption[itemIndex]},_clickMultiple:function(event,item){var itemIndex=item.index();if(this.items.eq(itemIndex).hasClass("jazz-boxlist-highlight")){this._unselectItem(item);this._trigger("unclick",null,item);this._changeTrigger(item,null)}else{this._selectItem(item);this._changeTrigger(null,item)}return this.getSelected()},_changeTrigger:function(oldItem,newItem){var changeItem={};if(!oldItem){var newIndex=newItem.index();changeItem.newObject=this.arrayOption[newIndex]}else{if(!newItem){var oldIndex=oldItem.index();changeItem.oldObject=this.arrayOption[oldIndex]}else{var newIndex=newItem.index();var oldIndex=oldItem.index();changeItem.newObject=this.arrayOption[newIndex];changeItem.oldObject=this.arrayOption[oldIndex]}}this._trigger("change",null,changeItem)},_selectItem:function(value){var item=null;if($.type(value)==="number"){item=this.items.eq(value)}else{item=value}item.addClass("jazz-boxlist-highlight").removeClass("jazz-boxlist-li")},_unselectItem:function(value){var item=null;if($.type(value)==="number"){item=this.items.eq(value)}else{item=value}item.addClass("jazz-boxlist-li").removeClass("jazz-boxlist-highlight")},reload:function(){this._init()},unselectAll:function(){this.items.removeClass("jazz-boxlist-highlight");this._trigger("change",null)},getSelected:function(){var selected=this.items.filter(".jazz-boxlist-highlight");var allSelected=[];var selectedIndex=null;for(var i=0;i<selected.length;i++){selectedIndex=selected.index();allSelected.push(this.arrayOption[selectedIndex])}return allSelected}})})(jQuery);(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.basemenu",$.jazz.boxComponent,{options:{name:"",width:-1,height:-1,delayhidetime:null,target:null,items:null,createitems:function(){return[]}},_create:function(){this._super();this._getMenuDefaultUrl();var el=this.element;el.addClass("jazz-menu-base");if(this.options.width>0){el.width(this.options.width)}if(this.options.height>0){el.height(this.options.height)}var items=eval(this.options.items);if(!items){var createitems=this.options.createitems;if(createitems){items=this._customopration(this.options.createitems)}}this.options.items=items||[];this._widgetCreateMenuDom()},_init:function(){this._super();var that=this;var el=that.element;that._bindMenuEvent()},_width:function(){},_height:function(){},_getMenuDefaultUrl:function(){var obj=$('<div id="div-img-src"  class="jazz-menu-img-src"></div>').appendTo(document.body);var str=obj.css("background-image");var start=str.indexOf("(");var end=str.lastIndexOf("tool-sprites-dark.png");this.defaulturl=str.substring(start+1,end).replace('"',"");obj.remove()},_bindMenuEvent:function(){var that=this;var el=that.element;el.on("contextmenu.jazz-menu-contextmenu",function(e){return false}).on("mouseover.jazz-menu",".jazz-menu-label",null,function(e){var time=el.data("timeCounter");if(time){el.data("timeCounter","");clearTimeout(time)}var parent=$(this).closest(".jazz-menu");parent.find(".jazz-menu-label-active").removeClass("jazz-menu-label-active");parent.find(".jazz-menu").hide();var nextmenu=$(this).next(".jazz-menu .jazz-submenu");nextmenu.show();nextmenu.css({left:"",top:"","z-index":++jazz.config.zindex}).position({my:"left top",at:"right top",of:$(this)});$(this).addClass("jazz-menu-label-active");e.stopPropagation()}).on("mouseout.jazz-menu",".jazz-menu-label",null,function(e){var target=$(e.target);var nextmenu=$(this).next(".jazz-menu .jazz-submenu");var li=$(this).parent();var x=e.pageX,y=e.pageY;var nw=nextmenu.width();var nleft=nextmenu.offset().left;var lih=li.height();var lileft=li.offset().left;var litop=li.offset().top;if(x<=lileft||y<=litop||y>=Math.floor(litop+lih-1)){nextmenu.hide();$(this).removeClass("jazz-menu-label-active")}}).on("click.jazz-menu",".jazz-menu-label",null,function(e){var nextmenu=$(this).next(".jazz-menu .jazz-submenu");if(nextmenu.is(":hidden")){nextmenu.show()}else{nextmenu.hide()}});var delayHideTime=that.options.delayhidetime||1000;el.on("mouseenter.jazz-submenu",".jazz-menu",null,function(e){var time=el.data("timeCounter");if(time){el.data("timeCounter","");clearTimeout(time)}$(this).find(".jazz-menu-label-active").removeClass("jazz-menu-label-active");$(this).find(".jazz-menu").hide();e.stopPropagation()}).on("mouseleave.jazz-submenu",".jazz-menu",null,function(e){var time=setTimeout(function(){el.find(".jazz-menu").hide();el.hide()},delayHideTime);el.data("timeCounter",time);e.stopPropagation()});var itemEvents=that.allItemsClickEvents;el.find(".jazz-menuitem-content").each(function(){var id=$(this).attr("id");var clickobj=$(this);$.each(itemEvents,function(i,temp){var auid=temp.auid;var clickevent=temp.click;if(auid==id){clickobj.on("click",function(e){if($.isFunction(clickevent)){clickevent.call($(this))}else{eval(clickevent).call($(this))}el.hide()})}})});$(document).on("mousedown.jazzz-menu",function(e){if(el.is(":hidden")){return}var target=$(e.target);if(target.is(el)||el.has(target).length>0){return}var offset=el.offset();if(e.pageX<offset.left||e.pageX>offset.left+el.width()||e.pageY<offset.top||e.pageY>offset.top+el.height()){el.hide()}})},_widgetCreateMenuDom:function(){var that=this;var el=that.element;var items=that.options.items;that.vtypeWidgets=[];that.allItemsClickEvents=[];that._recorderVtypeWidet(items);var menuHtml=that._getWidgetMemuDom(items);el.append(menuHtml);that._initVtypeSubmenuComponent()},_recorderVtypeWidet:function(items){var that=this;if(items&&items.length>0){var item,nextItems,name,vtype;for(var i=0;i<items.length;i++){item=items[i];name=item.name;vtype=item.vtype;nextItems=item.items;if(vtype){var uid=jazz.util.getIndex();name=name||"submenu"+uid;item.name=name;that.vtypeWidgets.push({vtype:vtype,name:name,option:item})}else{if(nextItems&&$.isArray(nextItems)){that._recorderVtypeWidet(nextItems)}}}}},_getWidgetMemuDom:function(items,isSubmenu){var that=this;var menuHtml=[];if(isSubmenu){menuHtml.push('<div class="jazz-menu jazz-submenu">')}else{menuHtml.push('<div class="jazz-menu">')}menuHtml.push('<div class="jazz-menu-content" >');menuHtml.push('<ul class="first-of-type" >');if(items&&items.length>0){var item,nextItems,name,vtype,html,aid,subMenuHtml;for(var i=0;i<items.length;i++){item=items[i];name=item.name;vtype=item.vtype;html=item.html;nextItems=item.items;aid="menu-uid-"+(++jazz.config.zindex);item.auid=aid;menuHtml.push('<li class="jazz-menuitem" >');if(vtype){menuHtml.push('<a class="jazz-menuitem-content-component" id=\''+aid+"'>");menuHtml.push("<div name='"+name+"' vtype='"+vtype+"'></div>");menuHtml.push("</a>")}else{var iconurl=item.iconurl;if(nextItems&&$.isArray(nextItems)){menuHtml.push('<a class="jazz-menu-label" id=\''+aid+"'>");menuHtml.push('<div class="jazz-menuitem-content-wrap">');menuHtml.push('<div class="jazz-menuitem-label-img">');if(iconurl){menuHtml.push('<img src="'+iconurl+'" alt="">')}else{iconurl=this.defaulturl+"/menu-blank.png";menuHtml.push('<img class="menuitem-default-icon" src="'+iconurl+'" alt="">')}menuHtml.push("</div>");menuHtml.push('<div class="jazz-menuitem-label-inner">');if(html){menuHtml.push(html)}else{menuHtml.push(item.text)}menuHtml.push("</div>");menuHtml.push("</div>");menuHtml.push("</a>");subMenuHtml=that._getWidgetMemuDom(nextItems,true);menuHtml.push(subMenuHtml)}else{menuHtml.push('<a class="jazz-menuitem-content" id=\''+aid+"'>");menuHtml.push('<div class="jazz-menuitem-content-wrap">');menuHtml.push('<div class="jazz-menuitem-content-img">');if(iconurl){menuHtml.push('<img src="'+iconurl+'" alt="">')}else{iconurl=this.defaulturl+"/menu-blank.png";menuHtml.push('<img class="menuitem-default-icon" src="'+iconurl+'" alt="">')}menuHtml.push("</div>");menuHtml.push('<div class="jazz-menuitem-content-inner">');if(html){menuHtml.push(html)}else{menuHtml.push(item.text)}menuHtml.push("</div>");menuHtml.push("</div>");menuHtml.push("</a>");that.allItemsClickEvents.push({auid:aid,click:item.click})}}menuHtml.push("</li>")}}menuHtml.push("</ul>");menuHtml.push("</div>");menuHtml.push("</div>");return menuHtml.join("")},_initVtypeSubmenuComponent:function(){var that=this;var el=that.element;var widgets=that.vtypeWidgets;var name,widget,option;for(var i=0,len=widgets.length;i<len;i++){widget=widgets[i];name=widget.name;option=widget.option;el.find("div[name='"+name+"']").parseComponent(option)}},destroy:function(){this.element.children().remove();this.element.remove();this._super()}});$.widget("jazz.menu",$.jazz.basemenu,{options:{vtype:"menu",target:null},_create:function(){this._super()},_init:function(){this._super()},_bindMenuEvent:function(){this._super();var that=this;var el=that.element;var target=that.options.target||$(document);var positionConfig={my:that.options.my,at:that.options.at,of:$(target)};el.css({left:"",top:"","z-index":++jazz.config.zindex}).position(positionConfig);var delayHideTime=that.options.delayhidetime||1000;el.off("mouseenter.jazz-submenu mouseleave.jazz-submenu").on("mouseenter.jazz-submenu",".jazz-menu",null,function(e){var time=el.data("timeCounter");if(time){el.data("timeCounter","");clearTimeout(time)}$(this).find(".jazz-menu-label-active").removeClass("jazz-menu-label-active");$(this).find(".jazz-menu").hide();e.stopPropagation()}).on("mouseleave.jazz-submenu",".jazz-menu",null,function(e){var time=setTimeout(function(){el.find(".jazz-menu-label-active").removeClass("jazz-menu-label-active");el.find(".jazz-menu .jazz-submenu").hide();el.hide();if($(target).hasClass("jazz-button")){$(target).find(".button-arrow-td img").hide();$(target).removeClass("jazz-button-pressed")}},delayHideTime);el.data("timeCounter",time);e.stopPropagation()})}});$.widget("jazz.contextmenu",$.jazz.basemenu,{options:{vtype:"contextmenu",target:null},_create:function(){this._super()},_init:function(){this._super()},_bindMenuEvent:function(){this._super();var that=this;var el=that.element;if(!this.element.is(document.body)){this.element.appendTo("body")}var target=that.options.target;if((typeof target=="string")||(target instanceof Object)){$(target).on("contextmenu.jazz-contextmenu",function(e){that._showContextMenu(e)})}},_showContextMenu:function(e){$(document.body).children(".jazz-contextmenu:visible").hide();var win=$(window),left=e.pageX,top=e.pageY,width=this.element.outerWidth(),height=this.element.outerHeight();if((left+width)>(win.width())+win.scrollLeft()){left=left-width}if((top+height)>(win.height()+win.scrollTop())){top=top-height}this.element.css({left:left,top:top,"z-index":++jazz.config.zindex}).show();this.element.children().show();e.preventDefault();e.stopPropagation()},showContextMenu:function(e){this._showContextMenu(e)}})});(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery"],factory)}else{factory($)}})(jQuery,function($){jazz.dataFormater=function(data,format){if(typeof format!="string"){return data}jazz.__DataFormater._value=data;jazz.__DataFormater._format=format;var output="",reg_date="/Y|M|D|H|m|s|S/g";if(format.match(reg_date)){output=jazz.__DataFormater.formatDate()}else{if(format.indexOf("$")!=-1){output=jazz.__DataFormater.formatCurrency("$",Math.round)}else{if(format.indexOf("¥")!=-1){output=jazz.__DataFormater.formatCurrency("¥",Math.round)}else{if(format.indexOf("%")!=-1){output=jazz.__DataFormater.formatPercentage("%",100,Math.round)}else{if(format.indexOf("‰")!=-1){output=jazz.__DataFormater.formatPercentage("‰",1000,Math.round)}else{output=jazz.__DataFormater.formatNumber(Math.round)}}}}}return output};jazz.__DataFormater={_value:"",_values:[],_format:"",formatDate:function(){this.fixValues();return this.matchDataFormat()},fixValues:function(){var datas=this._value.toString().split("");var datas_len=datas.length;var output="";while(datas_len--){if((datas[datas_len]==" ")||isNaN(datas[datas_len])){datas.splice(datas_len,1)}}while(datas.length<14){datas.push("0")}this._values=datas},matchDataFormat:function(){var formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g;var formats=this._format.match(formattingTokens);var formats_len=formats.length;while(formats_len--){formats[formats_len]=this.matchDataFactory(formats[formats_len])}return formats.join("")},matchDataFactory:function(formatName){if(formatName=="YY"){return(this._values.slice(2,4).join(""))}else{if(formatName=="YYYY"){return(this._values.slice(0,4).join(""))}else{if(formatName=="MM"){return(this._values.slice(4,6).join(""))}else{if(formatName=="M"){return(this._values.slice(4,6).join("").replace("0",""))}else{if(formatName=="DD"){return(this._values.slice(6,8).join(""))}else{if(formatName=="D"){return(this._values.slice(6,8).join("").replace("0",""))}else{if(formatName=="HH"){return(this._values.slice(8,10).join(""))}else{if(formatName=="mm"){return(this._values.slice(10,12).join(""))}else{if(formatName=="ss"){return(this._values.slice(12,14).join(""))}else{return formatName}}}}}}}}}},formatCurrency:function(symbol,roundingFunction){var format=this._format;var symbolIndex=format.indexOf(symbol),openParenIndex=format.indexOf("("),minusSignIndex=format.indexOf("-"),space="",spliceIndex,output;if(format.indexOf(" "+symbol)>-1){space=" ";format=format.replace(" "+symbol,"")}else{if(format.indexOf(symbol+" ")>-1){space=" ";format=format.replace(symbol+" ","")}else{format=format.replace(symbol,"")}}this._format=format;output=this.formatNumber(roundingFunction);if(format===""||format===undefined){return n._value}if(symbolIndex<=1){if(output.indexOf("(")>-1||output.indexOf("-")>-1){output=output.split("");spliceIndex=1;if(symbolIndex<openParenIndex||symbolIndex<minusSignIndex){spliceIndex=0}output.splice(spliceIndex,0,symbol+space);output=output.join("")}else{output=symbol+space+output}}else{if(output.indexOf(")")>-1){output=output.split("");output.splice(-1,0,space+symbol);output=output.join("")}else{output=output+space+symbol}}return output},formatPercentage:function(symbol,_n,roundingFunction){var space="",output,format=this._format;if(format.indexOf(" "+symbol)>-1){space=" ";format=format.replace(" "+symbol,"")}else{format=format.replace(symbol,"")}this._format=format;this._value=this._value*_n;output=this.formatNumber(roundingFunction);if(output.indexOf(")")>-1){output=output.split("");output.splice(-1,0,space+symbol);output=output.join("")}else{output=output+space+symbol}return output},formatNumber:function(roundingFunction){var negP=false,signed=false,optDec=false,abbr="",abbrK=false,abbrM=false,abbrB=false,abbrT=false,abbrForce=false,bytes="",ord="",abs=Math.abs(value),suffixes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],min,max,power,w,precision,thousands,d="",neg=false,format=this._format,value=this._value;if(value===0&&zeroFormat!==null){return zeroFormat}else{if(format.indexOf("[.]")>-1){optDec=true;format=format.replace("[.]",".")}w=value.toString().split(".")[0];precision=format.split(".")[1];thousands=format.indexOf(",");if(precision){if(precision.indexOf("[")>-1){precision=precision.replace("]","");precision=precision.split("[");d=this.toFixed(value,(precision[0].length+precision[1].length),roundingFunction,precision[1].length)}else{d=this.toFixed(value,precision.length,roundingFunction)}w=d.split(".")[0];if(d.split(".")[1].length){d="."+d.split(".")[1]}else{d=""}if(optDec&&Number(d.slice(1))===0){d=""}}else{w=this.toFixed(value,null,roundingFunction)}if(w.indexOf("-")>-1){w=w.slice(1);neg=true}if(thousands>-1){w=w.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}if(format.indexOf(".")===0){w=""}return((negP&&neg)?"(":"")+((!negP&&neg)?"-":"")+((!neg&&signed)?"+":"")+w+d+((ord)?ord:"")+((abbr)?abbr:"")+((bytes)?bytes:"")+((negP&&neg)?")":"")}},toFixed:function(value,precision,roundingFunction,optionals){var power=Math.pow(10,precision),optionalsRegExp,output;output=(roundingFunction(value*power)/power).toFixed(precision);if(optionals){optionalsRegExp=new RegExp("0{1,"+optionals+"}$");output=output.replace(optionalsRegExp,"")}return output}}});if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function($){$.DataAdapter={submit:function(params,$this){var adapter=new $.dataAdapterObject();adapter.submit(params,$this)},query:function(params){var adapter=new $.dataAdapterObject();adapter.createAdapter();adapter.options.components=params.components;adapter.componentsData2();return adapter.dataArray},vtypeset:["gridpanel","formpanel","querypanel","comboxtreefield","comboxfield","icon","attachment","boxlist","tree"]};$.dataAdapterObject=function(){this.options={sourceobject:null,contextpath:"",name:null,vtype:null,components:null,url:null,type:"post",data:null,success:null,error:null,callback:null,params:null,pageparams:null,queryparams:null,showloading:null}};$.dataAdapterObject.prototype={createAdapter:function(){this.jazzData=new Object();this.dataArray=new Array();this.jazzData.data=this.dataArray},addAttr:function(name,value){if(!!name&&!!vtype){var temp={};temp.name=name;temp.vtype="attr";temp.data=value;this.dataArray[name]=value}},addForm:function(name,vtype,formData){this.dataArray.push(formData)},addGrid:function(name,vtype,gridData){var obj={};obj.name=name;obj.vtype=vtype;obj.data={};obj.data["rows"]=gridData||[];this.dataArray.push(obj)},addSelect:function(name,vtype,selectData){this.dataArray.push(selectData)},addTree:function(name,vtype,treeData){this.dataArray.push(treeData)},addIcon:function(name,vtype,iconData){var obj=new Object();this.dataArray.push(iconData);return obj},getJazzDataString:function(){return jazz.jsonToString(this.jazzData)},getSubmitJsonData:function(){return this.jazzData},ajaxSubmit:function(){var $this=this;var initRes={obj:{},setAttr:function(key,value){this.obj[key]=value},getAttr:function(key){return this.obj[key]}};var data=this.getJazzDataString();$.ajax({url:$this.options.url,type:$this.options.type,dataType:"json",data:{postData:data},async:true,contentType:"application/x-www-form-urlencoded; charset=utf-8",error:$this.options.error||function(responseObj){if(responseObj.responseText){var err=jazz.stringToJson(responseObj.responseText);if(err.exceptionMes){jazz.error('<font color="blue" >错误信息</font> : '+err.exceptionMes)}else{jazz.error("与服务器连接断开，请尝试重新登录或与管理员联系!")}}else{jazz.error("与服务器连接断开，请尝试重新登录或与管理员联系!")}return false},complete:function(){if(((jazz.config.submitShowLoading==true&&$this.options.showloading==null)||$this.options.showloading==true)&&$this.modality){$this.modality.remove()}if($.isFunction($this.options.complete)){$this.options.complete.apply(this)}},success:function(responseObj){if(responseObj.message=="noSessionRight"){return false}if(responseObj.exception){jazz.error('<font color="blue" >错误名称</font> : '+responseObj.exception+'<br><font color="blue" >错误信息</font> : '+responseObj.exceptionMes);return false}var callbackdata=null;var jsonData=responseObj.data;if(typeof(jsonData)=="object"){if(jsonData!=null&&$.isArray(jsonData)){var newJsonData=[];$.each(jsonData,function(i,jsonObj){var vtype=jsonObj.vtype;if(vtype=="attr"){initRes.setAttr(jsonObj.name,jsonObj.data)}if($.inArray(vtype,$.DataAdapter.vtypeset)>=0){newJsonData.push(jsonData[i])}});if(newJsonData.length==1){callbackdata=newJsonData[0]}}}else{callbackdata=jsonData}if($.isFunction($this.options.callback)){$this.options.callback.call(this,callbackdata,$this.options.sourceobject,initRes)}}})},componentsData:function(){var flag=true;var components=this.options.components;if($.isArray(components)){for(var i=0,len=components.length;i<len;i++){var compJson=$('div[name="'+components[i]+'"]');var vtype=compJson.attr("vtype");var name=compJson.attr("name");if(vtype=="formpanel"){$('div[name="'+components[i]+'"]').find("div[vtype]").each(function(index,element){var el=$(element);var vtype=el.attr("vtype"),$field=el.data(vtype);var options=$field.options;var rule=options.rule;if(rule&&vtype!="gridpanel"&&vtype!="hiddenfield"&&vtype!="checkboxfield"&&vtype!="radiofield"&&options.isrule){var msg=options.msg;var f=jazz.doTooltip($field,$field.getText(),rule,msg);if(f==false){flag=false;$field._validateStyle(f)}}})}if(!flag){return false}if($.inArray(vtype,$.DataAdapter.vtypeset)>=0){if(vtype=="formpanel"||vtype=="querypanel"){var data=compJson[vtype]("getValue");this.addForm(name,vtype,data)}else{if(vtype=="gridpanel"){var data=compJson[vtype]("getSelection");this.addGrid(name,vtype,data)}}}else{alert("解析的vtype类型错误！！！ ");return false}}}var qparams=this.options.queryparams;if(qparams){var $this=this;$.each(qparams,function(){$this.dataArray.push(this)})}var params=this.options.pageparams;if(params&&typeof(params)=="object"){for(var p in params){var param={};param.vtype="pagination";param.name=p;param.data=params[p];this.dataArray.push(param)}}var params=this.options.params;if(params&&typeof(params)=="object"){for(var p in params){var param={};param.vtype="attr";param.name=p;param.data=params[p];this.dataArray.push(param)}}return flag},componentsData2:function(){var params=this.options.params;if(params&&typeof(params)=="object"){for(var p in params){var param={};param.vtype="attr";param.name=p;param.data=params[p];this.dataArray.push(param)}}var components=this.options.components;if($.isArray(components)){for(var i=0,len=components.length;i<len;i++){var name=components[i];var compJson=$('div[name="'+name+'"]');var vtype=compJson.attr("vtype");if(vtype=="formpanel"||vtype=="querypanel"){var data=compJson[vtype]("getValue");this.addForm(this.options.name,vtype,data)}else{if(vtype=="textfield"||vtype=="comboxfield"||vtype=="datefield"||vtype=="comboxtreefield"||vtype=="checkboxfield"||vtype=="radiofield"||vtype=="autofield"||vtype=="numberfield"||vtype=="passwordfield"){var data=compJson[vtype]("getValue");var param={};param.vtype="attr";param.name=name;param.data=data;this.dataArray.push(param)}}}}},submit:function(params,$sourcethis){$.extend(this.options,params);if((jazz.config.submitShowLoading==true&&this.options.showloading==null)||this.options.showloading==true){this.modality=$('<div id="submit_"'+jazz.getRandom()+'"></div>').css({position:"fixed",top:"0px",left:"0px",width:jazz.windowWidth(),height:jazz.windowHeight(),"z-index":++jazz.config.zindex}).appendTo(document.body).loading({blank:true})}var flag=true;this.createAdapter();this.options.sourceobject=$sourcethis;flag=this.componentsData();if(String(flag)=="false"){if(((jazz.config.submitShowLoading==true&&this.options.showloading==null)||this.options.showloading==true)&&this.modality){this.modality.remove()}return false}this.ajaxSubmit()}};$(function(){var initRes={obj:{},setAttr:function(key,value){this.obj[key]=value},getAttr:function(key){return this.obj[key]}};var initPageData=$("#OptimusData").attr("data");if(typeof(initPageData)!="object"){if(initPageData){initPageData=jazz.stringToJson(initPageData)}}if(initPageData){var jsonData=initPageData.data;if($.isArray(jsonData)){$.each(jsonData,function(i,jsonObj){var vtype=jsonObj.vtype,name=jsonObj.name;if(vtype=="attr"){initRes.setAttr(name,jsonObj.data)}})}if($.isFunction(window.initData)){initData(initRes)}}})})(jQuery);