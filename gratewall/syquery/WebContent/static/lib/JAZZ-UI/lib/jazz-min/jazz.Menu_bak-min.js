(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.basemenu",$.jazz.boxComponent,{options:{name:"",width:-1,height:-1,delayhidetime:null,target:null,items:null,createitems:function(){return[]}},_create:function(){this._super();this._getMenuDefaultUrl();var el=this.element;el.addClass("jazz-menu-base");if(this.options.width>0){el.width(this.options.width)}if(this.options.height>0){el.height(this.options.height)}var items=eval(this.options.items);if(!items){var createitems=this.options.createitems;if(createitems){items=this._customopration(this.options.createitems)}}this.options.items=items||[];this._widgetCreateMenuDom()},_init:function(){this._super();var that=this;var el=that.element;that._bindMenuEvent()},_height:function(){},_getMenuDefaultUrl:function(){var obj=$('<div id="div-img-src"  class="jazz-menu-img-src"></div>').appendTo(document.body);var str=obj.css("background-image");var start=str.indexOf("(");var end=str.lastIndexOf("tool-sprites-dark.png");this.defaulturl=str.substring(start+1,end).replace('"',"");obj.remove()},_bindMenuEvent:function(){var that=this;var el=that.element;el.on("contextmenu.jazz-menu-contextmenu",function(e){return false}).on("mouseover.jazz-menu",".jazz-menu-label",null,function(e){var time=el.data("timeCounter");if(time){el.data("timeCounter","");clearTimeout(time)}var parent=$(this).closest(".jazz-menu");parent.find(".jazz-menu-label-active").removeClass("jazz-menu-label-active");parent.find(".jazz-menu").hide();var nextmenu=$(this).next(".jazz-menu .jazz-submenu");nextmenu.show();nextmenu.css({left:"",top:"","z-index":++jazz.config.zindex}).position({my:"left top",at:"right top",of:$(this)});$(this).addClass("jazz-menu-label-active");e.stopPropagation()}).on("mouseout.jazz-menu",".jazz-menu-label",null,function(e){var target=$(e.target);var nextmenu=$(this).next(".jazz-menu .jazz-submenu");var li=$(this).parent();var x=e.pageX,y=e.pageY;var nw=nextmenu.width();var nleft=nextmenu.offset().left;var lih=li.height();var liw=li.width();var lileft=li.offset().left;var litop=li.offset().top;var nw_left=parseInt(nextmenu.css("left").replace("px",""));if(nw_left>0){if(x<=lileft||y<=litop||y>=Math.floor(litop+lih-1)){nextmenu.hide();$(this).removeClass("jazz-menu-label-active")}}else{if(x>=Math.floor(lileft+liw-1)||y<=litop||y>=Math.floor(litop+lih-1)){nextmenu.hide();$(this).removeClass("jazz-menu-label-active")}}}).on("click.jazz-menu",".jazz-menu-label",null,function(e){var nextmenu=$(this).next(".jazz-menu .jazz-submenu");if(nextmenu.is(":hidden")){nextmenu.show()}else{nextmenu.hide()}});var delayHideTime=that.options.delayhidetime||1000;el.on("mouseenter.jazz-submenu",".jazz-menu",null,function(e){var time=el.data("timeCounter");if(time){el.data("timeCounter","");clearTimeout(time)}$(this).find(".jazz-menu-label-active").removeClass("jazz-menu-label-active");$(this).find(".jazz-menu").hide();e.stopPropagation()}).on("mouseleave.jazz-submenu",".jazz-menu",null,function(e){var time=setTimeout(function(){el.find(".jazz-menu").hide();el.hide()},delayHideTime);el.data("timeCounter",time);e.stopPropagation()});var itemEvents=that.allItemsClickEvents;el.find(".jazz-menuitem-content").each(function(){var id=$(this).attr("id");var ispropagation=$(this).attr("ispropagation");var clickobj=$(this);$.each(itemEvents,function(i,temp){var auid=temp.auid;var clickevent=temp.click;if(auid==id){clickobj.on("click",function(e){if($.isFunction(clickevent)){clickevent.call($(this))}else{eval(clickevent).call($(this))}if(ispropagation=="true"||ispropagation==true){el.hide()}})}})});$(document).on("mousedown.jazzz-menu",function(e){if(el.is(":hidden")){return}var target=$(e.target);if(target.is(el)||el.has(target).length>0){return}var offset=el.offset();if(e.pageX<offset.left||e.pageX>offset.left+el.width()||e.pageY<offset.top||e.pageY>offset.top+el.height()){el.hide()}})},_widgetCreateMenuDom:function(){var that=this;var el=that.element;var items=that.options.items;that.vtypeWidgets=[];that.allItemsClickEvents=[];that._recorderVtypeWidet(items);var menuHtml=that._getWidgetMemuDom(items);el.append(menuHtml);that._initVtypeSubmenuComponent()},_recorderVtypeWidet:function(items){var that=this;if(items&&items.length>0){var item,nextItems,name,vtype;for(var i=0;i<items.length;i++){item=items[i];name=item.name;vtype=item.vtype;nextItems=item.items;if(vtype){var uid=jazz.util.getIndex();name=name||"submenu"+uid;item.name=name;that.vtypeWidgets.push({vtype:vtype,name:name,option:item})}else{if(nextItems&&$.isArray(nextItems)){that._recorderVtypeWidet(nextItems)}}}}},_getWidgetMemuDom:function(items,isSubmenu){var that=this;var menuHtml=[];if(isSubmenu){menuHtml.push('<div class="jazz-menu jazz-submenu">')}else{menuHtml.push('<div class="jazz-menu">')}menuHtml.push('<div class="jazz-menu-content" >');menuHtml.push('<ul class="first-of-type" >');if(items&&items.length>0){var item,nextItems,name,vtype,html,aid,subMenuHtml,ispropagation,value;for(var i=0;i<items.length;i++){item=items[i];name=item.name;vtype=item.vtype;value=item.value;html=item.html;htmlid=item.htmlid;ispropagation=item.ispropagation;nextItems=item.items;aid="menu-uid-"+(++jazz.config.zindex);item.auid=aid;if(ispropagation===undefined){ispropagation=true}menuHtml.push('<li class="jazz-menuitem" >');if(vtype){menuHtml.push('<a class="jazz-menuitem-content-component" id=\''+aid+"' value='"+value+"'>");menuHtml.push("<div name='"+name+"' vtype='"+vtype+"'></div>");menuHtml.push("</a>")}else{var iconurl=item.iconurl;if(nextItems&&$.isArray(nextItems)){menuHtml.push('<a class="jazz-menu-label" id=\''+aid+"' ispropagation='"+ispropagation+"' value='"+value+"'>");menuHtml.push('<div class="jazz-menuitem-content-wrap">');menuHtml.push('<div class="jazz-menuitem-label-img">');if(iconurl){menuHtml.push('<img src="'+iconurl+'" alt="">')}else{iconurl=this.defaulturl+"/menu-blank.png";menuHtml.push('<img class="menuitem-default-icon" src="'+iconurl+'" alt="">')}menuHtml.push("</div>");menuHtml.push('<div class="jazz-menuitem-label-inner">');if(html){menuHtml.push(html)}else{if(htmlid){menuHtml.push("<div id='"+htmlid+"'></div>")}else{menuHtml.push(item.text)}}menuHtml.push("</div>");menuHtml.push("</div>");menuHtml.push("</a>");subMenuHtml=that._getWidgetMemuDom(nextItems,true);menuHtml.push(subMenuHtml)}else{menuHtml.push('<a class="jazz-menuitem-content" id=\''+aid+"' ispropagation='"+ispropagation+"' value='"+value+"'>");menuHtml.push('<div class="jazz-menuitem-content-wrap">');menuHtml.push('<div class="jazz-menuitem-content-img">');if(iconurl){menuHtml.push('<img src="'+iconurl+'" alt="">')}else{iconurl=this.defaulturl+"/menu-blank.png";menuHtml.push('<img class="menuitem-default-icon" src="'+iconurl+'" alt="">')}menuHtml.push("</div>");menuHtml.push('<div class="jazz-menuitem-content-inner">');if(html){menuHtml.push(html)}else{if(htmlid){menuHtml.push("<div id='"+htmlid+"'></div>")}else{menuHtml.push(item.text)}}menuHtml.push("</div>");menuHtml.push("</div>");menuHtml.push("</a>");that.allItemsClickEvents.push({auid:aid,click:item.click})}}menuHtml.push("</li>")}}menuHtml.push("</ul>");menuHtml.push("</div>");menuHtml.push("</div>");return menuHtml.join("")},_initVtypeSubmenuComponent:function(){var that=this;var el=that.element;var widgets=that.vtypeWidgets;var name,widget,option;for(var i=0,len=widgets.length;i<len;i++){widget=widgets[i];name=widget.name;option=widget.option;el.find("div[name='"+name+"']").parseComponent(option)}},destroy:function(){this.element.children().remove();this.element.remove();this._super()}});$.widget("jazz.menu",$.jazz.basemenu,{options:{vtype:"menu",triggertype:"mouseenter",autotrigger:false,my:"left top",at:"left bottom",target:null},_create:function(){this._super()},_init:function(){this._super();this.options.target=$(this.options.target);this._bindTargetEvent();this._event("menuCreatedFinish")},_cleanTargetEvent:function(){var triggertype=this.options.triggertype,target=this.options.target;target.off(triggertype+".jazz-menu")},_bindTargetEvent:function(){if(!this.options.autotrigger||!this.options.target){return}var triggertype=this.options.triggertype,target=this.options.target,that=this;target.off(triggertype+".jazz-menu").on(triggertype+".jazz-menu",function(){that.element.show().position({my:that.options.my,at:that.options.at,of:target})})},showMenu:function(position){if(position){this.element.show().position(position)}else{this.element.show().position({my:this.options.my,at:this.options.at,of:this.options.target})}},hideMenu:function(){this.element.hide()},setTarget:function(target){this._cleanTargetEvent();this.options.target=target;this._bindTargetEvent()},setTriggerType:function(triggertype){this._cleanTargetEvent();this.options.triggertype=triggertype;this._bindTargetEvent()},setAutoTrigger:function(flag){this.options.autotrigger=flag;if(flag){this._bindTargetEvent()}else{this._cleanTargetEvent()}},_bindMenuEvent:function(){this._super();var that=this;var el=that.element;var target=that.options.target||$(document);var positionConfig={my:that.options.my,at:that.options.at,of:$(target)};el.css({left:"",top:"","z-index":++jazz.config.zindex}).position(positionConfig);var delayHideTime=that.options.delayhidetime||1000;el.off("mouseenter.jazz-submenu mouseleave.jazz-submenu").on("mouseenter.jazz-submenu",".jazz-menu",null,function(e){var time=el.data("timeCounter");if(time){el.data("timeCounter","");clearTimeout(time)}$(this).find(".jazz-menu-label-active").removeClass("jazz-menu-label-active");$(this).find(".jazz-menu").hide();e.stopPropagation()}).on("mouseleave.jazz-submenu",".jazz-menu",null,function(e){var time=setTimeout(function(){el.find(".jazz-menu-label-active").removeClass("jazz-menu-label-active");el.find(".jazz-menu .jazz-submenu").hide();el.hide();if($(target).hasClass("jazz-button")){$(target).find(".button-arrow-td img").hide();$(target).removeClass("jazz-button-pressed")}},delayHideTime);el.data("timeCounter",time);e.stopPropagation()})}});$.widget("jazz.contextmenu",$.jazz.basemenu,{options:{vtype:"contextmenu",target:null},_create:function(){this._super()},_init:function(){this._super()},_bindMenuEvent:function(){this._super();var that=this;var el=that.element;if(!this.element.is(document.body)){this.element.appendTo("body")}var target=that.options.target;if((typeof target=="string")||(target instanceof Object)){$(target).on("contextmenu.jazz-contextmenu",function(e){that._showContextMenu(e)})}},_showContextMenu:function(e){$(document.body).children(".jazz-contextmenu:visible").hide();var win=$(window),left=e.pageX,top=e.pageY,width=this.element.outerWidth(),height=this.element.outerHeight();if((left+width)>(win.width())+win.scrollLeft()){left=left-width}if((top+height)>(win.height()+win.scrollTop())){top=top-height}this.element.css({left:left,top:top,"z-index":++jazz.config.zindex}).show();this.element.children().show();e.preventDefault();e.stopPropagation()},showContextMenu:function(e){this._showContextMenu(e)}})});