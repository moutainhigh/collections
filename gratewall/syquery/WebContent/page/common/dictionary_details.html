<!DOCTYPE html PUBLIC>
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="../../static/script/jazz.js" type="text/javascript"></script>
<script>

 	var codeTableEnName = jazz.util.getParameter("codeTableEnName");
	var codeTableChName = jazz.util.getParameter("codeTableChName");
	$(function() {
		queryTableStruct();
		query();
		
	});
 	//查询代码表结构
	function queryTableStruct(){
		$('div[name="gridStruct"]').gridpanel('option','dataurl',rootPath+'/dictionaryDetails/queryStruct.do?codeTableEnName='+codeTableEnName);
		$('div[name="gridStruct"]').gridpanel('reload');
	}
 	
 	function query(){
 		$('div[name="gridValue"]').gridpanel('option','dataurl',rootPath+'/dictionaryDetails/queryValue.do?codeTableEnName='+codeTableEnName);
		$('div[name="gridValue"]').gridpanel('query', [ 'formpanel']);
 	}
 	
 	function reset(){
 		$('div[name="formpanel"]').formpanel('reset');
 	}
 	
 	function addData(){
		winEdit = jazz.widget({
	   	     vtype: 'window',
	   	     frameurl: './dictionary_detailsedit.html?codeTableEnName='+codeTableEnName+'&update=false',
	  			name: 'win',
	  	    	title: '新增代码信息',
	  	    	titlealign: 'center',
	  	    	titledisplay: true,
	  	        width: 800,
	  	        height: 450,
	  	        modal:true,
	  	        visible: true,
	  	      	resizable: true
	   		});
	}
 	
 	function updateData(){
		var selected = $('div[name="gridValue"]').gridpanel('getSelection');
		if (selected == null || selected.length!=1 ){
			jazz.info("请选中一个目标");}
		else{
			//alert(selected[0].pkCodeTableManager);
			effectiveCode = selected[0].effectiveCode;
			//alert(pkCodeTableManager);
			winEdit = jazz.widget({
		   	     vtype: 'window',
		   	     frameurl: './dictionary_detailsedit.html?codeTableEnName='+codeTableEnName+'&update=true&effectiveCode='+effectiveCode,
		  			name: 'win',
		  	    	title: '修改代码信息',
		  	    	titlealign: 'center',
		  	    	titledisplay: true,
		  	        width: 800,
		  	        height: 450,
		  	        modal:true,
		  	        visible: true,
		  	      	resizable: true
		   		});
			
		}
	}
 	
 	function deleteData(){
		var selected = $('div[name="gridValue"]').gridpanel('getSelection');
		if (selected == null || selected.length<1 ){
			jazz.info("请选中至少一个目标");
		}else if(selected.length>=1){
			jazz.confirm("该操作将删除该代码表中所有数据，是否删除？", function(){
				var params = {
						url : rootPath+'/dictionaryDetails/deleteValue.do?codeTableEnName='+codeTableEnName,
						components: ['gridValue'],
						callback : function(data, r, res) { 
							if (res.getAttr("back") == 'success'){
								query();
								jazz.info("删除成功");
							}
						}
				}
				$.DataAdapter.submit(params);
			}, function(){})
		}
	}
 
</script>
</head>
<body>
	<div id="codetable">  
        <div name="tab_name" vtype="tabpanel" overflowtype="2" tabtitlewidth="150" width="98%" height="500"
            orientation="top" id="tab_name">      
            <ul>      
               <li><a href="#tab1">代码表结构</a></li>      
               <li><a href="#tab2">代码表记录维护</a></li>     
            </ul>      
            <div>
            	<div id="tab1">
		              <div vtype="gridpanel" name="gridStruct" id="gridStruct" width="100%"  linenowidth="50" showborder="true" height="90%"
							titledisplay="false" dataurl="" layout="fit">
					        <!-- 表头 -->
							<div vtype="gridcolumn" name="grid_column" >
								<div>
									<!-- 单行表头 -->
									<div name='columnName' text="字段名" textalign="center" width='20%'></div>
									<div name='comments' text="中文名" textalign="center" width='17%'></div>
									<div name='constraintType' text="约束类型" textalign="center" width='17%'></div>
									<div name='dataType' text="字段类型" textalign="center" width='17%'></div>	
									<div name='nullable' text="可否为空" textalign="center" width='13%'></div>
									<div name='dataLength' text="字段长度" textalign="center" width='16%'></div>
								</div>
							</div>
							<!-- 表格 -->
							<div vtype="gridtable" name="grid_table"></div>
							<!-- 分页 -->
							<div vtype="paginator" name="grid_paginator" theme="2" pagerows="10"></div>
		               </div>      
		    	</div>
		        <div id="tab2">
		      	
			       <div vtype="formpanel" id="formpanel"  name="formpanel" 
						titledisplay="true" width="100%" layout="table"  showborder="true"
						layoutconfig="{cols:2, columnwidth: ['50%','*']}" title="代码值查询" height="150">

						<div name='effectiveCode' vtype="textfield" label="代码" labelalign="right" width="400" labelwidth="100"></div>
						<div name='name' vtype="textfield" label="名称" labelalign="right" width="400" labelwidth="100"></div>
						
						
        				<div id="toolbar" name="toolbar" vtype="toolbar"  align="center">
							<div name="query_button" vtype="button" text="查询"
								icon="../query/queryssuo.png" onclick="query();"></div>
							<div name="reset_button" vtype="button" text="重置"
								icon="../query/queryssuo.png" onclick="reset();"></div>
						</div>
			
						
					</div>
					<div vtype="gridpanel" name="gridValue" id="gridValue" width="100%"  linenowidth="50" showborder="true" height="70%"
							titledisplay="false" dataurl="" layout="fit">
					        <div name="toolbar" vtype="toolbar">
						    <div name="add_button" vtype="button" text="新增"
								icon="../query/queryssuo.png" onClick="addData();"></div>
						    <div name="update_button" vtype="button" text="修改"
								icon="../query/queryssuo.png" onClick="updateData();"></div>
						    <div name="delete_button" vtype="button" text="删除"
								icon="../query/queryssuo.png" onClick="deleteData();"></div>
			
						    </div>
					        <!-- 表头 -->
							<div vtype="gridcolumn" name="grid_column" >
								<div>
									<!-- 单行表头 -->
									<div name='effectiveCode' text="代码" textalign="center" width='15%'></div>
									<div name='name' text="名称" textalign="center" width='15%'></div>
									<div name='nameShort' text="简称" textalign="center" width='15%'></div>
									<div name='fCode' text="父节点代码" textalign="center" width='15%'></div>	
									<div name='chooseMark' text="选用标记" textalign="center" width='10%' datatype='comboxfield'
										dataurl='[{"text":"选用","value":"0"},{"text":"停用","value":"1"}]'></div>
									<div name='createrTime' text="创建时间" textalign="center" width='15%'></div>
									<div name='modifierTime' text="最后修改时间" textalign="center" width='15%'></div>
								</div>
							</div>
							<!-- 表格 -->
							<div vtype="gridtable" name="grid_table"></div>
							<!-- 分页 -->
							<div vtype="paginator" name="grid_paginator" theme="2" pagerows="10"></div>
		             </div>      
		      	
		      	</div>
		               
			</div>
              
        </div>  
                         
    </div>  
	
</body>
</html>