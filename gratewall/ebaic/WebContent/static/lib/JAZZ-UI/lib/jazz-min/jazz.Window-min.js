(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.loading","jazz.Panel"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.window",$.jazz.panel,{options:{vtype:"window",closable:true,closeonescape:false,closestate:true,draggable:true,height:230,maximize:false,minwidth:200,minheight:200,minimizable:false,maximizable:false,modal:false,resizable:false,taskbar:null,titledisplay:true,visible:false,width:300,afteropen:null,beforeopen:null,maximize:null,minimize:null},_create:function(){this._super()},_init:function(){this._super();this.element.addClass("jazz-window jazz-helper-hidden");this.icons=this.titlebarInner.find(".jazz-panel-titlebar-icon");this.closeIcon=this.handlerIcons.children(".jazz-panel-titlebar-close");this._maximizable();this._minimizable();this._esc();this.blockEvents="focus.window mousedown.window mouseup.window keydown.window keyup.window";this.parent=this.element.parent();this._winbindEvents();this._draggable();if(this.options.resizable){this._setupResizable()}if(this.options.maximize){this.toggleMaximize()}if($(document.body).children(".jazz-window-docking-zone").length===0){$(document.body).append('<div class="jazz-window-docking-zone"></div>')}if(this.options.visible){this.open()}this.pageindex=0},_applyFocus:function(){this.element.find(":not(:submit):not(:button):input:visible:enabled:first").focus()},_draggable:function(){if(this.options.draggable){this.titlebar.addClass("jazz-panel-move-titlebar");if(this.options.maximizable){this._setupDraggable()}else{if(!this.options.maximize){this._setupDraggable()}}}else{this.titlebar.removeClass("jazz-panel-move-titlebar");this.element.draggable("option","disabled",true)}},_disableModality:function(){this.modality.loading("destroy");this.modality=null;$(document).unbind(this.blockEvents).unbind("keydown.window")},_dock:function(zone){this.element.appendTo(zone).css("position","static");this.element.css({height:"auto",width:"auto","float":"left"});this.content.hide();this.handlerIcons.find(".jazz-titlebar-icon-minus").removeClass("jazz-titlebar-icon-minus").addClass("jazz-titlebar-icon-plus");this.minimized=true;if(this.options.resizable){this.resizers.hide()}zone.css("z-index",++jazz.config.zindex);this._event("minimize")},_esc:function(){if(this.options.closeonescape){var $this=this;$(document).on("keydown.window",function(e){var keyCode=$.ui.keyCode,active=parseInt($this.element.css("z-index"),10)===jazz.config.zindex;if(e.which===keyCode.ESCAPE&&$this.element.is(":visible")&&active){$this.close()}})}else{$(document).off("keydown.window")}},_enableModality:function(){var $this=this;var _height="100%";if(jazz.isIE(6)){_height=jazz.util.windowHeight()}this.modality=$("<div></div>").addClass("jazz-window-modal").css({top:"0px",left:"0px",width:"100%",height:_height,"z-index":$this.element.css("z-index")-1}).appendTo(document.body).loading({blank:true})},_initPosition:function(){if(this.options.maximize){this.element.css({top:0,left:0})}else{var windowWidth=jazz.util.windowWidth(),windowHeight=jazz.util.windowHeight();var eleWidth=this.element.width(),eleHeight=this.element.height();var top=0,left=0;if(eleWidth>windowWidth){left=0}else{left=Math.ceil((windowWidth-eleWidth)/2)}if(eleHeight>windowHeight){top=0}else{top=Math.ceil((windowHeight-eleHeight)/2)}this.element.css({top:top,left:left})}this.positionInitialized=true},_maximizable:function(){if(this.options.maximizable===true){var $this=this;var a=this.titlebarInner.find(".jazz-titlebar-icon-extlink");if(a.hasClass("jazz-titlebar-icon-extlink")){this.titlebarInner.find(".jazz-panel-titlebar-maximize").remove()}var obj=this._renderTitleButton("jazz-panel-titlebar-maximize","jazz-titlebar-icon-extlink");this.titlebar.off("dblclick.window").on("dblclick.window",function(e){$this.toggleMaximize();e.preventDefault()});obj.off("click.panelmax").on("click.panelmax",function(e){$this.toggleMaximize();e.preventDefault()})}else{this.titlebarInner.find(".jazz-panel-titlebar-maximize").remove()}},_minimizable:function(){if(this.options.minimizable===true){var $this=this;var a=this.titlebarInner.find(".jazz-titlebar-icon-minus");if(a.hasClass("jazz-titlebar-icon-minus")){this.titlebarInner.find(".jazz-panel-titlebar-minimize").remove()}var obj=this._renderTitleButton("jazz-panel-titlebar-minimize","jazz-titlebar-icon-minus");obj.on("click.panelmin",function(e){$this.toggleMinimize();e.preventDefault()})}else{this.titlebarInner.find(".jazz-panel-titlebar-minimize").remove()}},_maxToResotre:function(){this.element.removeClass("jazz-window-maximized");this._restoreState();this.handlerIcons.find(".jazz-titlebar-icon-newwin").removeClass("jazz-titlebar-icon-newwin").addClass("jazz-titlebar-icon-extlink");this.maximized=false},_moveToTop:function(){this.element.css("z-index",++jazz.config.zindex)},_postShow:function(){this._event("afteropen",null);this._applyFocus()},_restoreState:function(){this.element.width(this.state.width).height(this.state.height);this._winCompSize(this.state.height);var win=$(window);this.element.offset({top:this.state.offset.top+(win.scrollTop()-this.state.windowScrollTop),left:this.state.offset.left+(win.scrollLeft()-this.state.windowScrollLeft)})},_setOption:function(key,value){switch(key){case"closeonescape":if(value=="true"||value==true){this.options.closeonescape=true}else{this.options.closeonescape=false}this._esc();break;case"draggable":if(value=="true"||value==true){this.options.draggable=true}else{this.options.draggable=false}this._draggable();break;case"resizable":if(value=="true"||value==true){this.options.resizable=true}else{this.options.resizable=false}this._setupResizable();break;case"maximize":if(value=="true"||value==true){this.options.maximize=true;if(!this.maximized){this.toggleMaximize()}}else{if(this.maximized){this._maxToResotre()}this.options.maximize=false}break;case"maximizable":if(value=="true"||value==true){this.options.maximizable=true}else{this.options.maximizable=false}this._maximizable();break;case"minimizable":if(value=="true"||value==true){this.options.minimizable=true}else{this.options.minimizable=false}this._minimizable();break;case"visible":if(value=="true"||value==true){this.options.visible=true;this.element.show()}else{this.options.visible=false;this.element.hide()}break}this._super(key,value)},_setupDraggable:function(){var $this=this;var xWidth=jazz.util.windowWidth()-$this.options.calculatewidth;var yHeight=jazz.util.windowHeight()-$this.titlebar.outerHeight()-5;this.element.draggable({cancel:".jazz-panel-content, .jazz-panel-titlebar-close",handle:".jazz-panel-titlebar",containment:[0,0,xWidth,yHeight],start:function(e,ui){if($this.maximized){$this.toggleMaximize()}var el=$this.element;xWidth=jazz.util.windowWidth()-$this.options.calculatewidth;yHeight=jazz.util.windowHeight()-$this.titlebar.outerHeight()-5;el.draggable("option","containment",[0,0,xWidth,yHeight]);if($this.frameObject!=null){$this.frameObject.css("marginLeft","-4000px");$this.displayDiv.css("display","block")}el.css("z-index",++jazz.config.zindex)},drag:function(e,ui){},stop:function(e,ui){if($this.frameObject!=null){$this.displayDiv.css("display","none");$this.frameObject.css("marginLeft","0px")}}})},_setupResizable:function(){if(this.options.resizable===true){var $this=this;this.element.resizable({minWidth:this.options.minwidth,minHeight:this.options.minheight,start:function(e,ui){if($this.options.frameurl!=null){$this.frameObject.css("marginLeft","-4000px");$this.displayDiv.addClass("jazz-window-framemb")}$this.content.width("100%")},resize:function(){},stop:function(e,ui){var width=ui.size.width;var toHeight=ui.size.height;if($this.titlebar){toHeight-=$this.titlebar.outerHeight()}if($this.toolbar){toHeight-=$this.toolbar.outerHeight()}$this.content.outerWidth(width);$this.content.outerHeight(toHeight);if($this.options.frameurl!=null){$this.displayDiv.removeClass("jazz-window-framemb");$this.frameObject.outerWidth($this.content.width()).outerHeight($this.content.height()).css("marginLeft","0px")}}});this.resizers=this.element.children(".jazz-resizable-handle")}else{this.element.resizable("destroy")}},_saveState:function(){var el=this.element,win=$(window);this.state={width:el.width(),height:el.height(),offset:el.offset(),windowScrollLeft:win.scrollLeft(),windowScrollTop:win.scrollTop()}},_winbindEvents:function(){var $this=this,el=this.element;el.on("click.window",function(e){el.css("z-index",++jazz.config.zindex)});if(this.options.frameurl!=null){$("#"+this.frameId).load(function(){$("#"+$this.frameId).contents().find("body").bind("mousedown.iframe",function(e){$this.element.css("z-index",++jazz.config.zindex)})})}},_winCompSize:function(height){var h=0;if(this.toolbar){h=this.toolbar.outerHeight()}this.content.width("auto").outerHeight(height-this.titlebar.outerHeight()-h);if(this.options.frameurl!=null){var h=this.content.height();this.frameObject.width("100%").outerHeight(h).load(function(){$(this).width("100%").outerHeight(h)})}},close:function(trigger){if(this.options.taskbar instanceof jQuery){var id=$("#"+this.liId);if(id instanceof jQuery){id.remove()}}if(this.options.closestate==true){if(!trigger){this._event("beforeclose",null)}if(this.options.frameurl!=null){this.frameObject.attr("src","about:blank");try{var dom=this.frameObject.get(0);if(!jazz.isIE(8)){dom.contentWindow.document.write("")}dom.contentWindow.document.clear()}catch(e){this.frameObject.remove()}}this.element.remove();this.destroy();if(this.options.modal){this._disableModality()}if(!trigger){this._event("afterclose",null)}}else{this.element.hide();if(this.options.afterhidden){this._event("afterhidden",null)}if(this.options.modal){this._disableModality()}}},currentPage:function(url,align){var obj={url:url};this.pageParams.push(obj);this.pageindex=this.pageindex+1;this.slider("left",url);if(this.pageindex===1){this.customIconId="customIconId"+jazz.getRandom();var $this=this;this.addTitleButton([{id:this.customIconId,align:align,iconClass:"jazz-leftarrow-icon",click:function(e,ui){$this.previous()}}])}},next:function(){var index=this.pageindex+1;if(index!=this.pageParams.length){var obj=this.pageParams[index];if(!!obj){this.slider("right",obj.url);this.pageindex=this.pageindex+1}}},open:function(){this.element.css("z-index",++jazz.config.zindex);if(this.element.is(":visible")){return}this._event("beforeopen",null);if(!this.positionInitialized){this._initPosition()}this.element.show();var _url=this.options.frameurl;if(_url!=null){if(this.options.closestate==false){if(!this.frameObject.attr("src")){this.frameObject.attr("src",_url)}}else{this.frameObject.attr("src",_url)}}this._postShow();this._moveToTop();if(this.options.modal){this._enableModality()}if(this.options.taskbar instanceof jQuery){var s="";if(this.options.titleicon){s='style="background: url('+this.options.titleicon+') no-repeat center center "'}this.liId="li_id_"+jazz.getRandom();var id=this.options.id?this.options.id:this.options.name;$('<li id="'+this.liId+'" winid="'+id+'"><div><span class="jazz-portal-bottom-li-img" '+s+'></span><span class="jazz-portal-bottom-li-word">'+this.getTitle()+'</span><span class="jazz-portal-bottom-li-close"></span></div></li>').appendTo(this.options.taskbar)}},previous:function(){var index=this.pageindex-1;if(index>-1){var obj=this.pageParams[index];if(!!obj){this.slider("left",obj.url);this.pageindex=this.pageindex-1;if(this.pageindex===0){this.removeTitleButton("#"+this.customIconId)}}}},slider:function(align,url){if(!!url){var $this=this;this.content.loading();var margin={marginLeft:(0-parseInt(this.element.width()))};if(align=="right"){margin={marginLeft:parseInt(this.element.width())}}if(this.options.frameurl!=null){this.frameObject.animate(margin,200,null,function(){$this.frameObject.attr("src",url);$this.frameObject.load(function(){$this.content.loading("hide");$this.frameObject.css({marginLeft:0})})})}}},toggleMaximize:function(){if(this.minimized){this.toggleMinimize()}if(this.maximized){this._maxToResotre()}else{this._saveState();var winTop=this.state.windowScrollTop;var winLeft=this.state.windowScrollLeft;var page=this.getPageSize();var winHeight=page.windowHeight,winWidth=page.windowWidth;if(this.options.taskbar instanceof jQuery){winHeight=winHeight-this.options.taskbar.outerHeight()}this.element.addClass("jazz-window-maximized").outerWidth(winWidth).outerHeight(winHeight).offset({top:winTop,left:winLeft});this._winCompSize(winHeight);this.handlerIcons.find(".jazz-titlebar-icon-extlink").removeClass("jazz-titlebar-icon-extlink").addClass("jazz-titlebar-icon-newwin");this.maximized=true;this._event("maximize")}},toggleMinimize:function(){var animate=true,dockingZone=$(document.body).children(".jazz-window-docking-zone");if(this.maximized){if(this.options.maximizable){this.toggleMaximize()}animate=false}var $this=this;if(this.minimized){this._restoreState();this.content.show();this.handlerIcons.find(".jazz-titlebar-icon-plus").removeClass("jazz-titlebar-icon-plus").addClass("jazz-titlebar-icon-minus");this.minimized=false;if(this.options.resizable){this.resizers.show()}}else{this._saveState();if(this.options.taskbar instanceof jQuery){this.element.css({"margin-left":"-3000px"})}else{if(animate){this.element.effect("transfer",{to:dockingZone,className:"jazz-window-minimizing"},300,function(){$this._dock(dockingZone);var width=$this.handlerIcons1.width()*2;if($this.handlerIcons1.width()<$this.handlerIcons2.width()){width=$this.handlerIcons2.width()*2}$this.element.width(width+$this.titlebar.width()+40)})}else{this._dock(dockingZone);var width=$this.handlerIcons1.width()*2;if($this.handlerIcons1.width()<$this.handlerIcons2.width()){width=$this.handlerIcons2.width()*2}$this.element.width(width+$this.titlebar.width()+40)}}}}})});