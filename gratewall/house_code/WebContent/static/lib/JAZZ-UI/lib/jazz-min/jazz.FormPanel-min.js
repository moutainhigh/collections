(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Panel","form/jazz.form.TextField","form/jazz.form.TextareaField","form/jazz.form.ComboxField","form/jazz.form.ComboxTree","form/jazz.form.AutocompletecomboxField","form/jazz.form.ColorField","form/jazz.form.DateField","form/jazz.form.CheckboxField","form/jazz.form.RadioField","form/jazz.form.NumberField"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.formpanel",$.jazz.panel,{options:{vtype:"formpanel",layout:"table",layoutconfig:{cols:2,columnwidth:["50%","*"]},dataurl:null,dataurlparams:null,dataview:false,readonly:false,iscondition:false,searchlabel:"查询条件",conditionaddevent:null,conditiondeleteevent:null,conditionreseteevent:null},_create:function(){this._super();this.element.addClass("jazz-formpanel")},_init:function(){this._super();this.content.addClass("jazz-formpanel-content");if(this.options.iscondition){this.content.prepend("<div class='jazz-formpanel-condition'><div class='jazz-formpanel-title'><div class='jazz-formpanel-title-img'></div><div class='jazz-formpanel-title-name'>"+this.options.searchlabel+"</div></div><div class='jazz-formpanel-con-c'></div><div class='jazz-formpanel-con-btn jazz-formpanel-con-btn2'><div class='jazz-formpanel-btn-span'></div></div><div style='clear:both'></div></div>");this.isconobj=this.content.find(".jazz-formpanel-con-c");var $this=this;$.each(this.getChildrenComponent(),function(){var name=$(this).attr("name");$this.isconobj.append("<div class='jazz-formpanel-con' name='"+name+"_con' id='"+name+"_con'></div>")})}if(this.options.dataurl){this.reload()}if(this.options.layout=="auto"){this.content.css("overflow","hidden")}},_ajax:function(){var param={url:this.options.dataurl,params:this.options.dataurlparams,async:true,showloading:false,callback:this._callback};$.DataAdapter.submit(param,this)},_callback:function(data,sourceThis){var jsonData=data;var $this=sourceThis;if(jsonData&&jsonData.data){$.each($this.getChildrenComponent(),function(name,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj),f=$this._filterVtype(childtype);var value=jsonData.data[name];if(isInited&&f){$this._runChildSetValue(childtype,value,obj)}})}if($.isFunction($this.callbackfunction)){$this.callbackfunction.call($this)}},_dataview:function(){var $this=this;$.each(this.getChildrenComponent(),function(name,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj),f=$this._filterVtype(childtype);if(isInited&&f){$this._readonly($obj.data(childtype))}})},_filterVtype:function(vtype){if(vtype=="toolbar"||vtype=="button"||vtype=="gridpanel"){return false}else{return true}},_getProperties:function(type,name){if(!name){var formJson={};formJson.name=this.options.name;formJson.vtype="formpanel";var formdata={};var $this=this;$.each(this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj),f=$this._filterVtype(childtype);if(isInited&&f){formdata[childname]=$obj[childtype](type)}});formJson.data=formdata;return formJson}else{var value="";$.each(this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj);if(isInited&&name==childname){value=$obj[childtype](type)}});return value}},_readonly:function(comp){if(this.options.dataview==true||this.options.readonly==true){comp.options.readonly=true;comp._readonly()}else{comp.options.readonly=false;comp._readonly()}},_runChildSetValue:function(vtype,value,obj){if(vtype=="datefield"&&(value+"").length>10){value=value.substring(0,10)}var comp=$(obj).data(vtype);comp.setValue(value)},_setOption:function(key,value){switch(key){case"dataurlparams":this.options.dataurlparams=value;break;case"dataurl":this.options.dataurl=value;break;case"dataview":case"readonly":if(value==true||value=="true"){this.options.dataview=true;this.options.readonly=true}else{this.options.dataview=false;this.options.readonly=false}this._dataview();break}this._super(key,value)},_setCondition:function(obj){if(this.isconobj){var that=this;var conobj=this.isconobj.find("div[name='"+obj.options.name+"_con']");if(conobj.length>0){var v=obj.getValue(),t=obj.getText();if(!obj.options.multiple){conobj.empty();if(v){conobj.addClass("jazz-formpanel-con2");conobj.removeClass("jazz-formpanel-con-height");if(obj.options.label){conobj.append("&nbsp;"+obj.options.label+"：<div class='jazz-formpanel-con-t' value='"+v+"'>"+t+"<div class='jazz-formpanel-con-img'>&nbsp;&nbsp;</div></div>")}else{conobj.append("<div class='jazz-formpanel-con-t' value='"+v+"'>"+t+"<div class='jazz-formpanel-con-img'>&nbsp;&nbsp;</div></div>")}this._conditionclick();this._event("conditionaddevent",null)}}else{conobj.empty();var vj=v.split(","),tj=t.split(",");for(var i=0,len=vj.length;i<len;i++){if(vj[i]){if(i==0){conobj.addClass("jazz-formpanel-con2");conobj.removeClass("jazz-formpanel-con-height");if(obj.options.label){conobj.append("&nbsp;"+obj.options.label+"：<div class='jazz-formpanel-con-t' value='"+vj[i]+"'>"+tj[i]+"<div class='jazz-formpanel-con-img'>&nbsp;&nbsp;</div></div>")}else{conobj.append("<div class='jazz-formpanel-con-t' value='"+vj[i]+"'>"+tj[i]+"<div class='jazz-formpanel-con-img'>&nbsp;&nbsp;</div></div>")}this._conditionclick()}else{conobj.append("<div class='jazz-formpanel-con-t' value='"+vj[i]+"'>"+tj[i]+"<div class='jazz-formpanel-con-img'>&nbsp;&nbsp;</div></div>")}}if((i+1)==len){this._event("conditionaddevent",null)}}}$.each(conobj.find(".jazz-formpanel-con-img"),function(){var $this=$(this);$(this).on("click",function(){$this.parent().remove("");var cn=conobj.children().length;if(cn==0){conobj.removeClass("jazz-formpanel-con2");conobj.addClass("jazz-formpanel-con-height");conobj[0].innerHTML="";if(that.isconobj.find(".jazz-formpanel-con-t").length==0){var nobj=that.isconobj.next();nobj.off("click");nobj.addClass("jazz-formpanel-con-btn2")}obj.element.show()}var _value="";$.each(conobj.children(".jazz-formpanel-con-t"),function(i){if(i==0){_value=$(this).attr("value")}else{_value+=","+$(this).attr("value")}});obj.setValue(_value);that._event("conditiondeleteevent",null,{name:obj.options.name,num:cn})})})}}},_conditionclick:function(){var $this=this;var nobj=this.isconobj.next();nobj.removeClass("jazz-formpanel-con-btn2");nobj.off("click").on("click",function(){$this.reset();$this._conditionrest(nobj);$.each($this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");if(childtype&&childtype!="hiddenfield"){$(this).show()}});$this._event("conditionreseteevent",null)})},_conditionrest:function(nobj){$.each(this.isconobj.find(".jazz-formpanel-con"),function(){$(this).addClass("jazz-formpanel-con-height");$(this).empty();$(this).removeClass("jazz-formpanel-con2")});nobj.addClass("jazz-formpanel-con-btn2")},getValue:function(name){return this._getProperties("getValue",name)},getText:function(name){return this._getProperties("getText",name)},reload:function(data,callbackfunction){this.callbackfunction=callbackfunction;if(this.options.dataurl){this._ajax()}},reset:function(flag){$.each(this.getChildrenComponent(),function(i,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");if(childtype!="toolbar"&&childtype!="button"){if(!flag&&childtype=="hiddenfield"){return true}var isInited=jazz._isComponentInited($obj);if(isInited){$obj[childtype]("reset")}}})},setValue:function(name,value){if(name instanceof Object){this.options.data=name;this._callback(this.options.data,this)}else{$.each(this.getChildrenComponent(),function(childname,obj){var $obj=$(obj);var childtype=$obj.attr("vtype");var isInited=jazz._isComponentInited($obj);if(childname==name&&isInited){$this._runChildSetValue(childtype,value,obj)}})}},validate:function(){var flag=true;var subElements=this.element.find("div[vtype]");if(subElements.length==0){}else{subElements.each(function(index,element){var el=$(element);var vtype=el.attr("vtype"),$field=el.data(vtype);var options=$field.options;var rule=options.rule;if(rule&&vtype!="gridpanel"&&vtype!="hiddenfield"&&vtype!="checkboxfield"&&vtype!="radiofield"&&options.isrule){var msg=options.msg;var f=jazz.doTooltip($field,$field.getText(),rule,msg);if(f==false){flag=false;$field._validateStyle(f)}}})}return flag}})});