<!DOCTYPE html PUBLIC>
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="../../static/script/jazz.js" type="text/javascript"></script>
<script>
	function queryDef() {
		$('div[name="gridpanel"]').gridpanel('option', 'dataurl',rootPath+'/dictionaryList/query.do');
		$('div[name="gridpanel"]').gridpanel('query', [ 'formpanel']);
	}

	function reset() {
		$("#formpanel").formpanel('reset');
	}

	function editColumn(event,obj) {
		var data = obj.data;
		for(var i=0;i<data.length;i++){
			var htm = '<a href="javascript:void(0);" onclick="calledit(\''+data[i]["dmbId"]+'\')">'
				+ "编辑" + '</a>&nbsp;|&nbsp;<a href="javascript:void(0);" '
				+ 'onclick="details(\''+data[i]["dmbId"]+'\', \''+data[i]["dmbLx"]+'\')">'
				+ "明细" + '</a> ';
			data[i]["edit"] = htm; 
		}
		return data;
	}
	
	var winEdit;
	function calledit(dmbId) {
		winEdit = jazz.widget({
   	     vtype: 'window',
	   	     frameurl: './dictionary_edit.html?dmbId='+dmbId+'&update=true',
	  			name: 'win',
	  	    	title: '编辑',
	  	    	titlealign: 'center',
	  	    	titledisplay: true,
	  	        width: 900,
	  	        height: 550,
	  	        modal:true,
	  	        visible: true,
	  	      	resizable: true
	   		});

	}
	
	function addData(){
		winEdit = jazz.widget({
	   	     vtype: 'window',
	   	     frameurl: './dictionary_edit.html?update=false',
	  			name: 'win',
	  	    	title: '新增代码引索表',
	  	    	titlealign: 'center',
	  	    	titledisplay: true,
	  	        width: 900,
	  	        height: 550,
	  	        modal:true,
	  	        visible: true,
	  	      	resizable: true
	   		});
	}
	
	function publish(){
		var selected = $('div[name="gridpanel"]').gridpanel('getSelection');
		var msg = '';
		var components = null;
		if (selected == null || selected.length<1 ){
			msg = "是否将所有代码表数据更新到缓存？";
		} else if(selected.length>=1){
			msg = "是否将选中的代码表数据更新到缓存？";
			components = ['gridpanel'];
		}
		jazz.confirm(msg, function(){
			var params = {
					url : rootPath+'/dictionaryList/publish.do',
					components: components,
					callback : function(data, r, res) { 
						var back = res.getAttr("back");
						if (back == 'success'){
							jazz.info("更新成功");
						} else if(back=='nocache') {
							jazz.info("未开启缓存");
						} else {
							jazz.info("更新缓存失败");
						}
					}
				};
				$.DataAdapter.submit(params);
		}, function(){});
	}
	
	function deleteData(){
		var selected = $('div[name="gridpanel"]').gridpanel('getSelection');
		if (selected == null || selected.length<1 ){
			jazz.info("请选中至少一个目标");
		}else if(selected.length>=1){
			jazz.confirm("该操作将删除该代码表中所有数据，是否删除？", function(){
				var params = {
						url : rootPath+'/dictionaryList/delete.do',
						components: ['gridpanel'],
						callback : function(data, r, res) { 
							if (res.getAttr("back") == 'success'){
								queryDef();
								jazz.info("删除成功");
							}
						}
				}
				$.DataAdapter.submit(params);
			}, function(){})
		}
	}
	
	function details(dmbId , dmbLx){
		win = jazz.widget({
	   	     vtype: 'window',
	   	     frameurl: './dictionary_details.html?dmbId='+dmbId+'&dmbLx='+dmbLx,
	  			name: 'win',
	  	    	title: dmbId+'代码表数据',
	  	    	titlealign: 'center',
	  	    	titledisplay: true,
	  	        width: 1000,
	  	        height: 560,
	  	        modal:true,
	  	        visible: true,
	  	      	resizable: true
	   		});
		//var selected = $('div[name="gridpanel"]').gridpanel('getSelection');
		//alert(JSON.stringify(selected));
		//alert(selected[0]["dmbId"]);
		/* if(selected == null){
			jazz.info("请选中一个目标");
		}
		else if(selected.length>1){
			jazz.info("只能选中一个目标");
		} else {
			var dmbId = selected[0]["dmbId"];
			var dmbLx = selected[0]["dmbLx"];
		} */
		/*var params = {
				url : rootPath+'/page/details.do',
				components: ['gridpanel'],
				callback : function(data, r, res) { 
					if (res.getAttr("back") == 'success'){
						queryData();
						jazz.info("删除成功");
						parent.win.window("close");
					}
				}
		}
		$.DataAdapter.submit(params);*/
	}
</script>
</head>
<body>
	<div vtype="formpanel" id="formpanel" displayrows="1" name="formpanel" showborder="false"
		titledisplay="true" width="100%" layout="table" 
		layoutconfig="{cols:2, width: ['50%','*']}" title="代码表定义查询">

		<div name='dmbId' vtype="textfield" label="代码表ID" labelalign="right" width="90%" labelwidth="110"></div>
		<div name='dmbMc' vtype="textfield" label="代码表名称" labelalign="right" width="90%" labelwidth="110"></div>
		<div id="toolbar" name="toolbar" vtype="toolbar" location="bottom" align="center">
			<div name="query_button" vtype="button" text="查询"
				icon="../query/queryssuo.png" onclick="queryDef();"></div>
			<div name="reset_button" vtype="button" text="重置"
				icon="../query/queryssuo.png" click="reset();"></div>
		</div>
	</div>

	<div vtype="gridpanel" name="gridpanel" width="100%" datarender="editColumn" linenowidth="50" showborder="false"
		titledisplay="true" title="查询结果" dataurl="" layout="fit">
		<div name="toolbar" vtype="toolbar">
			<div name="add_button" vtype="button" text="新增"
				icon="../query/queryssuo.png" onClick="addData();"></div>
			<div name="delete_button" vtype="button" text="删除"
				icon="../query/queryssuo.png" onClick="deleteData();"></div>
			<!-- <div name="details_button" vtype="button" text="明细"
				icon="../query/queryssuo.png" onClick="details();"></div> -->
			<div name="publish_button" vtype="button" text="更新缓存"
				icon="../query/queryssuo.png" onClick="publish();"></div>
		</div>
		<!-- 表头 -->
		<div vtype="gridcolumn" name="grid_column" width="100%">
			<div>
				<!-- 单行表头 -->
				<div name='dmbMc' text="代码表名称" textalign="center" width='20%'></div>
				<div name='dmbId' text="代码表ID" textalign="center" width='10%'></div>
				<div name='sjccLx' text="存储类型" textalign="center" width='10%'
					dataurl='[{"text":"通用表","value":"1"},{"text":"独立表","value":"2"},{"text":"自定义SQL","value":"3"}]'></div>
				<div name='dmbLx' text="代码表类型" textalign="center" width='10%'
					dataurl='[{"text":"列表","value":"1"},{"text":"层次树","value":"2"},{"text":"父节点树","value":"3"}]'></div>
				<div name='hcLx' text="缓存类型" textalign="center" width='10%'
					dataurl='[{"text":"内存","value":"1"},{"text":"数据库","value":"2"}]'></div>
				<div name='qyBj' text="启用标记" textalign="center" width='20%'
					dataurl='[{"text":"启用","value":"1"},{"text":"停用","value":"0"}]'></div>
				<div name='edit' text="编辑" textalign="center" width='20%'></div>
			</div>
		</div>
		<!-- 表格 -->
		<!-- ../../grid/reg3.json -->
		<div vtype="gridtable" name="grid_table"></div>
		<!-- 分页 -->

		<div vtype="paginator" name="grid_paginator" theme="2" pagerows="10"></div>
	</div>


</body>
</html>