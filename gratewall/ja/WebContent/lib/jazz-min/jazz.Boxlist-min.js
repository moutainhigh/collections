(function($){$.widget("jazz.boxlist",$.jazz.boxComponent,{options:{vtype:"boxlist",width:150,height:180,dataurl:null,params:null,multiple:false,datarender:null,click:null,change:null,unclick:null,dblclick:null},_create:function(){this._super();this.element.addClass("jazz-boxlist-ul jazz-boxlist-content");this._width();this._height();this.listContainer=$('<ul class="jazz-listbox-list"></ul>').appendTo(this.element)},_init:function(){if(typeof(this.options.dataurl)=="object"){this._callback("1",this)}else{if(!!this.options.dataurl){this._ajax()}else{this._callback({},this)}}},_ajax:function(){param={url:this.options.dataurl,params:this.options.params,callback:this._callback};$.DataAdapter.submit(param,this)},_callback:function(data,sourceThis){var jsonData=null;var $this=null;if(data=="1"){jsonData=this.options.dataurl;$this=sourceThis}else{jsonData=data;$this=sourceThis}$this.arrayOption=[];if(!!jsonData&&!!jsonData.data){$this.arrayOption=jsonData.data}var optHtml="";var render="";for(var i=0;i<$this.arrayOption.length;i++){var choice=$this.arrayOption[i];var _text=$.trim(choice.text);if(!choice.text){_text=""}if(!!$this.options.datarender){render=eval($this.options.datarender).call(this,choice);optHtml+='<li class="jazz-boxlist-item jazz-boxlist-li">'+render+"</li>"}else{optHtml+='<li class="jazz-boxlist-item jazz-boxlist-li">'+_text+"</li>"}}$this.listContainer.append(optHtml);$this.items=$this.listContainer.find(".jazz-boxlist-item");$this._bindEvents()},_bindEvents:function(){var time=null;var $this=this;this.element.off().on("dblclick.boxlist",function(event){var target=event.target;var $target=$(target);if($target.is("li")){clearTimeout(time);var item=$target;if($this.options.multiple){item=$this._clickMultiple(event,item);$this._trigger("dblclick",null,item)}else{item=$this._clickSingle(event,item);$this._trigger("dblclick",null,item)}}}).on("click.boxlist",function(event){var target=event.target;var $target=$(target);if($target.is("li")){clearTimeout(time);var item=$target;time=setTimeout(function(){if($this.options.multiple){item=$this._clickMultiple(event,item);$this._trigger("click",null,item)}else{item=$this._clickSingle(event,item);$this._trigger("click",null,item)}},200)}})},_clickSingle:function(event,item){var selectedItem=this.items.filter(".jazz-boxlist-highlight");var itemIndex=item.index();var selectedIndex=selectedItem.index();if(itemIndex!==selectedIndex){if(selectedItem.length){this._unselectItem(selectedItem)}this._selectItem(item);if(selectedItem.length){this._changeTrigger(selectedItem,item)}else{this._changeTrigger(null,item)}}return this.arrayOption[itemIndex]},_clickMultiple:function(event,item){var itemIndex=item.index();if(this.items.eq(itemIndex).hasClass("jazz-boxlist-highlight")){this._unselectItem(item);this._trigger("unclick",null,item);this._changeTrigger(item,null)}else{this._selectItem(item);this._changeTrigger(null,item)}return this.getSelected()},_changeTrigger:function(oldItem,newItem){var changeItem={};if(!oldItem){var newIndex=newItem.index();changeItem.newObject=this.arrayOption[newIndex]}else{if(!newItem){var oldIndex=oldItem.index();changeItem.oldObject=this.arrayOption[oldIndex]}else{var newIndex=newItem.index();var oldIndex=oldItem.index();changeItem.newObject=this.arrayOption[newIndex];changeItem.oldObject=this.arrayOption[oldIndex]}}this._trigger("change",null,changeItem)},_selectItem:function(value){var item=null;if($.type(value)==="number"){item=this.items.eq(value)}else{item=value}item.addClass("jazz-boxlist-highlight").removeClass("jazz-boxlist-li")},_unselectItem:function(value){var item=null;if($.type(value)==="number"){item=this.items.eq(value)}else{item=value}item.addClass("jazz-boxlist-li").removeClass("jazz-boxlist-highlight")},reload:function(){this._init()},unselectAll:function(){this.items.removeClass("jazz-boxlist-highlight");this._trigger("change",null)},getSelected:function(){var selected=this.items.filter(".jazz-boxlist-highlight");var allSelected=[];var selectedIndex=null;for(var i=0;i<selected.length;i++){selectedIndex=selected.index();allSelected.push(this.arrayOption[selectedIndex])}return allSelected}})})(jQuery);