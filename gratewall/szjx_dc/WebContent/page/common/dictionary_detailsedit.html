<!DOCTYPE html PUBLIC>
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="../../static/script/jazz.js" type="text/javascript"></script>
<script>
	var codeTableEnName = jazz.util.getParameter("codeTableEnName");
	var update = jazz.util.getParameter("update");
	
	$(function() {
		
		var effectiveCode = jazz.util.getParameter("effectiveCode");
		if(effectiveCode == null){
			
		}else{
 			/* $('div[name="formpanel_edit"]').formpanel('option', 'dataurl',rootPath+
					'/dictionaryDetails/show.do?effectiveCode='+effectiveCode+'&codeTableEnName='+codeTableEnName); */
			//$('div[name="formpanel_edit"]').formpanel('reload');
			$('div[name="effectiveCode"]').textfield("option", "disabled", true); 
			var params = {
				url:rootPath+'/dictionaryDetails/show.do?effectiveCode='+effectiveCode+'&codeTableEnName='+codeTableEnName,
				callback : function(data, r, res) {
						$('div[name="effectiveCode"]').textfield("setValue",res.getAttr("effectiveCode"));	
						$('div[name="name"]').textfield("setValue",res.getAttr("name"));
						$('div[name="nameShort"]').textfield("setValue",res.getAttr("nameShort"));
						$('div[name="fCode"]').textfield("setValue",res.getAttr("fCode"));
						$('div[name="chooseMark"]').comboxfield("setValue",res.getAttr("chooseMark"));
							}
						};
				$.DataAdapter.submit(params);	

			
				
			}
	});
	
	function save(){
		//alert(codeTableEnName);
		var hiddenfield = $("div[name='hiddenfield']").hiddenfield('getValue');
		var effectiveCode = $("div[name='effectiveCode']").textfield('getValue');
		var name = $("div[name='name']").textfield('getValue');
		var nameShort = $("div[name='nameShort']").textfield('getValue');
		var fCode = $("div[name='fCode']").textfield('getValue');
		var shooseMark = $("div[name='shooseMark']").comboxfield('getValue');
		
		
		//alert(pkSysIntegration);
		if(effectiveCode == ''||name==''||nameShort==''||shooseMark==''){
			jazz.info("有必填选项未填写，添加失败");
		}else{
			var params = {
				url : rootPath+'/dictionaryDetails/save.do?codeTableEnName='+codeTableEnName+'&update='+update,
				components : [ 'formpanel_edit' ],
				
				callback : function(data, r, res) { 
					if (res.getAttr("back") == 'success'){
						jazz.info("保存成功");
						parent.query();
					} 
					else 
						jazz.info("代码表已经存在，添加失败");
					
					
				}
			};
			$.DataAdapter.submit(params);
		}
	}
	
	function back() {
		parent.winEdit.window("close");
	}

	
</script>
</head>
<body>
	<div id="formpanel_edit" name="formpanel_edit" vtype="formpanel"
		tableStyleClass="tablecss" titledisplay="false" showborder="false" width="100%"
		layout="table" layoutconfig="{cols:2, columnwidth: ['50%','*']}"
		dataurl="">
		<div name='hiddenfield' vtype='hiddenfield' width="350" ></div> 
		<div name='effectiveCode' vtype="textfield" label="代码" labelAlign="right"
			rule="must" width="350" labelwidth="100"></div>
		<div name='name' vtype="textfield" label="名称" labelAlign="right"
			rule="must" width="350" labelwidth="100"></div>
		<div name='nameShort' vtype="textfield" label="简称" labelAlign="right"
			rule="must" width="350" labelwidth="100"></div>
		<div name='fCode' vtype="textfield" label="父节点代码" labelAlign="right"
		    width="350" labelwidth="100"></div>
		<div name='chooseMark' vtype="comboxfield" label="选用标记" labelAlign="right" rule="must" 
			width="350" labelwidth="100" dataurl='[{"text":"选用","value":"0"},{"text":"停用","value":"1"}]'></div>
		
		<div id="toolbar" name="toolbar" vtype="toolbar" location="bottom" align="center">
			<div id="btn1" name="btn1" vtype="button" text="保存"
				icon="../../../style/default/images/save.png" click="save()"></div>
			<div id="btn2" name="btn2" vtype="button" text="返回"
				icon="../../../style/default/images/fh.png" click="back()"></div>
		</div>
	</div>

</body>
</html>