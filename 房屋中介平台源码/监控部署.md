

项目中细节把握？

细节决定成败。

问题出现后如何解决才是关键。

多实践，多爬坑。

大家分析问题和解决问题的思维能力(你们工作经验)





### Spring Boot Admin

Spring Boot Admin 是一个管理和监控你的 Spring Boot 应用程序的应用程序。 这些应用程序通过 Spring Boot Admin Client（通过 HTTP）注册或者使用 Spring Cloud（例如 Eureka）发现。UI只是 Spring Boot Actuator端点上的一个 AngularJs 应用程序。

Spring Boot Admin 是一个管理和监控 Spring Boot 应用程序的开源项目。分为admin-server 与 admin-client 两个组件，admin-server通过采集 actuator 端点数据，显示在spring-boot-admin-ui 上，已知的端点几乎都有进行采集，通过 spring-boot-admin 可以动态切换日志级别、导出日志、导出heapdump、监控各项指标 等等….

Spring Boot Admin 在对单一应用服务监控的同时也提供了集群监控方案，支持通过eureka、consul、zookeeper等注册中心的方式实现多服务监控与管理…

相关文档：http://codecentric.github.io/spring-boot-admin/current/

服务端：

引入依赖

```xml
<dependency>
    <groupId>de.codecentric</groupId>
    <artifactId>spring-boot-admin-starter-server</artifactId>
    <version>2.0.4</version>
</dependency>


<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-zookeeper-discovery</artifactId>
</dependency>
```

在主类添加注解

```
@EnableAdminServer
```

客户端:

引入依赖

```xml
<dependency>
    <groupId>de.codecentric</groupId>
    <artifactId>spring-boot-admin-starter-client</artifactId>
    <version>2.0.4</version>
</dependency>
```

添加配置项: spring.boot.admin.client.url=admin-server的地址



### Hystix 

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix-dashboard</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

```java
/**
     * 启用hystrix的/actuator/hystrix.stream地址映射
     * @return
     */
    @Bean
    public ServletRegistrationBean getServlet(){
        HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet();
        ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet);
        registrationBean.setLoadOnStartup(1);
        registrationBean.addUrlMappings("/actuator/hystrix.stream");
        registrationBean.setName("HystrixMetricsStreamServlet");
        return registrationBean;
    }


```



### Sleuth 

```xml
<dependency> 
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-sleuth</artifactId>
</dependency>
```

a -> b -> c -> d(扣库存) => 消耗的时间

监控

1. zipkin（https://zipkin.io/）

- 监控服务构建: (普通的springBoot项目)

```xml
<!--引入的zipkinServer依赖-->
<dependency>
    <groupId>io.zipkin.java</groupId>
    <artifactId>zipkin-server</artifactId>
    <version>2.9.4</version>
</dependency>
<dependency>
    <groupId>io.zipkin.java</groupId>
    <artifactId>zipkin-autoconfigure-ui</artifactId>
    <version>2.9.4</version>
</dependency>
```

配置内容：解决zipkin服务后台报错

```properties
management.metrics.web.server.auto-time-requests=false
```

- 启动类上加入@EnableZipkinServer注解启用zipkin服务

1. 在需要监控链路的服务里面加入下面依赖

   a、加入依赖

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-zipkin</artifactId>
</dependency>
```

​	b、配置项

```properties
spring:
  zipkin:
    base-url: http://localhost:7777 # zipkin服务地址
    sleuth:
      sampler:
        probability: 1 # 抽样百分比
    sender:
      type: web # 链路类型（kafka,rabbitmq）
```

