(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Container","jazz.Toolbar"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.panel",$.jazz.container,{options:{vtype:"panel",bgcolor:null,buttons:null,closable:false,collapsable:false,customtitlebutton:null,framename:"",frameurl:null,showborder:true,titledisplay:false,title:"",titlealign:"left",titleicon:null,titlebuttonalign:"right",toggleable:false,toggleorientation:"vertical",beforeclose:null,afterclose:null,beforecollapse:null,aftercollapse:null,beforeexpand:null,afterexpand:null},_create:function(){this._super();this.compId=this.getCompId();var title=this.element.attr("title");if(title){this.element.removeAttr("title")}this.element.css("overflow","hidden").addClass("jazz-panel");this._createPanelElement()},_init:function(){this._super();var isrefresh=false;var parent=this.element.parent();if(this.isScrollX(parent)||this.isScrollY(parent)){isrefresh=true}this._showborder();this._title();this._titleButton();this._closable();this._customTitleButton();this._toggleable();this._titledisplay();this._bgcolor();this._width();this._buttons();this._height();this._frameurl();this.doLayout(this.content);if(this.options.content){this._createContent(this.content)}if(this.options.items){this._createItems(this.content)}this._collapsable();if(this.isScrollX(parent)||this.isScrollY(parent)){isrefresh=true}if(isrefresh){var pcom=this.getParentComponent();pcom.attr("refresh","1")}},_bgcolor:function(){if(this.options.bgcolor!=null){this.content.css("background",this.options.bgcolor)}},_buttons:function(){var buttons=this.options.buttons;if($.isArray(buttons)){if(this.toolbar){this.toolbar.remove()}this.toolbar=$("<div>").appendTo(this.element);for(var i=0,len=buttons.length;i<len;i++){buttons[i]["vtype"]="button"}this.toolbar.addClass("jazz-panel-toolbar").toolbar({items:buttons})}},_closable:function(){if(this.options.closable){var $this=this;var a=this.titlebar.find(".jazz-panel-titlebar-close");if(a.hasClass("jazz-panel-titlebar-close")){a.remove()}var obj=this._renderTitleButton("jazz-panel-titlebar-close","jazz-titlebar-icon-close");obj.off("click.panelclose").on("click.panelclose",function(e){$this.close();e.preventDefault()})}else{this.titlebar.find(".jazz-panel-titlebar-close").remove()}},_collapsable:function(){if(this.options.toggleable){if(this.options.collapsable){this.collapse()}}},_createPanelElement:function(){var compId=this.compId,el=this.element,vtype=this.options.vtype;var div=[];div.push('<div id = "');div.push(compId);div.push('_content" class="jazz-panel-content"></div>');el.wrapInner(div.join(""));div=[];div.push('<div id = "'+compId+'_titlebar" class="jazz-panel-titlebar jazz-panel-header jazz-');div.push(vtype);div.push('-titlebar" style="text-align: left;"><div id="');div.push(compId);div.push('_titlebar_inner" class="jazz-');div.push(vtype);div.push('-titlebar-inner" style="width:100%; height:100%"></div></div>');el.prepend(div.join(""));this.titlebar=$("#"+compId+"_titlebar");this.titlebarInner=$("#"+compId+"_titlebar_inner");this.content=$("#"+compId+"_content");if(this.options.content){this.content.append(this.options.content)}},_compSize:function(){this._width();this._height()},_customTitleButton:function(){var ctb=this.options.customtitlebutton;if(ctb){if(!$.isArray(ctb)){ctb=jazz.stringToJson(ctb)}var $this=this;$.each(ctb,function(i,handler){var customIcons=$this.handlerIcons1;if(handler.align=="right"||handler.vtype){customIcons=$this.handlerIcons2}$this._customIcon(handler,customIcons,handler.icon)})}},_customIcon:function(handler,handlerIcons,icon,iconClass){var $this=this;var f="float: left";if(handler.align=="right"){f="float: right"}if(!iconClass){iconClass=""}if(icon){icon="style=\"background: url('"+icon+"') no-repeat\""}else{icon=""}var id=handler.id||"c_btn_"+jazz.getRandom();var c=$('<a id="'+id+'" class="jazz-panel-titlebar-icon jazz-panel-titlebar-custom" style="'+f+'"></a>').appendTo(handlerIcons);var vtype=handler.vtype;if(vtype){var btnobj=$('<div name="'+handler.name+'"></div>');$("#"+id).append(btnobj);btnobj[vtype](handler)}else{$("#"+id).append("<span "+icon+' class="jazz-titlebar-icon jazz-titlebar-icon-custom '+iconClass+' " />')}c.on("click",function(e){if($.isFunction(handler.click)){handler.click.call(this,e,{object:$this,element:$this.element})}})},_frameurl:function(){if(this.options.frameurl!=null){this.content.empty();var framename=this.options.framename;if(framename){this.frameId=framename}else{var name=this.options.name;if(name){this.frameId="frame_"+name}else{this.frameId="frame_"+jazz.getRandom()}}var width=this.content.width(),height=this.content.height();if(this.options.height=="auto"){height="auto"}this.frameObject=$('<iframe name="'+this.frameId+'" id="'+this.frameId+'" frameBorder="0"></iframe>');this.displayDiv=$('<div style="display:none; width:100%; height:100%; background:#FFFFFF;"></div>').appendTo(this.content);this.content.css("overflow","hidden").append(this.frameObject);this.frameObject.css({width:width,height:height}).attr("src",this.options.frameurl||"");this.pageParams=[];this.pageParams.push({url:this.options.frameurl})}},_height:function(forcecalculate){var layout=this.options.layout,height=this.options.height;if(layout!="fit"){if(layout=="border"&&height!="auto"){this.options.height="100%"}if(height==-1){height="auto"}if(height!="auto"){this._super(forcecalculate);if(this.iscalculateheight){var h=0;if(this.toolbar&&this.options.vtype!="gridpanel"){h=this.toolbar.outerHeight(true)}var titleHeight=0;if(this.options.titledisplay){titleHeight=this.titlebar.outerHeight(true)}this.content.outerHeight(this.options.calculateinnerheight-titleHeight-h,true)}if(this.options.frameurl!=null&&this.frameObject){this.frameObject.height(this.content.height())}}else{this.element.height("auto");this.content.css("overflow","hidden").height("auto");if(this.options.frameurl!=null&&this.frameObject){this.frameObject.height("auto")}}}},_titleButton:function(){var icon_width="";if(jazz.isIE(7)||jazz.isIE(6)){icon_width+="width:100px"}this.handlerIcons1=$('<span class="jazz-panel-rtl-left" style="'+icon_width+'"></span>').appendTo(this.titlebarInner);this.handlerIcons2=$('<span class="jazz-panel-rtl-right" style="'+icon_width+'"></span>').appendTo(this.titlebarInner);var handlerIcons=this.handlerIcons1;if(this.options.titlebuttonalign=="right"){handlerIcons=this.handlerIcons2}this.handlerIcons=handlerIcons},_titledisplay:function(){if(!this.options.titledisplay){this.titlebar.css("display","none")}else{this.titlebar.css("display","")}},_panelFitCallback:function($this){var h=0;if($this.toolbar){h=$this.toolbar.outerHeight(true)}if($this.options.titledisplay){$this.content.outerHeight($this.element.height()-$this.titlebar.outerHeight(true)-h,true)}else{$this.content.outerHeight($this.element.height()-h,true)}if($this.options.frameurl){$this.content.css({overflow:"hidden"});if($this.options.frameurl!=null){$this.frameObject.outerHeight($this.content.height(),true)}}if($this.options.vtype=="gridpanel"&&$this.options.layout=="fit"){$this._height()}else{var y=$this.content.css("overflow-y");$this.content.css("overflow-y","hidden");this._reflashChildHeight();$this.content.css("overflow-y",y)}},_renderTitleButton:function(styleClass,icon,id){var f="float:"+this.options.titlebuttonalign;var _id=id?'id="'+id+'"':"";var obj=$("<a "+_id+' class="jazz-panel-titlebar-icon '+styleClass+'" style="'+f+'" ><span class="jazz-titlebar-icon '+icon+'"></span></a>');if("jazz-panel-titlebar-close"==styleClass){if(this.options.titlebuttonalign=="left"){this.handlerIcons.append(obj)}else{this.handlerIcons.prepend(obj)}}else{this.handlerIcons.append(obj)}return obj},_setOption:function(key,value){switch(key){case"title":this.options.title=value;this.title.html(value);break;case"titlealign":this.options.titlealign=value;this.titlebar.css({"text-align":value});break;case"titleicon":this.options.titleicon=value;this.title.css({background:'url("'+value+'")',"background-repeat":"no-repeat","padding-left":"22px"});break;case"bgcolor":this.options.bgcolor=value;this.content.css("background-color",value);break;case"toggleable":this.options.toggleable=value;this._toggleable();if(this.options.collapsable){this.collapse()}else{this.expand()}break;case"collapsable":if(this.options.toggleable){if(value=="true"||value==true){this.collapse()}else{this.expand()}}else{this.options.collapsable=value}break;case"titlebuttonalign":var align=value=="left"?"left":"right";if(align==="left"){if(this.options.titlebuttonalign=="right"){this.handlerIcons1.append(this.handlerIcons2.contents());this.handlerIcons2.empty();this.handlerIcons=this.handlerIcons1}}else{if(this.options.titlebuttonalign=="left"){this.handlerIcons2.append(this.handlerIcons1.contents());this.handlerIcons1.empty();this.handlerIcons=this.handlerIcons2}}this.options.titlebuttonalign=align;break;case"customtitlebutton":this.options.customtitlebutton=value;this._customTitleButton();break;case"closable":if(value=="true"||value==true){this.options.closable=true}else{this.options.closable=false}this._closable();break;case"showborder":if(value=="true"||value==true){this.options.showborder=true}else{this.options.showborder=false}this._showborder();this._compSize();break;case"frameurl":if(this.options.frameurl==null){this.options.frameurl=value;this._frameurl()}else{this.options.frameurl=value;this.frameObject.attr("src",value)}break;case"titledisplay":this.options.titledisplay=value;this._compSize();this._titledisplay();break;case"buttons":var b=this.options.buttons;this.options.buttons=value;this._buttons();if(b==null){this._compSize()}break}this._super(key,value)},_slideUp:function(){this._event("beforecollapse");if(this.options.calculateinnerheight!=-1){this.content_height=this.content.height();this.element.height("auto")}this.content.css("display","none");this._event("aftercollapse");this.options.collapsable=true},_slideDown:function(){this._event("beforeexpand");if(this.options.calculateinnerheight!=-1){this.element.height(this.options.calculateinnerheight);this.content.height(this.content_height)}this.content.css("display","block");this._event("afterexpand");this.options.collapsable=false},_slideLeft:function(){var $this=this;this.originalWidth=this.options.calculateinnerwidth;this.title.hide();this.toggler.hide();this.content.hide();this.element.animate({width:"42px"},this.options.toggleSpeed,"easeInOutCirc",function(){$this.toggler.show();$this.element.addClass("jazz-panel-collapsed-h");$this.options.collapsable=!$this.options.collapsable})},_slideRight:function(){var $this=this,expandWidth=this.originalWidth||"100%";this.toggler.hide();this.element.animate({width:expandWidth},this.options.toggleSpeed,"easeInOutCirc",function(){$this.element.removeClass("jazz-panel-collapsable-h");$this.title.show();$this.toggler.show();$this.options.collapsable=!$this.options.collapsable;$this.content.css({visibility:"visible",display:"block",height:"auto"})})},_showborder:function(){if(this.options.showborder){this.element.addClass("jazz-panel-border")}else{this.element.removeClass("jazz-panel-border")}},_title:function(){var title=this.options.title||"";this.titlebarInner.children().remove();var titleicon="";if(this.options.titleicon){titleicon="style=\"background: url('"+this.options.titleicon+"') no-repeat; padding-left: 22px; \""}var tfontclass="jazz-panel-title-font jazz-"+this.options.vtype+"-title-font";if(this.options.titlealign){this.titlebar.css({"text-align":this.options.titlealign})}this.titlebarInner.append('<span id="'+this.compId+'_title" class="'+tfontclass+'" '+titleicon+" >"+title+"&nbsp;</span>");this.title=$("#"+this.compId+"_title")},_toggleable:function(){var $this=this;if(this.options.toggleable){var icon=this.options.collapsable?"jazz-titlebar-icon-expand":"jazz-titlebar-icon-collapse";this.titlebar.find("#toggleableId").remove();this.toggler=this._renderTitleButton("",icon,"toggleableId");this.toggler.off("click.toggler").on("click.toggler",function(e){if($this.options.collapsable){$this.expand()}else{$this.collapse()}e.preventDefault()})}else{this.titlebar.find("#toggleableId").remove()}},_width:function(forcecalculate){this._super(forcecalculate);if(this.iscalculatewidth){this.content.outerWidth(this.options.calculateinnerwidth,true);if(this.options.titledisplay){this.titlebar.width("auto")}if(this.options.frameurl!=null&&this.frameObject){this.frameObject.width(this.content.width())}}},addTitleButton:function(handlers){var $this=this;if($.isArray(handlers)){$.each(handlers,function(i,handler){var customIcons=$this.handlerIcons1;if(handler.align=="right"){customIcons=$this.handlerIcons2}$this._customIcon(handler,customIcons,handler.icon,handler.iconClass)})}},close:function(){var $this=this;this._event("beforeclose",null);this.element.fadeOut("normal",function(){$this._event("afterclose",null)})},collapse:function(){this.toggler.children("span.jazz-titlebar-icon").removeClass("jazz-titlebar-icon-collapse").addClass("jazz-titlebar-icon-expand");if(this.options.toggleorientation==="vertical"){this._slideUp()}else{if(this.options.toggleorientation==="horizontal"){this._slideLeft()}}},expand:function(){this.toggler.children("span.jazz-titlebar-icon").removeClass("jazz-titlebar-icon-expand").addClass("jazz-titlebar-icon-collapse");if(this.options.toggleorientation==="vertical"){this._slideDown()}else{if(this.options.toggleorientation==="horizontal"){this._slideRight()}}},getTitle:function(){return this.options.title},hideTitleButton:function(r){$(r+"").hide()},iframeSrcHandler:function(src){if(this.frameObject){this.content.loading();this.frameObject.attr("src",src);var $this=this;this.frameObject.load(function(){$this.content.loading("hide")})}},open:function(){var $this=this;this._event("beforeopen",null);this.element.fadeIn("normal",function(){$this._event("afteropen",null)})},removeTitleButton:function(r){$(r+"").remove()},showTitleButton:function(r){$(r+"").show()}})});