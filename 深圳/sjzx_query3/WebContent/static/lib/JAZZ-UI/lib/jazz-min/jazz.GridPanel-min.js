(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.Paginator","jazz.Loading","jazz.DataFormat","jazz.Panel"],factory)}else{factory($)}})(jQuery,function($){(function($,undefined){jazz.namespace("grid");$.widget("jazz.gridpanel",$.jazz.panel,{options:{vtype:"gridpanel",name:null,dataurl:null,dataurlparams:null,iseditable:false,isshoweditcell:false,editortype:"cell",isshowselecthelper:true,isshowtoolbar:true,isshowpaginator:true,defaultview:"table",lineno:true,linenowidth:30,linetype:0,linestyle:1,rowselectable:true,selecttype:2,datarender:null,dataloadcomplete:null,queryparams:{},sortparams:{},items:null,isgroupsummary:false,ispagesummary:false,groupfield:null,grouptitlefield:null,isgroupexpand:true},_create:function(){this.originHtml=this.element[0].outerHTML;this._super();this.element.addClass("jazz-gridpanel");this.content.css("overflow","hidden")},_init:function(){this.isGridPanelAlreadyInit=false;this._super();if(!this.options.items||this.options.items.length==0){this._createContent(this.content)}this.gtoolbar=this.getChildrenComponentByVtype("toolbar");this.gcolumn=this.getChildrenComponentByVtype("gridcolumn");this.gtable=this.getChildrenComponentByVtype("gridtable");this.gcard=this.getChildrenComponentByVtype("gridcard");this.gpaginator=this.getChildrenComponentByVtype("paginator");this._extendGridpanelFunctions();this._settingGridpanelComponentView();this.paginationInfo={};this.rows=[];this._initLoadData()},_extendGridpanelFunctions:function(){if(this.gtable){var gtable=this.gtable.data("gridtable");if(gtable&&gtable._isGridtableEditable()){$.extend(this,jazz.grid.editorgridpanel)}}},_settingGridpanelComponentView:function(){if(this.options.isshowtoolbar==false||this.options.isshowtoolbar=="false"){if(this.gtoolbar){this.gtoolbar.hide()}}if(this.options.isshowpaginator==false||this.options.isshowpaginator=="false"){if(this.gpaginator){this.gpaginator.hide()}}this._settingPageareaHeight();if(this.options.defaultview=="card"){if(this.gcolumn){this.gcolumn.hide()}if(this.gtable){this.gtable.hide()}}else{if(this.gcard){this.gcard.hide()}}},_height:function(){this._super();if(this.isGridPanelAlreadyInit){this._settingPageareaHeight()}else{this.isGridPanelAlreadyInit=true}},_settingPageareaHeight:function(){if(parseInt(this.options.height)>0||this.options.layout=="fit"){var toolbarheight=0;if(this.gtoolbar&&this.gtoolbar.is(":visible")){toolbarheight=this.gtoolbar.outerHeight(true)||0}var gridcolumnheight=0;if(this.gcolumn&&this.gcolumn.is(":visible")){gridcolumnheight=this.gcolumn.outerHeight(true)||0}var paginatorheight=0;if(this.gpaginator&&this.gpaginator.is(":visible")){paginatorheight=this.gpaginator.outerHeight(true)||0}var pagearea=this.element.find(".jazz-pagearea");var h=0;if(pagearea[0]){if(this.options.defaultview=="card"){h=this.content.height()-toolbarheight-paginatorheight;pagearea.height(h)}else{h=this.content.height()-toolbarheight-gridcolumnheight-paginatorheight;pagearea.height(h)}}}else{}},_getGridOptions:function(){return this.options},getToolbar:function(){return this.gtoolbar},getGridColumn:function(){return this.gcolumn},getGridTable:function(){return this.gtable},getGridCard:function(){return this.gcard},getPaginator:function(){return this.gpaginator},recalculateGridpanelWidth:function(){this._width();this._reflashLayout();this._reflashChildWidth();this._height();this._reflashLayout();this._reflashChildHeight()},showColumn:function(columnname){this.gcolumn.gridcolumn("showColumn",columnname)},hideColumn:function(columnname){this.gcolumn.gridcolumn("hideColumn",columnname)},showView:function(viewname){var $this=this;var hideheader=$this.gcolumn.data("gridcolumn").options.hideheader;var gridcolumnheight=0;if(!hideheader||hideheader=="false"){gridcolumnheight=$this.gcolumn.outerHeight(true)||0}var display="";if(viewname=="card"){display=$this.gcard.css("display");if(display=="none"){if(parseInt($this.options.height)>0||$this.options.layout=="fit"){$this.gcard.parent().height($this.gcard.parent().height()+gridcolumnheight)}$this.gcard.parent().css({overflow:"auto"});if(!hideheader||hideheader=="false"){$this.gcolumn.hide()}$this.gtable.hide();$this.gcard.show()}}else{display=$this.gtable.css("display");if(display=="none"){if(parseInt($this.options.height)>0||$this.options.layout=="fit"){$this.gcard.parent().height($this.gcard.parent().height()-gridcolumnheight)}$this.gcard.parent().css({overflow:"hidden"});if(!hideheader||hideheader=="false"){$this.gcolumn.show()}$this.gtable.show();$this.gcard.hide()}}},destroyComp:function(){if(this.gtoolbar){var toolbar=this.gtoolbar.data("toolbar");toolbar.destroy()}if(this.gcolumn){var gridcolumn=this.gcolumn.data("gridcolumn");gridcolumn.destroy()}if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.destroy()}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.destroy()}if(this.gpaginator){var paginator=this.gpaginator.data("paginator");paginator.destroy()}this.element.replaceWith(this.originHtml);this.destroy()},setEditorCell:function(rowIndex,colIndex,editState){var rowIndex=parseInt(rowIndex);var colIndex=parseInt(colIndex);var editState=editState==true||editState=="true";if(rowIndex>0||colIndex>0){if(this.gtable){this.gtable.gridtable("setEditorCell",rowIndex,colIndex,editState)}}},addRow:function(data){if(data){this._setRowUUID(data);this.rows=this.rows.concat(data);data=$.extend(true,[],data);var $this=this;this._code2DataRenderGridpanel(data,function(rowdata){$this._processGridpanelData(rowdata);if($this.gtable){var gridtable=$this.gtable.data("gridtable");gridtable.addRow(rowdata)}if($this.gcard){var gridcard=$this.gcard.data("gridcard");gridcard.addCard(rowdata)}})}},updateRow:function(data){var rowuuid=data.rowuuid;if(!rowuuid){return null}this._updateTableAndCardById(data,rowuuid,"rowuuid")},updateRowById:function(data,id){if(!id){return null}var keyColumn=this._getGridcolumnKeyCode();if(!keyColumn){return null}this._updateTableAndCardById(data,id,keyColumn)},updateRowByIndex:function(data,rowIndex){var id=this._getRowUUIDByRowIndex(rowIndex);if(!id){return null}this._updateTableAndCardById(data,id,"rowuuid")},_updateTableAndCardById:function(data,id,keyColumn){var row=null;for(var i=0,len=this.rows.length;i<len;i++){if(this.rows[i][keyColumn]==id){for(var key in data){this.rows[i][key]=data[key]}row=$.extend(true,{},this.rows[i]);break}}if(!row){return null}var rowarr=[];rowarr.push(row);var $this=this;this._code2DataRenderGridpanel(rowarr,function(rowdata){$this._processGridpanelData(rowdata);if($this.gtable){var gridtable=$this.gtable.data("gridtable");gridtable.updateRowById(rowdata[0],rowdata[0]["rowuuid"])}if($this.gcard){var gridcard=$this.gcard.data("gridcard");gridcard.updateCardById(rowdata[0],rowdata[0]["rowuuid"])}})},_code2DataRenderGridpanel:function(rowsdata,fn){var $this=this;var cols=null,toCodeColumn=null;if($this.gcolumn){var gridcolumn=$this.gcolumn.data("gridcolumn");cols=gridcolumn.cols;toCodeColumn=gridcolumn.toCodeColumn;toCodeColumn=$this._combinedStaticAndUrlValueSet(toCodeColumn)}if(toCodeColumn&&toCodeColumn.length>0){$this._code2DataComplete(100,5000,rowsdata,toCodeColumn,function(data){fn(data)})}else{fn(rowsdata)}},getAllData:function(){return this.rows||[]},getRow:function(rowIndex){rowIndex=parseInt(rowIndex)+1;var data=this.getRowDataByIndex(rowIndex);return data},getRowLength:function(){return this.rows?this.rows.length:0},getRowDataById:function(id){if(!id){return null}var keyColumn=this._getGridcolumnKeyCode();if(!keyColumn){return null}var data=null;var ids=[];ids.push(id);data=this._getRowdataByKey(ids,keyColumn,"singleobject");return data},getRowDataByIndex:function(index){var id=this._getRowUUIDByRowIndex(index);if(!id){return null}var $this=this;var data=null;if(id){var ids=[];ids.push(id);data=$this._getRowdataByKey(ids,"rowuuid","singleobject")}return data},_getRowUUIDByRowIndex:function(index){var $this=this;var id=null;if($this.gtable){var tds=$this.gtable.find("td.jazz-grid-cell-no");for(var i=0,len=tds.length;i<len;i++){var lineno=$(tds[i]).html();if(parseInt(lineno)==parseInt(index)){id=$(tds[i]).parent().attr("id");break}}}return id},_getRowUUIDByKeyCode:function(dataId){var keyColumn=this._getGridcolumnKeyCode();if(!keyColumn){return null}var ids=[],rowuuid=null;ids.push(dataId);var data=this._getRowdataByKey(ids,keyColumn,"singleobject");if(data){rowuuid=data.rowuuid}return rowuuid},removeRow:function(data){var rowuuid=data.rowuuid;if(!rowuuid){return null}var data=this._removeTableAndCardById(rowuuid,"rowuuid");return data},removeRowById:function(id){if(!id){return null}var keyColumn=this._getGridcolumnKeyCode();if(!keyColumn){return null}var data=this._removeTableAndCardById(id,keyColumn);return data},removeRowByIndex:function(index){var id=this._getRowUUIDByRowIndex(index);if(!id){return null}var data=this._removeTableAndCardById(id,"rowuuid");return data},_removeTableAndCardById:function(id,keyColumn){if(!id){return null}var data=this._removeRowdataByKey(id,keyColumn);if(data&&data.rowuuid){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.removeRowById(data.rowuuid)}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.removeCardById(data.rowuuid)}}return data},getSelection:function(){var $this=this;var data=null;data=$this.getSelectedRowData();return data||[]},getSelectedRowData:function(){var $this=this;var data=null;var rowuuids=$this._getSelectedRowId();data=$this._getRowdataByKey(rowuuids,"rowuuid")||[];if(data){var trId="",no="";for(var i=0,len=data.length;i<len;i++){if($this.gtable){trId=data[i]["rowuuid"];no=$this.gtable.find("#"+trId+" td.jazz-grid-cell-no").html();data[i]["lineNo"]=no||""}else{data[i]["lineNo"]=""}}}return data},_getSelectedRowId:function(){var $this=this;var idArray=[],id=null;if($this.gtable){var trs=$this.gtable.find("tr[aria-selected=true]");for(var i=0,len=trs.length;i<len;i++){id=$(trs[i]).attr("id");if(id){idArray.push(id)}}}else{if($this.gcard){var cards=$this.gcard.find("div.jazz-grid-cardcell[aria-selected=true]");for(var i=0,len=cards.length;i<len;i++){id=$(cards[i]).attr("id");if(id){idArray.push(id)}}}}return idArray},_getRowdataByKey:function(ids,key,returnDataType){var $this=this,data=[];if(!ids||ids.length==0||!key){return null}var num=ids.length;for(var i=0,len=$this.rows.length;i<len;i++){if(num==0){break}for(var j=0;j<ids.length;j++){if($this.rows[i][key]==ids[j]){data.push($this.rows[i]);num=num-1;break}}}return returnDataType=="singleobject"&&data.length==1?data[0]:data},_removeRowdataByKey:function(id,key){var $this=this,data=null;if(!id||!key){return data}for(var i=0,len=$this.rows.length;i<len;i++){if($this.rows[i][key]==id){data=$this.rows[i];delete $this.rows[i];break}}for(var j=0,ln=$this.rows.length;j<ln;j++){if(!$this.rows[j]){$this.rows.splice(j,1)}}return data},getSelectedRowDataById:function(id){if(!id){return null}var data=null;var ids=[];ids.push(id);data=this._getRowdataByKey(ids,"rowuuid","singleobject");return data},selectRow:function(id){this.selectRowById(id)},unselectRow:function(id){this.unselectRowById(id)},selectRowById:function(id){if(!id){return}var rowuuid=this._getRowUUIDByKeyCode(id);if(rowuuid){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.selectRow(rowuuid)}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.selectRow(rowuuid)}}},selectRowByIndex:function(index){},unselectRowById:function(id){if(!id){return}var rowuuid=this._getRowUUIDByKeyCode(id);if(rowuuid){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.unselectRow(rowuuid)}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.unselectRow(rowuuid)}}},unselectRowByIndex:function(index){},selectAllRows:function(){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.selectAllRows()}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.selectAllRows()}},unselectAllRows:function(){if(this.gtable){var gridtable=this.gtable.data("gridtable");gridtable.unselectAllRows()}if(this.gcard){var gridcard=this.gcard.data("gridcard");gridcard.unselectAllRows()}},_initLoadData:function(){var $this=this;if($this.options.isshowpaginator||$this.options.isshowpaginator=="true"){if($this.gpaginator){var paginator=$this.gpaginator.data("paginator");var pagerows=0;if(paginator){pagerows=paginator.options.pagerows||0}else{pagerows=$this.gpaginator.attr("pagerows")||0}$this.paginationInfo.pagerows=parseInt(pagerows)}}if($this.options.dataurl){$this.element.find(".jazz-pagearea").loading();var params={url:$this.options.dataurl,params:$this.options.dataurlparams,pageparams:$this.paginationInfo,showloading:false,callback:function(responseText,$this){$this._successLoadData("init",responseText,null,null)}};$.DataAdapter.submit(params,$this)}},_successLoadData:function(loadDataType,responseText,requestdatacomplete,isRebindPaginator){var $this=this;if(responseText&&typeof(responseText)=="object"){var dataObj=responseText.data;if(dataObj){$this.paginationInfo.page=dataObj.page||1;$this.paginationInfo.pagerows=dataObj.pagerows||10;$this.paginationInfo.totalrows=dataObj.totalrows||0;$this.rows=dataObj.rows;if($this.rows){$this._setRowUUID($this.rows);var rowsdata=$.extend(true,[],$this.rows);var cols=null,toCodeColumn=null;if($this.gcolumn){var gridcolumn=$this.gcolumn.data("gridcolumn");cols=gridcolumn.cols;toCodeColumn=gridcolumn.toCodeColumn;toCodeColumn=$this._combinedStaticAndUrlValueSet(toCodeColumn)}if(toCodeColumn&&toCodeColumn.length>0){$this._code2DataComplete(100,5000,rowsdata,toCodeColumn,function(data){if(loadDataType=="init"){$this._renderGridpanelData(data)}else{$this._requestLoadData(data,requestdatacomplete,isRebindPaginator)}})}else{if(loadDataType=="init"){$this._renderGridpanelData(rowsdata)}else{$this._requestLoadData(rowsdata,requestdatacomplete,isRebindPaginator)}}}}}try{$this.element.find(".jazz-pagearea").loading("hide")}catch(e){jazz.log(e)}},_setRowUUID:function(data){var $this=this;if(data){for(var i=0,len=data.length;i<len;i++){data[i]["rowuuid"]=Math.uuid(32)}}},_getGridcolumnKeyCode:function(){var $this=this;var keyColumn=null;if($this.gcolumn){var gridcolumn=$this.gcolumn.data("gridcolumn");keyColumn=gridcolumn.keyCode}return keyColumn},_processGridpanelData:function(rowsdata){if(this.gcolumn){var gridcolumn=this.gcolumn.data("gridcolumn");cols=gridcolumn.cols;var data=null,columnname="",datatype="",dataformat="";for(var i=0,rowslen=rowsdata.length;i<rowslen;i++){data=rowsdata[i];for(var j=0,len=cols.length;j<len;j++){columnname=cols[j]["columnname"];datatype=cols[j]["datatype"];dataformat=cols[j]["dataformat"];if(datatype&&data[columnname]!=undefined){data[columnname]=jazz.util.parseDataByDataFormat({cellvalue:data[columnname],datatype:datatype,dataformat:dataformat})}}}}this._event("datarender",null,{data:rowsdata})},_renderGridpanelData:function(rowsdata){var $this=this;$this._processGridpanelData(rowsdata);var delay=100,timeout=5000;if($this.gtable){var gridtable=$this.gtable.data("gridtable");if(gridtable){gridtable.renderGridtableData(rowsdata,true)}else{loopReloadData($this.gtable,"gridtable",0)}}if($this.gcard){var gridcard=$this.gcard.data("gridcard");if(gridcard){gridcard.renderGridcardData(rowsdata,true)}else{loopReloadData($this.gcard,"gridcard",0)}}if($this.gpaginator){var paginator=$this.gpaginator.data("paginator");var a=$this.paginationInfo;if(paginator){paginator.updatePage({page:a.page,pagerows:a.pagerows,totalrecords:a.totalrows})}else{loopReloadData($this.gpaginator,"paginator",0)}}$this.recomputeGridTableWidth();$this._event("dataloadcomplete",null,{data:$this.rows,paginationInfo:$this.paginationInfo});function loopReloadData(obj,dataname,count){var compObject=obj.data(dataname);if(compObject){if(dataname=="gridtable"){compObject.renderGridtableData(rowsdata,true)}else{if(dataname=="gridcard"){compObject.renderGridcardData(rowsdata,true)}else{if(dataname=="paginator"){compObject.updatePage({page:$this.paginationInfo.page,pagerows:$this.paginationInfo.pagerows,totalrecords:$this.paginationInfo.totalrows})}}}}else{if(count*delay<=timeout){count++;setTimeout(function(){loopReloadData(obj,dataname,count)},delay)}}}},_combinedStaticAndUrlValueSet:function(codeColumn){if(!codeColumn||!codeColumn.length>0){return[]}var columnname=null;var valueset=null;var datatype=null;var tempArray=[];for(var i=0,len=codeColumn.length;i<len;i++){var temp=codeColumn[i];columnname=temp.columnname;valueset=temp.valueset;datatype=temp.datatype;if(valueset){if(valueset.indexOf("[")==0&&valueset.lastIndexOf("]")==valueset.length-1){valueset=eval("("+valueset+")");tempArray.push({columnname:columnname,valueset:"",resultset:valueset,datasettype:"static",datatype:datatype})}else{if(valueset.indexOf("{")!=-1||valueset.indexOf("{")!=-1){}else{tempArray.push({columnname:columnname,valueset:valueset,resultset:null,datasettype:"url",datatype:datatype})}}}}return tempArray},_code2data:function(valuesetColumn,rowsData){var row=null;var codeColumn=null;var columnName="";var resultset=null;var datatype=null;var oldText=null;for(var j=0,len=rowsData.length;j<len;j++){row=rowsData[j];for(var i=0;i<valuesetColumn.length;i++){codeColumn=valuesetColumn[i];resultset=codeColumn.resultset;if(resultset){columnName=codeColumn.columnname;oldText=row[columnName];datatype=codeColumn.datatype;if(datatype=="comboxfield"){for(var n=0;n<resultset.length;n++){if(oldText==resultset[n].value){row[columnName]=resultset[n].text}}}else{if(datatype=="comboxtreefield"){for(var n=0;n<resultset.length;n++){if(oldText==resultset[n].id){row[columnName]=resultset[n].name}}}else{for(var n=0;n<resultset.length;n++){if(oldText==resultset[n].value){row[columnName]=resultset[n].text}}}}}}}return rowsData},_code2DataComplete:function(delay,timeout,rowsData,toCodeColumn,callback){var count=0,$this=this,datatranslated;if(rowsData){codeToDataComplete(toCodeColumn,0)}function codeToDataComplete(valuesetColumn,index){if(!valuesetColumn||valuesetColumn.length==0){return}if(index==valuesetColumn.length){datatranslated=$this._code2data(valuesetColumn,rowsData);callback.call($this,datatranslated)}else{if(index<valuesetColumn.length){var datasettype=valuesetColumn[index]["datasettype"];var resultset=valuesetColumn[index]["resultset"];if(datasettype=="static"){count=0;index=index+1;codeToDataComplete(valuesetColumn,index)}else{if(datasettype=="url"&&resultset){count=0;index=index+1;codeToDataComplete(valuesetColumn,index)}else{if(datasettype=="url"&&!resultset){var url=valuesetColumn[index]["valueset"];var data=G.getPageDataSetCache(url);if(data&&data.status=="success"){data=data.data;if(data[0]["vtype"]||false){var d=data[0]["data"]||false;if(d){data=d}else{data=[]}}valuesetColumn[index]["resultset"]=data;count=0;index=index+1;codeToDataComplete(valuesetColumn,index)}else{if(count*delay>=timeout){count=0;index=index+1;codeToDataComplete(valuesetColumn,index)}else{count++;setTimeout(function(){codeToDataComplete(valuesetColumn,index)},delay)}}}}}}}}},getqueryparams:function(){return this.options.queryparams||{}},getPaginationInfo:function(){return this.paginationInfo||{}},query:function(comps,fn){if($.isArray(comps)){var a={};a.url=this.options.dataurl;a.components=comps;this.options.queryparams=$.DataAdapter.query(a);this._loadGirdpanelData("query",fn)}},reload:function(data,fn){this._loadGirdpanelData("reload",fn,data)},reloadCurrentPage:function(fn){this._loadGirdpanelData("reloadcurrentpage",fn)},goPage:function(n){if(!n){return false}this.paginationInfo.page=n;this._loadGirdpanelData()},_loadGirdpanelData:function(t,fn,data){this.rows=null;this._resetQueryDataParams(t);this.requestPageData(t,fn,data)},requestPageData:function(flag,fn,reloadJsonData){var $this=this;var url=$this.options.dataurl,urlparams=$this.options.dataurlparams,qparams=$this.options.queryparams,pginfo=$this.paginationInfo,sparams=$this.options.sortparams;if(flag=="reload"){url=reloadJsonData||$this.options.dataurl}if(url){$this.element.find(".jazz-pagearea").loading();if(typeof url=="object"){$this._successLoadData("",url,fn,true)}else{var data=$.extend({},pginfo,sparams);var params={url:url,params:urlparams,pageparams:data,queryparams:qparams,showloading:false,callback:function(resopnseData,that){var t=(flag!="paginator");that._successLoadData("",resopnseData,fn,t)}};$.DataAdapter.submit(params,$this)}}},_requestLoadData:function(data,fn,flag){var that=this;that._processGridpanelData(data);if(that.gtable){that.gtable.gridtable("renderGridtableData",data)}if(that.gcard){that.gcard.gridcard("renderGridcardData",data)}var a=that.paginationInfo;if(flag){if(that.options.isshowpaginator&&that.gpaginator){that.gpaginator.paginator("updatePage",{page:a.page,pagerows:a.pagerows,totalrecords:a.totalrows})}}if(fn&&$.isFunction(fn)){fn.call(that,that.rows,a)}},_resetQueryDataParams:function(flag){switch(flag){case"reload":this.options.sortparams.sortName="";this.options.sortparams.sortFlag="";this.options.queryparams={};this.paginationInfo.page=1;this.paginationInfo.totalrows=0;if(this.gcolumn){this.gcolumn.gridcolumn("clearColumnStatus")}break;case"reloadcurrentpage":this.paginationInfo.totalrows=0;break;case"query":this.options.sortparams.sortName="";this.options.sortparams.sortFlag="";this.paginationInfo.page=1;this.paginationInfo.totalrows=0;if(this.gcolumn){this.gcolumn.gridcolumn("clearColumnStatus")}break;case"paginator":this.options.sortparams.sortName="";this.options.sortparams.sortFlag="";if(this.gcolumn){this.gcolumn.gridcolumn("clearColumnStatus")}break}},bindPaginatorClickEvent:function(page,pagerows){this.paginationInfo.page=page;this.paginationInfo.pagerows=pagerows;this._resetQueryDataParams("paginator");this.requestPageData("paginator")},_setOption:function(key,value){switch(key){case"dataurl":this.paginationInfo.totalrows=0;break;case"dataurlparams":this.paginationInfo.totalrows=0;break;case"queryparams":this.paginationInfo.totalrows=0;break}this._super(key,value)},recomputeGridTableWidth:function(){var gridcolumn=this.gcolumn.data("gridcolumn");if(gridcolumn){gridcolumn._width()}var gridtable=this.gtable.data("gridtable");if(gridtable){gridtable._width()}}})})(jQuery);(function($){$.widget("jazz.gridcolumn",$.jazz.boxComponent,{options:{vtype:"gridcolumn",name:null,resizecolumn:true,wordbreak:false,hideheader:false,content:null,columnheader:null,isdefaultclickevent:true},_create:function(){this.options.columnheader=this.options.content||"";this.options.content=null;this._super();this.compId=this.getCompId();var el=this.element;el.attr("id",this.compId+"_gridcolumn").addClass("jazz-gridcolumn").css({width:"100%",overflow:"hidden"});if(el.children()&&el.children().length>0){this.tempcolumnheader=el.children();el.children().remove()}else{if(this.options.columnheader){this.tempcolumnheader=$(this.options.columnheader)}}var tableclass="jazz-grid-column-table";if(this.options.wordbreak||this.options.wordbreak=="true"){tableclass+=" jazz-grid-column-table-wordbreak"}var div='<div id="'+this.compId+'_columns" class="jazz-grid-columns" style="display: block;"><table id="'+this.compId+'_table" class="'+tableclass+'" cellspacing="0" cellpadding="0" border="0"><thead><tr><th style="width:0px;height:0px;"></th></tr></thead><tbody></tbody></table></div>';el.append(div);this.columns=$("#"+this.compId+"_columns");this.table=$("#"+this.compId+"_table");this.tbody=this.table.children("tbody");this.thead=this.table.children("thead")},_init:function(){this._super();this._createGridColumnOptions();this._createColumns();this._selectAllTableRows();if(this.options.resizecolumn){this._bindMoveColumnEvent()}if(this.options.isdefaultclickevent){this._bindColumnSortEvent()}this._calculateColumnSplitterHeight();if(this.options.hideheader==true||this.options.hideheader=="true"){this.element.hide()}},_width:function(){this.calculateGridcolumnWidth();this.settingGridcolumnWidth()},_height:function(){},_createGridColumnOptions:function(){this.options.lineno=true;this.options.linenowidth=30;this.options.isshowselecthelper=true;this.options.selecttype=2;var vtypeparent=this.getParentComponent();if(vtypeparent&&(vtypeparent.attr("vtype")=="gridpanel"||vtypeparent.attr("vtype")=="gridtreepanel")){this.gridpanel=$(vtypeparent).data(vtypeparent.attr("vtype"));var gridoptions=this.gridpanel.options;this.options.lineno=gridoptions.lineno;this.options.linenowidth=gridoptions.linenowidth;this.options.isshowselecthelper=gridoptions.isshowselecthelper;this.options.selecttype=gridoptions.selecttype}if(this.tempcolumnheader){var headers=[];$.each(this.tempcolumnheader,function(i,content){var t=[],str="";$.each($(content).children(),function(j,objs){var obj=$(objs);str={text:obj.attr("text"),textalign:obj.attr("textalign"),name:obj.attr("name"),visible:obj.attr("visible"),width:obj.attr("width"),datatype:obj.attr("datatype"),dataformat:obj.attr("dataformat"),textdisplaytype:obj.attr("textdisplaytype"),rowspan:obj.attr("rowspan"),valueset:obj.attr("dataurl"),key:obj.attr("key"),colspan:obj.attr("colspan"),sort:obj.attr("sort"),iseditable:obj.attr("iseditable"),issummary:obj.attr("issummary"),summarytype:obj.attr("summarytype"),summaryrender:obj.attr("summaryrender")};t.push(str)});headers.push(t)});this.options.header=headers}},_calculateColumnSplitterHeight:function(){var splitterObj=this.tbody.find(".jazz-grid-column-splitter");$.each(splitterObj,function(i,obj){var tdHeight=$(obj).parents(".jazz-grid-headerCell").height()||24;$(obj).height(tdHeight)})},_createColumns:function(){var lineno=this.options.lineno;var isshowselecthelper=this.options.isshowselecthelper;var selecttype=this.options.selecttype;var header2="",colIndex=0;this.columnWidth=[];this.cols=[];this.toCodeColumn=[];var headers=this.options.header,headrows=headers.length;var nums=0;if(this.options.lineno==true||this.options.lineno=="true"){nums+=1}if((this.options.isshowselecthelper==true||this.options.isshowselecthelper=="true")&&(this.options.selecttype!=0||this.options.selecttype!="0")){nums+=1}var cellColumnIndexArray=this._getCellColumnIndexArray();var headcell=null,cover=null,colindex=null,celltype=null,celldata=null;for(var i=0;i<cellColumnIndexArray.length;i++){header2+="<tr><th></th>";for(var j=0,len=cellColumnIndexArray[i].length;j<len;j++){headcell=cellColumnIndexArray[i][j];cover=headcell.cover;colindex=headcell.colindex;celltype=headcell.celltype;celldata=headcell.celldata;if(cover=="combined"){continue}if(celltype){if(celltype=="lineno"){header2+='<td index="'+colindex+'" class="jazz-grid-headerCell" rowspan="'+headrows+'"><div class="jazz-grid-headerCell-inner" style="text-align:center;">序号</div></td>'}if(celltype=="select"){if(selecttype==2||selecttype=="2"){header2+='<td index="'+colindex+'" class="jazz-grid-headerCell" rowspan="'+headrows+'"><div class="jazz-grid-headerCell-box"><input type="checkbox" name="'+this.compId+'_box" id="'+this.compId+'_box" /></div></td>'}else{header2+='<td class="jazz-grid-headerCell">&nbsp;</td>'}}}else{if(!celldata){continue}if(celldata.name){if(celldata.key==true||celldata.key=="true"){this.keyCode=celldata.name.replace(/^\s+(\w+)\s+$/g,"$1")}this.cols[colindex-nums]={columnname:celldata.name,sort:celldata.sort,index:colindex,datatype:celldata.datatype,dataformat:celldata.dataformat,textalign:celldata.textalign,iseditable:celldata.iseditable,issummary:celldata.issummary,summarytype:celldata.summarytype,summaryrender:celldata.summaryrender};this.toCodeColumn.push({columnname:celldata.name,valueset:celldata.valueset,datatype:celldata.datatype});var width=celldata.width,visible=celldata.visible;this.columnWidth[colindex-nums]={columnname:celldata.name,columnwidth:celldata.width,visible:visible}}var _colspan="",_rowspan="",_align="",_bottomclass="",_name="",_text="",_items="";if(celldata.rowspan){_rowspan=' rowspan="'+celldata.rowspan+'"'}if(celldata.colspan){_colspan=' colspan="'+celldata.colspan+'"'}if(celldata.textalign){_align=' style="text-align: '+celldata.textalign+'"'}if(celldata.text){_text=celldata.text}if(celldata.name){_bottomclass=" jazz-grid-bottomCell";_name=celldata.name}if(celldata.items){_items=celldata.items}header2+='<td index="'+colindex+'" name="'+_name+'" items="'+_items+'" class="jazz-grid-headerCell'+_bottomclass+'" '+_rowspan+_colspan+'><div class="jazz-grid-headerCell-outer"><div class="jazz-grid-headerCell-inner" '+_align+">"+_text+'</div><div class="jazz-grid-column-splitter"></div></td>'}}header2+="</tr>"}this.calculateGridcolumnWidth();this._createTheadDom();this.settingGridcolumnWidth();this.table.append(header2)},calculateGridcolumnWidth:function(){var width_table=this.columns.width();if((this.options.isshowselecthelper==true||this.options.isshowselecthelper=="true")&&(this.options.selecttype!=0||this.options.selecttype!="0")){width_table-=24}if(this.options.lineno==true||this.options.lineno=="true"){var linowidth=this.options.linenowidth?parseInt(this.options.linenowidth):30;width_table-=linowidth}var grid=this.getParentComponent();if(grid){var gridtable=$(grid)[grid.attr("vtype")]("getGridTable");if(gridtable){var contentDiv=gridtable.find(".jazz-grid-tables");if(contentDiv.size()>0){var gridTableClientWidth=contentDiv.get(0).clientWidth;var gridTableWidth=contentDiv.width();if(gridTableWidth>gridTableClientWidth){width_table-=17}}}}var re=/^[0-9]+.?[0-9]*$/;var fixedColumnWidth=0;var exceptFixedColumnWidth=0;var percentColumnWidth=0;var hasPercentWidth=false;var autoWidthNums=0;for(var i=0,m=this.columnWidth.length;i<m;i++){var temp=this.columnWidth[i];var colwidth=temp.columnwidth;var visible=temp.visible;if(visible==="false"||visible===false){continue}if(!colwidth||$.trim(colwidth)=="*"){autoWidthNums++}else{if(colwidth.indexOf("px")!=-1||(re.test(colwidth)&&colwidth.indexOf("%")==-1)){fixedColumnWidth+=parseFloat(colwidth);temp._columnwidth=parseFloat(colwidth)}if(!hasPercentWidth&&colwidth.indexOf("%")!=-1){hasPercentWidth=true}}}exceptFixedColumnWidth=width_table-fixedColumnWidth;if(hasPercentWidth){for(var i=0,m=this.columnWidth.length;i<m;i++){var temp=this.columnWidth[i];var colwidth=temp.columnwidth;var visible=temp.visible;if(visible==="false"||visible===false){continue}if(colwidth&&colwidth.indexOf("%")!=-1){var a=colwidth.substring(0,colwidth.indexOf("%"));var b=Math.floor((a/100)*exceptFixedColumnWidth);temp._columnwidth=b;percentColumnWidth+=b}}}if(autoWidthNums>0){var leftColumnWidth=exceptFixedColumnWidth-percentColumnWidth;for(var i=0,m=this.columnWidth.length;i<m;i++){var temp=this.columnWidth[i];var colwidth=temp.columnwidth;var visible=temp.visible;if(visible==="false"||visible===false){continue}if(!colwidth||$.trim(colwidth)=="*"){temp._columnwidth=Math.floor(leftColumnWidth/autoWidthNums)}}}},_createTheadDom:function(){var linowidth="";var thead_th="";if((this.options.isshowselecthelper==true||this.options.isshowselecthelper=="true")&&(this.options.selecttype!=0||this.options.selecttype!="0")){thead_th+='<th style="width:24px;height:0px;" name="selecthelper"></th>'}if(this.options.lineno==true||this.options.lineno=="true"){linowidth=this.options.linenowidth?parseInt(this.options.linenowidth)+"px":"30px";thead_th+='<th style="width:'+linowidth+';height:0px;" name="rowlineno"></th>'}for(var i=0,len=this.columnWidth.length;i<len;i++){var temp=this.columnWidth[i];var colname=temp.columnname;thead_th+='<th style="height:0px;" name="'+colname+'"></th>'}this.thead.find("tr").append(thead_th)},settingGridcolumnWidth:function(){for(var i=0,len=this.columnWidth.length;i<len;i++){var temp=this.columnWidth[i];var width=temp._columnwidth;var visible=temp.visible;var colname=temp.columnname;if(visible==false||visible=="false"){width=0}this.thead.find('th[name="'+colname+'"]').css("width",width+"px")}},_getCellColumnIndexArray:function(){var headers=this.options.header,headrows=headers.length;var columnnums=0;var haslineno=false,hasselectbox=false;if(this.options.lineno==true||this.options.lineno=="true"){columnnums+=1;haslineno=true}if((this.options.isshowselecthelper==true||this.options.isshowselecthelper=="true")&&(this.options.selecttype!=0||this.options.selecttype!="0")){columnnums+=1;hasselectbox=true}for(var m=0;m<headrows;m++){for(var n=0,len=headers[m].length;n<len;n++){if(headers[m][n]["name"]){columnnums=columnnums+1}}}var cellColumnIndexArray=[];for(var m=0;m<headrows;m++){cellColumnIndexArray[m]=[];for(var n=0;n<columnnums;n++){cellColumnIndexArray[m][n]={colindex:0,cover:false,celldata:null}}}if(hasselectbox){for(var j=0;j<headrows;j++){if(j==0){cellColumnIndexArray[j][0]["colindex"]=0;cellColumnIndexArray[j][0]["cover"]=true;cellColumnIndexArray[j][0]["celltype"]="select"}else{cellColumnIndexArray[j][0]["cover"]="combined"}}}if(haslineno&&hasselectbox){for(var j=0;j<headrows;j++){if(j==0){cellColumnIndexArray[j][1]["colindex"]=1;cellColumnIndexArray[j][1]["cover"]=true;cellColumnIndexArray[j][1]["celltype"]="lineno"}else{cellColumnIndexArray[j][1]["cover"]="combined"}}}else{if(!hasselectbox&&haslineno){for(var j=0;j<headrows;j++){if(j==0){cellColumnIndexArray[j][0]["colindex"]=0;cellColumnIndexArray[j][0]["cover"]=true;cellColumnIndexArray[j][0]["celltype"]="lineno"}else{cellColumnIndexArray[j][0]["cover"]="combined"}}}}for(var m=0;m<headrows;m++){for(var n=0,len=headers[m].length;n<len;n++){var obj=headers[m][n];var rowspan=parseInt(obj.rowspan)||1;var colspan=parseInt(obj.colspan)||1;var positionIndex=0;for(var k=0;k<cellColumnIndexArray[m].length;k++){if(cellColumnIndexArray[m][k]["cover"]==false){positionIndex=k;cellColumnIndexArray[m][k]["cover"]=true;cellColumnIndexArray[m][k]["colindex"]=k+colspan-1;cellColumnIndexArray[m][k]["celldata"]=obj;break}}if(rowspan>1){for(var j=m+1;j<m+rowspan;j++){cellColumnIndexArray[j][positionIndex]["cover"]="combined"}}if(colspan>1){for(var j=positionIndex+1;j<positionIndex+colspan;j++){cellColumnIndexArray[m][j]["cover"]="combined"}}}}return cellColumnIndexArray},_selectAllTableRows:function(){var $this=this;$("#"+this.compId+"_box").off("click.box").on("click.box",function(){if($this.gridpanel){if($(this).prop("checked")){$this.gridpanel.selectAllRows()}else{$this.gridpanel.unselectAllRows()}}})},_bindMoveColumnEvent:function(){var $this=this,$tbody=this.tbody.find("td");$tbody.off("mousedown.splitter").on("mousedown.splitter",function(e){var target=e.target,$target=$(target);if($target.is(".jazz-grid-column-splitter")){$this.spliderTd=$target.closest("td");$this.x1=e.pageX;var splitHeight=$this.columns.height()+$this._getTableObj().element.height();$this.grid_proxy=$('<div class="jazz-grid-proxy" style="display:none"></div>').appendTo(document.body);$this.grid_proxy.css({display:"block",top:$this.columns.offset().top,left:$this.x1,height:splitHeight});$(document).on("selectstart",function(){return false});$("body").css({"-moz-user-select":"none","-khtml-user-select":"none","user-select":" none"});$(document).off("mousemove.splitter").on("mousemove.splitter",function(e){if($this.grid_proxy){$this.x2=e.pageX;$this.grid_proxy.css({top:$this.columns.offset().top,left:$this.x2,height:splitHeight})}});$(document).off("mouseup.splitter").on("mouseup.splitter",function(e){if($this.grid_proxy){$this.grid_proxy.remove();var w=0;if($this.x2!=0){w=$this.x2-$this.x1}$this.x2=0;var index=$this.spliderTd.attr("index");var obj=$this.thead.find("th").eq((parseInt(index)+1));var tableWidth=$this.table.width();var colWidth=obj.width();var newColWidth=colWidth+w;var dfWidth=30;if(newColWidth<dfWidth){newColWidth=dfWidth;w=-(colWidth-newColWidth);$this.grid_proxy.css({top:$this.columns.offset().top,left:$this.x1+w,height:splitHeight})}obj.width(newColWidth);var newTableWidth=tableWidth+w;var tableObj=$this._getTableObj();var childrenObj=tableObj.thead.find("th").eq((parseInt(index)+1));childrenObj.width(newColWidth)}$(document).off("selectstart");$("body").css({"-moz-user-select":"","-khtml-user-select":"","user-select":""});$(document).off("mousemove.splitter mouseup.splitter");$this._calculateColumnSplitterHeight()})}})},_bindColumnSortEvent:function(){var $this=this;var el=this.tbody.find("td.jazz-grid-bottomCell");el.off("click.sortcell").on("click.sortcell",function(e){var colindex=$(this).attr("index");var colname=$(this).attr("name");var sortFlag="asc";var sortable=false;if(!colname){return}for(var i=0,len=$this.cols.length;i<len;i++){if(colname==$this.cols[i]["columnname"]){sortable=$this.cols[i]["sort"]==true||$this.cols[i]["sort"]=="true";break}}if(sortable){el.filter("[name!="+colname+"]").removeClass("jazz-grid-asc jazz-grid-desc").find("span.jazz-grid-sortIcon").remove();if($(this).find("span.jazz-grid-sortIcon").length==0){$(this).find("div.jazz-grid-headerCell-inner").append('<span class="jazz-grid-sortIcon"></span>')}if($(this).hasClass("jazz-grid-asc")){$(this).removeClass("jazz-grid-asc").addClass("jazz-grid-desc");sortFlag="desc"}else{if($(this).hasClass("jazz-grid-desc")){$(this).removeClass("jazz-grid-desc").addClass("jazz-grid-asc")}else{$(this).addClass("jazz-grid-asc")}}if(colname){$this.gridpanel.options.sortparams.sortName=colname;$this.gridpanel.options.sortparams.sortFlag=sortFlag;$this.gridpanel.requestPageData()}}})},_getTableObj:function(){if(!this.gridTableObj){var grid=this.getParentComponent();if(grid){if(!grid.gridTableObj){var t=$(grid)[grid.attr("vtype")]("getGridTable");grid.gridTableObj=t.data("gridtable")}}this.gridTableObj=grid.gridTableObj}return this.gridTableObj},hideColumn:function(columnname){if(!columnname){return}var el=this.thead.find('th[name="'+columnname+'"]');if(el.length>0){el.css("width","0px");var gridTableObj=this._getTableObj();if(gridTableObj){$(gridTableObj.thead).find('th[name="'+columnname+'"]').css("width","0px")}}},showColumn:function(columnname){if(!columnname){return}for(var i=0,len=this.columnWidth.length;i<len;i++){var temp=this.columnWidth[i];var width=temp._columnwidth;var colname=temp.columnname;if(colname==columnname){this.thead.find('th[name="'+colname+'"]').css("width",width+"px");var gridTableObj=this._getTableObj();if(gridTableObj){$(gridTableObj.thead).find('th[name="'+colname+'"]').css("width",width+"px")}}}},clearColumnStatus:function(){var $this=this;var el=this.tbody.find("td.jazz-grid-bottomCell");if(el.length>0){el.removeClass("jazz-grid-asc jazz-grid-desc").find("span.jazz-grid-sortIcon").remove()}var ckbox=this.tbody.find("input:checkbox");if(ckbox.length>0){ckbox.attr("checked",false)}}})})(jQuery);(function($){$.widget("jazz.gridtable",$.jazz.boxComponent,{options:{vtype:"gridtable",name:null,rowrender:null,isfixrow:false,addrowposition:"first",rowselect:null,rowunselect:null,rowdblclick:null},_create:function(){this._super();this.compId=this.getCompId();var el=this.element;el.attr("id",this.compId+"_gridtable").addClass("jazz-datatable");var div='<div id="'+this.compId+'_tables" class="jazz-grid-tables" style="display: block;"><table id="'+this.compId+'_table" class="jazz-grid-data-table" cellspacing="0" cellpadding="0" border="0"><thead><tr></tr></thead><tbody></tbody></table></div>';el.append(div);this.columns=$("#"+this.compId+"_tables");this.table=$("#"+this.compId+"_table");this.thead=this.table.children("thead");this.tbody=this.table.children("tbody")},_init:function(){this._super();this._createGridTableOptions();if(this.options.linetype&&(this.options.linetype!=0||this.options.linetype!="0")){this.table.addClass("jazz-grid-table-linetype"+this.options.linetype)}if(this.options.linestyle&&(this.options.linestyle!=1||this.options.linestyle!="1")){this.table.addClass("jazz-grid-table-linestyle"+this.options.linestyle)}this.calculateGridtableWidth();this._bindTableHorizonScrollEvent();this._bindGridTableEvent()},_width:function(){this.calculateGridtableWidth()},_height:function(){},_bindGridTableEvent:function(){if(this._isGridtableEditable()){$.extend(this,jazz.grid.editorgridtable)}if(this.options.groupfield){$.extend(this,jazz.grid.groupgridtable);this._bindGroupGridTableEvent();this._bindSummaryGridTableEvent()}else{if(this.options.isgroupsummary||this.options.ispagesummary){$.extend(this,jazz.grid.summarygridtable);this._bindSummaryGridTableEvent()}}this._bindGridTableSelectionEvent();this._bindGridTreeTableArrowEvent()},_isGridtableEditable:function(){var iseditable=false;if(this.options.iseditable){iseditable=true}else{for(var j=0,len=this.cols.length;j<len;j++){if(this.cols[j]["iseditable"]){iseditable=true;break}}}return iseditable},_createGridTableOptions:function(){this.options.lineno=true;this.options.isshowselecthelper=true;this.options.selecttype=2;this.options.linetype=0;this.options.linestyle=1;this.options.isshowpaginator=true;this.options.rowselectable=true;this.options.isshoweditcell=false;this.options.isshoweditcell=false;this.options.editortype="cell";this.options.iseditable=false;this.options.isgroupsummary=false;this.options.ispagesummary=false;this.options.groupfield=null;this.options.grouptitlefield=null;this.options.isgroupexpand=true;var parentobj=this.getParentComponent();if(parentobj&&parentobj.length>0){this.gridpanel=$(parentobj).data($(parentobj).attr("vtype"));var gridoptions=this.gridpanel.options;this.options.lineno=gridoptions.lineno;this.options.isshowselecthelper=gridoptions.isshowselecthelper;this.options.selecttype=gridoptions.selecttype;this.options.linetype=gridoptions.linetype;this.options.linestyle=gridoptions.linestyle;this.options.isshowpaginator=gridoptions.isshowpaginator;this.options.rowselectable=gridoptions.rowselectable;this.options.isshoweditcell=gridoptions.isshoweditcell;this.options.editortype=gridoptions.editortype;this.options.iseditable=gridoptions.iseditable;this.options.isgroupsummary=gridoptions.isgroupsummary;this.options.ispagesummary=gridoptions.ispagesummary;this.options.groupfield=gridoptions.groupfield;this.options.grouptitlefield=gridoptions.grouptitlefield;this.options.isgroupexpand=gridoptions.isgroupexpand;var el=this.element;var pagearea=parentobj.find(".jazz-pagearea");if(pagearea&&pagearea.length>0){el.appendTo(pagearea);if(parseInt(gridoptions.height)>0||gridoptions.layout=="fit"){}else{this.columns.css("height","auto")}}else{el.wrap('<div class="jazz-pagearea"></div>');pagearea=el.parent();if(parseInt(gridoptions.height)>0||gridoptions.layout=="fit"){pagearea.css({overflow:"hidden"})}else{this.columns.css("height","auto")}}this.gridcolumn=parentobj.find("div[vtype=gridcolumn]").data("gridcolumn");this.cols=this.gridcolumn.cols||[]}},calculateGridtableWidth:function(){if(this.gridcolumn){this.thead.children().remove();this.thead.append(this.gridcolumn.thead[0].innerHTML)}},_bindTableHorizonScrollEvent:function(){var that=this;var el=that.element;var gridtables=el.find("div.jazz-grid-tables");var gridcolumns=that.gridcolumn.columns;gridtables.off("scroll.gridtable").on("scroll.gridtable",function(){var scrollwidth=$(this).scrollLeft();gridcolumns.css("margin-left",-scrollwidth)})},_drawDataLine:function(){var $this=this,dataLength=this._trNumber(),rowLength=0,n=0;var pageNo=10;if(this.gridpanel&&this.gridpanel.paginationInfo){pageNo=this.gridpanel.paginationInfo.pagerows||10}if(dataLength<pageNo){rowLength=pageNo-dataLength}if(dataLength%2!=0){n=1}var trHtml="",showLine=this.options.lineno;for(var i=0,len=rowLength;i<len;i++){if((n+1+i)%2===0){cls="jazz-gridtable-even"}else{cls="jazz-gridtable-odd"}trHtml+='<tr index="'+(dataLength+i)+'" class="nodata '+cls+'">';trHtml+='<th style="height:20px;"></th>';if(this._isSelectHelper()&&this._isSelectType()){trHtml+="<td class='jazz-grid-cell'>&nbsp;</td>"}if(showLine){trHtml+="<td class='jazz-grid-cell'>&nbsp;</td>"}for(var j=0,l=this.cols.length;j<l;j++){trHtml+="<td class='jazz-grid-cell'>&nbsp;</td>"}trHtml+="</tr>"}if(rowLength>0){this.tbody.append(trHtml)}},_insertRowHtml:function(rowObj,index,lineIndex){var $this=this;var data=rowObj;var lineno=this.options.lineno;var page=1;var pagerows=0;if(this.gridpanel&&this.gridpanel.paginationInfo){page=this.gridpanel.paginationInfo.page||1;pagerows=this.gridpanel.paginationInfo.pagerows||0}lineIndex=index+lineIndex+1+((page-1)*pagerows);var cls="";if((lineIndex)%2==0){cls="jazz-gridtable-even"}else{cls="jazz-gridtable-odd"}var rowHtml='<tr index="'+(lineIndex-1)+'" class="jazz-grid-row '+cls+' " id="'+data.rowuuid+'">';rowHtml+='<th style="height:20px;"></th>';var b="";if(this._isSelectHelper()&&this._isSelectType()){if($this._isMultipleSelection()){b="checkbox"}else{if($this._isSingleSelection()){b="radio"}}rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box"><input type="'+b+'"/></td>'}if(lineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no">'+lineIndex+"</td>"}var columnname="",stm="",textalign="",title="";for(var j=0,len=this.cols.length;j<len;j++){columnname=this.cols[j]["columnname"];textalign=this.cols[j]["textalign"]||"";title="";stm="&nbsp;";if(columnname&&data[columnname]!=undefined){if(data[columnname].toString().indexOf("<")!=0){title=data[columnname]||""}stm=data[columnname]}if(textalign){textalign="text-align-"+textalign}rowHtml+='<td class="jazz-grid-cell '+textalign+'" title='+title+">"+stm+"</td>"}return rowHtml},_isSelectHelper:function(){var isshowselecthelper=this.options.isshowselecthelper;return(isshowselecthelper==true||isshowselecthelper=="true")},_isSelectType:function(){var selecttype=this.options.selecttype;return(selecttype!=0||selecttype!="0")},_isSingleSelection:function(){var selecttype=this.options.selecttype;return(selecttype==1||selecttype=="1")},_isMultipleSelection:function(){var selecttype=this.options.selecttype;return(selecttype==2||selecttype=="2")},_renderData:function(rows){if(!rows){return}var lineIndex=0;var rowHtml="";this._trObject().remove();lineIndex=this._trNumber();for(var i=0;i<rows.length;i++){rowHtml+=this._insertRowHtml(rows[i],i,lineIndex)}this.tbody.append(rowHtml);this._event("rowrender",null,{data:rows,rowEl:this.tbody.find("tr")});this._isNullData()},_isNullData:function(){if(this._trObject().length==0){this.element.find(".jazz-grid-tables").addClass("jazz-grid-tables-nulldata")}else{this.element.find(".jazz-grid-tables").removeClass("jazz-grid-tables-nulldata")}},renderGridtableData:function(rowsdata){if(rowsdata){this._renderData(rowsdata);this._updateIndex()}},_bindGridTableSelectionEvent:function(){var that=this;this.tbody.on("click.td","td.jazz-grid-cell",null,function(e){if($(this).parent().hasClass("nodata")){return}if($(e.target).is("a")){return}if($(e.target).hasClass("jazz-gridtree-arrow")){return}that._onRowClickEvent(e,$(this),false)}).on("dblclick.td","td.jazz-grid-cell",null,function(e){if($(this).parent().hasClass("nodata")){return}if($(e.target).is("a")){return}if($(e.target).hasClass("jazz-gridtree-arrow")){return}that._onRowClickEvent(e,$(this),true)})},_onRowClickEvent:function(e,tdEl,dbclick){var that=this;var targetrow=$(tdEl).parent();var rowselectable=that.options.rowselectable||that.options.rowselectable=="true";if(rowselectable){if(dbclick){that._onRowClick(e,targetrow,true)}else{setTimeout(function(){that._onRowClick(e,targetrow,false)},100)}}else{if($(e.target).is(".jazz-grid-cell-box :input")){that._onRowClick(e,targetrow,false)}}},_onRowClick:function(event,targetRow,flag){var row=$(targetRow);var isSelected=row.hasClass("jazz-row-selected");if(this._isMultipleSelection()){if(flag){this._selectRow(row,true,event,flag)}else{if(isSelected){this._unselectRow(row,true,event)}else{this._selectRow(row,true,event,flag)}}}else{if(flag){this._selectRow(row,true,event,flag)}else{if(isSelected){this._selectRow(row,true,event,flag)}else{this._unselectAllRows();this._selectRow(row,true,event,flag)}}}},_selectRow:function(row,isCallback,event,flag){var $this=this;var id=row.attr("id");row.addClass("jazz-row-selected").attr("aria-selected",true);if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",true)}if($this.tbody.find("input:checked").length==$this.tbody.find("input:checkbox").length){var thead=$this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",true)}}else{if(row.find("input:radio")){row.find("input:radio").attr("checked",true);row.siblings().find("input:radio").attr("checked",false)}}if($this.gridpanel.gcard){var card=$this.gridpanel.gcard.find("#"+id);card.removeClass("jazz-gridtable-hover").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",true)}}else{if(card.find("input.jazz-card-radio")){card.find("input.jazz-card-radio").attr("checked",true);card.siblings().find("input.jazz-card-radio").attr("checked",false)}}}if(isCallback){var data={};data=this.gridpanel.getSelectedRowDataById(id);if(flag==true){this._event("rowdblclick",event,data)}else{this._event("rowselect",event,data)}}},_unselectRow:function(row,isCallback,event){var $this=this;var id=row.attr("id");row.removeClass("jazz-row-selected").attr("aria-selected",false);var thead=$this.gridcolumn.tbody;if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",false)}if($this.tbody.find("input:checked").length!=$this.tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",false)}}if($this.gridpanel.gcard){var card=$this.gridpanel.gcard.find("#"+id);card.removeClass("jazz-gridtable-highlight").attr("aria-selected",false);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",false)}}else{if(card.find("input.jazz-card-radio")){card.find("input.jazz-card-radio").attr("checked",true);card.siblings().find("input.jazz-card-radio").attr("checked",false)}}}if(isCallback){var data={};data=this.gridpanel.getSelectedRowDataById(id);this._event("rowunselect",event,data)}},_selectAllRows:function(){this.tbody.find("tr.jazz-grid-row").addClass("jazz-row-selected").attr("aria-selected",true);if(this._isMultipleSelection()){this.tbody.find("input:checkbox").attr("checked",true);var thead=this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",true)}if(this.gridpanel.gcard){var gridcard=this.gridpanel.gcard.data("gridcard");var cardContent=gridcard.cardContent;cardContent.find("div.jazz-grid-cardcell").addClass("jazz-gridtable-highlight").attr("aria-selected",true);cardContent.find("input.jazz-card-checkbox").attr("checked",true)}},_unselectAllRows:function(){this.tbody.find("tr.jazz-grid-row").removeClass("jazz-row-selected").attr("aria-selected",false);if(this._isMultipleSelection()){this.tbody.find("input:checkbox").attr("checked",false);var thead=this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",false)}if(this.gridpanel.gcard){var gridcard=this.gridpanel.gcard.data("gridcard");var cardContent=gridcard.cardContent;cardContent.find("div.jazz-grid-cardcell").removeClass("jazz-gridtable-highlight").attr("aria-selected",false);cardContent.find("input.jazz-card-checkbox").attr("checked",false);cardContent.find("input.jazz-card-radio").attr("checked",false)}},_trObject:function(){var obj=this.tbody.children("tr");return obj},_trNumber:function(){var obj=this._trObject();if(obj){return obj.length}else{return 0}},_updateIndex:function(){if(this.options.lineno){var n=0;if(this.options.isshowpaginator){var p=1;var r=10;if(this.gridpanel&&this.gridpanel.paginationInfo){p=this.gridpanel.paginationInfo.page||1;r=this.gridpanel.paginationInfo.pagerows||10}n=(p-1)*r}var trObjs=this.tbody.children(".jazz-grid-row");$.each(trObjs,function(i,obj){$(this).children("td.jazz-grid-cell-no").text(i+1+n)})}if(this.options.isfixrow){this._drawDataLine()}},addRow:function(data){if(!data){return}var rowHtml="";var lineIndex=this._trNumber();for(var i=0;i<data.length;i++){rowHtml+=this._insertRowHtml(data[i],i,lineIndex)}var trobj=null;if(rowHtml){trobj=$(rowHtml).appendTo(this.tbody)}this._event("rowrender",null,{data:data,rowEl:trobj})},updateRowById:function(data,id){if(!data||!id){return}var trobj=this.tbody.find("#"+id);var isselected=trobj.hasClass("jazz-row-selected");var rowIndex=trobj.find(".jazz-grid-cell-no").html();var rowHtml=this._insertRowHtml(data,0,(parseInt(rowIndex)-1));trobj.replaceWith(rowHtml);var newtrobj=this.tbody.find("#"+id);if(isselected){newtrobj.addClass("jazz-row-selected").attr("aria-selected",true);newtrobj.find("input:checkbox").attr("checked",true);var thead=this.gridcolumn.tbody;if(this._isMultipleSelection()){if(this.tbody.find("input:checked").length==this.tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",true)}}}this._event("rowrender",null,{data:data,rowEl:newtrobj});if(this.options.isgroupsummary||this.options.ispagesummary){this.tbody.trigger("cellvaluechange.summaryrow",[id])}},removeRowById:function(id){this.tbody.find("#"+id).remove();if(this.tbody.children().length==0||this.tbody.find("tr[id]").length==0){if(this._isMultipleSelection()){var thead=this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",false)}}this._updateIndex();if(this.options.isgroupsummary||this.options.ispagesummary){this.tbody.trigger("cellvaluechange.summaryrow",[id])}},selectRow:function(id){var $this=this;var row=this.tbody.find("#"+id);row.addClass("jazz-row-selected").attr("aria-selected",true);var thead=$this.gridcolumn.tbody;if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",true)}if($this.tbody.find("input:checked").length==$this.tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",true)}}else{if(row.find("input:radio")){row.find("input:radio").attr("checked",true);row.siblings().find("input:radio").attr("checked",false)}}},unselectRow:function(id){var $this=this;var row=this.tbody.find("#"+id);row.removeClass("jazz-row-selected").attr("aria-selected",false);var thead=$this.gridcolumn.tbody;if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",false)}if($this.tbody.find("input:checked").length!=$this.tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",false)}}},selectAllRows:function(){var $this=this;$this.tbody.find("tr.jazz-grid-row").addClass("jazz-row-selected").attr("aria-selected",true);if($this._isMultipleSelection()){$this.tbody.find("input:checkbox").attr("checked",true)}var thead=$this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",true)},unselectAllRows:function(){var $this=this;$this.tbody.find("tr.jazz-grid-row").removeClass("jazz-row-selected").attr("aria-selected",false);if($this._isMultipleSelection()){$this.tbody.find("input:checkbox").attr("checked",false)}var thead=$this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",false)},_bindGridTreeTableArrowEvent:function(){var that=this;this.tbody.on("click","span.jazz-gridtree-arrow",null,function(e){if($(e.target).hasClass("jazz-gridtree-arrow-open")){var id=$(e.target).parent().attr("id");var index=$(e.target).parents("tr").index();that.gridpanel.rebuildTreeTable(0,{isOpen:true,id:id,lineIndex:index});$(e.target).removeClass("jazz-gridtree-arrow-open").addClass("jazz-gridtree-arrow-close")}else{if($(e.target).hasClass("jazz-gridtree-arrow-close")){var id=$(e.target).parent().attr("id");var index=$(e.target).parents("tr").index();that.gridpanel.rebuildTreeTable(0,{isOpen:false,id:id,lineIndex:index});$(e.target).removeClass("jazz-gridtree-arrow-close").addClass("jazz-gridtree-arrow-open")}else{return}}})},addTreeRow:function(data,rowIndex){if(!data){return}var rowHtml="";var lineIndex=this._trNumber();var idkey=this.options.idkey;var pidkey=this.options.pidkey;for(var i=0;i<data.length;i++){rowHtml+=this._insertTreeRowHtml(data[i],i,lineIndex)}var trobj=null;if(rowHtml){if(rowIndex!==undefined){this.tbody.children().eq(rowIndex).before($(rowHtml))}else{trobj=$(rowHtml).appendTo(this.tbody)}}this.fixTreeRowAttr()},removeTreeRows:function(info){if(!info){return}var start=info.start,end=info.end,length=info.length,tr_len=this.tbody.children().length;if(start!==undefined&&end!==undefined){this.removeTreeRows({start:start,length:end-start+1});return}else{if(start===undefined&&end===undefined&&length!==undefined){this.removeTreeRows({start:tr_len-length,length:length});return}else{if(start===undefined&&end!==undefined&&length!==undefined){this.removeTreeRows({start:end-length,length:length});return}else{if(start!==undefined&&end===undefined&&length!==undefined){if(start==0){this.tbody.children(":lt("+length+")").remove()}else{this.tbody.children(":gt("+(start-1)+"):lt("+length+")").remove()}}}}}},_insertTreeRowHtml:function(rowObj,index,lineIndex){var $this=this;var data=rowObj;var lineno=this.options.lineno;var treeColumnName=this.options.treecolumnname;var id=this.options.idkey;var childkey=this.options.childkey;var isparentkey=this.options.isparentkey;var lv=this.options.levelkey;var pId=this.options.pidkey;var isopen=this.options.isopenkey;var page=1;var pagerows=0;if(this.gridpanel&&this.gridpanel.paginationInfo){page=this.gridpanel.paginationInfo.page||1;pagerows=this.gridpanel.paginationInfo.pagerows||0}lineIndex=index+lineIndex+1+((page-1)*pagerows);var cls="";if((lineIndex)%2==0){cls="jazz-gridtable-even"}else{cls="jazz-gridtable-odd"}var rowHtml='<tr index="'+(lineIndex-1)+'" class="jazz-grid-row '+cls+' " id="'+data[id]+'">';rowHtml+='<th style="height:20px;"></th>';var b="";if(this._isSelectHelper()&&this._isSelectType()){if($this._isMultipleSelection()){b="checkbox"}else{if($this._isSingleSelection()){b="radio"}}rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box"><input type="'+b+'"/></td>'}if(lineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no">'+lineIndex+"</td>"}var columnname="",stm="",textalign="",title="";for(var j=0,len=this.cols.length;j<len;j++){columnname=this.cols[j]["columnname"];textalign=this.cols[j]["textalign"]||"";title="";stm="&nbsp;";if(columnname&&data[columnname]!=undefined){if(data[columnname].toString().indexOf("<")!=0){title=data[columnname]||""}stm=data[columnname]}if(textalign){textalign="text-align-"+textalign}if(columnname==treeColumnName){rowHtml+='<td id="'+data[id]+'" pid="'+data[pId]+'" treelevel="'+data[lv]+'" class="jazz-grid-cell jazz-grid-tree-cell jazz-gridtree-lv'+data[lv]+' text-align-left" title='+title+">";if((data[childkey]&&data[childkey].length)||data[isparentkey]==true||data[isparentkey]=="true"){if(data[isopen]==true||data[isopen]=="true"){rowHtml+='<span class="jazz-gridtree-arrow jazz-gridtree-arrow-open"></span>'}else{rowHtml+='<span class="jazz-gridtree-arrow jazz-gridtree-arrow-close"></span>'}}else{rowHtml+='<span class="jazz-gridtree-arrow"></span>'}rowHtml+=(stm+"</td>")}else{rowHtml+='<td class="jazz-grid-cell '+textalign+'" title='+title+">"+stm+"</td>"}}return rowHtml},getChildrenRows:function(lineIndex){var arr=[],flag=false,lv=null;this.tbody.children().each(function(i){if(flag||$(this).attr("index")==lineIndex){if(lv===null){lv=parseInt($(this).find("[treelevel]").attr("treelevel"));flag=true}else{if(lv>=parseInt($(this).find("[treelevel]").attr("treelevel"))){flag=false}else{arr.push($(this))}}}});return arr},getAllTreeRows:function(){return this.tbody.children("tr")},fixTreeRowAttr:function(){var cls;this.tbody.children().each(function(i){if((i)%2==0){cls="jazz-gridtable-even"}else{cls="jazz-gridtable-odd"}$(this).attr("index",i).removeClass("jazz-gridtable-even").removeClass("jazz-gridtable-odd").addClass(cls);$(this).find(".jazz-grid-cell-no").html(i+1)})}})})(jQuery);(function($){$.widget("jazz.gridcard",$.jazz.boxComponent,{options:{vtype:"gridcard",name:null,width:null,height:null,margin:10,cardclass:"jazz-grid-qh-cardcell",html:function(data){var html='<div style="width:100%;height:100%"><div class="jazz-grid-cardcell-i"><div class="jazz-grid-bblb-img"></div></div><div class="jazz-grid-qh-c jazz-grid-bblb-c"><div class="jazz-grid-qh-c-h1">'+data.name+'</div><div class="jazz-grid-qh-c-date">'+data.org+'</div><div class="jazz-grid-cardcell-title" style="display:none;">'+data.name+"</div></div></div>";return html},isaddcard:true,addcardposition:"first",addcardrender:null,addcardclick:null,cardselect:null,cardunselect:null,carddblclick:null},_create:function(){this._super();this.compId=this.getCompId();var el=this.element;el.attr("id",this.compId+"_gridcard").addClass("jazz-gridcard");this.cardContent=$('<div id="'+this.compId+'_cardcontent" style="height:100%;"></div>').appendTo(el)},_init:function(){this._super();this._createGridCardOptions();this._bindGridcardSelectionEvent();this._calCardStyle();this._cardResize();if(this._isCardAddBtn()){this._addCardNewIcon()}},_width:function(){this.calculateGridcardWidth()},_height:function(){},_createGridCardOptions:function(){this.options.isshowselecthelper=true;this.options.selecttype=2;this.options.isshowpaginator=true;this.options.rowselectable=true;var parentobj=this.getParentComponent();if(parentobj&&parentobj.length>0){this.gridpanel=parentobj.data(parentobj.attr("vtype"));var gridoptions=this.gridpanel.options;this.options.isshowselecthelper=gridoptions.isshowselecthelper;this.options.selecttype=gridoptions.selecttype;this.options.isshowpaginator=gridoptions.isshowpaginator;this.options.rowselectable=gridoptions.rowselectable;var el=this.element;var pagearea=parentobj.find(".jazz-pagearea");if(pagearea&&pagearea.length>0){el.appendTo(pagearea);if(parseInt(gridoptions.height)>0||gridoptions.layout=="fit"){}else{this.cardContent.css("height","auto")}}else{el.wrap('<div class="jazz-pagearea" ></div>');pagearea=el.parent();if(parseInt(gridoptions.height)>0||gridoptions.layout=="fit"){pagearea.css({overflow:"hidden"})}else{this.cardContent.css("height","auto")}}if(gridoptions.defaultview=="card"){pagearea.css({overflow:"auto"})}this.gridcolumn=parentobj.find("div[vtype=gridcolumn]").data("gridcolumn");this.gridtable=parentobj.find("div[vtype=gridtable]").data("gridtable");if(this.gridcolumn){this.cols=this.gridcolumn.cols}}},calculateGridcardWidth:function(){this._calCardStyle();this._cardResize()},_getcardSizeStyle:function(){var style="";var width=this.options.width,height=this.options.height,margin=this.options.margin||"10px";if(width&&height){style=" style='width:"+width+";height:"+height+";margin:"+margin+";'"}return style},renderGridcardData:function(rowsdata){if(rowsdata){this._renderData(rowsdata)}},_renderData:function(rowsData){var $this=this,rows=rowsData;$this.cardContent.children().remove();if($this._isCardAddBtn()&&!$this._hasCardAddBtn()){$this._addCardNewIcon()}if(rows){var functionHtml="";if($this.options.isshowselecthelper==true||$this.options.isshowselecthelper=="true"){if($this.options.selecttype=="1"){functionHtml='<div class="jazz-grid-cardcell-functionarea" ><div class="jazz-grid-cardcell-functionarea-radio"><input class="jazz-card-checkbox" type="radio" style="width:16px;height:16px;" /></div></div>'}else{if($this.options.selecttype=="2"){functionHtml='<div class="jazz-grid-cardcell-functionarea" ><div class="jazz-grid-cardcell-functionarea-checkbox"><input class="jazz-card-checkbox" type="checkbox" style="width:16px;height:16px;" /></div></div>'}}}var cardmodel=$this.options.html;var style=$this._getcardSizeStyle();var cardclass=$this.options.cardclass;var cardHtml="",cellcontent="";for(var i=0,len=rows.length;i<len;i++){cardHtml='<div class="jazz-grid-cardcell '+cardclass+'" '+style+' id="'+rows[i]["rowuuid"]+'">';cellcontent=$this._customopration(cardmodel,rows[i])||"";cardHtml=cardHtml+cellcontent;cardHtml=cardHtml+functionHtml;var stm=rows[i]["@toolsopration"];if(stm){stm="<div class='jazz-grid-cardcell-tools' >"+stm+"</div>"}else{stm=""}cardHtml=cardHtml+stm+"</div>";$(cardHtml).appendTo($this.cardContent)}}},_isCardAddBtn:function(){return((this.options.isaddcard==false)||(this.options.isaddcard=="false")?false:true)},_hasCardAddBtn:function(){return this.cardContent.find(".jazz-card-new").length==0?false:true},_addCardNewIcon:function(){var $this=this,$cardContent=$this.cardContent,addcardposition=$this.options.addcardposition,addcardrender=$this.options.addcardrender,addcardclick=$this.options.addcardclick;var cardHtml="";if(addcardrender){cardHtml=$this._customopration(addcardrender)}else{cardHtml=$this._createCardNewIcon()}if(addcardposition&&addcardposition==="first"&&($cardContent.find("div.jazz-grid-cardcell:first").length>0)){$cardContent.find("div.jazz-grid-cardcell:first").before(cardHtml)}else{$cardContent.append(cardHtml)}if(addcardclick){$cardContent.find("div.jazz-card-new").on("click",function(e){$this._event("addcardclick",e)})}},_createCardNewIcon:function(){var $this=this;if(!$this.cardCell){$this._calCardStyle()}var cardHeight=$this.cardCell.cardHeight;var style=$this._getcardSizeStyle();var cardclass=$this.options.cardclass;var addcard='<div class="jazz-grid-cardcell '+cardclass+'" '+style+'><div class="jazz-card-new" style="height:'+cardHeight+'px;"></div></div>';return addcard},_calCardStyle:function(){var $this=this,style=$this._getcardSizeStyle(),cardclass=$this.options.cardclass,card="<div class='jazz-grid-cardcell "+cardclass+"' "+style+"></div>",cardOuterwidth=$(card).outerWidth(true),cardWidth=$(card).width(),cardHeight=$(card).height(),cardMargin=$(card).outerWidth(true)-$(card).width();var cardContentWidth=this.element.parent().width();var total=Math.floor(cardContentWidth/(cardOuterwidth+2)),cardContainerWidth=total*(cardOuterwidth+2);$this.cardCell={total:total,cardWidth:cardWidth,cardHeight:cardHeight,cardMargin:cardMargin,cardContainerWidth:cardContainerWidth}},_cardResize:function(flag){if(!this.cardCell){return}var $this=this,cardCell=$this.cardCell,cardContainerWidth=cardCell.cardContainerWidth,total=cardCell.total;if(flag){total=Math.floor($this.element.parent().width()/(cardCell.cardWidth+22)),cardContainerWidth=total*(cardCell.cardWidth+22)}$this.cardContent.css({width:cardContainerWidth+"px",margin:"0 auto"})},_isSingleSelection:function(){var selecttype=this.options.selecttype;return(selecttype==1||selecttype=="1")},_isMultipleSelection:function(){var selecttype=this.options.selecttype;return(selecttype==2||selecttype=="2")},_bindGridcardSelectionEvent:function(){var $this=this;var selector="div.jazz-grid-cardcell";this.cardContent.on("mouseover.gridcard",selector,null,function(e){var element=$(this);if(!element.hasClass("jazz-gridtable-highlight")){element.addClass("jazz-gridtable-hover")}var tipObj=element.find("div.jazz-grid-qh-c-h1");if(tipObj.size()>0){var tip=element.find(".jazz-grid-cardcell-title").text();tipObj.tooltip({iconclass:"jazz-tooltip-default-icon",content:tip})}}).on("mouseout.gridcard",selector,null,function(){var element=$(this);if(!element.hasClass("jazz-gridtable-highlight")){element.removeClass("jazz-gridtable-hover")}}).on("click.gridcard",selector,null,function(e){if($(e.target).is(":input,div.jazz-grid-cardcell-functionarea-checkbox,div.jazz-grid-cardcell-functionarea-radio")){return}if($(e.target).is("a")||$(e.target).parent().is("div.jazz-grid-cardcell-tools")){return}if($(this).hasClass("jazz-card-new")){return}if($(this).children().hasClass("jazz-card-new")){return}var that=this;if($this.options.rowselectable||$this.options.rowselectable=="true"){setTimeout(function(){$this._onCardClick(e,that,false)},200)}}).on("dblclick.gridcard",selector,null,function(e){if($(e.target).is(":input, div.jazz-grid-cardcell-functionarea-checkbox,div.jazz-grid-cardcell-functionarea-radio")){return}if($(e.target).is("a")||$(e.target).parent().is("div.jazz-grid-cardcell-tools")){return}if($(this).hasClass("jazz-card-new")){return}if($(this).children().hasClass("jazz-card-new")){return}$this._onCardClick(e,this,true)}).on("click.cardcheckbox","input.jazz-card-checkbox",null,function(e){if($this._isMultipleSelection()){var row=e.target.parentNode.parentNode.parentNode;if($(this).attr("onclick")){}else{if(this.checked){$this._selectCard($(row),true,e)}else{$this._unselectCard($(row),true,e)}}}else{alert("组件选中类型非多选，无法触发复选框事件响应。")}})},_onCardClick:function(event,targetCard,flag){var card=$(targetCard);var isSelected=card.hasClass("jazz-gridtable-highlight");if(this._isMultipleSelection()){if(flag){this._selectCard(card,true,event,flag)}else{if(isSelected){this._unselectCard(card,true,event)}else{this._selectCard(card,true,event,flag)}}}else{if(flag){this._selectCard(card,true,event,flag)}else{if(isSelected){return}else{this._unselectAllCards();this._selectCard(card,true,event,flag)}}}},_getCardIndex:function(card){var index=-1;index=this.cardContent.find("div.jazz-grid-cardcell").index(card);if(this._isCardAddBtn()){if(this.options.addcardposition&&this.options.addcardposition==="first"){index-=1}}return index},_selectCard:function(row,isCallback,event,flag){var id=row.attr("id");row.removeClass("jazz-gridtable-hover").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if(row.find("input.jazz-card-checkbox")){row.find("input.jazz-card-checkbox").attr("checked",true)}if(row.find("input.jazz-card-radio")){row.find("input.jazz-card-radio").attr("checked",true)}if(this.gridtable){var tbody=this.gridtable.tbody;var thead=this.gridcolumn.tbody;var tablerow=tbody.find("#"+id);tablerow.addClass("jazz-row-selected").attr("aria-selected",true);if(tablerow.find("input:checkbox")){tablerow.find("input:checkbox").attr("checked",true)}if(tablerow.find("input:radio")){tablerow.find("input:radio").attr("checked",true);tablerow.siblings().find("input:radio").attr("checked",false)}if(tbody.find("input:checked").length==tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",true)}}if(isCallback){var data={};data=this.gridpanel.getSelectedRowDataById(id);if(flag==true){this._event("carddblclick",event,data)}else{this._event("cardselect",event,data)}}},_unselectCard:function(row,isCallback,event){var id=row.attr("id");row.removeClass("jazz-gridtable-highlight").attr("aria-selected","false");if(row.find("input.jazz-card-checkbox")){row.find("input.jazz-card-checkbox").attr("checked",false)}if(row.find("input.jazz-card-radio")){row.find("input.jazz-card-radio").attr("checked",false)}if(this.gridtable){var tbody=this.gridtable.tbody;var thead=this.gridcolumn.tbody;var tablerow=tbody.find("#"+id);tablerow.removeClass("jazz-row-selected").attr("aria-selected",false);if(tablerow.find("input:checkbox")){tablerow.find("input:checkbox").attr("checked",false)}if(tablerow.find("input:radio")){tablerow.find("input:radio").attr("checked",false)}if(tbody.find("input:checked").length!=tbody.find("input:checkbox").length){thead.find("input:checkbox").attr("checked",false)}}if(isCallback){var data={};data=this.gridpanel.getSelectedRowDataById(id);this._event("cardunselect",event,data)}},_selectAllCards:function(){this.cardContent.find("div.jazz-grid-cardcell").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if(this._isMultipleSelection()){this.cardContent.find("input.jazz-card-checkbox").attr("checked",true)}if(this.gridtable){var tbody=this.gridtable.tbody;var thead=this.gridcolumn.tbody;tbody.find("tr").addClass("jazz-row-selected").attr("aria-selected",true);if(this._isMultipleSelection()){tbody.find("input:checkbox").attr("checked",true);thead.find("input:checkbox").attr("checked",true)}}},_unselectAllCards:function(){this.cardContent.find("div.jazz-grid-cardcell").removeClass("jazz-gridtable-highlight").attr("aria-selected",false);this.cardContent.find("input.jazz-card-checkbox").attr("checked",false);this.cardContent.find("input.jazz-card-radio").attr("checked",false);if(this.gridtable){var tbody=this.gridtable.tbody;var thead=this.gridcolumn.tbody;tbody.find("tr").removeClass("jazz-row-selected").attr("aria-selected",false);if(this._isMultipleSelection()){tbody.find("input:checkbox").attr("checked",false);thead.find("input:checkbox").attr("checked",false)}}},addCard:function(data){if(!data){return}var cardHtml=this._creatCardHtml(data);if(cardHtml){if(this.options.addcardposition=="last"){this.cardContent.find("div.jazz-grid-cardcell:last").before(cardHtml)}else{this.cardContent.append(cardHtml)}}},_creatCardHtml:function(rows){var $this=this;if(rows){var functionHtml="";if($this.options.isshowselecthelper==true||$this.options.isshowselecthelper=="true"){if($this.options.selecttype=="1"){functionHtml='<div class="jazz-grid-cardcell-functionarea" ><div class="jazz-grid-cardcell-functionarea-radio"><input class="jazz-card-checkbox" type="radio" style="width:16px;height:16px;" /></div></div>'}else{if($this.options.selecttype=="2"){functionHtml='<div class="jazz-grid-cardcell-functionarea" ><div class="jazz-grid-cardcell-functionarea-checkbox"><input class="jazz-card-checkbox" type="checkbox" style="width:16px;height:16px;" /></div></div>'}}}var cardmodel=$this.options.html;var style=$this._getcardSizeStyle();var cardclass=$this.options.cardclass;var cardHtml="";for(var i=0,len=rows.length;i<len;i++){cardHtml+='<div class="jazz-grid-cardcell '+cardclass+'" '+style+' id="'+rows[i]["rowuuid"]+'">';cellcontent=$this._customopration(cardmodel,rows[i])||"";cardHtml=cardHtml+cellcontent;cardHtml=cardHtml+functionHtml;var stm=rows[i]["@toolsopration"];if(stm){stm="<div class='jazz-grid-cardcell-tools' >"+stm+"</div>"}else{stm=""}cardHtml=cardHtml+stm+"</div>"}return cardHtml}},updateCardById:function(data,id){if(!data||!id){return}var carddata=[];carddata.push(data);var cardobj=this.cardContent.find("#"+id);var cardHtml=this._creatCardHtml(carddata);if(cardHtml){cardobj.replaceWith(cardHtml)}},removeCardById:function(id){this.cardContent.find("#"+id).remove()},selectRow:function(id){if(!id){return false}var $this=this;var card=this.cardContent.find("#"+id);card.removeClass("jazz-gridtable-hover").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",true)}}else{if(card.find("input.jazz-card-radio")){card.find("input.jazz-card-radio").attr("checked",true);card.siblings().find("input.jazz-card-radio").attr("checked",false)}}},unselectRow:function(id){if(!id){return false}var $this=this;var card=this.cardContent.find("#"+id);card.removeClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",false)}}},unselectAllRows:function(){var $this=this;this.cardContent.find("div.jazz-grid-cardcell").removeClass("jazz-gridtable-highlight").attr("aria-selected",false);if($this._isMultipleSelection()){this.cardContent.find("input.jazz-card-checkbox").attr("checked",false)}},selectAllRows:function(){var $this=this;this.cardContent.find("div.jazz-grid-cardcell").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){this.cardContent.find("input.jazz-card-checkbox").attr("checked",true)}}})})(jQuery);(function($){jazz.grid.editorgridpanel={setEditorCell:function(rowIndex,colIndex,editState){var rowIndex=parseInt(rowIndex);var colIndex=parseInt(colIndex);var editState=editState==true||editState=="true";if(rowIndex>0||colIndex>0){if(this.gtable){this.gtable.gridtable("setEditorCell",rowIndex,colIndex,editState)}}},addEidtorRow:function(insertPosition){if(this.gtable){var data={};if(this.rows.length>0){var copyrow=this.rows[0];for(var key in copyrow){data[key]=null}}else{if(this.gcolumn){var gridcolumn=this.gcolumn.data("gridcolumn");cols=gridcolumn.cols;var columnname="";for(var j=0,len=cols.length;j<len;j++){columnname=cols[j]["columnname"];data[columnname]=null}}}data.eidtorstate="editing";data.rowuuid=Math.uuid(32);this.gtable.gridtable("addEidtorRow",data,insertPosition);this.rows.push(data)}},getUpdatedRowData:function(){var that=this;var rows=that.rows;var data=[],state="",temp=null;for(var i=0,len=rows.length;i<len;i++){state=rows[i]["eidtorstate"];if(state){temp={};$.extend(true,temp,rows[i]);data.push(temp)}}return data||[]},_renderGridpanelData:function(rowsdata){var $this=this;$this._processGridpanelData(rowsdata);var delay=100,timeout=5000;if($this.gtable){var gridtable=$this.gtable.data("gridtable");if(gridtable){gridtable.renderGridtableData(rowsdata,true)}else{loopReloadData($this.gtable,"gridtable",0)}}if($this.gcard){var gridcard=$this.gcard.data("gridcard");if(gridcard){gridcard.renderGridcardData(rowsdata,true)}else{loopReloadData($this.gcard,"gridcard",0)}}if($this.gpaginator){var paginator=$this.gpaginator.data("paginator");var a=$this.paginationInfo;if(paginator){paginator.updatePage({page:a.page,pagerows:a.pagerows,totalrecords:a.totalrows})}else{loopReloadData($this.gpaginator,"paginator",0)}}var isshoweditcell=$this.options.isshoweditcell;if(isshoweditcell){if($this.gtable){var gridtable=$this.gtable.data("gridtable");gridtable.createEditorCell()}}$this._event("dataloadcomplete",null,{data:$this.rows,paginationInfo:$this.paginationInfo});function loopReloadData(obj,dataname,count){var compObject=obj.data(dataname);if(compObject){if(dataname=="gridtable"){compObject.renderGridtableData(rowsdata,true)}else{if(dataname=="gridcard"){compObject.renderGridcardData(rowsdata,true)}else{if(dataname=="paginator"){compObject.updatePage({page:$this.paginationInfo.page,pagerows:$this.paginationInfo.pagerows,totalrecords:$this.paginationInfo.totalrows})}}}}else{if(count*delay<=timeout){count++;setTimeout(function(){loopReloadData(obj,dataname,count)},delay)}}}},_requestLoadData:function(data,fn,flag){var that=this;that._processGridpanelData(data);if(that.gtable){that.gtable.gridtable("renderGridtableData",data)}if(that.gcard){that.gcard.gridcard("renderGridcardData",data)}var isshoweditcell=that.options.isshoweditcell;if(isshoweditcell){if(that.gtable){var gridtable=that.gtable.data("gridtable");gridtable.createEditorCell()}}var a=that.paginationInfo;if(flag){if(that.options.isshowpaginator&&that.gpaginator){that.gpaginator.paginator("updatePage",{page:a.page,pagerows:a.pagerows,totalrecords:a.totalrows})}}if(fn&&$.isFunction(fn)){fn.call(that,that.rows,a)}}}})(jQuery);(function($){jazz.grid.editorgridtable={_insertRowHtml:function(rowObj,index,lineIndex){var $this=this;var data=rowObj;var lineno=this.options.lineno;var page=1;var pagerows=0;if(this.gridpanel&&this.gridpanel.paginationInfo){page=this.gridpanel.paginationInfo.page||1;pagerows=this.gridpanel.paginationInfo.pagerows||0}lineIndex=index+lineIndex+1+((page-1)*pagerows);var cls="";if((lineIndex)%2==0){cls="jazz-gridtable-even"}else{cls="jazz-gridtable-odd"}var rowHtml='<tr index="'+(lineIndex-1)+'" class="jazz-grid-row '+cls+' " id="'+data.rowuuid+'">';rowHtml+='<th style="height:20px;"></th>';var b="";if(this._isSelectHelper()&&this._isSelectType()){if($this._isMultipleSelection()){b="checkbox"}else{if($this._isSingleSelection()){b="radio"}}rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box"><input type="'+b+'"/></td>'}if(lineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no">'+lineIndex+"</td>"}var iseditable=false;if(this.gridpanel&&this.gridpanel.paginationInfo){iseditable=this.gridpanel.options.iseditable}var columnname="",stm="",textalign="",columneditor=null,title="";for(var j=0,len=this.cols.length;j<len;j++){columnname=this.cols[j]["columnname"];textalign=this.cols[j]["textalign"]||"";columneditor=this.cols[j]["iseditable"];title="";stm="&nbsp;";if(columnname&&data[columnname]!=undefined){if(data[columnname].toString().indexOf("<")!=0){title=data[columnname]||""}stm=data[columnname]}if(textalign){textalign="text-align-"+textalign}if(iseditable){columneditor=columneditor==false||columneditor=="false"?"":"celleditable"}else{columneditor=columneditor==true||columneditor=="true"?"celleditable":""}rowHtml+='<td class="jazz-grid-cell '+textalign+" "+columneditor+'" title='+title+">"+stm+"</td>"}return rowHtml},_bindGridTableSelectionEvent:function(){var that=this;this.tbody.on("click.td","td.jazz-grid-cell",null,function(e){if($(this).parent().hasClass("nodata")){return}if($(e.target).is("a")){return}that._onRowClickEvent(e,$(this),false)}).on("dblclick.td","td.jazz-grid-cell",null,function(e){if($(this).parent().hasClass("nodata")){return}if($(e.target).is("a")){return}that._onRowClickEvent(e,$(this),true)});$(document).on("mousedown.editorgrid",function(e){var target=$(e.target);if(!that.pretd||!that.pretd[0]){return}if(that.pretd[0]==target[0]||that.pretd.find(target)[0]){return}var isshoweditcell=that.options.isshoweditcell;if(isshoweditcell){that._showeditcellChange(e)}else{that._editorChange(e)}})},_onRowClickEvent:function(e,tdEl,dbclick){var $this=this;var targetrow=$(tdEl).parent();var editortype=$this.options.editortype;var rowselectable=$this.options.rowselectable||$this.options.rowselectable=="true";if(tdEl.hasClass("celleditable")){if(dbclick){if(rowselectable){$this._shiftToRowSelectedStyle(targetrow)}$this._editTdClick(e,targetrow,tdEl)}else{setTimeout(function(){if(rowselectable){$this._shiftToRowSelectedStyle(targetrow)}$this._editTdClick(e,targetrow,tdEl)},100)}}else{if(rowselectable){if(dbclick){$this._onRowClick(e,targetrow,true)}else{setTimeout(function(){$this._onRowClick(e,targetrow,false)},100)}}else{if($(e.target).is(".jazz-grid-cell-box :input")){$this._onRowClick(e,targetrow,false)}}if(editortype=="row"){$this._editTdClick(e,targetrow,tdEl)}}},_shiftToRowSelectedStyle:function(row){var $this=this;var id=row.attr("id");row.addClass("jazz-row-selected").attr("aria-selected",true);if($this._isMultipleSelection()){if(row.find("input:checkbox")){row.find("input:checkbox").attr("checked",true)}if($this.tbody.find("input:checked").length==$this.tbody.find("input:checkbox").length){var thead=$this.gridcolumn.tbody;thead.find("input:checkbox").attr("checked",true)}}else{if(row.find("input:radio")){row.find("input:radio").attr("checked",true);row.siblings().find("input:radio").attr("checked",false)}}if($this.gridpanel.gcard){var card=$this.gridpanel.gcard.find("#"+id);card.removeClass("jazz-gridtable-hover").addClass("jazz-gridtable-highlight").attr("aria-selected",true);if($this._isMultipleSelection()){if(card.find("input.jazz-card-checkbox")){card.find("input.jazz-card-checkbox").attr("checked",true)}}else{if(card.find("input.jazz-card-radio")){card.find("input.jazz-card-radio").attr("checked",true);card.siblings().find("input.jazz-card-radio").attr("checked",false)}}}},_resetPretdComponent:function(){var that=this;that.pretd=null;that.pretdoption=null;that.prevtype=null;that.preheadname=null;that.preid=null;that.predata=null},_reValuePretdComponent:function(event,tr,td){var that=this;var comp=td.children();var vtype=comp.attr("vtype")||"";var index=td.index()||-1;var headname=that.thead.find("th").eq(index).attr("name");var id=tr.attr("id");var data=that.gridpanel.getSelectedRowDataById(id);var headerCells=that.gridcolumn.options.header;var tdoption=that._getDefinedColumn(headerCells,headname);that.pretd=td;that.pretdoption=tdoption;that.compobject=comp.data(vtype);that.prevtype=vtype;that.preheadname=headname;that.preid=id;that.predata=data},_editTdClick:function(event,tr,td){var that=this;var editortype=that.options.editortype;if(editortype=="row"){if(that.pretd&&that.pretd[0]==td[0]){return}else{if(tr.find("div[vtype]").length>0){if(td.hasClass("celleditable")){that._reValuePretdComponent(event,tr,td)}else{}}else{$(tr).find("td.celleditable").each(function(i){that._createCellEditorComponent(event,tr,$(this))});var defaultTD=$(tr).find("td.celleditable:first");that._reValuePretdComponent(event,tr,defaultTD)}}}else{if(editortype=="column"){if(that.pretd&&that.pretd[0]==td[0]){return}else{if(td.find("div[vtype]").length>0){if(td.hasClass("celleditable")){that._reValuePretdComponent(event,tr,td)}else{that._resetPretdComponent()}}else{var index=td.index();that.tbody.find("tr").each(function(i){var obj=$(this).children().eq(index);that._createCellEditorComponent(event,$(this),obj)});var defaultTR=that.tbody.find("tr:first");var defaultTD=defaultTR.children().eq(index);that._reValuePretdComponent(event,defaultTR,defaultTD)}}}else{if(that.pretd&&that.pretd[0]==td[0]){return}else{that._createCellEditorComponent(event,tr,td);that._reValuePretdComponent(event,tr,td);var inputObj=td.find("input[class='jazz-field-comp-input']");if(inputObj[0]){inputObj.focus()}}}}},_createCellEditorComponent:function(event,tr,td){var that=this;var editortype=that.options.editortype;var comp=td.children();var vtype=comp.attr("vtype")||"";if(!vtype){td.empty();var index=td.index()||-1;var headname=that.thead.find("th").eq(index).attr("name");td.addClass("jazz-grid-cell-editing");comp=$("<div style='margin:0px;padding:0px;'>").appendTo(td);var vtype="textfield",options={width:td.width(),height:td.height()};var headerCells=that.gridcolumn.options.header;if(headerCells){var tdoption=that._getDefinedColumn(headerCells,headname);if(tdoption){$.extend(true,options,tdoption);options.name="";vtype=tdoption.datatype||"textfield";if(vtype=="comboxtreefield"||vtype=="comboxfield"){var compdataurl=tdoption.valueset;if(compdataurl){if(compdataurl.trim().indexOf("[")===0){compdataurl=eval("("+compdataurl+")")}$.extend(options,{dataurl:compdataurl})}}}}comp[vtype](options);var compobject=comp.data(vtype);var id=tr.attr("id");var data=that.gridpanel.getSelectedRowDataById(id);var value=data&&data[headname]?data[headname]:"";compobject.setValue(value)}},_editorChange:function(e){var that=this;var headname=that.preheadname||"";var newText=that.compobject.getText()||"";var newValue=that.compobject.getValue()||"";var oldValue=that.predata[headname]||"";if((!oldValue&&!newValue)||newValue==oldValue){}else{that.predata[headname]=newValue||"";that.predata.eidtorstate="editing";that.pretd.addClass("jazz-editgrid-state");var predataid="";predataid=that.preid}var editortype=that.options.editortype;var target=$(e.target);if(editortype=="row"){var prerow=that.pretd.parent();if(prerow.has(target).length>0){}else{$(prerow).find("td.celleditable").each(function(i){var comp=$(this).find("div[vtype]");var v="";if(comp[0]){var vtype=comp.attr("vtype");var compobject=comp.data(vtype);v=compobject.getText()||""}$(this).empty();var index=$(this).index()||-1;var headname=that.thead.find("th").eq(index).attr("name");var headerCells=that.gridcolumn.options.header;var tdoption=that._getDefinedColumn(headerCells,headname);var datatype=tdoption.datatype;var dataformat=tdoption.dataformat;if(datatype&&v!=undefined){v=jazz.util.parseDataByDataFormat({cellvalue:v,datatype:datatype,dataformat:dataformat})}$(this).removeClass("jazz-grid-cell-editing").text(v).attr("title",v)});that._resetPretdComponent()}}else{if(editortype=="column"){var index=that.pretd.index();var td=target.closest("td");if(td[0]&&that.tbody.find(td).length>0&&td.index()==index){}else{that.tbody.find("tr").each(function(i){var tdobj=$(this).children().eq(index);var comp=tdobj.find("div[vtype]");var v="";if(comp[0]){var vtype=comp.attr("vtype");var compobject=comp.data(vtype);v=compobject.getText()||""}tdobj.empty();var headname=that.thead.find("th").eq(index).attr("name");var headerCells=that.gridcolumn.options.header;var tdoption=that._getDefinedColumn(headerCells,headname);var datatype=tdoption.datatype;var dataformat=tdoption.dataformat;if(datatype&&v!=undefined){v=jazz.util.parseDataByDataFormat({cellvalue:v,datatype:datatype,dataformat:dataformat})}tdobj.removeClass("jazz-grid-cell-editing").text(v).attr("title",v)});that._resetPretdComponent()}}else{var datatype=that.pretdoption.datatype;var dataformat=that.pretdoption.dataformat;if(datatype&&newText!=undefined){newText=jazz.util.parseDataByDataFormat({cellvalue:newText,datatype:datatype,dataformat:dataformat})}that.pretd.empty().removeClass("jazz-grid-cell-editing").text(newText).attr("title",newText);that.tbody.find(".jazz-grid-cell-edited").removeClass("jazz-grid-cell-edited");that.pretd.addClass("jazz-grid-cell-edited");that._resetPretdComponent()}}if(this.options.isgroupsummary||this.options.ispagesummary){if(predataid){that.tbody.trigger("cellvaluechange.summaryrow",[predataid])}}},_showeditcellChange:function(event){var that=this;var headname=that.preheadname||"";var newText=that.compobject.getText()||"";var newValue=that.compobject.getValue()||"";var oldValue=that.predata[headname]||"";if((!oldValue&&!newValue)||newValue==oldValue){}else{var datatype=that.pretdoption.datatype;var dataformat=that.pretdoption.dataformat;if(datatype&&newValue!=undefined){newValue=jazz.util.parseDataByDataFormat({cellvalue:newValue,datatype:datatype,dataformat:dataformat})}that.predata[headname]=newValue||"";that.predata.eidtorstate="editing"}that.pretd.attr("title",newText);that._resetPretdComponent()},_getDefinedColumn:function(cells,name){var $this=this;var opt=null;if($.isArray(cells)){for(var i=0,len=cells.length;i<len;i++){var cell=cells[i];if($.isArray(cell)){opt=$this._getDefinedColumn(cell,name)}else{if(name==cell.name){opt=cell;break}}}}return opt},setEditorCell:function(rowIndex,colIndex,editState){},createEditorCell:function(){var that=this;$.each(this._trObject(),function(i,obj){var tr=$(this);tr.find("td.celleditable").each(function(i){var td=$(this);that._createCellEditorComponent(null,tr,td)})})},addEidtorRow:function(data,insertPosition){var rowHtml="";var p=parseInt(insertPosition);var lineIndex=this._trNumber();if(p===0||insertPosition=="first"){rowHtml=this._insertRowHtml(data,0,0);$(rowHtml).insertBefore(this.tbody.children().first());this._updateIndex()}else{if(p>0&&p<lineIndex){rowHtml=this._insertRowHtml(data,0,0);$(rowHtml).insertBefore(this.tbody.children().eq(p));this._updateIndex()}else{rowHtml=this._insertRowHtml(data,0,lineIndex);$(rowHtml).appendTo(this.tbody)}}}}})(jQuery);(function($){jazz.grid.groupgridtable={_bindGroupGridTableEvent:function(){var that=this;this.tbody.on("click.tr","tr.jazz-grid-group-row",null,function(e){var isgroupsummary=that.options.isgroupsummary;var ispagesummary=that.options.ispagesummary;if($(this).hasClass("jazz-grid-group-expand")){$(this).removeClass("jazz-grid-group-expand").addClass("jazz-grid-group-collapse");if(isgroupsummary){$(this).nextUntil(".jazz-grid-groupsummary-row").show()}else{if(ispagesummary){if($(this)[0]==that.tbody.find("tr.jazz-grid-group-row").last()[0]){$(this).nextUntil(".jazz-grid-pagesummary-row").show()}else{$(this).nextUntil(".jazz-grid-group-row").show()}}else{$(this).nextUntil(".jazz-grid-group-row").show()}}}else{if($(this).hasClass("jazz-grid-group-collapse")){$(this).removeClass("jazz-grid-group-collapse").addClass("jazz-grid-group-expand");if(isgroupsummary){$(this).nextUntil(".jazz-grid-groupsummary-row").hide()}else{if(ispagesummary){if($(this)[0]==that.tbody.find("tr.jazz-grid-group-row").last()[0]){$(this).nextUntil(".jazz-grid-pagesummary-row").hide()}else{$(this).nextUntil(".jazz-grid-group-row").hide()}}else{$(this).nextUntil(".jazz-grid-group-row").hide()}}}}})},_bindSummaryGridTableEvent:function(){var that=this;this.tbody.on("cellvaluechange.summaryrow",function(event){that._computeGroupAndPageSummartResult()})},_renderData:function(rows){if(!rows){return}var groupfieldId=this.options.groupfield;var groupfieldTitle=this.options.grouptitlefield;var isgroupsummary=this.options.isgroupsummary;var ispagesummary=this.options.ispagesummary;rows.sort(function(a,b){return parseInt(a[groupfieldId])-parseInt(b[groupfieldId])});var lineIndex=0;var rowHtml=[];this._trObject().remove();lineIndex=this._trNumber();var groupId,grouptitle;for(var i=0;i<rows.length;i++){if(i==0){groupId=rows[i][groupfieldId];grouptitle=rows[i][groupfieldTitle]||"";rowHtml.push(this._getGroupRowHtml(groupId,grouptitle))}if(groupId==rows[i][groupfieldId]){}else{if(isgroupsummary){rowHtml.push(this._getSummaryRowHtml("groupsummary"))}groupId=rows[i][groupfieldId];grouptitle=rows[i][groupfieldTitle]||"";rowHtml.push(this._getGroupRowHtml(groupId,grouptitle))}rowHtml.push(this._insertRowHtml(rows[i],i,lineIndex))}if(isgroupsummary){rowHtml.push(this._getSummaryRowHtml("groupsummary"))}if(ispagesummary){rowHtml.push(this._getSummaryRowHtml("pagesummary"))}this.tbody.append(rowHtml.join(""));var isexpand=this.options.isgroupexpand;if(!isexpand){this.tbody.children("tr.jazz-grid-group-row").each(function(){if(isgroupsummary){$(this).nextUntil(".jazz-grid-groupsummary-row").hide()}else{if(ispagesummary){if($(this)[0]==that.tbody.find("tr.jazz-grid-group-row").last()[0]){$(this).nextUntil(".jazz-grid-pagesummary-row").hide()}else{$(this).nextUntil(".jazz-grid-group-row").hide()}}else{$(this).nextUntil(".jazz-grid-group-row").hide()}}})}this._computeGroupAndPageSummartResult(rows);var trObjs=this.tbody.children(".jazz-grid-row");this._event("rowrender",null,{data:rows,rowEl:trObjs})},_getGroupRowHtml:function(groupId,grouptitle){var groupId=groupId||"";var isexpand=this.options.isgroupexpand;var expandclass=isexpand?"jazz-grid-group-collapse":"jazz-grid-group-expand";var rowHtml='<tr class="jazz-grid-group-row '+expandclass+'" groupid="'+groupId+'" >';rowHtml+='<th style="height:20px;"></th>';var colspan_num=0;if(this._isSelectHelper()&&this._isSelectType()){colspan_num++}if(this.options.lineno){colspan_num++}colspan_num+=this.cols.length;rowHtml+='<td class="jazz-grid-cell" colspan="'+colspan_num+'"><div class="jazz-grid-group-title">'+grouptitle+"</div></td></tr>";return rowHtml},_computeGroupAndPageSummartResult:function(rows){var that=this;var isgroupsummary=this.options.isgroupsummary;var ispagesummary=this.options.ispagesummary;if(isgroupsummary){this.tbody.find("tr.jazz-grid-group-row").each(function(i){var siblings=$(this).nextUntil(".jazz-grid-group-row");var groupdata=[],data;$.each(siblings,function(j,obj){var id=$(obj).attr("id");if(id){data=that.gridpanel.getSelectedRowDataById(id);groupdata.push(data)}});var summaryrow=siblings.filter("tr.jazz-grid-groupsummary-row");that._computeSummaryResult(groupdata,summaryrow)})}if(ispagesummary){var summaryrow=this.tbody.find("tr.jazz-grid-pagesummary-row");if(!rows){rows=this.gridpanel.getAllData()}this._computeSummaryResult(rows,summaryrow)}},_computeSummaryResult:function(rows,summaryrow){var columnname="",issummary="",result=0,value;for(var j=0,len=this.cols.length;j<len;j++){issummary=this.cols[j]["issummary"];if(issummary){columnname=this.cols[j]["columnname"];summarytype=this.cols[j]["summarytype"];summaryrender=this.cols[j]["summaryrender"];var result=this._getSummaryTypeResult(columnname,rows,summarytype);result=this._getSummaryRenderResult(result,rows,summaryrender);var index=this.thead.find("th[name='"+columnname+"']").index();summaryrow.children().eq(index).text(result)}}},_getSummaryTypeResult:function(columnname,rows,type){if(type){var result;if(type.indexOf("(")!=-1){result=this._customopration(type,rows);return result}var temp=[],value;for(var i=0;i<rows.length;i++){value=rows[i][columnname];temp.push(value)}switch(type){case"count":return rows.length;case"min":var x=Math.min.apply(null,temp);return Math.min.apply(null,temp);case"max":return Math.max.apply(null,temp);case"sum":return eval(temp.join("+"));case"average":var count=temp.length;var sum=eval(temp.join("+"));if(count>0){return Math.round(sum/count)}else{return 0}default:return""}}else{return""}},_getSummaryRenderResult:function(result,rows,format){if(format){if(format.indexOf("(")!=-1){result=this._customopration(format,result,rows);return result}}else{return result}},_getSummaryRowHtml:function(summary){var rowHtml='<tr class="jazz-grid-'+summary+'-row">';rowHtml+='<th style="height:20px;"></th>';var isselect=this._isSelectHelper()&&this._isSelectType();var islineno=this.options.lineno;var hj=summary=="groupsummary"?"合计":"总合计";if(isselect&&islineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box" colspan="2">'+hj+"</td>";rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no" style="display:none;"></td>'}else{if(isselect){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box" colspan="2">'+hj+"</td>"}if(islineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no">'+hj+"</td>"}}var textalign;for(var j=0,len=this.cols.length;j<len;j++){textalign=this.cols[j]["textalign"]||"";if(textalign){textalign="text-align-"+textalign}rowHtml+='<td class="jazz-grid-cell '+textalign+'">&nbsp;</td>'}return rowHtml},addRow:function(data){if(!data){return}var rowHtml="";var lineIndex=this._trNumber();for(var i=0;i<data.length;i++){rowHtml+=this._insertRowHtml(data[i],i,lineIndex)}var trobj=null;if(rowHtml){trobj=$(rowHtml).prependTo(this.tbody)}this._event("rowrender",null,{data:data,rowEl:trobj});var isgroupsummary=this.options.isgroupsummary;var groupfieldId=this.options.groupfield;var groupfieldTitle=this.options.grouptitlefield;var id="",groupId="",trrow,targetgroup,grouprows,groupLastRow;for(var i=0;i<data.length;i++){id=data[i]["rowuuid"];groupId=data[i][groupfieldId];grouptitle=data[i][groupfieldTitle];trrow=this.tbody.find("#"+id);targetgroup=this.tbody.find("tr[groupid='"+groupId+"']");if(targetgroup[0]){grouprows=targetgroup.nextUntil("tr.jazz-grid-group-row");groupLastRow=grouprows.filter("tr.jazz-grid-row:last");groupLastRow.after(trrow)}else{var groupTrHtml="";groupTrHtml+=this._getGroupRowHtml(groupId,grouptitle);if(isgroupsummary){groupTrHtml+=this._getSummaryRowHtml("groupsummary")}var groupTrs=$(groupTrHtml).prependTo(this.tbody);groupTrs.filter("tr.jazz-grid-group-row").after(trrow)}}if(this.options.isgroupsummary||this.options.ispagesummary){this.tbody.trigger("cellvaluechange.summaryrow")}}}})(jQuery);(function($){jazz.grid.summarygridtable={_renderData:function(rows){if(!rows){return}var lineIndex=0;var rowHtml=[];this._trObject().remove();lineIndex=this._trNumber();for(var i=0;i<rows.length;i++){rowHtml.push(this._insertRowHtml(rows[i],i,lineIndex))}rowHtml.push(this._getSummaryRowHtml("pagesummary"));this.tbody.append(rowHtml.join(""));var summaryrow=this.tbody.find("tr.jazz-grid-pagesummary-row");this._computeSummaryResult(rows,summaryrow);var trObjs=this.tbody.children(".jazz-grid-row");this._event("rowrender",null,{data:rows,rowEl:trObjs})},_computeSummaryResult:function(rows,summaryrow){var columnname="",issummary="",result=0,value;for(var j=0,len=this.cols.length;j<len;j++){issummary=this.cols[j]["issummary"];if(issummary){columnname=this.cols[j]["columnname"];summarytype=this.cols[j]["summarytype"];summaryrender=this.cols[j]["summaryrender"];var result=this._getSummaryTypeResult(columnname,rows,summarytype);result=this._getSummaryRenderResult(result,rows,summaryrender);var index=this.thead.find("th[name='"+columnname+"']").index();summaryrow.children().eq(index).text(result)}}},_getSummaryTypeResult:function(columnname,rows,type){if(type){var result;if(type.indexOf("(")!=-1){result=this._customopration(type,rows);return result}var temp=[],value;for(var i=0;i<rows.length;i++){value=rows[i][columnname];temp.push(value)}switch(type){case"count":return rows.length;case"min":return Math.min.apply(null,temp);case"max":return Math.max.apply(null,temp);case"sum":return eval(temp.join("+"));case"average":var count=temp.length;var sum=eval(temp.join("+"));if(count>0){return Math.round(sum/count)}else{return 0}default:return""}}else{return""}},_getSummaryRenderResult:function(result,rows,format){if(format){if(format.indexOf("(")!=-1){result=this._customopration(format,result,rows);return result}}else{return result}},_getSummaryRowHtml:function(summary){var rowHtml='<tr class="jazz-grid-'+summary+'-row">';rowHtml+='<th style="height:20px;"></th>';var isselect=this._isSelectHelper()&&this._isSelectType();var islineno=this.options.lineno;var hj=summary=="groupsummary"?"合计":"总合计";if(isselect&&islineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box" colspan="2">'+hj+"</td>";rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no" style="display:none;"></td>'}else{if(isselect){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-box" colspan="2">'+hj+"</td>"}if(islineno){rowHtml+='<td class="jazz-grid-cell jazz-grid-cell-no">'+hj+"</td>"}}var textalign;for(var j=0,len=this.cols.length;j<len;j++){textalign=this.cols[j]["textalign"]||"";if(textalign){textalign="text-align-"+textalign}rowHtml+='<td class="jazz-grid-cell '+textalign+'">&nbsp;</td>'}return rowHtml},addRow:function(data){if(!data){return}var rowHtml="";var lineIndex=this._trNumber();for(var i=0;i<data.length;i++){rowHtml+=this._insertRowHtml(data[i],i,lineIndex)}var trobj=null;if(rowHtml){trobj=$(rowHtml).prependTo(this.tbody)}this._event("rowrender",null,{data:data,rowEl:trobj});var isgroupsummary=this.options.isgroupsummary;var groupfieldId=this.options.groupfield;var groupfieldTitle=this.options.grouptitlefield;var id="",groupId="",trrow,targetgroup,grouprows,groupLastRow;for(var i=0;i<data.length;i++){id=data[i]["rowuuid"];groupId=data[i][groupfieldId];grouptitle=data[i][groupfieldTitle];trrow=this.tbody.find("#"+id);targetgroup=this.tbody.find("tr[groupid='"+groupId+"']");if(targetgroup[0]){grouprows=targetgroup.nextUntil("tr.jazz-grid-group-row");groupLastRow=grouprows.filter("tr.jazz-grid-row:last");groupLastRow.after(trrow)}else{var groupTrHtml="";groupTrHtml+=this._getGroupRowHtml(groupId,grouptitle);if(isgroupsummary){groupTrHtml+=this._getSummaryRowHtml("groupsummary")}var groupTrs=$(groupTrHtml).prependTo(this.tbody);groupTrs.filter("tr.jazz-grid-group-row").after(trrow)}}if(this.options.isgroupsummary||this.options.ispagesummary){this.tbody.trigger("cellvaluechange.summaryrow")}}}})(jQuery)});