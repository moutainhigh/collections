<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script src="../../static/js/jquery-1.8.3.js"></script>
<title>系统管理-人员添加</title>
<style type="text/css">
* {
	margin: 0;
	padding: 0
}

body {
	height: 350px;
	width: 400px;
	background: #f5f5f5;
	overflow-x: hidden;
}

li {
	list-style: none;
}

ul {
	background: #fff;
}

.m-r-4 {
	margin-right: 4px;
}

.m-t-10 {
	margin-top: 10px;
}

.content {
	width: 190px;
    margin: 0 auto;
}

.content .box {
	margin-left: 0px;
    width: 240px;
}

.btns {
	border: none;
	outline: none;
	text-align: center;
	background: #399CDE;
	color:#fff;
	width: 50px;
	height: 30px;
	line-height: 30px;
	border-radius: 7px;
}
.btns:hover{
	background: #47B976;
}


.childBox {
	margin-top: 19px;
}

.item-wrap {
	position: relative;
	    margin-top: 25px;
}
li:hover{background:#D9D9D9}


.add{
    padding: 4px;
    border: 0px;
    font-size: 12px;
    font-family: "宋体";
    width: 232px;
    height: 22px;
    display: block;
    line-height: 22px;
    border: 1px solid #C5D6E0;
}

.addSh{
    padding: 4px;
    border: 0px;
    font-size: 12px;
    font-family: "宋体";
    width: 232px;
    height: 22px;
    display: block;
    line-height: 22px;
    border: 1px solid #C5D6E0;
}


 input:focus { outline: none; }
</style>

<script>
	
</script>
</head>
<body>
<body>
	<div class="content">
		<div class="wrap">
			<div class="item-wrap">
				<label>
					<span class="m-r-4">用户账号:</span>
						<input type="text" id= 'userId'  class="add" />
						<br><br>
					<span class="m-r-4">用户姓名:</span>
						<input type="text" id= 'userName'  class="add" />
						<br><br>
					<span class="m-r-4">部门名称:</span>
						<input type="text" class="addSh" id= 'departmentName' onclick='showDep(this)' class="" />
						<ul id = "depBox" class="box floor1 fixBox">
						</ul>
						<br>
					<span class="m-r-4">角色代码:</span>
						<input type="text" class="addSh" id= 'roleName' onclick='showRole(this)' class="" />
						<ul id = "roleBox" class="box floor1 fixBox">
						</ul>
				</label>
					 <input type="hidden" value='' class="add" id="depCode" /> 
					 <input type="hidden" value='' class="add" id="roleCode" /> 
				
			</div>

		</div>
		<div class="childBox"></div>
		<br>
		<input type="button" value='保存' class="btns" id="btnSave" />
		<input type="button" value='重置' class="btns" id="btnReSet" />
		<input type="button" value='关闭' class="btns" id="btnClose" />
	</div>

	<script>
		$(function() {
			var num = 1;

			/* $("#btnAdd").click(function() {
				num++;
				if(num<6){
					$(".childBox").append("<div class='item-wrap'>"
							+ "<label><span class='m-r-4'>用户"+ num+ "</span><input type='text' class='add' onclick='show(this)'/></label>"
							+ "<ul class='box floor"+num+"'></ul></div>");
				}else{
					alert("最多可一次添加五名用户！");
				}
			}); */
		})
		
	   function getContextPath(){
			var pathName = document.location.pathname;//  /page/mgr/torch/sysconfig/functionList.html
			var index = pathName.substr(1).indexOf("/");//  4
			var result = pathName.substr(0,index+1);//    /page
			return result;
		}
		
		function showDep(obj){
			var _this = $(obj);
			_this.on("input propertychange",function(){
				_this.parents(".item-wrap").find(".box").html("");
				name = _this.val();
				$.ajax({
    				url : getContextPath()+"/otherselect/QueryDep.do",
    				 data :{
    					name : name
    				}, 
    				async : false,
    				type : 'post',
    				dataType : 'json',
    				contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
    				success : function(data) {
    					var _html ="";
    					var departmentname;
    					var departmentcode;
    					if(data){
    						for (var i = 0; i < data.length; i++) {
    							departmentname=data[i]["name"];
    							departmentcode=data[i]["code"];
        						_html = "<li tabindex='-1' data-floor='"+(i+1)+"' onclick='addDep(this)' width ='180px'   value = '"+departmentcode+"'>"+departmentname+"</li>";
    							_this.parents(".item-wrap").find("#depBox").append(_html);
        					}
    					}
    				},
    				error : function() {
    					jazz.warn("获取数据失败");
    				}
    			});
			});
		}
		
		
		function showRole(obj){
			var _this = $(obj);
			_this.on("click",function(){
				_this.parents(".item-wrap").find(".box").html("");
				//var userInfo = _this.val();
				$.ajax({
    				url : getContextPath()+"/otherselect/QueryRole.do",
    				/* data :{
    					userInfo : userInfo
    				}, */
    				async : false,
    				type : 'post',
    				dataType : 'json',
    				contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
    				success : function(data) {
    					var _html ="";
    					var rolename;
    					var rolecode;
    					if(data){
    						for (var i = 0; i < data.length; i++) {
    							rolename=data[i]["rolename"];
    							rolecode=data[i]["rolecode"];
        						_html = "<li tabindex='-1' data-floor='"+(i+1)+"' onclick='addRole(this)' width ='180px'  value = '"+rolecode+"'>"+rolename+"</li>";
    							_this.parents(".item-wrap").find("#roleBox").append(_html);
        					}
    					}
    				},
    				error : function() {
    					jazz.warn("获取数据失败");
    				}
    			});
			});
		}
		
		function addDep(obj){
			var value = obj.getAttribute("value");
			$(obj).parents(".item-wrap").find("#departmentName").val(obj.innerHTML);
			$("#depCode").val(value);
			$(obj).parents(".item-wrap").find(".box").html("");
		}
		
		function addRole(obj){
			var value = obj.getAttribute("value");
			$(obj).parents(".item-wrap").find("#roleName").val(obj.innerHTML);
			$("#roleCode").val(value);
			$(obj).parents(".item-wrap").find(".box").html("");
		}
	</script>
	<script type="text/javascript" src="../../static/js/config.js"></script>
	<script type="text/javascript" data-main="other/AddPerson.js" src="../../static/lib/require.js"></script>
</body>
</html>