(function($,factory){if(jazz.config.isUseRequireJS===true){define(["jquery","jazz.BoxComponent"],factory)}else{factory($)}})(jQuery,function($){$.widget("jazz.date",$.jazz.boxComponent,{options:{vtype:"date",width:200,height:200,year:new Date().getFullYear(),month:new Date().getMonth()+1,defaultvalue:null,isshowdatelist:false,select:null,finish:null,preyear:null,premonth:null,nextyear:null,nextmonth:null},_create:function(){this._super();if(this.options.defaultvalue){this.options.defaultvalue=new Date(this.options.defaultvalue.replace(/-/g,"/"))}this.element.addClass("jazz-date").css({width:this.options.width,height:this.options.height});this.calendarPreYear=$('<div class="jazz-date-preyear"></div>').appendTo(this.element);this.calendarPreMonth=$('<div class="jazz-date-premonth"></div>').appendTo(this.element);this.calendarNextYear=$('<div class="jazz-date-nextyear"></div>').appendTo(this.element);this.calendarNextMonth=$('<div class="jazz-date-nextmonth"></div>').appendTo(this.element);this.calendarText=$('<div class="jazz-date-text"><table align="center"><tr><td><div class="jazz-date-year-o">'+this.options.year+'</div></td><td> <div class="jazz-date-year-w">年</div> </td><td><div class="jazz-date-month-o">'+this.options.month+'</div></td><td> <div class="jazz-date-year-w">月</div> </td></tr></table></div>').appendTo(this.element);this.calendarYear=this.calendarText.find(".jazz-date-year-o");this.calendarMonth=this.calendarText.find(".jazz-date-month-o");if(this.options.isshowdatelist===true){this.calendarYear.addClass("jazz-cursor-pointer");this.calendarMonth.addClass("jazz-cursor-pointer")}this.calendarHeader=$('<table class="jazz-date-header" cellspacing="0" cellpadding="0" border="0" width="100%" height="22" align="center" vAlign="middle">  <thead>    <tr>      <td style="height:22px" class="jazz-date-week">一</td>      <td class="jazz-date-week">二</td>      <td class="jazz-date-week">三</td>      <td class="jazz-date-week">四</td>      <td class="jazz-date-week">五</td>      <td class="jazz-date-week">六</td>      <td class="jazz-date-week">日</td>    </tr>  </thead></table>').appendTo(this.element);this.items=$('<table class="jazz-date-body" cellspacing="0" cellpadding="0" border="0" width="100%" height="'+(this.options.height-this.calendarText.outerHeight(true)-this.calendarHeader.outerHeight(true))+'" align="center" vAlign="middle">  </tbody></table>').appendTo(this.element);this.yearnum=5},_init:function(){this._draw();this._bindEvent()},_bindEvent:function(){var $this=this;this.calendarPreYear.off("mousedown.date").on("mousedown.date",function(e){$this._listHide();$this.preYear();$this._event("preyear",e);e.stopPropagation()});this.calendarPreMonth.off("mousedown.date").on("mousedown.date",function(e){$this._listHide();$this.preMonth();$this._event("premonth",e);e.stopPropagation()});this.calendarNextMonth.off("mousedown.date").on("mousedown.date",function(e){$this._listHide();$this.nextMonth();$this._event("nextmonth",e);e.stopPropagation()});this.calendarNextYear.off("mousedown.date").on("mousedown.date",function(e){$this._listHide();$this.nextYear();$this._event("nextyear",e);e.stopPropagation()});this.items.off("mousedown.date, mouseover.date, mouseout.date").on("mousedown.date",function(event){var t=event.target,$t=$(t);if(t.tagName!="TD"||$t.hasClass("jazz-date-pmonth")||$t.hasClass("jazz-date-nmonth")){return}$this.items.find(".jazz-date-selected").removeClass("jazz-date-selected");$t.addClass("jazz-date-selected");var _day=t.innerHTML;if(_day&&_day.length==1){_day="0"+_day}var _month=$this.options.month;if(_month&&(_month+"").length==1){_month="0"+_month}$this._listHide();var num=$t.prop("id").length;var newdate=$t.prop("id").substring(5,num);$this._event("select",event,{date:newdate});event.stopPropagation()}).on("mouseover.date",function(event){var t=event.target,$t=$(t);if(t.tagName!="TD"||$t.hasClass("jazz-date-pmonth")||$t.hasClass("jazz-date-nmonth")){return}$t.addClass("jazz-date-hover");event.stopPropagation()}).on("mouseout.date",function(event){var t=event.target,$t=$(t);$t.removeClass("jazz-date-hover");event.stopPropagation()});$this.calendarYear.off("mousedown.date").on("mousedown.date",function(event){if($this.options.isshowdatelist===true){$this._listMonthHide();$this._yearlist($this.searchyear);if(!$this.listYear){$this._listyearShow()}$this.listYear.off("click.datelist").on("click.datelist",function(e){var target=$(e.target);if(target.hasClass("jazz-date-yearlist-td")){var year=$.trim(target.text());$this.calendarYear.text(year);$this._listYearHide();$this.options.year=parseInt(year||$this.options.year);$this._preDraw(new Date($this.options.year,$this.options.month-1,1))}else{if(target.hasClass("jazz-date-yearlist-td-p")){$this.searchyear=$this.yearAfter[0]-$this.yearnum;$this._yearlist($this.searchyear);$this._listyearShow()}else{if(target.hasClass("jazz-date-yearlist-td-c")){$this._listYearHide()}else{if(target.hasClass("jazz-date-yearlist-td-n")){$this.searchyear=$this.yearBefore[$this.yearnum-1]+$this.yearnum+1;$this._yearlist($this.searchyear);$this._listyearShow()}}}}});event.stopPropagation();$(document).off("mousedown.slistdate").on("mousedown.slistdate",function(){$this._listHide();$(this).off("mousedown.slistdate")})}});$this.calendarMonth.off("click.date").on("click.date",function(event){if($this.options.isshowdatelist===true){$this._listYearHide();if(!$this.listMonth){$this._monthlist()}$this.listMonth.off("click.datelist").on("click.datelist",function(e){var target=$(e.target);if(target.hasClass("jazz-date-monthlist-td")){var monthtext=$.trim(target.text());var month=$this._monthTextToNumber(monthtext)||$this.options.month;$this.calendarMonth.text(month);$this._listMonthHide();$this.options.month=month;$this._preDraw(new Date($this.options.year,month-1,1))}});event.stopPropagation();$(document).off("mousedown.slistMdate").on("mousedown.slistMdate",function(){$this._listHide();$(this).off("mousedown.slistMdate")})}})},_buildList:function(type){},_draw:function(){var arr=[];for(var i=0,firstday=new Date(this.options.year,this.options.month-1,1).getDay()-1;i<firstday;i++){arr.push(0)}for(var i=1,monthDay=new Date(this.options.year,this.options.month,0).getDate();i<=monthDay;i++){arr.push(i)}var frag=document.createDocumentFragment();while(arr.length){var row=document.createElement("tr");for(var i=1;i<=7;i++){var cell=document.createElement("td");cell.innerHTML="&nbsp;";if(arr.length){var d=arr.shift();if(d){cell.innerHTML=d;var on=new Date(this.options.year,this.options.month-1,d);if(this._isSame(on,new Date())){$(cell).addClass("jazz-date-today")}if(this.options.defaultvalue&&this._isSame(on,this.options.defaultvalue)){$(cell).addClass("jazz-date-selected")}}else{$(cell).addClass("jazz-date-pmonth")}var cellmonth=this.options.month<10?"0"+this.options.month:this.options.month;var cellday=d<10?"0"+d:d;$(cell).attr("id","date-"+this.options.year+"-"+cellmonth+"-"+cellday)}else{$(cell).addClass("jazz-date-nmonth")}row.appendChild(cell)}frag.appendChild(row)}this.items.children().remove();this.items.append(frag);this.calendarYear.text(this.options.year);this.calendarMonth.text(this.options.month);this._event("finish")},_isSame:function(d1,d2){return(d1.getFullYear()==d2.getFullYear()&&d1.getMonth()==d2.getMonth()&&d1.getDate()==d2.getDate())},_listHide:function(){this._listYearHide();this._listMonthHide()},_listYearHide:function(){if(this.listYear){this.listYear.remove();this.listYear=null}},_listMonthHide:function(){if(this.listMonth){this.listMonth.remove();this.listMonth=null}},_listyearShow:function(){var buf=[];buf.push('<div class="jazz-date-yearlist" style="display: block;">');buf.push('	<table cellspacing="0" cellpadding="3" border="0" align="center">');buf.push("		<tbody>");for(var i=0;i<this.yearnum;i++){buf.push('			<tr nowrap="nowrap">');buf.push('				<td class="jazz-date-yearlist-td" >');buf.push(this.yearAfter[i]);buf.push("				</td>");buf.push('				<td class="jazz-date-yearlist-td" >');buf.push(this.yearBefore[i]);buf.push("				</td>");buf.push("			</tr>")}buf.push("		</tbody>");buf.push("	</table>");buf.push('	<table cellspacing="0" cellpadding="3" border="0" align="center">');buf.push("		<tbody>");buf.push("			<tr>");buf.push('				<td class="jazz-date-yearlist-td-p"> ← </td>');buf.push('				<td class="jazz-date-yearlist-td-c"> × </td>');buf.push('				<td class="jazz-date-yearlist-td-n"> → </td>');buf.push("			</tr>");buf.push("		</tbody>");buf.push("	</table>");buf.push("</div>");var str=buf.join("");this.calendarYear.children(".jazz-date-yearlist").remove();this.listYear=$(str).appendTo(this.calendarYear);this.listYear.css({top:this.calendarYear.height()+1})},_monthlist:function(){var buf=[];buf.push('<div class="jazz-date-monthlist" style="display: block;">');buf.push('	<table cellspacing="0" cellpadding="3" border="0" align="center">');buf.push("		<tbody>");buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >一月</td><td class="jazz-date-monthlist-td" >七月</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >二月</td><td class="jazz-date-monthlist-td" >八月</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >三月</td><td class="jazz-date-monthlist-td" >九月</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >四月</td><td class="jazz-date-monthlist-td" >十月</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >五月</td><td class="jazz-date-monthlist-td" >十一</td></tr>');buf.push('			<tr nowrap="nowrap"><td class="jazz-date-monthlist-td" >六月</td><td class="jazz-date-monthlist-td" >十二</td></tr>');buf.push("		</tbody>");buf.push("	</table>");buf.push("</div>");var str=buf.join("");this.listMonth=$(str).appendTo(this.calendarMonth);this.listMonth.css({top:this.calendarMonth.height()+1,right:"20px"})},_monthTextToNumber:function(text){var yue=jazz.config.i18n.months;for(var i=0;i<yue.length;i++){if(text==yue[i]){return(i+1)}}return""},_preDraw:function(date){this.options.year=date.getFullYear();this.options.month=date.getMonth()+1;this._draw()},_yearlist:function(year){var _year=year?parseInt(year):this.options.year;this.yearAfter=[],this.yearBefore=[];for(var i=this.yearnum;i>0;i--){this.yearAfter.push(_year-i);this.yearBefore.push(_year+(this.yearnum-i))}},currentMonth:function(){this._preDraw(new Date())},nextMonth:function(){this._preDraw(new Date(this.options.year,this.options.month,1))},nextYear:function(){this._preDraw(new Date(this.options.year+1,this.options.month-1,1))},preMonth:function(){this._preDraw(new Date(this.options.year,this.options.month-2,1))},preYear:function(){this._preDraw(new Date(this.options.year-1,this.options.month-1,1))}})});