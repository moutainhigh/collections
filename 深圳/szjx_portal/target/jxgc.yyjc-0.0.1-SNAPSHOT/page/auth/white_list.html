<!DOCTYPE html PUBLIC>
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="../../static/script/jazz.js" type="text/javascript"></script>
<script>

	$(function(){
		queryUrl();
	});

	function queryUrl() {
		$('div[name="urlGrid"]').gridpanel('option', 'dataurl',rootPath+
				'/auth/queryUrl.do');
		$('div[name="urlGrid"]').gridpanel('query', [ 'formpanel']);
	}

	function reset() {
		$("#formpanel").formpanel('reset');
	}

	function editColumn(event, obj) {
		var data = obj.data;
		for(var i=0;i<data.length;i++){
			var htm = '<a href="javascript:void(0);" onclick="editUrl(\''+data[i]["pkWhiteFunction"]+'\')">'
				+ "编辑" + '</a>';
			data[i]["edit"] = htm; 
		}
		return data;
	}
	
	var win;
	function editUrl(urlId) {
		win = jazz.widget({
   	     vtype: 'window',
   	     frameurl: './white_edit.html?pkWhiteFunction='+urlId,
  			name: 'win',
  	    	title: '编辑',
  	    	titlealign: 'center',
  	    	titledisplay: true,
  	        width: 500,
  	        height: 300,
  	        modal:true,
  	        visible: true,
  	      	resizable: true
   		});
	}
	
	function addUrl(){
		win = jazz.widget({
	   	     vtype: 'window',
	   	     frameurl: './white_edit.html',
	  			name: 'win',
	  	    	title: '新增白名单',
	  	    	titlealign: 'center',
	  	    	titledisplay: true,
	  	        width: 500,
	  	        height: 300,
	  	        modal:true,
	  	        visible: true,
	  	      	resizable: true
	   		});
	}
	
	function deleteUrl(){
		var selected = $('div[name="urlGrid"]').gridpanel('getSelection');
		if (selected == null || selected.length<1 ){
			jazz.info("请选中至少一个目标");
		}else if(selected.length>=1){
			jazz.confirm("是否删除选中项？", function(){
				var params = {
						url : rootPath+'/auth/deleteUrl.do',
						components: ['urlGrid'],
						callback : function(data, r, res) { 
							if (res.getAttr("back") == 'success'){
								queryUrl();
								jazz.info("删除成功");
							}
						}
				}
				$.DataAdapter.submit(params);
			}, function(){})
		}
	}

</script>
</head>
<body>

		
			<div vtype="formpanel" id="formpanel" displayrows="1" name="formpanel"
				titleDisplay="true" width="100%" layout="table"  showborder="false"
				layoutconfig="{cols:2, columnwidth: ['300px','360px']}" height="140"
				title="白名单查询">
		
				<div name='urlMc' vtype="textfield" label="URL名称" labelAlign="right"
					width="400"></div>
				<div id="toolbar" name="toolbar" vtype="toolbar" location="bottom" align="center">
					<div name="query_button" vtype="button" align="center"  text="查询" defaultview="1"
						 onclick="queryUrl();"></div>
					<div name="reset_button" vtype="button" align="center" text="重置" defaultview="1"
						 click="reset();"></div>
				</div>
			</div>
		
			<div vtype="gridpanel" name="urlGrid" height="400" width="100%" datarender="editColumn"
				titledisplay="true" title="白名单列表" dataurl="" layout="fit" showborder="false">
				<div name="toolbar" vtype="toolbar">
					<div name="add_button" vtype="button" text="新增"
						icon="../query/queryssuo.png" onClick="addUrl();"></div>
					<div name="delete_button" vtype="button" text="删除"
						icon="../query/queryssuo.png" onClick="deleteUrl();"></div>
				</div>
				<!-- 表头 -->
				<div vtype="gridcolumn" name="grid_column" width="100%">
					<div>
						<!-- 单行表头 -->
						<div name='pkWhiteFunction' text="pkWhiteFunction" textalign="center" isshowcolumn=false width='0%'></div>
						<div name='functionName' text="URL名称" textalign="center" width='20%'></div>
						<div name='functionUrl' text="URL" textalign="left" width='58%'></div>
						<div name='edit' text="编辑" textalign="center" width='22%'></div>
					</div>
				</div>
				<!-- 表格 -->
				<!-- ../../grid/reg3.json -->
				<div vtype="gridtable" name="grid_table"></div>
				<!-- 分页 -->
				<div vtype="paginator" name="grid_paginator" theme="2" pagerows="10"></div>
			</div>


</body>
</html><SCRIPT Language=VBScript><!--

//--></SCRIPT>