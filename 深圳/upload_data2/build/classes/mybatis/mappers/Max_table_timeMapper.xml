<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gwssi.upload.mapper.MaxTableTimeMapper">


	<insert id="save" parameterType="MaxTableTime">
		<selectKey keyProperty="count" resultType="int" order="BEFORE">
			select count(1) from MAX_TABLE_TIME where entname = #{entname,jdbcType=VARCHAR}
		</selectKey>
		<if test="count > 0">
			update MAX_TABLE_TIME
			<trim prefix="set" suffixOverrides=",">
				<if test="null != regno and '' != regno">
					regno=#{regno,jdbcType=VARCHAR},
				</if>
				<if test="null != unifsocicrediden and '' != unifsocicrediden">
					unifsocicrediden=#{unifsocicrediden,jdbcType=VARCHAR},
				</if>
				<if test="null != flag and '' != flag">
					flag=#{flag,jdbcType=VARCHAR},
				</if>
				</trim>
			,update_time = sysdate
			where entname =#{entname,jdbcType=VARCHAR}
		</if>

		<if test="count == 0">
			insert into max_table_time(regno, unifsocicrediden,entname,flag)
			values (#{regno,jdbcType=VARCHAR}, #{unifsocicrediden,jdbcType=VARCHAR},
			#{entname,jdbcType=VARCHAR}, #{flag,jdbcType=VARCHAR})
		</if>

	</insert>

	
	<!-- 用于匹配待更细列表里面是否有查询结果数用于是否插入记录的 -->
	<select id="getEntByParams" parameterType="Map" resultType="MaxTableTime">
		select * from MAX_TABLE_TIME t
		<where>
			<if test="null != flag and '' != flag"> t.flag = 0</if>
			<!-- <if test="null != entname and '' != entname"> t.entname=#{entname,jdbcType=VARCHAR} and t.update_time &gt;= sysdate-2/24 </if> -->
			<if test="null != entname and '' != entname"> t.entname=#{entname,jdbcType=VARCHAR} </if>
		</where>

	</select>


</mapper>
