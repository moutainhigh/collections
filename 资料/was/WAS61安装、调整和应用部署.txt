WAS61安装、调整和应用部署
目录
WAS安装、调整和应用部署 1
必备条件 2
WAS v6.1的安装 2
进入管理控制台的方法 26
创建和配置数据源 28
安装IBM HTTP SERVER和HTTP 插件 36
在应用中使用Reference引用的方式访问数据源 47
应用部署 49
验证WAS安装和配置： 55
重新生成插件，从IHS作为入口访问应用 55
WAS参数设置和调整 56
停止和启动WAS的方法 70
查看系统日志 71
资源监控和参数调整方法 71

 

 
必备条件
1． 为了安装设置最简便，本文所有操作请都在root用户下进行
2． 对各个文件系统的要求。
空间大小 文件系统 用途
磁盘空间总大小 42.4G
2 GB /usr/IBM/WebSphere/AppServer 产品代码
400 MB /tmp 安装临时目录
40 GB
 /var/xxxlogs （请在盘阵上创建此共享文件系统） 日志目录
 根据客户应用自行决定 应用日志
 /var/xxxlogs/hostA/server1 A机的WAS系统日志
 /var/xxxlogs/hostA/server1/TransactionLogs (该文件很重要，不能随意更改和删除，如要操作，请找IBM支持) A机的WAS交易日志
 /var/xxxlogs/hostA/WASHeapDump A机的WAS Heap Dump 和 Java Core 文件
3． 注意，如果DB2是远程数据库并且是64位，则要在WAS的服务器上安装DB2 8.2 客户端，并创建一个32位实例（本地硬盘）（参见DB2安装手册），将数据库编目（Catalog）到本地。如果DB2在本地，但数据库是64位的，也需要创建一个32位实例，将数据库B编目（Catalog）到该实例中。
本例后续DB2相关安装和启动采用db2inst2用户。（提醒DB2的安装人员安装并配置）
4． 把下面的代码添加到每台WAS服务器的root用户.profile（注意前面有个小数点）文件中（db2profile文件具体在哪个目录下，可以通过在root用户下用su C db2inst2来查看。通常情况是/home/db2inst2/sqllib）：
. /home/db2inst2/sqllib/db2profile （注意，是小数点紧跟一个空格，再输入/home/db2inst2/sqllib/db2profile）
注意，要使.profile文件生效，请查看“/”目录下的.dtprofile文件中最后一行是否取消了注释。如果是用“#”符号注释的，请删除“#”，去掉注释，然后注销当前会话，重新登录，在root用户下输入命令“db2”，如果能够进入db2的命令控制环境，就设置成功。
WAS v6.1的安装 
1． 将WAS v6 Network Deployment安装介质拷贝到主机shcisa上
键入如下两个命令创建目录：
cd /hk
mkdir 7_was
请讲介质上传至此

2． 介质大小和用途说明如下：
541M  C88SQML_WASNDv61AIX5Lv5_32B.tar.gz  WAS ND安装介质
73M  download.updii.6100.aix.ppc32.zip   补丁安装工厂
264M  6.1.0-WS-WAS-AixPPC32-FP0000002.pak  WAS ND补丁6.1.0.2

3． 将安装介质和补丁解包：
cd /hk/7_was
mkdir was61
mkdir updateinstaller

解包WAS ND的安装介质：
cd /hk/7_was
gzip -d C88SQML_WASNDv61AIX5Lv5_32B.tar.gz
cd was61
tar -xvf ../C88SQML_WASNDv61AIX5Lv5_32B.tar

解包WAS ND的补丁安装工厂：
cd /hk/7_was/updateinstaller
/usr/java14/bin/jar -xvf ../download.updii.6100.aix.ppc32.zip

给安装目录足够的权限：
cd /hk/7_was
chmod CR 777 was61
chmod CR 777 updateinstaller

4． 进入目录/hk/7_was/was61/WAS，执行install命令，开始安装。如下图：
 

5． 出现如下页面，点击“Next”：
 

6． 出现如下页面，选择“I accept……”，点击“Next”：
 
7． 在出现的页面上点击“Next”
8． 出现如下页面，点击“Next”（注意，不要选取“Install the sample applications”，也就是不安装样例）：
 
9． 出现如下页面，确认WAS安装目录为“/usr/IBM/WebSphere/AppServer”，点击“Next”：
 
10． 出现如下页面，在“Environments”一栏选择“None”，点击“Next”：
 
（注：因为我们要在打完补丁后再进行概要文件的创建和设置，所以在这里选择None，暂时不做）
11． 出现如下页面警告未创建概要文件。如上所述，我们将把这个工作放到安装和打补丁之后进行。所以这里点击“Yes”：
 
12． 在出现的页面上点击“Next”；
13． 等待安装进度条行进至100%
14． 出现如下页面，取消选择“Create a new WebSphere Application Server profile using the Profile management tool”，原因如上所述，我们将把这个工作放到安装和打补丁之后进行。点击“Finish”：
 
15． 补丁安装工厂：
1） 进入目录/hk/7_was/updateinstaller/UpdateInstaller，执行install命令，如下图所示：
 
2） 出现如下页面，点击“Next”：
 
3） 出现如下页面，选择“I accept…”，点击“Next”：
 
4） 在出现的页面上点击“Next”；
5） 出现如下页面，确认安装目录为“/usr/IBM/WebSphere/UpdateInstaller”，点击“Next”：
 
6） 在出现的页面上点击“Next”；
7） 等待进度条行进至100%
8） 出现如下页面，选择“Launch IBM Update Installer for WebSphere software on exit”（这一步会在结束补丁安装工厂的安装后，自动启动补丁安装工厂），点击“Finish”；
 
9） 拷贝补丁文件至目录/usr/IBM/WebSphere/UpdateInstaller/maintenance下：
cp /hk/7_was/6.1.0-WS-WAS-AixPPC32-FP0000002.pak /usr/IBM/WebSphere/UpdateInstaller/maintenance/.
10） 在拷贝补丁文件的同时，补丁安装向导可能会自动弹出（注：如果该页面没有自动弹出，请执行/usr/IBM/WebSphere/UpdateInstaller/update.sh），如下图所示。请确认已经执行过上一步后，再点击“Next”：
 
11） 在出现的页面上点击“Next”；
12） 出现如下页面，确认WAS的安装目录为“/usr/IBM/WebSphere/AppServer”，点击“Next”：
 
13） 出现如下页面，确认选择了“Install maintenance package”，点击“Next”：
 
14） 出现如下页面，确认该目录下的确存在该文件，即为第9)步中拷贝的文件，点击“Next”：
 
15） 出现如下页面，点击“Next”：
 
16） 等待进度条行进至100%
17） 出现如下页面，点击“Finish”：
 
18） 查看版本，确认补丁安装成功：
执行：/usr/IBM/WebSphere/AppServer/bin/versionInfo.sh
出现如下页面。注意最后10行以内的内容。Version应为：6.1.0.2
 
16． 创建并配置概要文件
1） 启用概要文件创建向导：进入目录/usr/IBM/WebSphere/AppServer/bin/ProfileManagement，执行pmt.sh
如下图：
 
2） 出现如下页面，点击“Next”：
 
3） 出现如下页面，选择“Application server”，点击“Next”：
 
4） 出现如下页面，选择“Advanced profile creation”（注意，因为我们要自己定义概要文件的名称和路径，故选则该高级向导），点击“Next”：
 
5） 出现如下页面，确认两个选择框都一定选中，点击“Next”：
 
6） 出现如下页面，输入并确认如下信息，注意，不要选择“Create the server using the development template”，点击“Next”：
Profile name:  CISFE
Profile directory: /usr/IBM/WebSphere/AppServer/profiles/CISFE
 
7） 出现如下页面，输入并确认如下信息，点击“Next”：
Node name: schisaNode
Host name: chcisa
（注意：Host name可以通过在操作系统提示符下键入命令hostname来查看，然后输入到这里，Node name建议用hostname加上字符串“Node”来命名）
 
8） 出现如下页面，选择“Enable administrative security”，输入并确认如下信息，点击“Next”：
User name:   admin
Password:    password
Confirm password: password
（注意，该用户名和密码只用于WAS管理员登陆WAS的惯例控制台，和操作系统的用户无关）
 
9） 出现如下页面，接受默认值，点击“Next”：
 
10） 从该步骤开始，都是在配置远程的Web Server。在我们的例子中是IBM HTTP Server。无论远程IBM HTTP Server是否已经安装，都可以进行如下的配置。
出现如下页面，选择“Create a Web server definition”，输入并确认如下信息，点击“Next”：
Web server type:     IBM HTTP Server
Web server operating system:   Linux
Web server name:     webserver1
Web server host name or IP address: 11.246.8.13
 
11） 出现如下页面，确认Web server的安装路径为“/opt/IBM/HTTPServer”，Web server plug-in的安装路径为“/opt/IBM/HTTPServer/Plugins”，点击“Next”：
 
12） 在出现的页面上点击“Create”；
13） 等待进度条行进至100%；
14） 出现如下页面，确认选中“Launch the First steps console”，点击“Finish”：
 
15） First steps console将会自动弹出，点击“Installation verification”，如下图所示（如果该页面未自动弹出，请进入目录/usr/IBM/WebSphere/AppServer/profiles/CISFE/firststeps，执行firststeps.sh）步手工验证）：
 
16） 如下页面将会自动弹出，等待验证结束（最后会显示：“The installation is complete”），注意查看验证过程是否报错。如下图所示就是成功安装的显示：
 
17） 返回First steps console，点击“Exit”，First steps console和验证窗口都将退出。
18） 输入如下URL进一步验证安装：
http://11.245.0.161:9080/snoop
如果页面显示如下，则恭喜您，WAS ND V6.1的安装和概要文件配置全部成功完成！
 

进入管理控制台的方法
1. 打开一个浏览器，输入如下URL：http://11.245.0.161:9060/admin

2. 弹出如下页面，点击“是”，接受证书：
 

3. 进入管理控制台登录页面，输入用户名“admin”，密码“password”（配置见前），点击“登录”：
 

4. 成功进入管理控制台：
 

 

创建和配置数据源
1. 拷贝DB2 JDBC Driver文件db2jcc.jar,db2jcc_license_cu.jar,db2jcc_license_cisuz.jar从目录“/home/db2inst2/sqllib/Java”至目录“/usr/IBM/WebSphere/AppServer/lib/ext”下。

2. 如果WebSphere Application Server的实例未运行(查看实例是否运行，可以在操作系统上用命令ps Cef | grep java查看。如果没有从/usr/IBM/WebSphere/AppServer目录下发起的java进程，则未运行)，则启动WebSphere应用服务器运行实例, 运行命令:
/usr/IBM/WebSphere/AppServer/profiles/CISFE/bin/startServer.sh server1

3. 应用服务器启动后，通过浏览器进行管理WebSphere服务器
http://11.245.0.161:9060/admin

4. 在管理界面左侧菜单中，选择资源 ->JDBC -> JDBC 提供程序
 

5. 选择“作用域”到服务器级别，并点击“新建”按钮，创建JDBC Driver
 

6. 依次按下图选择数据库类型“DB2”，提供程序类型“DB2 Universal JDBC Driver Provider”，实施类型“连接池数据源”，接受自动的名称和描述，点击“下一步”：
 

7. 在“输入数据库类路径信息”页面上，设置如下图所示的两个JDBC Driver安装目录环境变量为“/usr/IBM/WebSphere/AppServer/lib/ext”，点击“下一步”：
 

8. 在最后一页上点击“完成”；

9. 以下步骤进行设置此JDBC Driver之下的数据源，点击“DB2 Universal JDBC Driver Provider”进入此数据源
 


10. ；在配置界面中，选择右侧“数据源”连接，进入数据源设置。
 

11. 点击新建，创建数据源
 

12. 在创建数据源界面中，输入您应用所使用数据源名“MyDB”和JNDI名称“jdbc/MyDB”，点击“下一步”：
 

13. 在数据源配置“步骤2”中，输入如下数据库基本信息。点击“下一步”：
数据库名：  cisfedb
驱动程序类型： 4 （默认值）
服务器名称：  11.245.0.161 （写此文时，实际用的是11.246.8.13，因为11.245.0.161上的数据库有些问题）
端口号：   50020 (请根据数据库实际的端口号设置，写此文时，实际用的是11.246.8.13上的端口50000)
 

14. 在“总结”页面上，点击“完成”；

15. 在如下页面上，点击“保存”：
 

16. 保存之后，点击“MyDB”进入此数据源，并点击右侧“JAAS － J2C 认证数据”，创建连接数据库的用户名和密码别名：
 

在如下页面点击“新建”：
 

在如下页面上输入如下数据，点击“确定”：
别名：  db2inst2
用户标识： db2inst2
密码：  db2inst2
（注解：写此文时，实际用的是11.246.8.13上的用户cisfe，因为11.245.0.161上的数据库有些问题）
 

在如下页面上，点击“保存”：
 

17. 出现如下页面，点击“MyDB”，回到刚才创建的数据源管理界面：
 

18. 回到先前创建的数据源“jdbc/MyDB”管理界面，选择“组件管理的认证别名”为刚才创建的“db2inst1”别名。点击“确定”：
 

19. 按照上面的方法，保存设置，然后在如下页面上，选中“MyDB”，然后点击“测试连接”：
 

20. 如果数据源配置正确，则会出现如下页面，注意“消息”一栏，显示测试成功：
 
 
21. 如果连接不成功，可以试试重启一下WAS。步骤为：
a) 停止WAS的server1进程：
进入目录/usr/IBM/WebSphere/AppServer/profiles/CISFE/bin，执行stopServer.sh server1，在提示Username和Password时，输入“admin”和“password”。
b) 启动WAS的server1进程：
进入目录/usr/IBM/WebSphere/AppServer/profiles/CISFE/bin，执行startServer.sh server1
c) 重试步骤19，看结果是否正确

安装IBM HTTP SERVER和HTTP 插件
1． 在服务器“linux”上安装HIS, IP地址“11.246.8.13”；
2． 将WAS v6 Network Deployment的IHS和Plugin安装介质拷贝到主机11.246.8.13上
键入如下命令创建目录：
cd /
mkdir soft
cd /soft
mkdir was
3． 上传如下文件至：/soft/was
介质大小和用途说明如下：
546M C88T0ML_WASNDv61SupplementsLinuxX86_32B.tar.gz IHS和Plugin安装介质
76M  download.updii.6100.linux.ia32.zip     补丁安装工厂
3M  6.1.0-WS-IHS-LinuxX32-FP0000002.pak    IHS补丁6.1.0.2
3M  6.1.0-WS-PLG-LinuxX32-FP0000002.pak    Plugin补丁6.1.0.2
4． 将安装介质和补丁解包：
mkdir was61sup
mkdir updateinstaller
解包IHS和Plugin的安装介质：
cd /soft/was
gzip -d C88T0ML_WASNDv61SupplementsLinuxX86_32B.tar.gz
cd /soft/was/was61sup
tar -xvf ../C88T0ML_WASNDv61SupplementsLinuxX86_32B.tar
解包补丁安装工厂：
cd /soft/was/updateinstaller
unzip ../download.updii.6100.linux.ia32.zip
给安装目录足够的权限：
cd /soft/was
chmod CR 777 was61sup
chmod CR 777 updateinstaller
5． 进入目录/soft/was/was61sup/IHS，执行install命令，开始安装。如下图：
 
6． 出现如下页面，点击“Next”：
 
7． 出现如下页面，选择“I accept...”，点击“Next”：
 
8． 在出现的页面上点击“Next”：
9． 出现如下页面，确认安装目录为“/opt/IBM/HTTPServer”，点击“Next”：
 
10． 出现如下页面，接受默认值，点击“Next”：
 
11． 出现如下页面，确认选中“Create a user....”，输入如下内容，点击“Next”：
User ID:    admin
Password:       password
Confirm Password:  password
 
12． 出现如下页面，选中“Setup IBM HTTP administration......”，取消选择“Create a unique user ID……”，并输入如下内容，点击“Next”：
User ID: root
Group: root
 
13． 出现如下页面，选中“Install the IBM Server Plug-in for......”，输入以下内容，点击“Next”：
Web server definition:        webserver1
Host name or IP address for the Application Server:  11.245.0.164 （此处应为HA的WAS的唯一IP）
 
14． 在出现的页面点击“Next”；
15． 等待进度条行进至100%；
16． 出现如下页面，点击“Finish”：
 
17． 安装补丁安装工厂：
a) 进入目录/soft/was/updateinstaller/UpdateInstaller，执行install命令，命令如下：
cd /soft/was/updateinstaller/UpdateInstaller
./install
b) 出现如下页面，点击“Next”：
 
c) 出现如下页面，选择“I accept...”，点击“Next”：
 
d) 在出现的页面上点击“Next”；
e) 出现如下页面，确认安装目录为“/opt/IBM/WebSphere/UpdateInstaller”，点击“Next”：
 
f) 在出现的页面上点击“Next”；
g) 等待进度条行进至100%
h) 出现如下页面，选中“Launch IBM Update Installer......” （这一步会在结束补丁安装工厂的安装后，自动启动补丁安装工厂），点击“Finish”：
 
18． 安装补丁：
a) 拷贝两个补丁文件至目录/opt/IBM/WebSphere/UpdateInstaller/maintenance/下，命令如下：
cp /soft/was/6.1.0-WS-IHS-LinuxX32-FP0000002.pak /opt/IBM/WebSphere/UpdateInstaller/maintenance/.
cp /soft/was/6.1.0-WS-PLG-LinuxX32-FP0000002.pak /opt/IBM/WebSphere/UpdateInstaller/maintenance/.
b) 在拷贝补丁文件的同时，补丁安装向导可能会自动弹出（注：如果该页面没有自动弹出，请执行/opt/IBM/WebSphere/UpdateInstaller/update.sh），如下图所示。请确认已经执行过上一步后，再点击“Next”：
 
c) 出现如下页面，确认目录为“/opt/IBM/HTTPServer”，点击“Next”：
 

d) 出现如下页面，确认选择“Install maintenance ...”，点击“Next”：
 
e) 出现如下页面，确认要安装的文件为“/opt/IBM/WebSphere/UpdateInstaller/maintenance/6.1.0-WS-IHS-LinuxX32-FP0000002.pak”，如果不是该文件，请更改该栏，或者点击“Browse”：
 

f) 如果点击了“Browse”，则出现如下页面，选择文件“6.1.0-WS-IHS-LinuxX32-FP0000002.pak”，点击“Open”：
 
g) 回到补丁包选择页面，点击“Next”：
h) 在出现的页面上点击“Next”：
i) 等待进度条行进至100%;
j) 出现如下页面，点击“Relaunch”：
 
k) 出现如下页面，输入（或者选择）目录为“/opt/IBM/HTTPServer/Plugins”，点击“Next”：
 
l) 在出现的页面上点击“Next”：
m) 出现如下页面，确认要安装的文件为“/opt/IBM/WebSphere/UpdateInstaller/maintenance/6.1.0-WS-PLG-LinuxX32-FP0000002.pak”，如果不是该文件，请更改该栏，或者点击“Browse”选择，然后点击“Next”：
 
n) 在出现的页面上点击“Next”：
o) 等待进度条行进至100%
p) 在出现的页面上点击“Finish”：
q) 查看版本，确认补丁安装成功：
执行：/opt/IBM/HTTPServer/bin/versionInfo.sh
出现如下信息：
Name    IBM HTTP Server
Version    6.1.0.2

执行：/opt/IBM/HTTPServer/Plugins/bin/versionInfo.sh
出现如下信息：
Name    Web server plug-ins for IBM WebSphere Application Server
Version    6.1.0.2

19． 启动IHS
执行命令：/opt/IBM/HTTPServer/bin/apachectl start
执行命令“ps -ef | grep http”查看http进程。如果已有数个http进程，则启动成功。
20． 输入如下URL验证安装: http://11.246.8.13
如果出现如下页面，则恭喜您，IHS及其补丁安装成功！
 

在应用中使用Reference引用的方式访问数据源
本步骤推荐使用RAD或者AST完成。如果不具备这些工具，请参考如下步骤：
1. 从应用包cis1019.war中解出如下文件：
WEB-INF/web.xml
WEB-INF/ibm-web-bnd.xmi （该文件如果不存在，则按照步骤3创建）
WEB-INF/ibm-web-ext.xmi （该文件如果不存在，则按照步骤3创建）
WEB-INF/classes/applicationContext.xml

2. 编辑文件WEB-INF/web.xml（如果以下内容已经存在，请按下面文字检查一遍）
a) 在应用WEB-INF/web.xml配置中，对<web-app>中加入 id="WebApp_ID"
<web-app id="WebApp_ID" ……>
b) 在应用WEB-INF/web.xml配置中，在<welcome-file-list/>后增加数据源引用配置
 <welcome-file-list>
  <welcome-file>index.jsp</welcome-file>
  <welcome-file>index.html</welcome-file>
 </welcome-file-list>

 <resource-ref id="ResourceRef_1160546934203">
  <description>
  </description>
  <res-ref-name>jdbc/MyDB</res-ref-name>
  <res-type>javax.sql.DataSource</res-type>
  <res-auth>Container</res-auth>
  <res-sharing-scope>Shareable</res-sharing-scope>
 </resource-ref> 

3. 如果ibm-web-bnd.xmi、ibm-web-ext.xmi文件已经存在，经跳过此步骤。在WEB-INF目录中增加针对JDNI配置的扩展文件：ibm-web-bnd.xmi、ibm-web-ext.xmi

ibm-web-bnd.xmi
<?xml version="1.0" encoding="UTF-8"?>
<webappbnd:WebAppBinding xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:webappbnd="webappbnd.xmi" xmi:id="WebAppBinding_1158741148984" virtualHostName="default_host">
  <webapp href="WEB-INF/web.xml#WebApp_ID"/>
  <resRefBindings xmi:id="ResourceRefBinding_1160546934203" jndiName="jdbc/MyDB">
    <bindingResourceRef href="WEB-INF/web.xml#ResourceRef_1160546934203"/>
  </resRefBindings>
</webappbnd:WebAppBinding>

ibm-web-ext.xmi
<?xml version="1.0" encoding="UTF-8"?>
<webappext:WebAppExtension xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:webappext="webappext.xmi" xmi:id="WebAppExtension_1158741148984" reloadInterval="3" reloadingEnabled="true" additionalClassPath="" fileServingEnabled="true" directoryBrowsingEnabled="false" serveServletsByClassnameEnabled="true">
  <webApp href="WEB-INF/web.xml#WebApp_ID"/>
</webappext:WebAppExtension>


4. 将上面更改过或者新加的文件重新打入文件包cis1019.war，注意其目录不能变。

应用部署
推荐使用RAD或者AST将war文件打包成EAR再发布。如果不具备工具，需要直接发布WAR文件，请参考如下步骤：
1. 利用FTP工具将应用文件包cis1019.war上传至WAS所在的服务器。本例中是上传至/hk/6_app目录
2. 进入管理控制台，在左边的菜单栏目中点击“应用程序 > 企业应用程序”，然后在右边的“企业应用程序”页面上点击“安装”，如下图：
 

3. 出现如下页面，选择“远程文件系统”，并在“完整路径”一栏输入（或选择）“/hk/6_app/cis1019.war”， 在“上下文根”一栏输入“/”，点击“下一步”：
 

4. 出现如下页面，点击“下一步”：
 

5. 出现如下页面，选中模块“cis1019.war”，再在“集群和服务器”一栏中选中“webserver1”和“server1”（按住Ctrl键），点击“应用”按钮，然后在下面的表格中，查看模块“cis1019.war”的“服务器”一栏是否已经变成“webserver1”和“server1”这两项。如果是，点击“下一步”：
 

6. 出现如下页面，点击“下一步”：
 

7. 出现如下页面，等待片刻后显示“安装成功”，点击“保存”：
 

8. 出现如下页面，点击“DefaultApplication”（从该步骤开始到第13步，都是为了停掉应用“DefaultApplication”，因为该应用的context root也为“/”，和我们发布的应用冲突。
 还有一个更直接的方法，删除“DefaultApplication”应用程序，本文不予讨论，可以自行决定是否采用该方法）：
 

9. 出现如下页面，点击“特定于目标的应用程序状态”：
 

10. 出现如下页面，选中“server1”，点击“禁用自动启动”：
 

11. 在出现的页面上点击“保存”；

12. 出现如下页面，点击“企业应用程序”（位于页面顶端）：
 

13. 出现如下页面，选中“DefaultApplication”，点击“停止”：
 

14. 出现如下页面，显示“DefaultApplication”成功停止。选中“cis1019_war”，点击“启动”：
 

15. 出现如下页面，显示cis1019_war启动成功：
 

验证WAS安装和配置：
检查应用安装： http://11.245.0.161:9080/
应用页面应该正常出现。

重新生成插件，从IHS作为入口访问应用
1. 生成插件：在WAS控制台上，选择“服务器 > Web服务器”，选中webserver1，点击“生成插件”：
 

2. 出现如下页面，注意在“消息”一栏中会显示，plugin-cfg.xml文件位于哪个目录下：
 
3. 按“消息”一栏中的提示进入目录：
/usr/IBM/WebSphere/AppServer/profiles/CISFE/config/cells/shcisa_bt2Node01Cell/nodes/11.246.8.13-node/servers/webserver1
将文件plugin-cfg.xml通过ftp拷贝至IHS所在服务器11.246.8.13的如下目录：
/opt/IBM/HTTPServer/Plugins/config/webserver1
4. 如果因为某些原因，WAS所在服务器的主机名不能加到IHS服务器的hosts文件中，使IHS所在的服务器只能通过IP地址访问WAS，则需要在IHS服务器11.246.8.13的目录/opt/IBM/HTTPServer/Plugins/config/webserver1下修改文件plugin-cfg.xml：
将类似如下的内容：
<Transport Hostname="shcisa" Port="9080" Protocol="http"/>
<Transport Hostname="shcisa" Port="9443" Protocol="https">
修改为：
<Transport Hostname="11.245.0.161" Port="9080" Protocol="http"/>
<Transport Hostname="11.245.0.161" Port="9443" Protocol="https">

注意黑体字部分，即为把机器名改为IP。

5. 重启HIS：进入目录/opt/IBM/HTTPServer/bin，执行如下命令：
./apachectl stop
./apachectl start

6. 输入如下URL验证：http://11.246.8.13/
应用首页应该正常显示

WAS参数设置和调整
本章节讨论的是WAS的参数设置。其中部分参数，必须要结合运行环境的实际情况来调整，例如Web Container的线程池大小、数据源连接池大小、语句高速缓存大小（Prepared statement cache size)，这几项参数都很重要，要结合实际的并发量和服务器的资源利用情况进行调整。目前本章节设置的值是根据开发项目组在平时测试中的经验得出。将来是否要更改请参见最后的“资源监控和参数调整方法”章节。
1. JVM参数：
a) 进入WAS的管理控制台
b) 在左边的菜单栏中点击“服务器 > 应用程序服务器”，然后在右边的应用服务器页面上点击“server1”：
 

c) 出现如下页面，找到“服务器基础结构”一栏，展开“Java和进程管理”，点击“进程定义”：
 

d) 出现如下页面，在“其他属性”一栏点击“Java虚拟机”：
 

e) 出现如下页面，设置server1的JVM堆大小：初始堆大小为512M，最大堆大小为1024M。注意下图中红色椭园形中的“详细垃圾回收”选择框：建议先不打开“详细垃圾回收”，如下图所示。如果未来在运行过程中出现“Out of memory”这样的错误，再在此位置选中该选择框。
 

f) 在页面底部点击“确定”
g) 在出现的页面上点击“保存”

2. 更改WAS HeapDump和Core文件的路径：在WAS的运行环境中，可能会因为“Out of memory”之类的异常产生Heap Dump，这会生成很大的HeapDump文件和Core文件，缺省生成在概要文件CISFE的目录下（/usr/IBM/WebSphere/AppServer/profiles/CISFE）。当出现这种情况时，迅速增长的HeapDump文件和Core文件有可能会把/usr文件系统占满，为了避免这种情况的发生，我们需要修改该缺省目录到共享盘阵上。
a) 选择“服务器 > 应用程序服务器”，点击“server1”，出现如下页面，展开“Java和进程管理”，点击“进程定义”：
 
b) 出现如下页面，点击“环境条目”：
 

c) 出现如下页面，点击“新建”：
 
d) 出现如下页面，输入如下内容，点击“确定”：
名称： IBM_HEAPDUMP
值：  true
 

e) 按照步骤c)和d)的方法，新建下列条目；
注意，HA中的A机和B机所填写的值略有不同，主要体现在路径上，如下表所示：
名称 值 （A机）
IBM_HEAP_DUMP true
IBM_HEAPDUMPDIR /var/cisfe/hostA/WASHeapDump
IBM_HEAPDUMP_OUTOFMEMORY true
IBM_JAVADUMP_OUTOFMEMORY true
IBM_JAVA_HEAPDUMP_TXT true
IBM_JAVACOREDIR /var/cisfe/hostA/WASHeapDump
f) 条目创建完毕，出现如下页面。请参照该页面核对参数是否创建完成：
 

g) 在出现的页面上点击“保存”：
3. Web容器线程池：
a) 选择“服务器 > 应用程序服务器 > server1 > 线程池”：
 
b) 在如下页面上，点击“WebContainer”：
 

c) 在如下页面上，确认“最小大小”值为默认的“10”，更改“最大大小”值为“100”：
 

4. 修改数据源连接池大小
a) 选择“资源 > JDBC > 数据源”，并在右边页面上确认作用域是“……服务器=server1”级别，如下图所示。点击“MyDB”：
 
b) 出现如下页面，点击“连接池属性”：
 
c) 出现如下页面，修改两个参数： “最大连接数”改为25，“最小连接数”改为15，然后点击“确定”：
 

d) 出现如下页面，点击“WebSphere Application Server 数据源属性”：
 
e) 出现如下页面，修改“语句高速缓存大小”（Prepared statement cache size)的值为：30，点击“确定”：
 

f) 在出现的页面上点击“保存”；

5. 修改日志的目录：
a) 选择“故障诊断 > 日志和跟踪”，点击“server1”：
 

b) 出现如下页面，点击“JVM日志”：
 

c) 出现如下页面，找到System.out栏，修改“文件大小 最大大小”的值为20，“历史日志文件的最大数”的值为10，如下图所示：
 

d) 滚动该页面到底部，找到System.err栏，修改“文件大小 最大大小”的值为10，“历史日志文件的最大数”的值为5，如下图所示，点击“确定”：
 

e) 选择“环境 > WebSphere变量”，在右边的页面上选择“作用域”为节点，如下图所示的“节点=shcisaNode”：
 

f) 出现如下页面，点击“LOG_ROOT”：
 

g) 出现如下页面，将“LOG_ROOT”的值从“${USER_INSTALL_ROOT}/logs”改为“/var/cisfe/hostA”，点击“确定”：
 

h) 在出现的页面上点击“保存”。

6. 修改事务日志的路径：
a) 选择：服务器 > 应用服务器”，点击“server1”，然后出现如下页面，在“容器设置”一栏展开“容器服务器”，点击“事务服务”：
 

b) 出现如下页面，在“事务日志目录”一栏输入“${SERVER_LOG_ROOT}/TransactionLog”，点击“确定”：
 
c) 在出现的页面上点击“保存”。
7. 所有参数设置完毕请重启WAS，重启方法请参见“停止和启动WAS的方法”章节。
停止和启动WAS的方法
1. 停止WAS(server1进程)：
进入目录/usr/IBM/WebSphere/AppServer/profiles/CISFE/bin，执行stopServer.sh server1，在提示Username和Password时，输入“admin”和“password”。命令如下：
cd /usr/IBM/WebSphere/AppServer/profiles/CISFE/bin
./stopServer.sh server1
或者使用一行命令，不进行交互：
./stopServer.sh server1 -username admin -password password
提示：如果因为某些异常无法正常停止，可以采用杀进程的方法：
执行命令：ps Cef | grep java
从显示的进程信息中找到进程号<pid>，然后执行命令kill -9 <pid>。例如，pid是807080，则命令为：
Kill -9 807080
如果“ps Cef | grep java”显示的进程很多，无法确认哪个JAVA进程是WAS，可以到WAS系统日志的目录下（本例中是/var/cisfe/hostA/server1）找一个文件server1.pid（是文本文件），查看该文件的内容即可得到进程号。
2. 启动WAS(server1进程)：
进入目录/usr/IBM/WebSphere/AppServer/profiles/CISFE/bin，执行startServer.sh server1，。命令如下：
cd /usr/IBM/WebSphere/AppServer/profiles/CISFE/bin
./startServer.sh server1

查看系统日志
1. 如果WAS运行时出现异常，例如不能正常启动等问题，请查看WAS的系统日志。
2. 日志文件：
以HA的A机为例，日志目录为：/var/cisfe/hostA/server1，主要查看文件SystemOut.log和SystemErr.log
3. 如果从上述两个文件无法判断错误，请寻求IBM的技术支持。

资源监控和参数调整方法
1. 监控操作系统：由于我们的WAS和数据库服务器位于同一台服务器上，因此对操作系统的监控很重要。要监控的几个指标分别为：CPU、内存、硬盘（IO）等。监控最好请系统管理员操作。
2. 监控WAS：利用管理控制台上的Tivoli Performance Viewer（以下简称TPV）进行监控。
1) 进入WAS的管理控制台，在左边的菜单栏里选择“监视和调整 > 性能查看器 > 当前活动”，在右边的页面上点击“server1”：
 

2) 出现如下页面，会看到一个树形菜单。展开“server1 > 性能模块”：
 
3) 在“性能模块”中，我们主要查看JDBC连接池（选择应用用到的jdbc/MyDB），JVM运行时，线程池中的Web Container。如下图所示：
 
4) 选择完成后，滚动回树形菜单顶端，点击“查看模块”：
 
5) TPV是采用Adobe SVG显示图表。如果您的浏览器没有安装SVG插件，会弹出如下提示框，选择“确定”：
 
6) 出现如下页面，TPV会用图表显示您要监控的指标。数据每隔30秒刷新一次。如果觉得刷新频率不够快，可以更改。方法见后。
 
7) 向下滚动页面，会看到图的后面是数据表格，显示当前WAS里的运行情况。下图中红框标出的指标都是重点要看的。其中“UseTime”指的一个JDBC连接使用的平均时间，单位为“毫秒”。通过这些值的监控，可以发现WAS相关参数的设置是否合理。
当发现Web Container和JDBC连接池都用得很满，同时服务器的CPU利用率很低，就可适当增大池的设置（结合并发量来考虑增大多少）。但同时有一个很关键的注意事项：如果服务器的CPU利用率已经接近100%，就不要增大这些池了，反而还要缩小一些，这样可以使CPU的利用率降低一些，就能处理得快一些，还能减小等待和响应时间。
 
8) 可以在树状菜单中选择“摘要报告”，点击“Servlet”，来查看每个JSP和Servlet的运行情况，例如每个Servlet的平均响应时间（单位是毫秒）。
 

9) 如果要改变TPV图表的刷新频率，请在树形菜单中选择“设置”，点击“用户”，就能看到如下页面，在“刷新率”中选择新的刷新频率，最短为5秒：
 
3. 如果要知道更详细的TPV的使用方法、性能监控的指标和参数调整的指导，请访问IBM的WAS 6.1在线手册（InfoCenter）：
http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/index.jsp?topic=/com.ibm.websphere.nd.doc/info/welcome_nd.html
具体查看“Monitoring”和“Tuning performance”两个章节。
顶
0
踩